%% Generated by Sphinx.
\def\sphinxdocclass{jupyterBook}
\documentclass[letterpaper,10pt,english]{jupyterBook}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}
%% turn off hyperref patch of \index as sphinx.xdy xindy module takes care of
%% suitable \hyperpage mark-up, working around hyperref-xindy incompatibility
\PassOptionsToPackage{hyperindex=false}{hyperref}
%% memoir class requires extra handling
\makeatletter\@ifclassloaded{memoir}
{\ifdefined\memhyperindexfalse\memhyperindexfalse\fi}{}\makeatother

\PassOptionsToPackage{warn}{textcomp}

\catcode`^^^^00a0\active\protected\def^^^^00a0{\leavevmode\nobreak\ }
\usepackage{cmap}
\usepackage{fontspec}
\defaultfontfeatures[\rmfamily,\sffamily,\ttfamily]{}
\usepackage{amsmath,amssymb,amstext}
\usepackage{polyglossia}
\setmainlanguage{english}



\setmainfont{FreeSerif}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Italic,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldItalic
]
\setsansfont{FreeSans}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]
\setmonofont{FreeMono}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]



\usepackage[Bjarne]{fncychap}
\usepackage[,numfigreset=1,mathnumfig]{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}


\usepackage{sphinxmessages}



        % Start of preamble defined in sphinx-jupyterbook-latex %
         \usepackage[Latin,Greek]{ucharclasses}
        \usepackage{unicode-math}
        % fixing title of the toc
        \addto\captionsenglish{\renewcommand{\contentsname}{Contents}}
        \hypersetup{
            pdfencoding=auto,
            psdextra
        }
        % End of preamble defined in sphinx-jupyterbook-latex %
        

\title{Codebook for Web-scraping of State Legislative Info}
\date{Jan 16, 2023}
\release{}
\author{UMN UCSC AFRI Project}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{intro::doc}}


\sphinxAtStartPar
Web scraping is an interactive process between computers and websites using HyperText Markup Language (HTML). Through HTML, web scraping can use bots to extract content and data from websites. Several softwares, like Python, R, and STATA can be used to do web scraping. Here legislative information web scraping is achieved by Python.

\sphinxAtStartPar
In this codebook, special Python language terms like Python module, library, function,and syntax are all italic and texts in the box represent code. Full codes without interpretation are in the appendix.
\begin{itemize}
\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch1::doc}]{\sphinxcrossref{Ch 1 Webscraping tool setup}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch2::doc}]{\sphinxcrossref{Ch 2 Webscraping Targets and Strategies}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch3::doc}]{\sphinxcrossref{Ch 3 Alabama}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch4::doc}]{\sphinxcrossref{Ch 4 Alaska}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch5::doc}]{\sphinxcrossref{Ch 5 Arizona}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch6::doc}]{\sphinxcrossref{Ch 6 Arkansas}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch7::doc}]{\sphinxcrossref{Ch 7 California}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch8::doc}]{\sphinxcrossref{Ch 8 Colorado}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch9::doc}]{\sphinxcrossref{Ch 9 Connecticut}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch10::doc}]{\sphinxcrossref{Ch 10 Delaware}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch11::doc}]{\sphinxcrossref{Ch 11 District of Columbia}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch12::doc}]{\sphinxcrossref{Ch 12 Florida}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch13::doc}]{\sphinxcrossref{Ch 13 Georgia}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch14::doc}]{\sphinxcrossref{Ch 14 Hawaii}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch15::doc}]{\sphinxcrossref{Ch 15 Idaho}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch16::doc}]{\sphinxcrossref{Ch 16 Illinois}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch17::doc}]{\sphinxcrossref{Ch 17 Indiana}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch18::doc}]{\sphinxcrossref{Ch 18 Iowa}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch19::doc}]{\sphinxcrossref{Ch 19 Kansas}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch20::doc}]{\sphinxcrossref{Ch 20 Kentucky}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch21::doc}]{\sphinxcrossref{Ch 21 Louisiana}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch22::doc}]{\sphinxcrossref{Ch 21 Maine}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch23::doc}]{\sphinxcrossref{Ch 23 Maryland}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch24::doc}]{\sphinxcrossref{Ch 24 Massachusetts}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch25::doc}]{\sphinxcrossref{Ch 25 Michigan}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch26::doc}]{\sphinxcrossref{Ch 26 Minnesota}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch27::doc}]{\sphinxcrossref{Ch 27 Mississippi}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch28::doc}]{\sphinxcrossref{Ch 28 Missouri}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch29::doc}]{\sphinxcrossref{Ch 29 Montana}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch30::doc}]{\sphinxcrossref{Ch 30 Nebraska}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch31::doc}]{\sphinxcrossref{Ch 31 Nevada}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch32::doc}]{\sphinxcrossref{Ch 48 Vermont}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch33::doc}]{\sphinxcrossref{Ch 33 New Jersey}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch34::doc}]{\sphinxcrossref{Ch 34 New Mexico}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch35::doc}]{\sphinxcrossref{Ch 35 New York}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch36::doc}]{\sphinxcrossref{Ch 43 North Carolina}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch37::doc}]{\sphinxcrossref{Ch 46 North Dakota}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch38::doc}]{\sphinxcrossref{Ch 38 Ohio}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch39::doc}]{\sphinxcrossref{Ch 39 Oklahoma}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch40::doc}]{\sphinxcrossref{Ch 40 Oregon}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch41::doc}]{\sphinxcrossref{Ch 41 Pennsylvania}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch42::doc}]{\sphinxcrossref{Ch 42 Rhode Island}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch43::doc}]{\sphinxcrossref{Ch 43 South Carolina}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch44::doc}]{\sphinxcrossref{Ch 44 South Dakota}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch45::doc}]{\sphinxcrossref{Ch 45 Tennessee}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch46::doc}]{\sphinxcrossref{Ch 46 Texas}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch47::doc}]{\sphinxcrossref{Ch 48 Utah}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch48::doc}]{\sphinxcrossref{Ch 48 Vermont}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch49::doc}]{\sphinxcrossref{Ch 49 Virginia}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch50::doc}]{\sphinxcrossref{Ch 50 Washington}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch51::doc}]{\sphinxcrossref{Ch 51 West Virginia}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch52::doc}]{\sphinxcrossref{Ch 52 Wisconsin}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{ch53::doc}]{\sphinxcrossref{Ch 53 Wyoming}}}

\end{itemize}

\sphinxstepscope


\chapter{Ch 1 Webscraping tool setup}
\label{\detokenize{ch1:ch-1-webscraping-tool-setup}}\label{\detokenize{ch1::doc}}
\sphinxAtStartPar
In this chapter, we introduce the webscraping tool set.


\section{Python Language}
\label{\detokenize{ch1:python-language}}
\sphinxAtStartPar
Python is a programming language that lets you work more quickly and integrate your systems more effectively (\sphinxurl{https://www.python.org/}).


\section{IDEs}
\label{\detokenize{ch1:ides}}
\sphinxAtStartPar
An IDE (Integrated Development Environment) understand your code much better than a text editor. It usually provides features such as build automation, code linting, testing and debugging. This can significantly speed up your work. The downside is that IDEs can be complicated to use. There are several IDEs that users can consider. Here we recommend


\section{Libraries}
\label{\detokenize{ch1:libraries}}
\sphinxAtStartPar
A Python library, like packages in R, is a reusable chunk of code to save time. Several useful libraries are needed to install for Python to run this script.

\sphinxAtStartPar
Selenium is a powerful web scraping tool by automating browsers to load the target website, retrieve the required data, and take screenshots or assert that certain actions happen on the website. This script relies heavily on Selenium. In addition to Selenium, we also need to import other necessary packages such as pandas,time, os, PyPDF2, glob, pick

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} import libraries}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 2 Webscraping Targets and Strategies}
\label{\detokenize{ch2:ch-2-webscraping-targets-and-strategies}}\label{\detokenize{ch2::doc}}
\sphinxAtStartPar
Our goal is to webscrape all session laws during 1975\sphinxhyphen{}2022 from state\sphinxhyphen{}level legislature websites. The General and Special Laws of Texas, often referred to as the “session laws,” constitute a complete set of all bills passed into law by each session of the state legislature.Session laws are organized into chapters, with each chapter consisting of a single “Act,” or bill. As bills are passed into law during a legislative session, the Secretary of State assigns each Act a corresponding chapter number.


\begin{savenotes}\sphinxatlongtablestart\begin{longtable}[c]{|l|l|l|l|}
\hline
\sphinxstyletheadfamily 
\sphinxAtStartPar
Name
&\sphinxstyletheadfamily 
\sphinxAtStartPar
FIPS State Numeric Code
&\sphinxstyletheadfamily 
\sphinxAtStartPar
Official USPS Code
&\sphinxstyletheadfamily 
\sphinxAtStartPar
Website Address
\\
\hline
\endfirsthead

\multicolumn{4}{c}%
{\makebox[0pt]{\sphinxtablecontinued{\tablename\ \thetable{} \textendash{} continued from previous page}}}\\
\hline
\sphinxstyletheadfamily 
\sphinxAtStartPar
Name
&\sphinxstyletheadfamily 
\sphinxAtStartPar
FIPS State Numeric Code
&\sphinxstyletheadfamily 
\sphinxAtStartPar
Official USPS Code
&\sphinxstyletheadfamily 
\sphinxAtStartPar
Website Address
\\
\hline
\endhead

\hline
\multicolumn{4}{r}{\makebox[0pt][r]{\sphinxtablecontinued{continues on next page}}}\\
\endfoot

\endlastfoot

\sphinxAtStartPar
Alabama
&
\sphinxAtStartPar
1
&
\sphinxAtStartPar
AL
&
\sphinxAtStartPar
\sphinxurl{https://arc-sos.state.al.us/CGI/actyear.mbr/input}
\\
\hline
\sphinxAtStartPar
Alaska
&
\sphinxAtStartPar
2
&
\sphinxAtStartPar
AK
&
\sphinxAtStartPar
\sphinxurl{http://www.akleg.gov/basis/Home/BillsandLaws}
\\
\hline
\sphinxAtStartPar
Arizona
&
\sphinxAtStartPar
4
&
\sphinxAtStartPar
AZ
&
\sphinxAtStartPar
\sphinxurl{https://apps.azleg.gov/BillStatus/BillOverview?Sessionid=123}
\\
\hline
\sphinxAtStartPar
Arkansas
&
\sphinxAtStartPar
5
&
\sphinxAtStartPar
AR
&
\sphinxAtStartPar
\sphinxurl{https://www.arkleg.state.ar.us/Acts/}
\\
\hline
\sphinxAtStartPar
California
&
\sphinxAtStartPar
6
&
\sphinxAtStartPar
CA
&
\sphinxAtStartPar
\sphinxurl{https://leginfo.legislature.ca.gov/faces/home.xhtml}
\\
\hline
\sphinxAtStartPar
Colorado
&
\sphinxAtStartPar
8
&
\sphinxAtStartPar
CO
&
\sphinxAtStartPar
\sphinxurl{https://leg.colorado.gov/bills}
\\
\hline
\sphinxAtStartPar
Connecticut
&
\sphinxAtStartPar
9
&
\sphinxAtStartPar
CT
&
\sphinxAtStartPar
\sphinxurl{https://www.cga.ct.gov/asp/menu/legdownload.asp}
\\
\hline
\sphinxAtStartPar
Delaware
&
\sphinxAtStartPar
10
&
\sphinxAtStartPar
DE
&
\sphinxAtStartPar
\sphinxurl{https://legis.delaware.gov/AllLegislation}
\\
\hline
\sphinxAtStartPar
District of Columbia
&
\sphinxAtStartPar
11
&
\sphinxAtStartPar
DC
&
\sphinxAtStartPar
\sphinxurl{https://lims.dccouncil.us/searchresult/}
\\
\hline
\sphinxAtStartPar
Florida
&
\sphinxAtStartPar
12
&
\sphinxAtStartPar
FL
&
\sphinxAtStartPar
\sphinxurl{http://www.leg.state.fl.us/Welcome/index.cfm}
\\
\hline
\sphinxAtStartPar
Georgia
&
\sphinxAtStartPar
13
&
\sphinxAtStartPar
GA
&
\sphinxAtStartPar
\sphinxurl{https://www.legis.ga.gov/legislation/all}
\\
\hline
\sphinxAtStartPar
Hawaii
&
\sphinxAtStartPar
15
&
\sphinxAtStartPar
HI
&
\sphinxAtStartPar
\sphinxurl{https://www.capitol.hawaii.gov/}
\\
\hline
\sphinxAtStartPar
Idaho
&
\sphinxAtStartPar
16
&
\sphinxAtStartPar
ID
&
\sphinxAtStartPar
\sphinxurl{https://legislature.idaho.gov/statutesrules/sessionlaws/}
\\
\hline
\sphinxAtStartPar
Illinois
&
\sphinxAtStartPar
17
&
\sphinxAtStartPar
IL
&
\sphinxAtStartPar
\sphinxurl{https://www.ilga.gov/previousga.asp}
\\
\hline
\sphinxAtStartPar
Indiana
&
\sphinxAtStartPar
18
&
\sphinxAtStartPar
IN
&
\sphinxAtStartPar
\sphinxurl{http://iga.in.gov/results/}
\\
\hline
\sphinxAtStartPar
Iowa
&
\sphinxAtStartPar
19
&
\sphinxAtStartPar
IA
&
\sphinxAtStartPar
\sphinxurl{https://www.legis.iowa.gov/legislation/billTracking}
\\
\hline
\sphinxAtStartPar
Kansas
&
\sphinxAtStartPar
20
&
\sphinxAtStartPar
KS
&
\sphinxAtStartPar
\sphinxurl{http://www.kslegislature.org/li/historical/}
\\
\hline
\sphinxAtStartPar
Kentucky
&
\sphinxAtStartPar
21
&
\sphinxAtStartPar
KY
&
\sphinxAtStartPar
\sphinxurl{https://legislature.ky.gov/Law/Pages/KyActs.aspx}
\\
\hline
\sphinxAtStartPar
Louisiana
&
\sphinxAtStartPar
22
&
\sphinxAtStartPar
LA
&
\sphinxAtStartPar
\sphinxurl{https://www.legis.la.gov/Legis/SessionInfo/SessionInfo.aspx}
\\
\hline
\sphinxAtStartPar
Maine
&
\sphinxAtStartPar
23
&
\sphinxAtStartPar
ME
&
\sphinxAtStartPar
\sphinxurl{https://legislature.maine.gov/ros/LOM/LOMpdfDirectory.htm}
\\
\hline
\sphinxAtStartPar
Maryland
&
\sphinxAtStartPar
24
&
\sphinxAtStartPar
MD
&
\sphinxAtStartPar
\sphinxurl{http://mgaleg.maryland.gov/mgawebsite/Search/FullText}
\\
\hline
\sphinxAtStartPar
Massachusetts
&
\sphinxAtStartPar
25
&
\sphinxAtStartPar
MA
&
\sphinxAtStartPar
\sphinxurl{https://malegislature.gov/Laws/SessionLaws}
\\
\hline
\sphinxAtStartPar
Michigan
&
\sphinxAtStartPar
26
&
\sphinxAtStartPar
MI
&
\sphinxAtStartPar
\sphinxurl{https://www.legislature.mi.gov/}
\\
\hline
\sphinxAtStartPar
Minnesota
&
\sphinxAtStartPar
27
&
\sphinxAtStartPar
MN
&
\sphinxAtStartPar
\sphinxurl{https://www.revisor.mn.gov/search/?search=stat}
\\
\hline
\sphinxAtStartPar
Mississippi
&
\sphinxAtStartPar
28
&
\sphinxAtStartPar
MS
&
\sphinxAtStartPar
\sphinxurl{http://billstatus.ls.state.ms.us/sessions.htm}
\\
\hline
\sphinxAtStartPar
Missouri
&
\sphinxAtStartPar
29
&
\sphinxAtStartPar
MO
&
\sphinxAtStartPar
\sphinxhref{https://house.mo.gov/LegislationSP.aspx?focusedID=Bill\%20List}{https://house.mo.gov/LegislationSP.aspx?focusedID=Bill List}
\\
\hline
\sphinxAtStartPar
Montana
&
\sphinxAtStartPar
30
&
\sphinxAtStartPar
MT
&
\sphinxAtStartPar
\sphinxhref{http://laws.leg.mt.gov/legprd/law0203w\%24.startup?P\_SESS=19991}{http://laws.leg.mt.gov/legprd/law0203w\$.startup?P\_SESS=19991}
\\
\hline
\sphinxAtStartPar
Nebraska
&
\sphinxAtStartPar
31
&
\sphinxAtStartPar
NE
&
\sphinxAtStartPar
\sphinxurl{https://nebraskalegislature.gov/laws/laws.php}
\\
\hline
\sphinxAtStartPar
Nevada
&
\sphinxAtStartPar
32
&
\sphinxAtStartPar
NV
&
\sphinxAtStartPar
\sphinxurl{https://www.leg.state.nv.us/Site/Search/search.cfm}
\\
\hline
\sphinxAtStartPar
New Hampshire
&
\sphinxAtStartPar
33
&
\sphinxAtStartPar
NH
&
\sphinxAtStartPar
\sphinxurl{http://www.gencourt.state.nh.us/bill\_status/legacy/bs2016/}
\\
\hline
\sphinxAtStartPar
New Jersey
&
\sphinxAtStartPar
34
&
\sphinxAtStartPar
NJ
&
\sphinxAtStartPar
\sphinxurl{https://www.njleg.state.nj.us/bills/Bills\_ADVS.aspx}
\\
\hline
\sphinxAtStartPar
New Mexico
&
\sphinxAtStartPar
35
&
\sphinxAtStartPar
NM
&
\sphinxAtStartPar
\sphinxurl{https://www.nmlegis.gov/Search}
\\
\hline
\sphinxAtStartPar
New York
&
\sphinxAtStartPar
36
&
\sphinxAtStartPar
NY
&
\sphinxAtStartPar
\sphinxurl{https://nyassembly.gov/leg/?sh=advanced}
\\
\hline
\sphinxAtStartPar
North Carolina
&
\sphinxAtStartPar
37
&
\sphinxAtStartPar
NC
&
\sphinxAtStartPar
\sphinxurl{https://www.ncleg.gov/Search/BillText/}
\\
\hline
\sphinxAtStartPar
North Dakota
&
\sphinxAtStartPar
38
&
\sphinxAtStartPar
ND
&
\sphinxAtStartPar
\sphinxurl{https://www.legis.nd.gov/search}
\\
\hline
\sphinxAtStartPar
Ohio
&
\sphinxAtStartPar
39
&
\sphinxAtStartPar
OH
&
\sphinxAtStartPar
\sphinxurl{https://www.legislature.ohio.gov/legislation/search/}
\\
\hline
\sphinxAtStartPar
Oklahoma
&
\sphinxAtStartPar
40
&
\sphinxAtStartPar
OK
&
\sphinxAtStartPar
\sphinxurl{http://www.oklegislature.gov/AdvancedSearchForm.aspx}
\\
\hline
\sphinxAtStartPar
Oregon
&
\sphinxAtStartPar
41
&
\sphinxAtStartPar
OR
&
\sphinxAtStartPar
\sphinxurl{https://www.oregonlegislature.gov/bills\_laws/Pages/Oregon-Laws.aspx}
\\
\hline
\sphinxAtStartPar
Pennsylvania
&
\sphinxAtStartPar
42
&
\sphinxAtStartPar
PA
&
\sphinxAtStartPar
\sphinxurl{https://www.legis.state.pa.us/cfdocs/legis/home/bills/}
\\
\hline
\sphinxAtStartPar
Rhode Island
&
\sphinxAtStartPar
44
&
\sphinxAtStartPar
RI
&
\sphinxAtStartPar
\sphinxurl{http://webserver.rilegislature.gov/search/}
\\
\hline
\sphinxAtStartPar
South Carolina
&
\sphinxAtStartPar
45
&
\sphinxAtStartPar
SC
&
\sphinxAtStartPar
\sphinxurl{https://www.scstatehouse.gov/query.php}
\\
\hline
\sphinxAtStartPar
South Dakota
&
\sphinxAtStartPar
46
&
\sphinxAtStartPar
SD
&
\sphinxAtStartPar
\sphinxurl{https://sdlegislature.gov/Statutes/Archived}
\\
\hline
\sphinxAtStartPar
Tennessee
&
\sphinxAtStartPar
47
&
\sphinxAtStartPar
TN
&
\sphinxAtStartPar
\sphinxurl{https://www.capitol.tn.gov/legislation/archives.html}
\\
\hline
\sphinxAtStartPar
Texas
&
\sphinxAtStartPar
48
&
\sphinxAtStartPar
TX
&
\sphinxAtStartPar
\sphinxurl{https://lrl.texas.gov/legis/billsearch/lrlhome.cfm}
\\
\hline
\sphinxAtStartPar
Utah
&
\sphinxAtStartPar
49
&
\sphinxAtStartPar
UT
&
\sphinxAtStartPar
\sphinxurl{https://le.utah.gov/asp/passedbills/passedbills.asp}
\\
\hline
\sphinxAtStartPar
Vermont
&
\sphinxAtStartPar
50
&
\sphinxAtStartPar
VT
&
\sphinxAtStartPar
\sphinxurl{https://legislature.vermont.gov/bill/search/2022}
\\
\hline
\sphinxAtStartPar
Virginia
&
\sphinxAtStartPar
51
&
\sphinxAtStartPar
VA
&
\sphinxAtStartPar
\sphinxurl{https://lis.virginia.gov/cgi-bin/legp604.exe?941+men+BIL}
\\
\hline
\sphinxAtStartPar
Washington
&
\sphinxAtStartPar
53
&
\sphinxAtStartPar
WA
&
\sphinxAtStartPar
\sphinxurl{http://search.leg.wa.gov/search.aspx\#document}
\\
\hline
\sphinxAtStartPar
West Virginia
&
\sphinxAtStartPar
54
&
\sphinxAtStartPar
WV
&
\sphinxAtStartPar
\sphinxurl{https://www.wvlegislature.gov/Bill\_Status/bill\_status.cfm}
\\
\hline
\sphinxAtStartPar
Wisconsin
&
\sphinxAtStartPar
55
&
\sphinxAtStartPar
WI
&
\sphinxAtStartPar
\sphinxurl{https://docs.legis.wisconsin.gov/search}
\\
\hline
\sphinxAtStartPar
Wyoming
&
\sphinxAtStartPar
56
&
\sphinxAtStartPar
WY
&
\sphinxAtStartPar
\sphinxurl{https://www.wyoleg.gov/Legislation/archives}
\\
\hline
\end{longtable}\sphinxatlongtableend\end{savenotes}

\sphinxAtStartPar
Since each state\sphinxhyphen{}level legislature website has different website structure, we adopted three different webscraping strategies: (i) direct webscraping, (ii) downloading act PDF files and extraction, and (iii) mixing them.


\section{Direct Webscraping}
\label{\detokenize{ch2:direct-webscraping}}
\sphinxAtStartPar
Some legislature websites store acts on their websites as html files or PDF files. So, we can webscrape acts’ full texts directly.

\sphinxAtStartPar
\sphinxincludegraphics{{ca}.png}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} Direct Webscraping Roadmap
├── Go to the website
├── Find the act full text
├── Save the text
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Downloading act PDF files and extraction}
\label{\detokenize{ch2:downloading-act-pdf-files-and-extraction}}
\sphinxAtStartPar
For some legislature websites with acts stored as PDF files, we adopted the strategy to download all act PDF files and extract full texts from PDF files. See {[}link{]}\sphinxurl{https://www.arkleg.state.ar.us/Acts/SearchByRange}.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} Downloading act PDF files and extraction roadmap
├── Go to the website
├── Download act PDF files
├── Extract acts from PDF files
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
\sphinxincludegraphics{{ar_pdf}.png}

\sphinxstepscope


\chapter{Ch 3 Alabama}
\label{\detokenize{ch3:ch-3-alabama}}\label{\detokenize{ch3::doc}}
\sphinxAtStartPar
Alabama Legislature website stores all acts passed in Alabama. The web address is \sphinxurl{https://arc-sos.state.al.us/CGI/actyear.mbr/input}.

\sphinxAtStartPar
\sphinxincludegraphics{{al}.png}

\sphinxAtStartPar
There are three types of law sessions including regular session, special session and special organization session. All enrolled bills are named by “HB”,”SB”,”SR”,”HR”,”SJR”, or “HJR” plus bill number and ended with “\sphinxhyphen{}enr”. They are stored as pdf files on Alabama Secretary of State website. You can check the acts on \sphinxhref{https://alison.legislature.state.al.us/acts}{Alabama Legislature website}.


\section{import libraries}
\label{\detokenize{ch3:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch3:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gt}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}
\PYG{n+ne}{FileNotFoundError}\PYG{g+gWhitespace}{                         }Traceback (most recent call last)
\PYG{n+nn}{/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb Cell 7} in \PYG{n+ni}{\PYGZlt{}cell line: 4\PYGZgt{}}\PYG{n+nt}{()}
      \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=0}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{1}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/to/driver}\PYG{l+s+s1}{\PYGZsq{}}
      \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{3}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{c+c1}{\PYGZsh{} Change the working directory}
\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZgt{}} \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=3}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{4}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
      \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=5}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{6}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
      \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=6}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{7}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{c+c1}{\PYGZsh{} Print the current working directory}

\PYG{n+ne}{FileNotFoundError}: [Errno 2] No such file or directory: \PYGZsq{}/yourpath/\PYGZsq{}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch3:pdf-file-download}}
\sphinxAtStartPar
As shown on \sphinxhref{http://alisondb.legislature.state.al.us/Alison/SelectSession.aspx}{Alabama Legislature website}, all sessions are stored since 2000. We scraped all passed acts since 2000 within a loop using the code \sphinxcode{\sphinxupquote{for yr in range(2000, 2023)}}. There are four types of sessions including regular session (RS), first special session (FS), second special session (SS), and organizational session (OS). For these session types, we had the loop \sphinxcode{\sphinxupquote{for st in ("RS","FS","SS","OS")}}. For acts, there are also six types based on the act sponsor including “HB”, “SB”, “SR”, “HR”, “SJR”, “HJR”. All act PDF files, i.e., enrolled bills are files with the pattern: \sphinxurl{http://alisondb.legislature.state.al.us/ALISON/SearchableInstruments/} + year + session type + “/PrintFiles/” + act type + order number + “\sphinxhyphen{}enr.pdf”. Using this pattern, we can download all act PDF files.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{for} \PYG{n}{yr} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2000}\PYG{p}{,}\PYG{l+m+mi}{2023}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{yr}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{n} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1000}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{for} \PYG{n}{t} \PYG{o+ow}{in} \PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{HB}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{SB}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{SR}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{HR}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{SJR}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{HJR}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{for} \PYG{n}{st} \PYG{o+ow}{in} \PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{RS}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{FS}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{SS}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{OS}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{:}
                \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://alisondb.legislature.state.al.us/ALISON/SearchableInstruments/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{yr}\PYG{p}{)} \PYG{o}{+} \PYG{n}{st} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/PrintFiles/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{t} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{n}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}enr.pdf}\PYG{l+s+s2}{\PYGZdq{}}
                \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
                \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mf}{0.001}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch3:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{badfiles} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
            \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
        \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
        \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{badfiles}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                           \PYG{n}{keep}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AL\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AL\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AL\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AL\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 4 Alaska}
\label{\detokenize{ch4:ch-4-alaska}}\label{\detokenize{ch4::doc}}
\sphinxAtStartPar
The Alaska State Legislature store all acts passed in Alabama. The web address is \sphinxurl{https://www.akleg.gov/basis/Home/BillsandLaws}.

\sphinxAtStartPar
\sphinxincludegraphics{{ak}.png}


\section{import libraries}
\label{\detokenize{ch4:import-libraries}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch4:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 5 Arizona}
\label{\detokenize{ch5:ch-5-arizona}}\label{\detokenize{ch5::doc}}
\sphinxstepscope


\chapter{Ch 6 Arkansas}
\label{\detokenize{ch6:ch-6-arkansas}}\label{\detokenize{ch6::doc}}
\sphinxAtStartPar
Arkansas State Legislature Website store all acts passed in Alabama. The web address is \sphinxhref{https://www.arkleg.state.ar.us/Acts/Search?ddBienniumSession=2021\%2F2022F}{https://www.arkleg.state.ar.us/Acts/Search?ddBienniumSession=2021/2022F}.

\sphinxAtStartPar
\sphinxincludegraphics{{ar_web}.png}

\sphinxAtStartPar
We can search all acts on \DUrole{xref,myst}{Arkansas State Legislature}. \sphinxhref{https://www.arkleg.state.ar.us/Acts/Search?tbType=\&ddBienniumSession=2021\%2F2022F\&bienniumAll=on\&hdnSessions=on\%2Cb2023\%2Cz2023R\%2Cb2021\%2Cz2021R\%2Cz2021S1\%2Cz2021S2\%2Cz2022F\%2Cz2022S3\%2Cb2019\%2Cz2019R\%2Cz2020F\%2Cz2020S1\%2Cb2017\%2Cz2017R\%2Cz2017S1\%2Cz2018F\%2Cz2018S2\%2Cb2015\%2Cz2015R\%2Cz2015S1\%2Cz2016F\%2Cz2016S2\%2Cz2016S3\%2Cb2013\%2Cz2013R\%2Cz2013S1\%2Cz2014F\%2Cz2014S2\%2Cb2011\%2Cz2011R\%2Cz2012F\%2Cb2009\%2Cz2009R\%2Cz2010F\%2Cb2007\%2Cz2007R\%2Cz2008S1\%2Cb2005\%2Cz2005R\%2Cz2006S1\%2Cb2003\%2Cz2003R\%2Cz2003S1\%2Cz2003S2\%2Cb2001\%2Cz2001R\%2Cz2002S1\%2Cb1999\%2Cz1999R\%2Cz1999S1\%2Cz2000S2\%2Cb1997\%2Cz1997R\%2Cb1995\%2Cz1995R\%2Cz1995S1\%2Cb1993\%2Cz1993R\%2Cz1993S1\%2Cz1994S2\%2Cb1991\%2Cz1991R\%2Cz1991S1\%2Cz1991S2\%2Cb1989\%2Cz1989R\%2Cz1989S1\%2Cz1989S2\%2Cz1989S3\%2Cb1987\%2Cz1987R\%2Cz1987S1\%2Cz1987S2\%2Cz1987S3\%2Cz1987S4\%2C\&ddChamber=A\&tbActNumber=\&tbBillNumber=\&ddSponsor=\&tbAllWords=\&tbExactPhrase=\&tbOneWord=\&tbWithoutWords=\&ddExclusivity=Only}{This papg} shows all acts stored on Arkansas State Legislature Website. On the website, all acts are stored as PDF files. So, the goal is to download all act PDF files and extract full texts from PDF files.


\section{import libraries}
\label{\detokenize{ch6:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch6:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch6:pdf-file-download}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.arkleg.state.ar.us/Acts/Search?tbType=\PYGZam{}ddBienniumSession=2021}\PYG{l+s+si}{\PYGZpc{}2F}\PYG{l+s+s2}{2022F\PYGZam{}bienniumAll=on\PYGZam{}hdnSessions=on}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cb2021}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2021R}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2021S1}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2021S2}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2022F}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cb2019}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2019R}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2020F}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2020S1}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cb2017}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2017R}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2017S1}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2018F}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2018S2}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cb2015}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2015R}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2015S1}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2016F}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2016S2}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2016S3}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cb2013}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2013R}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2013S1}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2014F}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2014S2}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cb2011}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2011R}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2012F}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cb2009}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2009R}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2010F}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cb2007}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2007R}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2008S1}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cb2005}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2005R}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2006S1}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cb2003}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2003R}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2003S1}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2003S2}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cb2001}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2001R}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2002S1}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cb1999}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1999R}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1999S1}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz2000S2}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cb1997}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1997R}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cb1995}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1995R}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1995S1}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cb1993}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1993R}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1993S1}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1994S2}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cb1991}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1991R}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1991S1}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1991S2}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cb1989}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1989R}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1989S1}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1989S2}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1989S3}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cb1987}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1987R}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1987S1}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1987S2}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1987S3}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2Cz1987S4}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{2C\PYGZam{}ddChamber=A\PYGZam{}tbActNumber=\PYGZam{}tbBillNumber=\PYGZam{}ddSponsor=\PYGZam{}tbAllWords=\PYGZam{}tbExactPhrase=\PYGZam{}tbOneWord=\PYGZam{}tbWithoutWords=\PYGZam{}ddExclusivity=Only}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(3)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(4)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(5)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(6)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(7)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(8)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(9)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(10)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(11)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(12)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(13)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(14)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(15)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(16)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(17)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(18)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(19)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(20)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(21)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{71}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(4)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(5)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(6)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(7)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(8)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(9)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(10)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(11)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(12)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(13)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(14)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(15)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(16)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(17)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(18)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(19)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(20)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(21)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}advancedResults \PYGZgt{} div.row.tableSectionFooter \PYGZgt{} div \PYGZgt{} a:nth\PYGZhy{}child(22)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,}
                                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}advancedResults \PYGZgt{} div \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}1.meetingButtons.leftAlign.noPrint \PYGZgt{} a:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{PARTIAL\PYGZus{}LINK\PYGZus{}TEXT}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{›}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}

\PYG{n}{urlsnew} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n+nb}{dict}\PYG{o}{.}\PYG{n}{fromkeys}\PYG{p}{(}\PYG{n}{urls}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{i}\PYG{p}{,}\PYG{n}{url} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{urlsnew}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mf}{0.1}\PYG{o}{*}\PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch6:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{badfiles} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
            \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
        \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
        \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{badfiles}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                           \PYG{n}{keep}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AR\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AR\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AR\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AR\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 7 California}
\label{\detokenize{ch7:ch-7-california}}\label{\detokenize{ch7::doc}}
\sphinxAtStartPar
\sphinxhref{https://leginfo.legislature.ca.gov/faces/advance/advance.xhtml}{California Legislative information} is an official website that stores all acts passed in California. The web address is \sphinxurl{https://leginfo.legislature.ca.gov/faces/home.xhtml}.

\sphinxAtStartPar
\sphinxincludegraphics{{ca_web}.png}

\sphinxAtStartPar
California Legislative information Website provides \sphinxhref{https://leginfo.legislature.ca.gov/faces/advance/advance.xhtml}{\sphinxstyleemphasis{Advanced Search}} function. Through selecting all sessions as shown below, we can get all bills information available on the website. Under the column \sphinxstyleemphasis{Status}, we can tell which bill is chaptered, i.e.,becoming a law. Then, the task of webscraping is to extract the information of all chaptered bills on the website.

\sphinxAtStartPar
\sphinxincludegraphics{{ca_search}.png}


\section{import libraries}
\label{\detokenize{ch7:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch7:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Direct webscraping}
\label{\detokenize{ch7:direct-webscraping}}
\sphinxAtStartPar
As shown on \sphinxhref{https://leginfo.legislature.ca.gov/faces/advance/advance.xhtml}{California Legislative information Website} after searching all sessions, we can see returned bills one by one. Clicking the bill under column \sphinxstyleemphasis{Measure}, there is the full text of the bill. For efficiency purposes, we first get all urls for chaptered bills and extract the full texts of the chaptered bills after clicking each url.


\subsection{Get all urls}
\label{\detokenize{ch7:get-all-urls}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{sessions} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2021 \PYGZhy{} 2022}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2019 \PYGZhy{} 2020}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2017 \PYGZhy{} 2018}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2015 \PYGZhy{} 2016}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2013 \PYGZhy{} 2014}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2011 \PYGZhy{} 2012}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2009 \PYGZhy{} 2010}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2007 \PYGZhy{} 2008}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2005 \PYGZhy{} 2006}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2003 \PYGZhy{} 2004}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2001 \PYGZhy{} 2002}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1999 \PYGZhy{} 2000}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}

\PYG{n}{urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{measures} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{subjects} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{authors} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{statuss} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{session} \PYG{o+ow}{in} \PYG{n}{sessions}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{session}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://leginfo.legislature.ca.gov/faces/billSearchClient.xhtml}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}attrSearch}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{select\PYGZus{}session} \PYG{o}{=} \PYG{n}{Select}\PYG{p}{(}\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{select\PYGZsh{}session\PYGZus{}year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}session}\PYG{o}{.}\PYG{n}{select\PYGZus{}by\PYGZus{}visible\PYGZus{}text}\PYG{p}{(}\PYG{n}{session}\PYG{p}{)}
    \PYG{n}{search} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}attrSearch}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{search}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}

    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}\PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{tbody tr}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{bills} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tbody tr}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{bill} \PYG{o+ow}{in} \PYG{n}{bills}\PYG{p}{:}
        \PYG{k}{if} \PYG{n}{bill}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{td:nth\PYGZhy{}child(4)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text} \PYG{o}{==} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Chaptered}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}
           \PYG{n}{url} \PYG{o}{=} \PYG{n}{bill}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{td:nth\PYGZhy{}child(1) a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
           \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
           \PYG{n}{measure} \PYG{o}{=} \PYG{n}{bill}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{td:nth\PYGZhy{}child(1) a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
           \PYG{n}{measures}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{measure}\PYG{p}{)}
           \PYG{n}{subject} \PYG{o}{=} \PYG{n}{bill}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{td:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
           \PYG{n}{subjects}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{subject}\PYG{p}{)}
           \PYG{n}{author} \PYG{o}{=} \PYG{n}{bill}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{td:nth\PYGZhy{}child(3)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
           \PYG{n}{authors}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{author}\PYG{p}{)}
           \PYG{n}{status} \PYG{o}{=} \PYG{n}{bill}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{td:nth\PYGZhy{}child(4)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
           \PYG{n}{statuss}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{status}\PYG{p}{)}
        \PYG{k}{else}\PYG{p}{:}
           \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Bill Died}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mf}{0.01}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{url done}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\subsection{Extract full texts}
\label{\detokenize{ch7:extract-full-texts}}
\sphinxAtStartPar
With the urls we scraped from last subsection, we click each url and extract the full bill text.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{for} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n}{urls}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{state} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{CA}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{states}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{state}\PYG{p}{)}

    \PYG{n}{billnumber} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}bill\PYGZus{}header \PYGZgt{} div:nth\PYGZhy{}child(3) \PYGZgt{} h1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{billnumbers}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{billnumber}\PYG{o}{.}\PYG{n}{text}\PYG{o}{.}\PYG{n}{rsplit}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ }\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{title} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}bill\PYGZus{}header \PYGZgt{} div:nth\PYGZhy{}child(3) \PYGZgt{} h1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{title} \PYG{o}{=} \PYG{n}{title}\PYG{o}{.}\PYG{n}{text}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ }\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}
    \PYG{n}{titles}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{p}{(}\PYG{n}{title}\PYG{o}{.}\PYG{n}{rsplit}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}

    \PYG{n}{textlinks}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{fulltext} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bill\PYGZus{}all}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
    \PYG{n}{fulltexts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{fulltext}\PYG{p}{)}
    \PYG{n}{fulltextpage} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}centercolumn}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
    \PYG{n}{fulltextpages}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{fulltextpage}\PYG{p}{)}
    \PYG{n}{sleeptime} \PYG{o}{=} \PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{)}\PYG{o}{*}\PYG{l+m+mf}{0.1}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{n}{sleeptime}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text saving and output}
\label{\detokenize{ch7:text-saving-and-output}}
\sphinxAtStartPar
After webscraping all chaptered bills’ full texts, we saved them into different formats of files.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{years}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{State}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{states}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Session Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{sessionyears}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Bill Number}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{billnumbers}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{titles}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Brief Summary}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{briefsummarys}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Introduced Date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{introduceddates}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date it was signed}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{signingdates}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date effective}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{effectivedates}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Expiration date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{expireddates}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Introducer}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{leadauthors}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{fulltexts}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Link to full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{textlinks}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} save bill info into files}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CA\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CA\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CA\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CA\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 8 Colorado}
\label{\detokenize{ch8:ch-8-colorado}}\label{\detokenize{ch8::doc}}
\sphinxstepscope


\chapter{Ch 9 Connecticut}
\label{\detokenize{ch9:ch-9-connecticut}}\label{\detokenize{ch9::doc}}
\sphinxAtStartPar
\sphinxhref{https://www.cga.ct.gov/asp/menu/legdownload.asp}{Connecticut General Assembly Website} stores acts from 2005. The web address is \sphinxurl{https://www.cga.ct.gov/asp/menu/legdownload.asp}. Connecticut General Assembly Website provides Legislative Information Download service as shown below. We can get all acts through File Transfer Protocol (FTP) and download all act PDF files into a local folder by hand.The main task is extract full act texts from all PDF files.
\sphinxincludegraphics{{ct_web}.png}


\section{import libraries}
\label{\detokenize{ch9:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch9:text-extraction-and-saving}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{yourpath}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{files}\PYG{o}{.}\PYG{n}{extend}\PYG{p}{(}\PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.PDF}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
    \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
    \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
        \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
        \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
    \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{c+c1}{\PYGZsh{}\PYGZsq{}Link to full text\PYGZsq{}:session\PYGZus{}urls,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CT\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CT\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CT\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CT\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
There are three types of law sessions including regular session, special session and special organization session. All enrolled bills are named by “HB”,”SB”,”SR”,”HR”,”SJR”, or “HJR” plus bill number and ended with “\sphinxhyphen{}enr”. They are stored as pdf files on Alabama Secretary of State website. You can check the acts on \sphinxhref{https://alison.legislature.state.al.us/acts}{Alabama Legislature website}.


\section{import libraries}
\label{\detokenize{ch9:id1}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch9:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gt}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}
\PYG{n+ne}{FileNotFoundError}\PYG{g+gWhitespace}{                         }Traceback (most recent call last)
\PYG{n+nn}{/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb Cell 7} in \PYG{n+ni}{\PYGZlt{}cell line: 4\PYGZgt{}}\PYG{n+nt}{()}
      \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=0}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{1}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/to/driver}\PYG{l+s+s1}{\PYGZsq{}}
      \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{3}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{c+c1}{\PYGZsh{} Change the working directory}
\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZgt{}} \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=3}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{4}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
      \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=5}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{6}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
      \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=6}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{7}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{c+c1}{\PYGZsh{} Print the current working directory}

\PYG{n+ne}{FileNotFoundError}: [Errno 2] No such file or directory: \PYGZsq{}/yourpath/\PYGZsq{}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch9:pdf-file-download}}
\sphinxAtStartPar
As shown on \sphinxhref{http://alisondb.legislature.state.al.us/Alison/SelectSession.aspx}{Alabama Legislature website}, all sessions are stored since 2000. We scraped all passed acts since 2000 within a loop using the code \sphinxcode{\sphinxupquote{for yr in range(2000, 2023)}}. There are four types of sessions including regular session (RS), first special session (FS), second special session (SS), and organizational session (OS). For these session types, we had the loop \sphinxcode{\sphinxupquote{for st in ("RS","FS","SS","OS")}}. For acts, there are also six types based on the act sponsor including “HB”, “SB”, “SR”, “HR”, “SJR”, “HJR”. All act PDF files, i.e., enrolled bills are files with the pattern: \sphinxurl{http://alisondb.legislature.state.al.us/ALISON/SearchableInstruments/} + year + session type + “/PrintFiles/” + act type + order number + “\sphinxhyphen{}enr.pdf”. Using this pattern, we can download all act PDF files.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{for} \PYG{n}{yr} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2000}\PYG{p}{,}\PYG{l+m+mi}{2023}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{yr}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{n} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1000}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{for} \PYG{n}{t} \PYG{o+ow}{in} \PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{HB}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{SB}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{SR}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{HR}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{SJR}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{HJR}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{for} \PYG{n}{st} \PYG{o+ow}{in} \PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{RS}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{FS}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{SS}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{OS}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{:}
                \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://alisondb.legislature.state.al.us/ALISON/SearchableInstruments/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{yr}\PYG{p}{)} \PYG{o}{+} \PYG{n}{st} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/PrintFiles/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{t} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{n}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}enr.pdf}\PYG{l+s+s2}{\PYGZdq{}}
                \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
                \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mf}{0.001}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch9:id2}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{badfiles} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
            \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
        \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
        \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{badfiles}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                           \PYG{n}{keep}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AL\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AL\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AL\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AL\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 10 Delaware}
\label{\detokenize{ch10:ch-10-delaware}}\label{\detokenize{ch10::doc}}
\sphinxstepscope


\chapter{Ch 11 District of Columbia}
\label{\detokenize{ch11:ch-11-district-of-columbia}}\label{\detokenize{ch11::doc}}
\sphinxstepscope


\chapter{Ch 12 Florida}
\label{\detokenize{ch12:ch-12-florida}}\label{\detokenize{ch12::doc}}
\sphinxstepscope


\chapter{Ch 13 Georgia}
\label{\detokenize{ch13:ch-13-georgia}}\label{\detokenize{ch13::doc}}
\sphinxAtStartPar
\sphinxhref{https://www.legis.ga.gov/legislation/all}{Georgia General Assembly Website} stores acts from 2001. The web address is \sphinxurl{https://www.legis.ga.gov/legislation/all}. Georgia General Assembly Website provides Legislation Search shown as below. We can get all acts through File Transfer Protocol (FTP) and download all act PDF files into a local folder by hand.The main task is extract full act texts from all PDF files.
\sphinxincludegraphics{{ga_web}.png}


\section{import libraries}
\label{\detokenize{ch13:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch13:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch13:pdf-file-download}}

\subsection{Get all act urls first.}
\label{\detokenize{ch13:get-all-act-urls-first}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{yrs} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{sts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{seyrs} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{titles} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{bfsums} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{introdts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{sigdts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{effdts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{epddtes} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{introducers} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{txtlks} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{stas} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{hoscoms} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}  \PYG{c+c1}{\PYGZsh{} house committee}
\PYG{n}{sponsors} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{sessions} \PYG{o}{=}\PYG{p}{[}\PYG{p}{]}
\PYG{n}{urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{billnums} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
    \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}session \PYGZgt{} option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} select all sessions except 2013\PYGZhy{}2024 session}
\PYG{n}{all\PYGZus{}sessions} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}session \PYGZgt{} option}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{session\PYGZus{}list} \PYG{o}{=} \PYG{n}{all\PYGZus{}sessions}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{index}\PYG{p}{,} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{session\PYGZus{}list}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}session \PYGZgt{} option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{all\PYGZus{}sessions} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}session \PYGZgt{} option}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{session\PYGZus{}list} \PYG{o}{=} \PYG{n}{all\PYGZus{}sessions}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{p}{]}
    \PYG{n}{session\PYGZus{}list}\PYG{p}{[}\PYG{n}{index}\PYG{p}{]}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{session} \PYG{o}{=} \PYG{n}{session\PYGZus{}list}\PYG{p}{[}\PYG{n}{index}\PYG{p}{]}\PYG{o}{.}\PYG{n}{text}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{session}\PYG{p}{)}

    \PYG{n}{search\PYGZus{}btn} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{button.btn.btn\PYGZhy{}primary}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{search\PYGZus{}btn}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}

    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}

    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
            \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{div.noResults}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
        \PYG{p}{)}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{div.noResults}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{No results found}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
            \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{div.resultCount b:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
        \PYG{p}{)}
        \PYG{n}{total\PYGZus{}bills} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{div.resultCount b:nth\PYGZhy{}child(2)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}

        \PYG{k}{if} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{total\PYGZus{}bills}\PYG{p}{)} \PYG{o}{\PYGZpc{}} \PYG{l+m+mi}{20} \PYG{o}{==} \PYG{l+m+mi}{0}\PYG{p}{:}
            \PYG{n}{total\PYGZus{}pages} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{total\PYGZus{}bills}\PYG{p}{)}\PYG{o}{/}\PYG{l+m+mi}{20}\PYG{p}{)}
        \PYG{k}{else}\PYG{p}{:}
            \PYG{n}{total\PYGZus{}pages} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{total\PYGZus{}bills}\PYG{p}{)}\PYG{o}{/}\PYG{l+m+mi}{20}\PYG{p}{)}\PYG{o}{+}\PYG{l+m+mi}{1}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{total\PYGZus{}pages}\PYG{p}{)}

        \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{total\PYGZus{}pages}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
                \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.text\PYGZhy{}nowrap}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
            \PYG{p}{)}
            \PYG{n}{bill\PYGZus{}list} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.text\PYGZhy{}nowrap}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
            \PYG{k}{for} \PYG{n}{bill} \PYG{o+ow}{in} \PYG{n}{bill\PYGZus{}list}\PYG{p}{:}
                \PYG{n}{url} \PYG{o}{=} \PYG{n}{bill}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
                \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
                \PYG{n}{billnum} \PYG{o}{=} \PYG{n}{bill}\PYG{o}{.}\PYG{n}{text}
                \PYG{n}{billnums}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{billnum}\PYG{p}{)}
                \PYG{n}{sessions}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{session}\PYG{p}{)}
            \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{page}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{page}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}

            \PYG{k}{if} \PYG{n}{total\PYGZus{}pages} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{:}
                \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
                    \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ul \PYGZgt{} li:last\PYGZhy{}child \PYGZgt{} a \PYGZgt{} span}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
                \PYG{p}{)}
                \PYG{n}{next\PYGZus{}page} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ul \PYGZgt{} li:last\PYGZhy{}child \PYGZgt{} a \PYGZgt{} span}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
                \PYG{k}{try}\PYG{p}{:}
                    \PYG{n}{next\PYGZus{}page}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
                    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
                \PYG{k}{except}\PYG{p}{:}
                    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{this session is done for urls}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
            \PYG{k}{else}\PYG{p}{:}
                \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{this session is done for urls}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\subsection{Downlowd all act PDF files}
\label{\detokenize{ch13:downlowd-all-act-pdf-files}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{for} \PYG{n}{idx}\PYG{p}{,}\PYG{n}{url} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{urls}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}

    \PYG{n}{version\PYGZus{}btn} \PYG{o}{=}\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{li.list\PYGZhy{}inline\PYGZhy{}item}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{version\PYGZus{}btn}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}

    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{div.col\PYGZhy{}6.justify\PYGZhy{}content\PYGZhy{}end.text\PYGZhy{}right \PYGZgt{} button}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{dnldbtn} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}class\PYGZus{}name}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{btn.btn\PYGZhy{}outline\PYGZhy{}primary.btn\PYGZhy{}sm.mr\PYGZhy{}2.mb\PYGZhy{}1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{dnldbtn}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Download finished}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch13:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI/data/GA}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{badfiles} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
            \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
        \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
        \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{badfiles}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                           \PYG{n}{keep}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{GA\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{GA\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{GA\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{GA\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 14 Hawaii}
\label{\detokenize{ch14:ch-14-hawaii}}\label{\detokenize{ch14::doc}}
\sphinxAtStartPar
\sphinxhref{https://www.capitol.hawaii.gov/session/slh.aspx}{Hawaii State Legislature}  website stores all acts since 1959 in Hawaii. The web address is \sphinxurl{https://www.capitol.hawaii.gov/session/slh.aspx}.

\sphinxAtStartPar
\sphinxincludegraphics{{hi_web}.png}


\section{Import libraries}
\label{\detokenize{ch14:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch14:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch14:pdf-file-download}}
\sphinxAtStartPar
There is a section \sphinxstyleemphasis{SESSION LAWS OF HAWAII}. From this section, we can all session laws OF Hawaii. So, the main goal is to download all session law PDF files. \sphinxincludegraphics{{hi_laws}.png}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{act\PYGZus{}urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{checklist} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{session\PYGZus{}acts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.capitol.hawaii.gov/slh.aspx}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} for sessions (1975, 2018)}
\PYG{k}{for} \PYG{n}{year} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{1975}\PYG{p}{,} \PYG{l+m+mi}{2018}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.capitol.hawaii.gov/slh/AllIndex/All\PYGZus{}Acts\PYGZus{}SLH}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.pdf}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} for sessions (2018)}
\PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.capitol.hawaii.gov/slh/AllIndex/All\PYGZus{}Acts\PYGZus{}SLH2017SS\PYGZhy{}SLH2018.pdf}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} for sessions (2019\PYGZhy{}2022)}

\PYG{k}{for} \PYG{n}{year} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2019}\PYG{p}{,} \PYG{l+m+mi}{2023}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.capitol.hawaii.gov/slh/AllIndex/SLH}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZus{}Complete.pdf}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch14:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI/data/HI}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
    \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
    \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
        \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
        \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
    \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                           \PYG{n}{keep}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} save all act info into files}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{HI\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{HI\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{HI\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{HI\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 15 Idaho}
\label{\detokenize{ch15:ch-15-idaho}}\label{\detokenize{ch15::doc}}
\sphinxAtStartPar
\sphinxhref{https://legislature.idaho.gov/statutesrules/sessionlaws/}{The official website of the Idaho Legislature} is an official website that stores all Idaho session laws. The web address is \sphinxurl{https://legislature.idaho.gov/statutesrules/sessionlaws/}.

\sphinxAtStartPar
\sphinxincludegraphics{{id_web}.png}

\sphinxAtStartPar
On the website, all session laws are saved into one or two volumes as PDF files. The main task of webscraping is to download all PDF files with sessions laws since 195 and extract full texts from them.


\section{import libraries}
\label{\detokenize{ch15:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch15:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Downloading Session Law PDF files}
\label{\detokenize{ch15:downloading-session-law-pdf-files}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{https://legislature.idaho.gov/statutesrules/sessionlaws/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{sessions} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}partial\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Volume}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{session\PYGZus{}urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{session} \PYG{o+ow}{in} \PYG{n}{sessions}\PYG{p}{:}
    \PYG{n}{session\PYGZus{}url} \PYG{o}{=} \PYG{n}{session}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{session\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{idx}\PYG{p}{,} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{session\PYGZus{}urls}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{idx}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{60}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\subsection{Extract full texts}
\label{\detokenize{ch15:extract-full-texts}}
\sphinxAtStartPar
With the urls we scraped from last subsection, we click each url and extract the full bill text.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{k}{with} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)} \PYG{k}{as} \PYG{n}{doc}\PYG{p}{:}
        \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
            \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text saving and output}
\label{\detokenize{ch15:text-saving-and-output}}
\sphinxAtStartPar
After extracting all full texts from PDF files, we saved them into different formats of files.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{c+c1}{\PYGZsh{}\PYGZsq{}Link to full text\PYGZsq{}:session\PYGZus{}urls,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                     \PYG{n}{keep} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace} \PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ID\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ID\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ID\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ID\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 16 Illinois}
\label{\detokenize{ch16:ch-16-illinois}}\label{\detokenize{ch16::doc}}
\sphinxAtStartPar
\sphinxhref{https://www.ilga.gov/}{Illinois Gneral Assembly}  website stores all acts since 1971 in Illinois. The web address is \sphinxurl{https://www.ilga.gov/}.

\sphinxAtStartPar
\sphinxincludegraphics{{il_web}.png}


\section{Import libraries}
\label{\detokenize{ch16:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch16:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch16:pdf-file-download}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{previous\PYGZus{}sessions} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{79}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{80}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{81}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{82}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{83}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{84}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{85}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{86}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{87}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{88}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{89}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{90}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{91}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{92}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{93}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{94}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                     \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{95}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{96}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{97}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{98}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{99}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{100}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{101}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{102}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{session} \PYG{o+ow}{in} \PYG{n}{previous\PYGZus{}sessions}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{n} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2000}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{n} \PYG{o}{=} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{n}\PYG{p}{)}
        \PYG{n}{PDF\PYGZus{}url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.ilga.gov/legislation/publicacts/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{session} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/PDF/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{session}\PYG{o}{.}\PYG{n}{zfill}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{n}\PYG{o}{.}\PYG{n}{zfill}\PYG{p}{(}
            \PYG{l+m+mi}{4}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.pdf}\PYG{l+s+s2}{\PYGZdq{}}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{PDF\PYGZus{}url}\PYG{p}{)}
        \PYG{k}{try}\PYG{p}{:}
            \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{PDF\PYGZus{}url}\PYG{p}{)}
            \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
        \PYG{k}{except}\PYG{p}{:}
            \PYG{k}{raise} \PYG{n+ne}{StopIteration}

\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/Users/long/OneDrive/Projects/AFRI/data/IL/}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{k}{with} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)} \PYG{k}{as} \PYG{n}{doc}\PYG{p}{:}
        \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
            \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch16:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
    \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
    \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
        \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
        \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
    \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                           \PYG{n}{keep}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} save all act info into files}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{IL\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{IL\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{IL\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{IL\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 17 Indiana}
\label{\detokenize{ch17:ch-17-indiana}}\label{\detokenize{ch17::doc}}
\sphinxstepscope


\chapter{Ch 18 Iowa}
\label{\detokenize{ch18:ch-18-iowa}}\label{\detokenize{ch18::doc}}
\sphinxstepscope


\chapter{Ch 19 Kansas}
\label{\detokenize{ch19:ch-19-kansas}}\label{\detokenize{ch19::doc}}
\sphinxAtStartPar
The \sphinxhref{https://www.kansas.gov/government/legislative/}{Kansas Legislature Archival Website} stores the compilation of all Legislative bills enacted by a session of the Kansas Legislature, organized by chapter, from 1996 through 2010. The \sphinxhref{http://www.kslegislature.org/li\_2022/historical/}{Kansas Legislature} stores all Legislative bills under \sphinxstyleemphasis{Bills and Sessions} since 2011.

\sphinxAtStartPar
\sphinxincludegraphics{{ks_ar}.png}
\sphinxincludegraphics{{ks_leg}.png}


\section{Import libraries}
\label{\detokenize{ch19:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch19:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Direct webscraping and PDF file download}
\label{\detokenize{ch19:direct-webscraping-and-pdf-file-download}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{year} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{1996}\PYG{p}{,} \PYG{l+m+mi}{2004}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{session\PYGZus{}url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.kansas.gov/government/legislative/sessionlaws/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mf}{0.001}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}agency\PYGZhy{}content \PYGZgt{} table \PYGZgt{} tbody}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{act\PYGZus{}no} \PYG{o}{=} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}agency\PYGZhy{}content \PYGZgt{} table \PYGZgt{} tbody \PYGZgt{} tr \PYGZgt{} td:nth\PYGZhy{}child(1) \PYGZgt{} a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{act\PYGZus{}no} \PYG{o}{+} \PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}
        \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.kansas.gov/government/legislative/sessionlaws/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/chap}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.html}\PYG{l+s+s2}{\PYGZdq{}}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
        \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
            \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
        \PYG{p}{)}
        \PYG{n}{acttxt} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
        \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{year} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2004}\PYG{p}{,} \PYG{l+m+mi}{2011}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.kansas.gov/government/legislative/sessionlaws/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}agency\PYGZhy{}content}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}agency\PYGZhy{}content \PYGZgt{} table \PYGZgt{} tbody \PYGZgt{} tr \PYGZgt{} td:nth\PYGZhy{}child(1) \PYGZgt{} a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{act}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mf}{0.001}\PYG{p}{)}

\PYG{n}{bill\PYGZus{}urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{session\PYGZus{}url} \PYG{o+ow}{in} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://www.kslegislature.org/li\PYGZus{}2022/b2021\PYGZus{}22/measures/bills/}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://www.kslegislature.org/li\PYGZus{}2021s/b2021s/measures/bills/}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://www.kslegislature.org/li\PYGZus{}2016s/b2015\PYGZus{}16/measures/bills/}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://www.kslegislature.org/li\PYGZus{}2013s/b2013\PYGZus{}14/measures/bills/}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://www.kslegislature.org/li\PYGZus{}2020s/b2020s/measures/bills/}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://www.kslegislature.org/li\PYGZus{}2020/b2019\PYGZus{}20/measures/bills/}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://www.kslegislature.org/li\PYGZus{}2018/b2017\PYGZus{}18/measures/bills/}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://www.kslegislature.org/li\PYGZus{}2016/b2015\PYGZus{}16/measures/bills/}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://www.kslegislature.org/li\PYGZus{}2014/b2013\PYGZus{}14/measures/bills/}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://www.kslegislature.org/li\PYGZus{}2012/b2011\PYGZus{}12/measures/bills/}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{[}\PYG{p}{:}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{page\PYGZus{}no} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}tab\PYGZhy{}disp}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{of }\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{page\PYGZus{}no}\PYG{p}{)} \PYG{o}{+} \PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}
            \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{page}\PYG{p}{)}
            \PYG{n}{page\PYGZus{}url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://www.kslegislature.org/li\PYGZus{}2012/b2011\PYGZus{}12/measures/bills/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{page}\PYG{p}{)}
            \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{page\PYGZus{}url}\PYG{p}{)}
            \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{page\PYGZus{}url}\PYG{p}{)}
            \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mf}{0.01}\PYG{p}{)}
            \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
                \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bill\PYGZhy{}tab\PYGZhy{}1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
            \PYG{p}{)}
            \PYG{n}{bills} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bill\PYGZhy{}tab\PYGZhy{}1 \PYGZgt{} li a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
            \PYG{k}{for} \PYG{n}{bill} \PYG{o+ow}{in} \PYG{n}{bills}\PYG{p}{:}
                \PYG{n}{bill\PYGZus{}url} \PYG{o}{=} \PYG{n}{bill}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{href}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
                \PYG{n}{bill\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{bill\PYGZus{}url}\PYG{p}{)}
                \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{bill\PYGZus{}url}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n}{bills} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bill\PYGZhy{}tab\PYGZhy{}1 \PYGZgt{} li a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{k}{for} \PYG{n}{bill} \PYG{o+ow}{in} \PYG{n}{bills}\PYG{p}{:}
            \PYG{n}{bill\PYGZus{}url} \PYG{o}{=} \PYG{n}{bill}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{href}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
            \PYG{n}{bill\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{bill\PYGZus{}url}\PYG{p}{)}
            \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{bill\PYGZus{}url}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{index}\PYG{p}{,} \PYG{n}{bill\PYGZus{}url} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{bill\PYGZus{}urls}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{index}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{bill\PYGZus{}url}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}version\PYGZhy{}tab\PYGZhy{}1 \PYGZgt{} tr}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{check} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}version\PYGZhy{}tab\PYGZhy{}1 \PYGZgt{} tr}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
    \PYG{k}{if} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Enrolled}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o+ow}{in} \PYG{n}{check}\PYG{p}{:}
        \PYG{n}{versions} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}version\PYGZhy{}tab\PYGZhy{}1 \PYGZgt{} tr}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{k}{for} \PYG{n}{version} \PYG{o+ow}{in} \PYG{n}{versions}\PYG{p}{:}
            \PYG{n}{version\PYGZus{}text} \PYG{o}{=} \PYG{n}{version}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{td:nth\PYGZhy{}child(1)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
            \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{version\PYGZus{}text}\PYG{p}{)}
            \PYG{k}{if} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Enrolled}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o+ow}{in} \PYG{n}{version\PYGZus{}text}\PYG{p}{:}
                \PYG{n}{pdf} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}version\PYGZhy{}tab\PYGZhy{}1 \PYGZgt{} tr:nth\PYGZhy{}child(1) \PYGZgt{} td:nth\PYGZhy{}child(2) \PYGZgt{} a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
                \PYG{n}{pdf}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
                \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mf}{0.01}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch19:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
    \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
    \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
        \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
        \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
    \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                           \PYG{n}{keep}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} save all act info into files}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{KS\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{KS\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{KS\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{KS\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 20 Kentucky}
\label{\detokenize{ch20:ch-20-kentucky}}\label{\detokenize{ch20::doc}}
\sphinxAtStartPar
\sphinxhref{https://legislature.ky.gov/Law/Pages/KyActs.aspx}{Kentucky General Assembly} is an official website that stores all acts passed in Kentucky. The web address is \sphinxurl{https://legislature.ky.gov/Law/Pages/KyActs.aspx}.

\sphinxAtStartPar
\sphinxincludegraphics{{ky_web}.png}

\sphinxAtStartPar
Kentucky General Assembly Website provides entire acts session by session as a PDF file.First, we downloaded all entire acts PDF files. Then, the task is to extract the information from them.

\sphinxAtStartPar
\sphinxincludegraphics{{ky_session}.png}


\section{import libraries}
\label{\detokenize{ch20:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch20:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch20:pdf-file-download}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{for} \PYG{n}{session} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{24}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{session}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1001}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://apps.legislature.ky.gov/law/acts/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{session}\PYG{p}{)}\PYG{o}{.}\PYG{n}{zfill}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{RS/documents/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{act}\PYG{p}{)}\PYG{o}{.}\PYG{n}{zfill}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)} \PYG{o}{+}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.pdf}\PYG{l+s+s2}{\PYGZdq{}}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
        \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mf}{0.1}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text saving and output}
\label{\detokenize{ch20:text-saving-and-output}}
\sphinxAtStartPar
After webscraping all chaptered bills’ full texts, we saved them into different formats of files.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
            \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
        \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
        \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{KY\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{KY\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{KY\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{KY\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
California Legislative information Website provides \sphinxhref{https://leginfo.legislature.ca.gov/faces/advance/advance.xhtml}{\sphinxstyleemphasis{Advanced Search}} function. Through selecting all sessions as shown below, we can get all bills information available on the website. Under the column \sphinxstyleemphasis{Status}, we can tell which bill is chaptered, i.e.,becoming a law. Then, the task of webscraping is to extract the information of all chaptered bills on the website.

\sphinxAtStartPar
\sphinxincludegraphics{{ca_search}.png}


\section{import libraries}
\label{\detokenize{ch20:id1}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch20:id2}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Direct webscraping}
\label{\detokenize{ch20:direct-webscraping}}
\sphinxAtStartPar
As shown on \sphinxhref{https://leginfo.legislature.ca.gov/faces/advance/advance.xhtml}{California Legislative information Website} after searching all sessions, we can see returned bills one by one. Clicking the bill under column \sphinxstyleemphasis{Measure}, there is the full text of the bill. For efficiency purposes, we first get all urls for chaptered bills and extract the full texts of the chaptered bills after clicking each url.


\subsection{Get all urls}
\label{\detokenize{ch20:get-all-urls}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{sessions} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2021 \PYGZhy{} 2022}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2019 \PYGZhy{} 2020}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2017 \PYGZhy{} 2018}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2015 \PYGZhy{} 2016}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2013 \PYGZhy{} 2014}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2011 \PYGZhy{} 2012}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2009 \PYGZhy{} 2010}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2007 \PYGZhy{} 2008}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2005 \PYGZhy{} 2006}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2003 \PYGZhy{} 2004}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2001 \PYGZhy{} 2002}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1999 \PYGZhy{} 2000}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}

\PYG{n}{urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{measures} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{subjects} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{authors} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{statuss} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{session} \PYG{o+ow}{in} \PYG{n}{sessions}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{session}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://leginfo.legislature.ca.gov/faces/billSearchClient.xhtml}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}attrSearch}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{select\PYGZus{}session} \PYG{o}{=} \PYG{n}{Select}\PYG{p}{(}\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{select\PYGZsh{}session\PYGZus{}year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}session}\PYG{o}{.}\PYG{n}{select\PYGZus{}by\PYGZus{}visible\PYGZus{}text}\PYG{p}{(}\PYG{n}{session}\PYG{p}{)}
    \PYG{n}{search} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}attrSearch}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{search}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}

    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}\PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{tbody tr}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{bills} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tbody tr}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{bill} \PYG{o+ow}{in} \PYG{n}{bills}\PYG{p}{:}
        \PYG{k}{if} \PYG{n}{bill}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{td:nth\PYGZhy{}child(4)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text} \PYG{o}{==} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Chaptered}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}
           \PYG{n}{url} \PYG{o}{=} \PYG{n}{bill}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{td:nth\PYGZhy{}child(1) a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
           \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
           \PYG{n}{measure} \PYG{o}{=} \PYG{n}{bill}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{td:nth\PYGZhy{}child(1) a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
           \PYG{n}{measures}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{measure}\PYG{p}{)}
           \PYG{n}{subject} \PYG{o}{=} \PYG{n}{bill}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{td:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
           \PYG{n}{subjects}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{subject}\PYG{p}{)}
           \PYG{n}{author} \PYG{o}{=} \PYG{n}{bill}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{td:nth\PYGZhy{}child(3)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
           \PYG{n}{authors}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{author}\PYG{p}{)}
           \PYG{n}{status} \PYG{o}{=} \PYG{n}{bill}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{td:nth\PYGZhy{}child(4)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
           \PYG{n}{statuss}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{status}\PYG{p}{)}
        \PYG{k}{else}\PYG{p}{:}
           \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Bill Died}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mf}{0.01}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{url done}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\subsection{Extract full texts}
\label{\detokenize{ch20:extract-full-texts}}
\sphinxAtStartPar
With the urls we scraped from last subsection, we click each url and extract the full bill text.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{for} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n}{urls}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{state} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{CA}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{states}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{state}\PYG{p}{)}

    \PYG{n}{billnumber} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}bill\PYGZus{}header \PYGZgt{} div:nth\PYGZhy{}child(3) \PYGZgt{} h1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{billnumbers}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{billnumber}\PYG{o}{.}\PYG{n}{text}\PYG{o}{.}\PYG{n}{rsplit}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ }\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{title} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}bill\PYGZus{}header \PYGZgt{} div:nth\PYGZhy{}child(3) \PYGZgt{} h1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{title} \PYG{o}{=} \PYG{n}{title}\PYG{o}{.}\PYG{n}{text}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ }\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}
    \PYG{n}{titles}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{p}{(}\PYG{n}{title}\PYG{o}{.}\PYG{n}{rsplit}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}

    \PYG{n}{textlinks}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{fulltext} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bill\PYGZus{}all}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
    \PYG{n}{fulltexts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{fulltext}\PYG{p}{)}
    \PYG{n}{fulltextpage} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}centercolumn}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
    \PYG{n}{fulltextpages}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{fulltextpage}\PYG{p}{)}
    \PYG{n}{sleeptime} \PYG{o}{=} \PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{)}\PYG{o}{*}\PYG{l+m+mf}{0.1}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{n}{sleeptime}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text saving and output}
\label{\detokenize{ch20:id3}}
\sphinxAtStartPar
After webscraping all chaptered bills’ full texts, we saved them into different formats of files.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{years}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{State}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{states}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Session Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{sessionyears}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Bill Number}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{billnumbers}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{titles}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Brief Summary}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{briefsummarys}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Introduced Date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{introduceddates}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date it was signed}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{signingdates}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date effective}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{effectivedates}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Expiration date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{expireddates}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Introducer}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{leadauthors}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{fulltexts}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Link to full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{textlinks}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} save bill info into files}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CA\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CA\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CA\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CA\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 21 Louisiana}
\label{\detokenize{ch21:ch-21-louisiana}}\label{\detokenize{ch21::doc}}
\sphinxAtStartPar
\sphinxhref{https://www.legis.la.gov/Legis/Home.aspx}{Louisiana State Legislature} stores all acts passed in Louisiana. The web address is \sphinxurl{https://www.legis.la.gov/Legis/Home.aspx}.

\sphinxAtStartPar
\sphinxincludegraphics{{la_web}.png}

\sphinxAtStartPar
There are three types of law sessions including regular session, special session and special organization session. All enrolled bills are named by “HB”,”SB”,”SR”,”HR”,”SJR”, or “HJR” plus bill number and ended with “\sphinxhyphen{}enr”. They are stored as pdf files on Alabama Secretary of State website. You can check the acts on \sphinxhref{https://alison.legislature.state.al.us/acts}{Alabama Legislature website}.


\section{import libraries}
\label{\detokenize{ch21:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch21:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch21:pdf-file-download}}
\sphinxAtStartPar
As shown on \sphinxhref{https://www.legis.la.gov/Legis/Home.aspx}{Louisiana State Legislature}, all sessions are stored since 1997. First, we go to each session available. Then, we click each act within the session. Clicking the Text button, there are several versions of bills and we only download the act PDF file. All the process can be implemented by the blow code.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{https://www.legis.la.gov/Legis/SessionInfo/SessionInfo.aspx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{session\PYGZus{}links} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}partial\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{acts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{years} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{97RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{971ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{972ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{973ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{98RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{981ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{982ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{983ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{99RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{991ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{992ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{993ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{00RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{001ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{002ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{003ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{01RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{011ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{012ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{013ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{02RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{021ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{022ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{023ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{03RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{031ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{032ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{033ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{04RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{041ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{042ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{043ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{05RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{051ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{052ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{053ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{06RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{061ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{062ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{063ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{07RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{071ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{072ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{073ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{08RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{081ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{082ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{083ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{09RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{091ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{092ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{093ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{10RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{101ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{102ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{103ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{11RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{111ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{112ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{113ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{12RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{121ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{122ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{123ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{13RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{131ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{132ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{133ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{14RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{141ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{142ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{143ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{15RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{151ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{152ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{153ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{16RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{161ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{162ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{163ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{17RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{171ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{172ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{173ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{18RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{181ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{182ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{183ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{19RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{191ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{192ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{193ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{20RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{201ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{202ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{203ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{21RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{211ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{212ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{213ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{22RS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{221ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{222ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{223ES}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{year} \PYG{o+ow}{in} \PYG{n}{years}\PYG{p}{:}
    \PYG{n}{yearurl} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{https://www.legis.la.gov/Legis/ActNumbers.aspx?sid=}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n}{year}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{yearurl}\PYG{p}{)}
        \PYG{n}{total} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}ctl00\PYGZus{}ctl00\PYGZus{}PageBody\PYGZus{}PageContent\PYGZus{}LabelTotalInstruments}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ Instruments}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{are }\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}
        \PYG{n}{total\PYGZus{}num} \PYG{o}{=} \PYG{n}{math}\PYG{o}{.}\PYG{n}{ceil}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{total}\PYG{p}{)}\PYG{o}{/}\PYG{l+m+mi}{100}\PYG{p}{)}
        \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{n}{total\PYGZus{}num}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{try}\PYG{p}{:}
                \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{100}\PYG{p}{)}\PYG{p}{:}
                    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{yearurl}\PYG{p}{)}
                    \PYG{n}{element} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}ctl00\PYGZus{}ctl00\PYGZus{}PageBody\PYGZus{}PageContent\PYGZus{}ListViewActs\PYGZus{}ctrl}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZus{}HyperLink1}\PYG{l+s+s1}{\PYGZsq{}}
                    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{n}{element}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
                    \PYG{n}{url} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{current\PYGZus{}url}
                    \PYG{n}{actpdf\PYGZus{}url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.legis.la.gov/Legis/BillDocs.aspx?i=}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+}  \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{i=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZam{}t=text}\PYG{l+s+s2}{\PYGZdq{}}
                    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{actpdf\PYGZus{}url}\PYG{p}{)}
                    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}formBillDocs \PYGZgt{} table \PYGZgt{} tbody \PYGZgt{} tr:nth\PYGZhy{}child(1) \PYGZgt{} td \PYGZgt{} a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
                \PYG{n}{pages} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}ctl00\PYGZus{}ctl00\PYGZus{}PageBody\PYGZus{}PageContent\PYGZus{}DataPager1 \PYGZgt{} a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
                \PYG{n}{nextpage} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}ctl00\PYGZus{}ctl00\PYGZus{}PageBody\PYGZus{}PageContent\PYGZus{}DataPager1 \PYGZgt{} a:nth\PYGZhy{}child(}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{pages}\PYG{p}{)}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{)}\PYG{l+s+s2}{\PYGZdq{}}
                \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{n}{nextpage}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
            \PYG{k}{except}\PYG{p}{:}
                \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{skip}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{skip}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch21:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{badfiles} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
            \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
        \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
        \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{badfiles}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                     \PYG{n}{keep} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace} \PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{LA\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{LA\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{LA\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{LA\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 21 Maine}
\label{\detokenize{ch22:ch-21-maine}}\label{\detokenize{ch22::doc}}
\sphinxAtStartPar
\sphinxhref{https://legislature.maine.gov/ros/pdf-editions-of-published-session-laws-and-other-materials/12024}{Maine State Legislature} stores all acts passed in Maine. \sphinxurl{https://legislature.maine.gov/ros/pdf-editions-of-published-session-laws-and-other-materials/12024}. As shown below, Maine State Legislature provides a web page with PDF Editions of Published Session Laws and Other Materials. So, the main task of webscraping is to download all PDF files with session laws.

\sphinxAtStartPar
\sphinxincludegraphics{{me_web}.png}


\section{Import libraries}
\label{\detokenize{ch22:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch22:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch22:pdf-file-download}}
\sphinxAtStartPar
As shown on \sphinxhref{https://legislature.maine.gov/ros/pdf-editions-of-published-session-laws-and-other-materials/12024}{Maine State Legislature}, all sessions are stored since 2009. We find elements with urls for all session law PDF files by using the syntax \sphinxcode{\sphinxupquote{find\_elements\_by\_partial\_link\_text("Session")}}. With the urls, we can download all session law PDF files.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{https://legislature.maine.gov/ros/LOM/LOMpdfDirectory.htm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{sessions} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}partial\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{session\PYGZus{}urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{session} \PYG{o+ow}{in} \PYG{n}{sessions}\PYG{p}{:}
    \PYG{n}{session\PYGZus{}url} \PYG{o}{=} \PYG{n}{session}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{session\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{idx}\PYG{p}{,} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{session\PYGZus{}urls}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{idx}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{60}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch22:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{badfiles} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
            \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
        \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
        \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{badfiles}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                     \PYG{n}{keep} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace} \PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ME\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ME\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ME\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ME\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 23 Maryland}
\label{\detokenize{ch23:ch-23-maryland}}\label{\detokenize{ch23::doc}}
\sphinxstepscope


\chapter{Ch 24 Massachusetts}
\label{\detokenize{ch24:ch-24-massachusetts}}\label{\detokenize{ch24::doc}}
\sphinxstepscope


\chapter{Ch 25 Michigan}
\label{\detokenize{ch25:ch-25-michigan}}\label{\detokenize{ch25::doc}}
\sphinxAtStartPar
\sphinxhref{https://www.legislature.mi.gov/}{Michigan Legislature} stores all public acts in Michigan since 1989. Its address is \sphinxurl{https://www.legislature.mi.gov/(S(0wetsrqlezkedtdyim2smihr)}.

\sphinxAtStartPar
\sphinxincludegraphics{{mi_web}.png}


\section{Import libraries}
\label{\detokenize{ch25:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch25:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch25:pdf-file-download}}
\sphinxAtStartPar
As shown below, choosing one legislative session, we can see the search results. \sphinxincludegraphics{{mi_act}.png}

\sphinxAtStartPar
On the search results web page, there are public acts shown up. Clicking one public act, two versions including html and PDF versions are available to be downloaded. We focus on using html versions.

\sphinxAtStartPar
\sphinxincludegraphics{{mi_pdf}.png}

\sphinxAtStartPar
Based on the structure, we first get all urls for PDF files and use them to extract full texts from act html versions.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} choose sessionyears}
\PYG{n}{input\PYGZus{}sessionyears} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2021\PYGZhy{}2022}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2019\PYGZhy{}2020}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2017\PYGZhy{}2018}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2015\PYGZhy{}2016}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2013\PYGZhy{}2014}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2011\PYGZhy{}2012}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2009\PYGZhy{}2010}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                      \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2007\PYGZhy{}2008}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2005\PYGZhy{}2006}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2003\PYGZhy{}2004}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2001\PYGZhy{}2002}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1999\PYGZhy{}2000}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1997\PYGZhy{}1998}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}

\PYG{n}{urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{input\PYGZus{}sessionyear} \PYG{o+ow}{in} \PYG{n}{input\PYGZus{}sessionyears}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.legislature.mi.gov/(S(uycj0anii1cfudf2mj0uyllp))/mileg.aspx?page=LegAdvancedSearch}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{select\PYGZus{}public} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}frg\PYGZus{}legadvancedsearch\PYGZus{}PublicActs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}public}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} select session year}
    \PYG{n}{select\PYGZus{}sessionyear} \PYG{o}{=} \PYG{n}{Select}\PYG{p}{(}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}frg\PYGZus{}legadvancedsearch\PYGZus{}LegislativeSession\PYGZus{}LegislativeSession}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}sessionyear}\PYG{o}{.}\PYG{n}{select\PYGZus{}by\PYGZus{}visible\PYGZus{}text}\PYG{p}{(}\PYG{n}{input\PYGZus{}sessionyear}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} search by keywords}
    \PYG{c+c1}{\PYGZsh{}input\PYGZus{}keywords = driver.find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector(\PYGZsq{}\PYGZsh{}frg\PYGZus{}legadvancedsearch\PYGZus{}LegFullText\PYGZsq{})}
    \PYG{c+c1}{\PYGZsh{}input\PYGZus{}keywords.send\PYGZus{}keys(keyword)}

    \PYG{c+c1}{\PYGZsh{} click search button}
    \PYG{n}{search\PYGZus{}button} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}frg\PYGZus{}legadvancedsearch\PYGZus{}SearchButton}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{search\PYGZus{}button}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}

    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}
            \PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}maincontent \PYGZgt{} table:nth\PYGZhy{}child(2) \PYGZgt{} tbody \PYGZgt{} tr:nth\PYGZhy{}child(1) \PYGZgt{} td \PYGZgt{} span}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}

    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{searchresult} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{table\PYGZsh{}frg\PYGZus{}executesearch\PYGZus{}SearchResults\PYGZus{}Results  tbody  tr td a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{k}{continue}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)}

    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{searchresult}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{searchresult}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}

\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{done with urls}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n}{urls}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{acttxt} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch25:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                     \PYG{n}{keep} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace} \PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ME\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ME\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ME\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ME\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 26 Minnesota}
\label{\detokenize{ch26:ch-26-minnesota}}\label{\detokenize{ch26::doc}}
\sphinxstepscope


\chapter{Ch 27 Mississippi}
\label{\detokenize{ch27:ch-27-mississippi}}\label{\detokenize{ch27::doc}}
\sphinxAtStartPar
\sphinxhref{http://www.legislature.ms.gov/}{Mississippi Legislature} stores all public acts in Mississippi since 1997. As shown below, Mississippi Legislature has a Mississippi Legislative Bill Status System web page shown as below. We can extract all session law information through this web page.

\sphinxAtStartPar
\sphinxincludegraphics{{ms_web}.png}


\section{Import libraries}
\label{\detokenize{ch27:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch27:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Extracting Acts from Html and PDF files}
\label{\detokenize{ch27:extracting-acts-from-html-and-pdf-files}}
\sphinxAtStartPar
Through Mississippi Legislative Bill Status System web page shown above, choosing one legislative session, we can see the results within one session. There are two types of results. One type is only with a list of all measures in 1997 and 1998. For this type, we need to tell which act or measure here in Mississippi Legislature is approved. Clicking approved act, the full text is stored as a html file. We can extract full text\sphinxincludegraphics{{ms_list}.png}

\sphinxAtStartPar
Another type is with a list of all measures (not dead).All we need is under \sphinxstyleemphasis{All Measures (Not Dead)}. \sphinxincludegraphics{{ms_session}.png} Clicking \sphinxhref{http://billstatus.ls.state.ms.us/2022/pdf/mainmenu.htm}{*All Measures (Not Dead)}, the report of All Measures (Not Dead) are shown up. There are acts one by one which are stored as PDF files.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}Mississippi Legislature 1998 Regular Session}

\PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://billstatus.ls.state.ms.us/1998/all\PYGZus{}measures/allmsrs.htm}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}partial\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Approved}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}Mississippi Legislature 1999\PYGZhy{} Regular Session}
\PYG{k}{for} \PYG{n}{year} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{1999}\PYG{p}{,} \PYG{l+m+mi}{2008}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{session\PYGZus{}url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://billstatus.ls.state.ms.us/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/pdf/all\PYGZus{}measures/notdead.htm}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}partial\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Approved}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{e} \PYG{o+ow}{in} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{1e}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2e}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{3e}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{4e}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{:}
        \PYG{n}{session\PYGZus{}url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://billstatus.ls.state.ms.us/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)} \PYG{o}{+} \PYG{n}{e} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/pdf/all\PYGZus{}measures/notdead.htm}\PYG{l+s+s2}{\PYGZdq{}}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}
        \PYG{k}{try}\PYG{p}{:}
            \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}partial\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Approved}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
            \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
                \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
                \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
        \PYG{k}{except}\PYG{p}{:}
            \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{No this session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}Mississippi Legislature 1999\PYGZhy{} Regular Session}

\PYG{n}{urls2} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{year} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2009}\PYG{p}{,} \PYG{l+m+mi}{2023}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{session\PYGZus{}url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://billstatus.ls.state.ms.us/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/pdf/all\PYGZus{}measures/notdead.xml}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}partial\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Approved}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls2}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{e} \PYG{o+ow}{in} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{1e}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2e}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{3e}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{4e}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{:}
        \PYG{n}{session\PYGZus{}url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://billstatus.ls.state.ms.us/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)} \PYG{o}{+} \PYG{n}{e} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/pdf/all\PYGZus{}measures/notdead.xml}\PYG{l+s+s2}{\PYGZdq{}}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}
        \PYG{k}{try}\PYG{p}{:}
            \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}partial\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Approved}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
            \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
                \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
                \PYG{n}{urls2}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
        \PYG{k}{except}\PYG{p}{:}
            \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{No this session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{urls}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}
        \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
            \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
        \PYG{p}{)}
        \PYG{n}{acturl} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}partial\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Sent to Governor}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{acturl}\PYG{p}{)}
        \PYG{k}{try}\PYG{p}{:}
            \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{acturl}\PYG{p}{)}
            \PYG{k}{if} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{pdf}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o+ow}{in} \PYG{n}{acturl}\PYG{p}{:}
                \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{pdf}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
            \PYG{k}{else}\PYG{p}{:}
                \PYG{n}{acttxt} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{html}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
                \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
        \PYG{k}{except}\PYG{p}{:}
            \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{check}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{check}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{urls2}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}
        \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
            \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
        \PYG{p}{)}
        \PYG{n}{acturl} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}partial\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Sent to Governor}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{acturl}\PYG{p}{)}
        \PYG{k}{try}\PYG{p}{:}
            \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{acturl}\PYG{p}{)}
            \PYG{k}{if} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{pdf}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o+ow}{in} \PYG{n}{acturl}\PYG{p}{:}
                \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{pdf}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
            \PYG{k}{else}\PYG{p}{:}
                \PYG{n}{acttxt} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{html}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
                \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
        \PYG{k}{except}\PYG{p}{:}
            \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{check}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{check}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and output}
\label{\detokenize{ch27:text-extraction-and-output}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{badfiles} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
            \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
        \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
        \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{badfiles}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MS\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MS\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MS\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MS\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 28 Missouri}
\label{\detokenize{ch28:ch-28-missouri}}\label{\detokenize{ch28::doc}}
\sphinxAtStartPar
\sphinxhref{https://docs.legis.wisconsin.gov/archive/law}{The Missouri House of Representative website} stores all passed Senate and House bills in Missouri since 2000. In each session, there is a \sphinxstyleemphasis{Bills Truly Agreed and Finally Passed by Effective Date} section.

\sphinxAtStartPar
\sphinxincludegraphics{{wi_web}.png}


\section{Import libraries}
\label{\detokenize{ch28:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch28:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch28:pdf-file-download}}
\sphinxAtStartPar
On \sphinxstyleemphasis{Bills Truly Agreed and Finally Passed by Effective Date} section, there is an act list with the link to download the act PDF files. The urls for act PDf files are with the below pattern:”\sphinxurl{https://house.mo.gov/billtracking/bills}” + session number + “hlrbillspdf/” + LR Number + “.pdf”. We can find the LR number from the summary table saved by a csv file on the same page.
So, we first download all summary tables, use LR number to make up the act urls and then download all PDF files.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path for csv files}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{csv\PYGZus{}files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{sumfile} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{concat}\PYG{p}{(}\PYG{p}{[}\PYG{n}{pd}\PYG{o}{.}\PYG{n}{read\PYGZus{}csv}\PYG{p}{(}\PYG{n}{f}\PYG{p}{)} \PYG{k}{for} \PYG{n}{f} \PYG{o+ow}{in} \PYG{n}{csv\PYGZus{}files} \PYG{p}{]}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{sumfile}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{df} \PYG{o}{=} \PYG{n}{sumfile}

\PYG{n}{final} \PYG{o}{=} \PYG{n}{df}\PYG{p}{[}\PYG{n}{df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ Last Action}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{str}\PYG{o}{.}\PYG{n}{contains}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Vetoed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYG{o}{==} \PYG{k+kc}{False}\PYG{p}{]}

\PYG{n}{final}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{checklist} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{no} \PYG{o+ow}{in} \PYG{n}{final}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{LR Number}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{no}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{111}\PYG{p}{,}\PYG{l+m+mi}{224}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{try}\PYG{p}{:}
            \PYG{n}{act\PYGZus{}url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://house.mo.gov/billtracking/bills}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/hlrbillspdf/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{no} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.pdf}\PYG{l+s+s2}{\PYGZdq{}}
            \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{act\PYGZus{}url}\PYG{p}{)}
        \PYG{k}{except}\PYG{p}{:}
            \PYG{n}{checklist}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{no}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch28:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{badfiles} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
            \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
        \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
        \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{badfiles}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                     \PYG{n}{keep} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace} \PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} save bill info into files}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MO\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MO\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MO\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MO\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 29 Montana}
\label{\detokenize{ch29:ch-29-montana}}\label{\detokenize{ch29::doc}}
\sphinxstepscope


\chapter{Ch 30 Nebraska}
\label{\detokenize{ch30:ch-30-nebraska}}\label{\detokenize{ch30::doc}}
\sphinxAtStartPar
\sphinxhref{https://nebraskalegislature.gov/laws/browse-statutes.php}{The Nebraska Legislature} is the official site of the Nebraska Unicameral Legislature. The web address is \sphinxurl{https://nebraskalegislature.gov/laws/browse-statutes.php}.

\sphinxAtStartPar
\sphinxincludegraphics{{ne_web}.png}


\section{import libraries}
\label{\detokenize{ch30:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch30:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Downloading Session Law PDF files}
\label{\detokenize{ch30:downloading-session-law-pdf-files}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{sessionurls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{section\PYGZus{}urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{chs} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{91}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{ch} \PYG{o+ow}{in} \PYG{n}{chs}\PYG{p}{:}
    \PYG{n}{ch} \PYG{o}{=} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{ch}\PYG{p}{)}
    \PYG{n}{ch\PYGZus{}url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://nebraskalegislature.gov/laws/browse\PYGZhy{}chapters.php?chapter=}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{ch}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{ch\PYGZus{}url}\PYG{p}{)}
    \PYG{n}{sections} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{span.col\PYGZhy{}md\PYGZhy{}2.col\PYGZhy{}sm\PYGZhy{}3.my\PYGZhy{}auto:nth\PYGZhy{}child(1) a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{section} \PYG{o+ow}{in} \PYG{n}{sections}\PYG{p}{:}
        \PYG{n}{section\PYGZus{}url} \PYG{o}{=} \PYG{n}{section}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{section\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{section\PYGZus{}url}\PYG{p}{)}

\PYG{n}{sections} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{bill\PYGZus{}urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{section\PYGZus{}url} \PYG{o+ow}{in} \PYG{n}{section\PYGZus{}urls}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{section\PYGZus{}url}\PYG{p}{)}
    \PYG{n}{section\PYGZus{}text} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{div.card\PYGZhy{}body}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
    \PYG{n}{sections}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{section\PYGZus{}text}\PYG{p}{)}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{bills} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}partial\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Laws }\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{k}{for} \PYG{n}{bill} \PYG{o+ow}{in} \PYG{n}{bills}\PYG{p}{:}
            \PYG{n}{bill\PYGZus{}url} \PYG{o}{=} \PYG{n}{bill}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
            \PYG{n}{bill\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{bill\PYGZus{}url}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{no source}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{done with bill urls}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{billurls} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n+nb}{set}\PYG{p}{(}\PYG{n}{bill\PYGZus{}urls}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{idx}\PYG{p}{,} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{billurls}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\subsection{Extract full texts}
\label{\detokenize{ch30:extract-full-texts}}
\sphinxAtStartPar
With the urls we scraped from last subsection, we click each url and extract the full bill text.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{k}{with} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)} \PYG{k}{as} \PYG{n}{doc}\PYG{p}{:}
        \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
            \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text saving and output}
\label{\detokenize{ch30:text-saving-and-output}}
\sphinxAtStartPar
After extracting all full texts from PDF files, we saved them into different formats of files.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{c+c1}{\PYGZsh{}\PYGZsq{}Link to full text\PYGZsq{}:session\PYGZus{}urls,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NE\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NE\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NE\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NE\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 31 Nevada}
\label{\detokenize{ch31:ch-31-nevada}}\label{\detokenize{ch31::doc}}
\sphinxstepscope


\chapter{Ch 48 Vermont}
\label{\detokenize{ch32:ch-48-vermont}}\label{\detokenize{ch32::doc}}
\sphinxAtStartPar
\sphinxhref{http://www.gencourt.state.nh.us/bill\_status/legacy/bs2016/}{The General Court of New Hampshire} stores all acts in New Hampshire. Through \sphinxstyleemphasis{Advanced Bill Status Search}, we can get all session laws including “signed by the governor” and “law without signature”

\sphinxAtStartPar
\sphinxincludegraphics{{nh_web}.png}


\section{Import libraries}
\label{\detokenize{ch32:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch32:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Direct Webscraping}
\label{\detokenize{ch32:direct-webscraping}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://www.gencourt.state.nh.us/bill\PYGZus{}status/legacy/bs2016/}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}txtsessionyear}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{clear}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{acturls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{c+c1}{\PYGZsh{} signed by governor}
\PYG{k}{for} \PYG{n}{year} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{1989}\PYG{p}{,} \PYG{l+m+mi}{2023}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://www.gencourt.state.nh.us/bill\PYGZus{}status/legacy/bs2016/}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}txtsessionyear}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{clear}\PYG{p}{(}\PYG{p}{)}

    \PYG{n}{sessionyear} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}txtsessionyear}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{sessionyear}\PYG{o}{.}\PYG{n}{send\PYGZus{}keys}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)}

    \PYG{n}{code} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{05}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}
    \PYG{n}{status} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}txtgstatus}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{status}\PYG{o}{.}\PYG{n}{send\PYGZus{}keys}\PYG{p}{(}\PYG{n}{code}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}cmdsubmit}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{PARTIAL\PYGZus{}LINK\PYGZus{}TEXT}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Bill}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
    \PYG{n}{acts}\PYG{o}{.}\PYG{n}{extend}\PYG{p}{(}\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Bill Text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{acts}\PYG{o}{.}\PYG{n}{extend}\PYG{p}{(}\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{[HTML]}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{href}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
        \PYG{n}{acturls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
        \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mf}{0.001}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} become law without siginature}
    \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://www.gencourt.state.nh.us/bill\PYGZus{}status/legacy/bs2016/}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}txtsessionyear}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{clear}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{code} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{06}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}
    \PYG{n}{status} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}txtgstatus}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{status}\PYG{o}{.}\PYG{n}{send\PYGZus{}keys}\PYG{p}{(}\PYG{n}{code}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}cmdsubmit}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{head}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
    \PYG{n}{acts}\PYG{o}{.}\PYG{n}{extend}\PYG{p}{(}\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Bill Text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{acts}\PYG{o}{.}\PYG{n}{extend}\PYG{p}{(}\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{[HTML]}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{href}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
        \PYG{n}{acturls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
        \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mf}{0.001}\PYG{p}{)}

\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{badurls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n}{acturls}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{t} \PYG{o}{=} \PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{)} \PYG{o}{*} \PYG{l+m+mf}{0.001}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{n}{t}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{acttxt} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
        \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
        \PYG{n}{t} \PYG{o}{=} \PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{)} \PYG{o}{*} \PYG{l+m+mf}{0.001}
        \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{n}{t}\PYG{p}{)}
        \PYG{k}{if} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Server Error}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o+ow}{in} \PYG{n}{acttxt}\PYG{p}{:}
            \PYG{n}{badurls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
        \PYG{k}{else}\PYG{p}{:}
            \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{good}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
        \PYG{n}{badurls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text saving}
\label{\detokenize{ch32:text-saving}}
\sphinxAtStartPar
In this section, we used the below code to save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                     \PYG{n}{keep} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace} \PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} save bill info into files}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VT\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VT\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VT\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VT\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 33 New Jersey}
\label{\detokenize{ch33:ch-33-new-jersey}}\label{\detokenize{ch33::doc}}
\sphinxstepscope


\chapter{Ch 34 New Mexico}
\label{\detokenize{ch34:ch-34-new-mexico}}\label{\detokenize{ch34::doc}}
\sphinxstepscope


\chapter{Ch 35 New York}
\label{\detokenize{ch35:ch-35-new-york}}\label{\detokenize{ch35::doc}}
\sphinxAtStartPar
\sphinxhref{https://nyassembly.gov/leg/?sh=advanced}{The New York State Assembly website} stores all acts in New York State.

\sphinxAtStartPar
\sphinxincludegraphics{{ny_web}.png}


\section{Import libraries}
\label{\detokenize{ch35:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch35:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Direct Webscraping}
\label{\detokenize{ch35:direct-webscraping}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://nyassembly.gov/leg/?sh=advanced}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{sessions} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2021\PYGZhy{}22}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2019\PYGZhy{}20}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2017\PYGZhy{}18}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2015\PYGZhy{}16}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2013\PYGZhy{}14}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2011\PYGZhy{}12}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2009\PYGZhy{}10}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2007\PYGZhy{}08}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2005\PYGZhy{}06}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2003\PYGZhy{}04}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2001\PYGZhy{}02}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1999\PYGZhy{}00}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{session} \PYG{o+ow}{in} \PYG{n}{sessions}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://nyassembly.gov/leg/?sh=advanced}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}session} \PYG{o}{=} \PYG{n}{Select}\PYG{p}{(}\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{select\PYGZsh{}term}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}session}\PYG{o}{.}\PYG{n}{select\PYGZus{}by\PYGZus{}visible\PYGZus{}text}\PYG{p}{(}\PYG{n}{session}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}type} \PYG{o}{=} \PYG{n}{Select}\PYG{p}{(}\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}leg\PYGZus{}type}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}type}\PYG{o}{.}\PYG{n}{select\PYGZus{}by\PYGZus{}visible\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{All Types}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}status} \PYG{o}{=} \PYG{n}{Select}\PYG{p}{(}\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}bill\PYGZus{}status}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}status}\PYG{o}{.}\PYG{n}{select\PYGZus{}by\PYGZus{}visible\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Chaptered}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}search\PYGZus{}btn\PYGZus{}div \PYGZgt{} input[type=button]:nth\PYGZhy{}child(1)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{bills} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}vcontent\PYGZus{}div \PYGZgt{} ul \PYGZgt{} li \PYGZgt{} a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{bill} \PYG{o+ow}{in} \PYG{n}{bills}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{bill}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
        
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n}{urls}\PYG{p}{:}
    \PYG{n}{urlnew} \PYG{o}{=} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}\PYG{o}{.}\PYG{n}{replace}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://nyassembly.gov/leg/?}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://nyassembly.gov/leg/?default\PYGZus{}fld=\PYGZam{}leg\PYGZus{}video=\PYGZam{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZam{}Text=Y}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{urlnew}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mf}{0.1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}\PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}legcontent \PYGZgt{} pre}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{act} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}legcontent \PYGZgt{} pre}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
    \PYG{n}{actnew} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{[}\PYG{l+s+s2}{\PYGZbs{}}\PYG{l+s+s2}{(}\PYG{l+s+s2}{\PYGZbs{}}\PYG{l+s+s2}{[].*?[}\PYG{l+s+s2}{\PYGZbs{}}\PYG{l+s+s2}{)}\PYG{l+s+s2}{\PYGZbs{}}\PYG{l+s+s2}{]]}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{act}\PYG{p}{)}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{actnew}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text saving}
\label{\detokenize{ch35:text-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}\PYG{p}{,}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{} save bill info into files}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NY\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NY\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NY\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NY\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 43 North Carolina}
\label{\detokenize{ch36:ch-43-north-carolina}}\label{\detokenize{ch36::doc}}
\sphinxAtStartPar
\sphinxhref{https://www.ncleg.gov/Laws/SessionLawPublications}{The North Carolina General Assembly} stores all session laws of North Carolina under session law publications. On the website, there is an \sphinxstyleemphasis{Acts Archives} section covering acts.

\sphinxAtStartPar
\sphinxincludegraphics{{nc_web}.png}


\section{Import libraries}
\label{\detokenize{ch36:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch36:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch36:pdf-file-download}}
\sphinxAtStartPar
All session laws on the website are stored as the PDF files. The main goal is to download all session law PDF files.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.ncleg.gov/Laws/SessionLawPublications}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{urls} \PYG{o}{=}\PYG{p}{[}\PYG{p}{]}
\PYG{n}{sessions} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{div.docSiteFiles.mt\PYGZhy{}3 \PYGZgt{} div a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{session} \PYG{o+ow}{in} \PYG{n}{sessions}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{session}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{idx}\PYG{p}{,}\PYG{n}{url} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{urls}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch36:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{k}{with} \PYG{n+nb}{open}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{file}\PYG{p}{)}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{k}{as} \PYG{n}{f}\PYG{p}{:}  \PYG{c+c1}{\PYGZsh{} open in readonly mode}
        \PYG{c+c1}{\PYGZsh{} creating a pdf File object of original pdf}
        \PYG{n}{pdfFileObj} \PYG{o}{=} \PYG{n+nb}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rb}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{pdfReader} \PYG{o}{=} \PYG{n}{PyPDF2}\PYG{o}{.}\PYG{n}{PdfFileReader}\PYG{p}{(}\PYG{n}{pdfFileObj}\PYG{p}{)}
        \PYG{n}{pagenumber} \PYG{o}{=}  \PYG{n}{pdfReader}\PYG{o}{.}\PYG{n}{numPages}
        \PYG{n}{acttxt} \PYG{o}{=}\PYG{p}{[}\PYG{p}{]}
        \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{p} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{pagenumber}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{pageObj} \PYG{o}{=} \PYG{n}{pdfReader}\PYG{o}{.}\PYG{n}{getPage}\PYG{p}{(}\PYG{n}{p}\PYG{p}{)}
            \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{pageObj}\PYG{o}{.}\PYG{n}{extractText}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
        \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                     \PYG{n}{keep} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace} \PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NC\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NC\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NC\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NC\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Import libraries}
\label{\detokenize{ch36:id1}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch36:id2}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Direct webscraping}
\label{\detokenize{ch36:direct-webscraping}}
\sphinxAtStartPar
All session laws on the website are stored as the html file. We can webscrape all session laws directly. Here we adopt a strategy to get all urls for all session laws, and then visit the url to extract the full text.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.scstatehouse.gov/aacts.php}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{sessions} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{div\PYGZsh{}contentsection a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{idx}\PYG{p}{,} \PYG{n}{session} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{sessions}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{sessionname} \PYG{o}{=} \PYG{n}{session}\PYG{o}{.}\PYG{n}{text}
    \PYG{k}{if} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Excel}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o+ow}{in} \PYG{n}{sessionname}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{sessionname}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{session\PYGZus{}url} \PYG{o}{=} \PYG{n}{session}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{session\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{idx}\PYG{p}{,} \PYG{n}{session\PYGZus{}url} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{session\PYGZus{}urls}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{h2.barheader}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{yr} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{h2.barheader}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}\PYG{o}{.}\PYG{n}{rsplit}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Acts}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{rsplit}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{rsplit}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ }\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
    \PYG{k}{if} \PYG{n}{yr} \PYG{o+ow}{in} \PYG{n}{specialyears}\PYG{p}{:}
        \PYG{n}{sessiongroup} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{div\PYGZsh{}resultsbox dl dd a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{k}{for} \PYG{n}{element} \PYG{o+ow}{in} \PYG{n}{sessiongroup}\PYG{p}{:}
            \PYG{n}{sgurl} \PYG{o}{=} \PYG{n}{element}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
            \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{sgurl}\PYG{p}{)}
            \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
                \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{div\PYGZsh{}contentsection}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
            \PYG{p}{)}
            \PYG{n}{lawlist} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{div\PYGZsh{}contentsection dl dt a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
            \PYG{k}{for} \PYG{n}{element} \PYG{o+ow}{in} \PYG{n}{lawlist}\PYG{p}{:}
                \PYG{n}{url} \PYG{o}{=} \PYG{n}{element}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
                \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
            \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{div\PYGZsh{}resultsbox dl dd}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
        \PYG{p}{)}
        \PYG{n}{lawlist} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}xpath}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{//*[@id=}\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{resultsbox}\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{]/ dl / dt / a[1]}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{for} \PYG{n}{element} \PYG{o+ow}{in} \PYG{n}{lawlist}\PYG{p}{:}
            \PYG{n}{url} \PYG{o}{=} \PYG{n}{element}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
            \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{idx}\PYG{p}{,} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{urls}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{textloc} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{div.bill\PYGZhy{}list\PYGZhy{}item a.nodisplay}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{n}{docurl} \PYG{o}{=} \PYG{n}{textloc}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{docurls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{docurl}\PYG{p}{)}
        \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{docurl}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n}{docurls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{body} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{acttxt} \PYG{o}{=} \PYG{n}{body}\PYG{o}{.}\PYG{n}{text}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text saving}
\label{\detokenize{ch36:text-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                     \PYG{n}{keep} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace} \PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NH\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NH\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NH\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NH\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 46 North Dakota}
\label{\detokenize{ch37:ch-46-north-dakota}}\label{\detokenize{ch37::doc}}
\sphinxAtStartPar
\sphinxhref{https://www.ndlegis.gov/legislative-histories/session-laws}{The North Dakota Legislative Branch} stores all session laws of North Dakota since 1862.

\sphinxAtStartPar
\sphinxincludegraphics{{nd_web}.png}


\section{Import libraries}
\label{\detokenize{ch37:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch37:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch37:pdf-file-download}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.ndlegis.gov/legislative\PYGZhy{}histories/session\PYGZhy{}laws}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{sessionurls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{n}{sessions} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}partial\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Session Laws}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{session} \PYG{o+ow}{in} \PYG{n}{sessions}\PYG{p}{:}
    \PYG{k}{if} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{session}\PYG{o}{.}\PYG{n}{text}\PYG{p}{[}\PYG{p}{:}\PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{)} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{1974}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{session}\PYG{o}{.}\PYG{n}{text}\PYG{p}{)}
        \PYG{n}{sessionurl} \PYG{o}{=} \PYG{n}{session}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{sessionurl}\PYG{p}{)}
        \PYG{n}{sessionurls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{sessionurl}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{k}{pass}

\PYG{k}{for} \PYG{n}{sessionurl} \PYG{o+ow}{in} \PYG{n}{sessionurls}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{sessionurl}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Chapter Categories}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{chapters} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{div \PYGZgt{} div \PYGZgt{} div \PYGZgt{} table \PYGZgt{} tbody \PYGZgt{} tr \PYGZgt{} td \PYGZgt{} p \PYGZgt{} a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{for} \PYG{n}{chapter} \PYG{o+ow}{in} \PYG{n}{chapters}\PYG{p}{:}
            \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{chapter}\PYG{o}{.}\PYG{n}{text}\PYG{p}{)}
            \PYG{k}{if} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Resolutions}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o+ow}{in} \PYG{n}{chapter}\PYG{o}{.}\PYG{n}{text}\PYG{p}{:}
                \PYG{k}{pass}
            \PYG{k}{else}\PYG{p}{:}
                \PYG{n}{url} \PYG{o}{=} \PYG{n}{chapter}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
                \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
                \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{sessionurl}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{urls are done}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{idx}\PYG{p}{,} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{urls}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{C:/Users/longy/OneDrive/Projects/AFRI/data/ND/}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{list\PYGZus{}of\PYGZus{}files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{latest\PYGZus{}file} \PYG{o}{=} \PYG{n+nb}{max}\PYG{p}{(}\PYG{n}{list\PYGZus{}of\PYGZus{}files}\PYG{p}{,} \PYG{n}{key}\PYG{o}{=}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{getctime}\PYG{p}{)}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{latest\PYGZus{}file}\PYG{p}{)}
    \PYG{k}{with} \PYG{n+nb}{open}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{latest\PYGZus{}file}\PYG{p}{)}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{k}{as} \PYG{n}{f}\PYG{p}{:}  \PYG{c+c1}{\PYGZsh{} open in readonly mode}
        \PYG{c+c1}{\PYGZsh{} creating a pdf File object of original pdf}
        \PYG{n}{pdfFileObj} \PYG{o}{=} \PYG{n+nb}{open}\PYG{p}{(}\PYG{n}{latest\PYGZus{}file}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rb}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{pdfReader} \PYG{o}{=} \PYG{n}{PyPDF2}\PYG{o}{.}\PYG{n}{PdfFileReader}\PYG{p}{(}\PYG{n}{pdfFileObj}\PYG{p}{)}
        \PYG{n}{pagenumber} \PYG{o}{=} \PYG{n}{pdfReader}\PYG{o}{.}\PYG{n}{numPages}
        \PYG{n}{acttxt} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{p} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{pagenumber}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{pageObj} \PYG{o}{=} \PYG{n}{pdfReader}\PYG{o}{.}\PYG{n}{getPage}\PYG{p}{(}\PYG{n}{p}\PYG{p}{)}
            \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{pageObj}\PYG{o}{.}\PYG{n}{extractText}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch37:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
    \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
    \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
        \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
        \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
    \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} save bill info into files}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ND\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ND\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ND\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ND\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 38 Ohio}
\label{\detokenize{ch38:ch-38-ohio}}\label{\detokenize{ch38::doc}}
\sphinxstepscope


\chapter{Ch 39 Oklahoma}
\label{\detokenize{ch39:ch-39-oklahoma}}\label{\detokenize{ch39::doc}}
\sphinxAtStartPar
\sphinxhref{http://www.oklegislature.gov/TextOfMeasures.aspx}{Oklahoma State Legislature} website stores all acts passed in Oklahoma. The web address is \sphinxurl{http://www.oklegislature.gov/TextOfMeasures.aspx}.

\sphinxAtStartPar
\sphinxincludegraphics{{ok_web}.png}


\section{import libraries}
\label{\detokenize{ch39:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch39:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch39:pdf-file-download}}
\sphinxAtStartPar
As shown on the above screenshot of \sphinxhref{http://www.oklegislature.gov/TextOfMeasures.aspx}{Oklahoma State Legislature}, users can select chamber, format, session and status. Here, we are to download all PDF files of acts by selecting \sphinxstyleemphasis{Adobe PDF} under \sphinxstylestrong{Select Format} and \sphinxstyleemphasis{Enrolled} under \sphinxstylestrong{Select Status}. For the both chambers, we have two pieces of code to get all act PDF file urls.


\subsection{Get all PDF files for both chambers}
\label{\detokenize{ch39:get-all-pdf-files-for-both-chambers}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{http://www.oklegislature.gov/TextOfMeasures.aspx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{sessions} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2022 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2023 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2022 Third Special Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2022 Second Special Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2021 First Special Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2021 Regular Session \PYGZhy{} Web}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2020 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2020 First Special Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2019 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2018 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2017 Second Special Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2017 First Special Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2017 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2016 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2015 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2014 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2013 Special Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2013 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2012 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2011 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2010 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2009 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2008 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2007 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2006 Second Special Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2006 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2005 Special Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2005 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2004 Special Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2004 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2003 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2002 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2001 Special Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2001 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2012 Special Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2000 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{1999 Special Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{1999 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{1998 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{1997 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{1996 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{1995 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{1994 Second Special Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{1994 First Special Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{1994 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{1993 Regular Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}

\PYG{c+c1}{\PYGZsh{}for senate}
\PYG{k}{for} \PYG{n}{session} \PYG{o+ow}{in} \PYG{n}{sessions}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{session}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}session} \PYG{o}{=} \PYG{n}{Select}\PYG{p}{(}\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}ctl00\PYGZus{}ContentPlaceHolder1\PYGZus{}cbxSessionId}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}session}\PYG{o}{.}\PYG{n}{select\PYGZus{}by\PYGZus{}visible\PYGZus{}text}\PYG{p}{(}\PYG{n}{session}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}status} \PYG{o}{=} \PYG{n}{Select}\PYG{p}{(}\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}ctl00\PYGZus{}ContentPlaceHolder1\PYGZus{}lbxMeasureStatus}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}status}\PYG{o}{.}\PYG{n}{select\PYGZus{}by\PYGZus{}visible\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Enrolled}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}ctl00\PYGZus{}ContentPlaceHolder1\PYGZus{}Button1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}ctl00\PYGZus{}ContentPlaceHolder1\PYGZus{}tblTomData}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}ctl00\PYGZus{}ContentPlaceHolder1\PYGZus{}tblTomData \PYGZgt{} tbody \PYGZgt{} tr h2 b a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{href}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}for house}
\PYG{k}{for} \PYG{n}{session} \PYG{o+ow}{in} \PYG{n}{sessions}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{session}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}ctl00\PYGZus{}ContentPlaceHolder1\PYGZus{}rbChamber\PYGZus{}1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}session} \PYG{o}{=} \PYG{n}{Select}\PYG{p}{(}\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}ctl00\PYGZus{}ContentPlaceHolder1\PYGZus{}cbxSessionId}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}session}\PYG{o}{.}\PYG{n}{select\PYGZus{}by\PYGZus{}visible\PYGZus{}text}\PYG{p}{(}\PYG{n}{session}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}status} \PYG{o}{=} \PYG{n}{Select}\PYG{p}{(}\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}ctl00\PYGZus{}ContentPlaceHolder1\PYGZus{}lbxMeasureStatus}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}status}\PYG{o}{.}\PYG{n}{select\PYGZus{}by\PYGZus{}visible\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Enrolled}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}ctl00\PYGZus{}ContentPlaceHolder1\PYGZus{}Button1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}ctl00\PYGZus{}ContentPlaceHolder1\PYGZus{}tblTomData}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}ctl00\PYGZus{}ContentPlaceHolder1\PYGZus{}tblTomData \PYGZgt{} tbody \PYGZgt{} tr h2 b a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{href}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\subsection{Get all PDF files from above urls}
\label{\detokenize{ch39:get-all-pdf-files-from-above-urls}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{for} \PYG{n}{index}\PYG{p}{,}\PYG{n}{url} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{urls}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{index}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch39:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{badfiles} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
            \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
        \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
        \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{badfiles}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                           \PYG{n}{keep}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{OK\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{OK\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{OK\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{OK\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
There are three types of law sessions including regular session, special session and special organization session. All enrolled bills are named by “HB”,”SB”,”SR”,”HR”,”SJR”, or “HJR” plus bill number and ended with “\sphinxhyphen{}enr”. They are stored as pdf files on Alabama Secretary of State website. You can check the acts on \sphinxhref{https://alison.legislature.state.al.us/acts}{Alabama Legislature website}.


\section{import libraries}
\label{\detokenize{ch39:id1}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch39:id2}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gt}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}
\PYG{n+ne}{FileNotFoundError}\PYG{g+gWhitespace}{                         }Traceback (most recent call last)
\PYG{n+nn}{/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb Cell 7} in \PYG{n+ni}{\PYGZlt{}cell line: 4\PYGZgt{}}\PYG{n+nt}{()}
      \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=0}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{1}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/to/driver}\PYG{l+s+s1}{\PYGZsq{}}
      \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{3}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{c+c1}{\PYGZsh{} Change the working directory}
\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZgt{}} \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=3}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{4}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
      \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=5}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{6}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
      \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=6}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{7}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{c+c1}{\PYGZsh{} Print the current working directory}

\PYG{n+ne}{FileNotFoundError}: [Errno 2] No such file or directory: \PYGZsq{}/yourpath/\PYGZsq{}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch39:id3}}
\sphinxAtStartPar
As shown on \sphinxhref{http://alisondb.legislature.state.al.us/Alison/SelectSession.aspx}{Alabama Legislature website}, all sessions are stored since 2000. We scraped all passed acts since 2000 within a loop using the code \sphinxcode{\sphinxupquote{for yr in range(2000, 2023)}}. There are four types of sessions including regular session (RS), first special session (FS), second special session (SS), and organizational session (OS). For these session types, we had the loop \sphinxcode{\sphinxupquote{for st in ("RS","FS","SS","OS")}}. For acts, there are also six types based on the act sponsor including “HB”, “SB”, “SR”, “HR”, “SJR”, “HJR”. All act PDF files, i.e., enrolled bills are files with the pattern: \sphinxurl{http://alisondb.legislature.state.al.us/ALISON/SearchableInstruments/} + year + session type + “/PrintFiles/” + act type + order number + “\sphinxhyphen{}enr.pdf”. Using this pattern, we can download all act PDF files.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{for} \PYG{n}{yr} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2000}\PYG{p}{,}\PYG{l+m+mi}{2023}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{yr}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{n} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1000}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{for} \PYG{n}{t} \PYG{o+ow}{in} \PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{HB}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{SB}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{SR}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{HR}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{SJR}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{HJR}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{for} \PYG{n}{st} \PYG{o+ow}{in} \PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{RS}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{FS}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{SS}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{OS}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{:}
                \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://alisondb.legislature.state.al.us/ALISON/SearchableInstruments/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{yr}\PYG{p}{)} \PYG{o}{+} \PYG{n}{st} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/PrintFiles/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{t} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{n}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}enr.pdf}\PYG{l+s+s2}{\PYGZdq{}}
                \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
                \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mf}{0.001}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch39:id4}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{badfiles} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
            \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
        \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
        \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{badfiles}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                           \PYG{n}{keep}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AL\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AL\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AL\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AL\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 40 Oregon}
\label{\detokenize{ch40:ch-40-oregon}}\label{\detokenize{ch40::doc}}
\sphinxAtStartPar
\sphinxhref{https://www.oregonlegislature.gov/bills\_laws/Pages/Oregon-Laws.aspx}{The Oregon State Legislature} stores all session laws of Oregon. On the website, there is a \sphinxstyleemphasis{Oregon Laws} section covering session laws from 1999 to 2023.

\sphinxAtStartPar
\sphinxincludegraphics{{or_web}.png}


\section{import libraries}
\label{\detokenize{ch40:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch40:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gt}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}
\PYG{n+ne}{FileNotFoundError}\PYG{g+gWhitespace}{                         }Traceback (most recent call last)
\PYG{n+nn}{/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb Cell 7} in \PYG{n+ni}{\PYGZlt{}cell line: 4\PYGZgt{}}\PYG{n+nt}{()}
      \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=0}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{1}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/to/driver}\PYG{l+s+s1}{\PYGZsq{}}
      \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{3}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{c+c1}{\PYGZsh{} Change the working directory}
\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZgt{}} \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=3}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{4}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/yourpath/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
      \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=5}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{6}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
      \PYG{o}{\PYGZlt{}}\PYG{n}{a} \PYG{n}{href}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vscode\PYGZhy{}notebook\PYGZhy{}cell:/Users/long/Library/CloudStorage/OneDrive\PYGZhy{}Personal/Projects/AFRI\PYGZus{}Coding/codebook/ch3.ipynb\PYGZsh{}X12sZmlsZQ}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{3D?line=6}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{7}\PYG{o}{\PYGZlt{}}\PYG{o}{/}\PYG{n}{a}\PYG{o}{\PYGZgt{}} \PYG{c+c1}{\PYGZsh{} Print the current working directory}

\PYG{n+ne}{FileNotFoundError}: [Errno 2] No such file or directory: \PYGZsq{}/yourpath/\PYGZsq{}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Get all session law url}
\label{\detokenize{ch40:get-all-session-law-url}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{sessionlist} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{span.ms\PYGZhy{}commentexpand\PYGZhy{}iconouter}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{session} \PYG{o+ow}{in} \PYG{n}{sessionlist}\PYG{p}{:}
    \PYG{n}{session}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}

\PYG{n}{chapters} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{td.ms\PYGZhy{}cellstyle.ms\PYGZhy{}vb2 a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{chapter} \PYG{o+ow}{in} \PYG{n}{chapters}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{chapter}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}

\PYG{n}{urlslist} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n+nb}{set}\PYG{p}{(}\PYG{n}{urls}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{urlslist}\PYG{o}{.}\PYG{n}{sort}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{PDF file download and Direct webscraping}
\label{\detokenize{ch40:pdf-file-download-and-direct-webscraping}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files of session laws and extract all full texts, or webscrape all full texts of session laws directly.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{for} \PYG{n}{idx}\PYG{p}{,} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{urlslist}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{k}{if} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.pdf}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o+ow}{in} \PYG{n}{url}\PYG{p}{:}
        \PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/Users/long/OneDrive/Projects/AFRI/data/OR/}\PYG{l+s+s2}{\PYGZdq{}}
        \PYG{n}{list\PYGZus{}of\PYGZus{}files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{latest\PYGZus{}file} \PYG{o}{=} \PYG{n+nb}{max}\PYG{p}{(}\PYG{n}{list\PYGZus{}of\PYGZus{}files}\PYG{p}{,} \PYG{n}{key}\PYG{o}{=}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{getctime}\PYG{p}{)}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{latest\PYGZus{}file}\PYG{p}{)}
        \PYG{k}{with} \PYG{n+nb}{open}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{latest\PYGZus{}file}\PYG{p}{)}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{k}{as} \PYG{n}{f}\PYG{p}{:}  \PYG{c+c1}{\PYGZsh{} open in readonly mode}
            \PYG{c+c1}{\PYGZsh{} creating a pdf File object of original pdf}
            \PYG{n}{pdfFileObj} \PYG{o}{=} \PYG{n+nb}{open}\PYG{p}{(}\PYG{n}{latest\PYGZus{}file}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rb}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
            \PYG{n}{pdfReader} \PYG{o}{=} \PYG{n}{PyPDF2}\PYG{o}{.}\PYG{n}{PdfFileReader}\PYG{p}{(}\PYG{n}{pdfFileObj}\PYG{p}{)}
            \PYG{n}{pagenumber} \PYG{o}{=} \PYG{n}{pdfReader}\PYG{o}{.}\PYG{n}{numPages}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
            \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
            \PYG{k}{for} \PYG{n}{p} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{pagenumber}\PYG{p}{)}\PYG{p}{:}
                \PYG{n}{pageObj} \PYG{o}{=} \PYG{n}{pdfReader}\PYG{o}{.}\PYG{n}{getPage}\PYG{p}{(}\PYG{n}{p}\PYG{p}{)}
                \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{pageObj}\PYG{o}{.}\PYG{n}{extractText}\PYG{p}{(}\PYG{p}{)}
                \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
                \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{html} \PYG{o}{=} \PYG{n}{requests}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
        \PYG{n}{soup} \PYG{o}{=} \PYG{n}{BeautifulSoup}\PYG{p}{(}\PYG{n}{html}\PYG{o}{.}\PYG{n}{content}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{html.parser}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{n}{tag} \PYG{o}{=} \PYG{n}{soup}\PYG{o}{.}\PYG{n}{body}
        \PYG{n}{acttxt} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{string} \PYG{o+ow}{in} \PYG{n}{tag}\PYG{o}{.}\PYG{n}{strings}\PYG{p}{:}
            \PYG{n}{acttxt}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{string}\PYG{p}{)}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Data saving}
\label{\detokenize{ch40:data-saving}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Session Laws}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Link to full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{urls}\PYG{p}{,}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{OR\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{OR\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{OR\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{OR\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 41 Pennsylvania}
\label{\detokenize{ch41:ch-41-pennsylvania}}\label{\detokenize{ch41::doc}}
\sphinxstepscope


\chapter{Ch 42 Rhode Island}
\label{\detokenize{ch42:ch-42-rhode-island}}\label{\detokenize{ch42::doc}}
\sphinxAtStartPar
\sphinxhref{http://webserver.rilegislature.gov/search/search.asp?SearchWhere=/Billtext97/}{The State of Rhode Island General Assembly} stores all session laws of Rhode Island. On the website, there is a \sphinxstyleemphasis{Search The Rhode Island General Assembly Website} page. Through this page, we can search all session laws.

\sphinxAtStartPar
\sphinxincludegraphics{{ri_act}.png}


\section{Import libraries}
\label{\detokenize{ch42:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch42:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Direct webscraping}
\label{\detokenize{ch42:direct-webscraping}}
\sphinxAtStartPar
All session laws on the website are stored as the html files. We can webscrape them directly. With observation, there is an url pattern for the session laws: \sphinxcode{\sphinxupquote{"http://webserver.rilin.state.ri.us/PublicLaws/law" + *year* + "/law" + *year*  + *act number* + ".htm"}}.
\sphinxincludegraphics{{ri_act}.png}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{act\PYGZus{}urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{checklist} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{session\PYGZus{}acts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{year} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{23}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n+nb}{str}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{year}\PYG{l+s+si}{:}\PYG{l+s+s2}{02}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{session\PYGZus{}url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://webserver.rilin.state.ri.us/Lawrevision/plshort/pl}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{20}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{year}\PYG{l+s+si}{:}\PYG{l+s+s2}{02}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{nu.htm}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}
    \PYG{n}{no} \PYG{o}{=} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{tbody tr}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{no}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n+nb}{str}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{i}\PYG{l+s+si}{:}\PYG{l+s+s2}{03}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://webserver.rilin.state.ri.us/PublicLaws/law}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{year}\PYG{l+s+si}{:}\PYG{l+s+s2}{02}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/law}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{year}\PYG{l+s+si}{:}\PYG{l+s+s2}{02}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{i}\PYG{l+s+si}{:}\PYG{l+s+s2}{03}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYG{o}{+}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.htm}\PYG{l+s+s2}{\PYGZdq{}}
        \PYG{k}{try}\PYG{p}{:}
            \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
            \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
            \PYG{n}{act\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
            \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
        \PYG{k}{except}\PYG{p}{:}
            \PYG{n}{checklist}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n}{act\PYGZus{}urls}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acttxt} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch42:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} save bill info into files}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{RI\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{RI\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{RI\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{RI\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 43 South Carolina}
\label{\detokenize{ch43:ch-43-south-carolina}}\label{\detokenize{ch43::doc}}
\sphinxAtStartPar
\sphinxhref{https://www.scstatehouse.gov/aacts.php}{The South Carolina Legislature} stores all session laws of South Carolina. On the website, there is an \sphinxstyleemphasis{Acts Archives} section covering acts.

\sphinxAtStartPar
\sphinxincludegraphics{{sc_web}.png}


\section{Import libraries}
\label{\detokenize{ch43:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch43:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Direct webscraping}
\label{\detokenize{ch43:direct-webscraping}}
\sphinxAtStartPar
All session laws on the website are stored as the html file. We can webscrape all session laws directly. Here we adopt a strategy to get all urls for all session laws, and then visit the url to extract the full text.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.scstatehouse.gov/aacts.php}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{sessions} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{div\PYGZsh{}contentsection a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{idx}\PYG{p}{,} \PYG{n}{session} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{sessions}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{sessionname} \PYG{o}{=} \PYG{n}{session}\PYG{o}{.}\PYG{n}{text}
    \PYG{k}{if} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Excel}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o+ow}{in} \PYG{n}{sessionname}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{sessionname}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{session\PYGZus{}url} \PYG{o}{=} \PYG{n}{session}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{session\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{idx}\PYG{p}{,} \PYG{n}{session\PYGZus{}url} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{session\PYGZus{}urls}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{h2.barheader}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{yr} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{h2.barheader}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}\PYG{o}{.}\PYG{n}{rsplit}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Acts}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{rsplit}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{rsplit}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ }\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
    \PYG{k}{if} \PYG{n}{yr} \PYG{o+ow}{in} \PYG{n}{specialyears}\PYG{p}{:}
        \PYG{n}{sessiongroup} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{div\PYGZsh{}resultsbox dl dd a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{k}{for} \PYG{n}{element} \PYG{o+ow}{in} \PYG{n}{sessiongroup}\PYG{p}{:}
            \PYG{n}{sgurl} \PYG{o}{=} \PYG{n}{element}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
            \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{sgurl}\PYG{p}{)}
            \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
                \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{div\PYGZsh{}contentsection}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
            \PYG{p}{)}
            \PYG{n}{lawlist} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{div\PYGZsh{}contentsection dl dt a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
            \PYG{k}{for} \PYG{n}{element} \PYG{o+ow}{in} \PYG{n}{lawlist}\PYG{p}{:}
                \PYG{n}{url} \PYG{o}{=} \PYG{n}{element}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
                \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
            \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{div\PYGZsh{}resultsbox dl dd}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
        \PYG{p}{)}
        \PYG{n}{lawlist} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}xpath}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{//*[@id=}\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{resultsbox}\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{]/ dl / dt / a[1]}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{for} \PYG{n}{element} \PYG{o+ow}{in} \PYG{n}{lawlist}\PYG{p}{:}
            \PYG{n}{url} \PYG{o}{=} \PYG{n}{element}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
            \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{idx}\PYG{p}{,} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{urls}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{textloc} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{div.bill\PYGZhy{}list\PYGZhy{}item a.nodisplay}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{n}{docurl} \PYG{o}{=} \PYG{n}{textloc}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{docurls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{docurl}\PYG{p}{)}
        \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{docurl}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n}{docurls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{body} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{acttxt} \PYG{o}{=} \PYG{n}{body}\PYG{o}{.}\PYG{n}{text}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text saving}
\label{\detokenize{ch43:text-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                     \PYG{n}{keep} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace} \PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NH\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NH\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NH\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NH\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 44 South Dakota}
\label{\detokenize{ch44:ch-44-south-dakota}}\label{\detokenize{ch44::doc}}
\sphinxAtStartPar
\sphinxhref{https://sdlegislature.gov/Statutes/Archived}{The South Dakota Legislature} stores all session laws of South Dakota. On the website, there is a \sphinxstyleemphasis{Archived Sessions} section covering session laws.

\sphinxAtStartPar
\sphinxincludegraphics{{sd_web}.png}


\section{Import libraries}
\label{\detokenize{ch44:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch44:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Direct webscraping}
\label{\detokenize{ch44:direct-webscraping}}
\sphinxAtStartPar
All session laws on the website are stored as the html file. We can webscrape all session laws directly. Here we adopt a strategy to get all urls for all session laws, and then visit the url to extract the full text.

\sphinxAtStartPar
\sphinxincludegraphics{{sd_web}.png}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{urls}\PYG{o}{=}\PYG{p}{[}\PYG{p}{]}
\PYG{n}{sessionurls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.sdlegislature.gov/Session/Archived}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}sessions = driver.find\PYGZus{}elements\PYGZus{}by\PYGZus{}link\PYGZus{}text(\PYGZdq{}Session Laws\PYGZdq{})}
\PYG{n}{sessions} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tbody tr td:nth\PYGZhy{}child(7) a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{session} \PYG{o+ow}{in} \PYG{n}{sessions}\PYG{p}{:}
    \PYG{n}{sessionurl} \PYG{o}{=} \PYG{n}{session}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{sessionurls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{sessionurl}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{sessionurl} \PYG{o+ow}{in} \PYG{n}{sessionurls}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{sessionurl}\PYG{p}{)}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n+nb}{list} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{tbody tr td:nth\PYGZhy{}child(1) span a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{k}{for} \PYG{n}{row} \PYG{o+ow}{in} \PYG{n+nb}{list}\PYG{p}{:}
            \PYG{n}{url} \PYG{o}{=} \PYG{n}{row}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
            \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{sessionurl}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{urls are done}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n}{urls}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{acttxt} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch44:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} save bill info into files}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{SD\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{SD\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{SD\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{SD\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 45 Tennessee}
\label{\detokenize{ch45:ch-45-tennessee}}\label{\detokenize{ch45::doc}}
\sphinxAtStartPar
\sphinxhref{https://www.capitol.tn.gov/legislation/archives.html}{The Tennessee General Assembly} stores all session laws of Tennessee. On the website, there is a \sphinxstyleemphasis{Legislation Archives} section including Bills and Resolutions, Public Chapters, and Legislative Record. Here we focus on Public Chapters.

\sphinxAtStartPar
\sphinxincludegraphics{{tn_web}.png}


\section{Import libraries}
\label{\detokenize{ch45:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch45:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Direct webscraping and PDF file download}
\label{\detokenize{ch45:direct-webscraping-and-pdf-file-download}}
\sphinxAtStartPar
On \sphinxhref{https://sharetngov.tnsosfiles.com/sos/acts/100/pub/pc1-100.htm}{100th General Assembly Public Acts (1997\sphinxhyphen{}1998)} of the website, all public acts are stored as html files. We can webscrape all acts directly. For the left sessions available on the website, all acts are stored as PDF files. So, we can download all act PDF files.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{1140}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://sharetngov.tnsosfiles.com/sos/acts/100/pub/Pubc}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{o}{.}\PYG{n}{zfill}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.HTM}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mf}{0.01}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{acttxt} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{year} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{101}\PYG{p}{,}\PYG{l+m+mi}{105}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{1500}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://sharetngov.s3.amazonaws.com/sos/acts/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/pub/pc}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{o}{.}\PYG{n}{zfill}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.pdf}\PYG{l+s+s2}{\PYGZdq{}}
        \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mf}{0.001}\PYG{p}{)}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{year} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{105}\PYG{p}{,}\PYG{l+m+mi}{113}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{1500}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://publications.tnsosfiles.com/acts/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/pub/pc}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{o}{.}\PYG{n}{zfill}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.pdf}\PYG{l+s+s2}{\PYGZdq{}}
        \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mf}{0.001}\PYG{p}{)}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch45:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
    \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
    \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
        \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
        \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
    \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} save bill info into files}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{TX\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{TX\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{TX\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{TX\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 46 Texas}
\label{\detokenize{ch46:ch-46-texas}}\label{\detokenize{ch46::doc}}
\sphinxAtStartPar
\sphinxhref{https://lrl.texas.gov/legis/billsearch/searchchapter.cfm?legSession=87-0\&chapter=\&submitbutton=Search+by+chapter}{The Legislative Reference Library of Texas} stores all session laws of Texas.

\sphinxAtStartPar
\sphinxincludegraphics{{tx_web}.png}


\section{Import libraries}
\label{\detokenize{ch46:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch46:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch46:pdf-file-download}}
\sphinxAtStartPar
First, we can visit each session on the website with the pattern: “\sphinxurl{https://lrl.texas.gov/legis/billsearch/searchchapter.cfm?legSession=}” + \sphinxstyleemphasis{session number} +”\sphinxhyphen{}” + \sphinxstyleemphasis{subsession number} + “\&chapter=\&submitbutton=Search+by+chapter”. Clicking the numbers under \sphinxstyleemphasis{Chapter} column,we can download the act PDF \sphinxhref{http://files.So}{files.So}, the main task is to get the urls for act PDF files, and click the urls to get all PDF files. \sphinxincludegraphics{{tx_act}.png}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}64\PYGZhy{}86th session 2021}
\PYG{n}{urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{session} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{64}\PYG{p}{,}\PYG{l+m+mi}{87}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{sub} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://lrl.texas.gov/legis/billsearch/searchchapter.cfm?legSession=}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{session}\PYG{p}{)} \PYG{o}{+}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{sub}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZam{}chapter=\PYGZam{}submitbutton=Search+by+chapter}\PYG{l+s+s2}{\PYGZdq{}}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
        \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
        \PYG{n}{act\PYGZus{}urls} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{td.results a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
            \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n}{act\PYGZus{}urls}\PYG{p}{:}
                \PYG{n}{act\PYGZus{}url} \PYG{o}{=} \PYG{n}{i}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{href}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
                \PYG{k}{if} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{pdf}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o+ow}{in} \PYG{n}{act\PYGZus{}url}\PYG{p}{:}
                    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{act\PYGZus{}url}\PYG{p}{)}
                    \PYG{n}{urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{act\PYGZus{}url}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{urls}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{act}\PYG{p}{)}
    \PYG{n}{t} \PYG{o}{=} \PYG{l+m+mf}{0.1}\PYG{o}{*} \PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{9}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{n}{t}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch46:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
    \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
    \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
        \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
        \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
    \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} save bill info into files}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{TX\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{TX\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{TX\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{TX\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 48 Utah}
\label{\detokenize{ch47:ch-48-utah}}\label{\detokenize{ch47::doc}}
\sphinxAtStartPar
\sphinxhref{https://le.utah.gov/asp/passedbills/passedbills.asp?session=2022GS}{Utah State Legislature} stores all laws of Utah Chapter.

\sphinxAtStartPar
\sphinxincludegraphics{{ut_web}.png}


\section{Import libraries}
\label{\detokenize{ch47:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch47:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch47:pdf-file-download}}
\sphinxAtStartPar
With observation, the laws of Utah Chapter are stored on the website with the pattern: “\sphinxurl{https://le.utah.gov/~}” + \sphinxstyleemphasis{year} + “/bills/” + h (house)/s (senate) billenr/ + HB/SB + “act number” +”.pdf”. The key for the pattern is we need to get the act number under house or senate. And then, we can generate the urls for all act PDF files.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{act\PYGZus{}urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{year} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{1998}\PYG{p}{,}\PYG{l+m+mi}{2023}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{GS}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{S1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{S2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{S3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{S4}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{S5}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{S6}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{H1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{:}
        \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://le.utah.gov/asp/passedbills/passedbills.asp?session=}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)} \PYG{o}{+} \PYG{n}{i}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
        \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
        \PYG{k}{try}\PYG{p}{:}
            \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}main\PYGZhy{}content \PYGZgt{} div \PYGZgt{} article \PYGZgt{} form \PYGZgt{} table \PYGZgt{} tbody \PYGZgt{} tr \PYGZgt{} td:nth\PYGZhy{}child(1) \PYGZgt{} a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
            \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
                \PYG{n}{act\PYGZus{}url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{href}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
                \PYG{n}{act\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{act\PYGZus{}url}\PYG{p}{)}
        \PYG{k}{except}\PYG{p}{:}
            \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{No Session}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{i}\PYG{p}{,}\PYG{n}{url} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{act\PYGZus{}urls}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{i}\PYG{p}{,}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{url} \PYG{o}{=} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{actno} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{search}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{static/(.*).html}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{url}\PYG{p}{)}\PYG{o}{.}\PYG{n}{group}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{year} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{search}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/\PYGZti{}(.*)/bills/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{url}\PYG{p}{)}\PYG{o}{.}\PYG{n}{group}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{k}{if} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{S}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o+ow}{in} \PYG{n}{actno}\PYG{p}{:}
        \PYG{n}{acttxt\PYGZus{}url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://le.utah.gov/\PYGZti{}}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{year} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/bills/sbillenr/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{actno} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.pdf}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{acttxt\PYGZus{}url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://le.utah.gov/\PYGZti{}}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{year} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/bills/hbillenr/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{actno} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.pdf}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{acttxt\PYGZus{}url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{acttxt\PYGZus{}url}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mf}{0.002}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch47:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
    \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
    \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
        \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
        \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
    \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} save bill info into files}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VT\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VT\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VT\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VT\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 48 Vermont}
\label{\detokenize{ch48:ch-48-vermont}}\label{\detokenize{ch48::doc}}
\sphinxAtStartPar
\sphinxhref{https://legislature.vermont.gov/bill/passed/2022\#both-house-and-senate}{Vermont General Assembly} stores all acts in Vermont.

\sphinxAtStartPar
\sphinxincludegraphics{{vt_web}.png}


\section{Import libraries}
\label{\detokenize{ch48:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch48:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Direct Webscraping}
\label{\detokenize{ch48:direct-webscraping}}
\sphinxAtStartPar
Clicking an act, there are several versions of full text. Our task is to webscrape the version of \sphinxstyleemphasis{Governor: Acts of Assembly Chapter text} and also download the PDF file.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{act\PYGZus{}urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2010}\PYG{p}{,} \PYG{l+m+mi}{2024}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}
    \PYG{n}{url1} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://legislature.vermont.gov/bill/passed/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}house}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url1}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bills\PYGZhy{}passed\PYGZhy{}senate}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{refresh}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bills\PYGZhy{}passed\PYGZhy{}house\PYGZus{}length \PYGZgt{} label \PYGZgt{} select \PYGZgt{} option:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}
        \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bills\PYGZhy{}passed\PYGZhy{}house \PYGZgt{} tbody \PYGZgt{} tr \PYGZgt{} td:nth\PYGZhy{}child(4) \PYGZgt{} a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
            \PYG{n}{act\PYGZus{}url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{href}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
            \PYG{n}{act\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{act\PYGZus{}url}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{url1}\PYG{p}{)}

    \PYG{n}{url2} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://legislature.vermont.gov/bill/passed/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{?\PYGZsh{}senate}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url2}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bills\PYGZhy{}passed\PYGZhy{}senate}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{refresh}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}
            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bills\PYGZhy{}passed\PYGZhy{}senate\PYGZus{}wrapper \PYGZgt{} div:nth\PYGZhy{}child(3) \PYGZgt{} div.dt\PYGZhy{}left \PYGZgt{} div \PYGZgt{} label \PYGZgt{} select \PYGZgt{} option:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}
        \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bills\PYGZhy{}passed\PYGZhy{}house \PYGZgt{} tbody \PYGZgt{} tr \PYGZgt{} td:nth\PYGZhy{}child(4) \PYGZgt{} a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
            \PYG{n}{act\PYGZus{}url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{href}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
            \PYG{n}{act\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{act\PYGZus{}url}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{url2}\PYG{p}{)}

    \PYG{n}{url3} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://legislature.vermont.gov/bill/passed/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}both\PYGZhy{}house\PYGZhy{}and\PYGZhy{}senate}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url3}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bills\PYGZhy{}passed\PYGZhy{}senate}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{refresh}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}
            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bills\PYGZhy{}passed\PYGZhy{}both\PYGZus{}wrapper \PYGZgt{} div:nth\PYGZhy{}child(3) \PYGZgt{} div.dt\PYGZhy{}left \PYGZgt{} div \PYGZgt{} label \PYGZgt{} select \PYGZgt{} option:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}
        \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bills\PYGZhy{}passed\PYGZhy{}house \PYGZgt{} tbody \PYGZgt{} tr \PYGZgt{} td:nth\PYGZhy{}child(4) \PYGZgt{} a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
            \PYG{n}{act\PYGZus{}url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{href}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
            \PYG{n}{act\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{act\PYGZus{}url}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{url3}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2010.1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2018.1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2021.1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}
    \PYG{n}{url1} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://legislature.vermont.gov/bill/passed/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}house}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url1}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bills\PYGZhy{}passed\PYGZhy{}house}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{refresh}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bills\PYGZhy{}passed\PYGZhy{}house\PYGZus{}length \PYGZgt{} label \PYGZgt{} select \PYGZgt{} option:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}
        \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bills\PYGZhy{}passed\PYGZhy{}house \PYGZgt{} tbody \PYGZgt{} tr \PYGZgt{} td:nth\PYGZhy{}child(4) \PYGZgt{} a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
            \PYG{n}{act\PYGZus{}url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{href}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
            \PYG{n}{act\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{act\PYGZus{}url}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{url1}\PYG{p}{)}

    \PYG{n}{url2} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://legislature.vermont.gov/bill/passed/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{?\PYGZsh{}senate}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url2}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bills\PYGZhy{}passed\PYGZhy{}senate}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{refresh}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}
            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bills\PYGZhy{}passed\PYGZhy{}senate\PYGZus{}wrapper \PYGZgt{} div:nth\PYGZhy{}child(3) \PYGZgt{} div.dt\PYGZhy{}left \PYGZgt{} div \PYGZgt{} label \PYGZgt{} select \PYGZgt{} option:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}
        \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bills\PYGZhy{}passed\PYGZhy{}house \PYGZgt{} tbody \PYGZgt{} tr \PYGZgt{} td:nth\PYGZhy{}child(4) \PYGZgt{} a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
            \PYG{n}{act\PYGZus{}url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{href}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
            \PYG{n}{act\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{act\PYGZus{}url}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{url2}\PYG{p}{)}

    \PYG{n}{url3} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://legislature.vermont.gov/bill/passed/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}both\PYGZhy{}house\PYGZhy{}and\PYGZhy{}senate}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url3}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bills\PYGZhy{}passed\PYGZhy{}senate}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{refresh}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}
            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bills\PYGZhy{}passed\PYGZhy{}both\PYGZus{}wrapper \PYGZgt{} div:nth\PYGZhy{}child(3) \PYGZgt{} div.dt\PYGZhy{}left \PYGZgt{} div \PYGZgt{} label \PYGZgt{} select \PYGZgt{} option:nth\PYGZhy{}child(2)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}
        \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}bills\PYGZhy{}passed\PYGZhy{}house \PYGZgt{} tbody \PYGZgt{} tr \PYGZgt{} td:nth\PYGZhy{}child(4) \PYGZgt{} a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
            \PYG{n}{act\PYGZus{}url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{href}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
            \PYG{n}{act\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{act\PYGZus{}url}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{url3}\PYG{p}{)}
\PYG{n}{act\PYGZus{}urls} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n+nb}{set}\PYG{p}{(}\PYG{n}{act\PYGZus{}urls}\PYG{p}{)}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n}{act\PYGZus{}urls}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch48:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
    \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
    \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
        \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
        \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
    \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
    \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} save bill info into files}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VT\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VT\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VT\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VT\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 49 Virginia}
\label{\detokenize{ch49:ch-49-virginia}}\label{\detokenize{ch49::doc}}
\sphinxAtStartPar
\sphinxhref{https://lis.virginia.gov/lis.htm}{Virginia’s Legislative Information System} stores all acts of assembly chapters in Virginia.

\sphinxAtStartPar
\sphinxincludegraphics{{va_web}.png}


\section{Import libraries}
\label{\detokenize{ch49:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch49:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch49:pdf-file-download}}
\sphinxAtStartPar
Under a session, clicking an act, we can download the act full text as a PDF file.

\sphinxAtStartPar
\sphinxincludegraphics{{va_acts}.png}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://lis.virginia.gov/lis.htm}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{select\PYGZus{}sessionyear} \PYG{o}{=} \PYG{n}{Select}\PYG{p}{(}\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}sLink \PYGZgt{} form \PYGZgt{} select}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{sessions} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}sLink \PYGZgt{} form \PYGZgt{} select \PYGZgt{} option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{session\PYGZus{}texts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{session} \PYG{o+ow}{in} \PYG{n}{sessions}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{session}\PYG{o}{.}\PYG{n}{text}\PYG{p}{)}
    \PYG{n}{session\PYGZus{}texts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{session}\PYG{o}{.}\PYG{n}{text}\PYG{p}{)}

\PYG{n}{act\PYGZus{}urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{text} \PYG{o+ow}{in} \PYG{n}{session\PYGZus{}texts}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://lis.virginia.gov/lis.htm}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{element\PYGZus{}to\PYGZus{}be\PYGZus{}clickable}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}sLink \PYGZgt{} form \PYGZgt{} select}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}sessionyear} \PYG{o}{=} \PYG{n}{Select}\PYG{p}{(}\PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}sLink \PYGZgt{} form \PYGZgt{} select}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{select\PYGZus{}sessionyear}\PYG{o}{.}\PYG{n}{select\PYGZus{}by\PYGZus{}visible\PYGZus{}text}\PYG{p}{(}\PYG{n}{text}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{element\PYGZus{}to\PYGZus{}be\PYGZus{}clickable}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}mainLink \PYGZgt{} li:nth\PYGZhy{}child(1) \PYGZgt{} a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}mainLink \PYGZgt{} li:nth\PYGZhy{}child(1) \PYGZgt{} a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{element\PYGZus{}to\PYGZus{}be\PYGZus{}clickable}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{LINK\PYGZus{}TEXT}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Acts of Assembly chapters}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Acts of Assembly chapters}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}mainC \PYGZgt{} ul \PYGZgt{} li \PYGZgt{} a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{20}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}mainC \PYGZgt{} ul \PYGZgt{} li \PYGZgt{} a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
            \PYG{n}{url} \PYG{o}{=} \PYG{n}{act}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{href}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
            \PYG{n}{act\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
        \PYG{k}{try}\PYG{p}{:}
            \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{More...}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
        \PYG{k}{except}\PYG{p}{:}
            \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{skip}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{checklist} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{pdf\PYGZus{}urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n}{act\PYGZus{}urls}\PYG{p}{:}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
        \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
            \PYG{n}{EC}\PYG{o}{.}\PYG{n}{element\PYGZus{}to\PYGZus{}be\PYGZus{}clickable}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{PARTIAL\PYGZus{}LINK\PYGZus{}TEXT}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{CHAP}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
        \PYG{p}{)}
        \PYG{n}{t} \PYG{o}{=} \PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{9}\PYG{p}{)} \PYG{o}{*} \PYG{l+m+mf}{0.01}
        \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{n}{t}\PYG{p}{)}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{refresh}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}partial\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{CHAP}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
            \PYG{n}{EC}\PYG{o}{.}\PYG{n}{element\PYGZus{}to\PYGZus{}be\PYGZus{}clickable}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
        \PYG{p}{)}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{refresh}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{n}{t}\PYG{p}{)}
        \PYG{n}{acttxt} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}mainC}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
        \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
        \PYG{n}{pdf\PYGZus{}url} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{pdf}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{href}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{pdf\PYGZus{}url}\PYG{p}{)}
        \PYG{n}{pdf\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pdf\PYGZus{}url}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n}{checklist}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch49:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                     \PYG{n}{keep} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace} \PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} save acts info into files}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VA\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VA\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VA\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VA\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 50 Washington}
\label{\detokenize{ch50:ch-50-washington}}\label{\detokenize{ch50::doc}}
\sphinxstepscope


\chapter{Ch 51 West Virginia}
\label{\detokenize{ch51:ch-51-west-virginia}}\label{\detokenize{ch51::doc}}
\sphinxAtStartPar
\sphinxhref{https://www.wvlegislature.gov/index.cfm}{West Virginia Legislature} stores all acts in West Virginia.

\sphinxAtStartPar
\sphinxincludegraphics{{wv_web}.png}

\sphinxAtStartPar
On the website, there is a \sphinxstyleemphasis{Publications of the West Virginia Legislature} page. From this page, we can download all acts during 1975\sphinxhyphen{}2022.

\sphinxAtStartPar
\sphinxincludegraphics{{wv_acts}.png}


\section{Import libraries}
\label{\detokenize{ch51:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch51:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch51:pdf-file-download}}
\sphinxAtStartPar
On \sphinxstyleemphasis{Publications of the West Virginia Legislature} page, there is a section \sphinxstyleemphasis{Acts of the Legislature of West Virginia}. From this section, we can see all volumes (PDF version) for West Virginia acts. So, the main goal is to download all volume PDF files. \sphinxincludegraphics{{wv_acts}.png}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{act\PYGZus{}urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{checklist} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{session\PYGZus{}acts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.wvlegislature.gov/Educational/publications.cfm\PYGZsh{}acts}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}most sessions except 2003}
\PYG{n}{sessions} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}partial\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Vol.}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{session} \PYG{o+ow}{in} \PYG{n}{sessions}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{n}{session}\PYG{o}{.}\PYG{n}{get\PYGZus{}attribute}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{href}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}2003 sessions}
\PYG{n}{othersessions} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.wvlegislature.gov/legisdocs/publications/acts/Acts\PYGZus{}2003\PYGZus{}Vol\PYGZus{}1.pdf}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.wvlegislature.gov/legisdocs/publications/acts/Acts\PYGZus{}2003\PYGZus{}Vol\PYGZus{}2.pdf}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.wvlegislature.gov/legisdocs/publications/acts/Acts\PYGZus{}2003\PYGZus{}2ES.pdf}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n}{othersessions}\PYG{p}{:}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch51:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{badfiles} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
            \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
        \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
        \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{badfiles}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                     \PYG{n}{keep} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace} \PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} save bill info into files}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{WY\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{WY\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{WY\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{WY\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 52 Wisconsin}
\label{\detokenize{ch52:ch-52-wisconsin}}\label{\detokenize{ch52::doc}}
\sphinxAtStartPar
\sphinxhref{https://docs.legis.wisconsin.gov/archive/law}{Wisconsin State Legislature} stores all public acts in Wyoming since 2001. On the website, there is a \sphinxstyleemphasis{Law Archive} page. From this page, we can download all acts during 1975\sphinxhyphen{}2022.

\sphinxAtStartPar
\sphinxincludegraphics{{wi_web}.png}


\section{Import libraries}
\label{\detokenize{ch52:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch52:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{PDF file download}
\label{\detokenize{ch52:pdf-file-download}}
\sphinxAtStartPar
On \sphinxstyleemphasis{Law Archive}, clicking a year under the \sphinxstyleemphasis{Acts} column, Wisconsin Acts are stored as PDF files. Then the main task is to download all these PDF files. There is a storage url pattern for the PDF files. The url for a PDF file is “\sphinxurl{https://docs.legis.wisconsin.gov/}” + \sphinxstyleemphasis{a session} + “/related/acts/” + \sphinxstyleemphasis{a number} + “.pdf”. So, the strategy to download these PDF files is to visit a session, count how many acts in the session and use this to generate the url for a PDF file. The detail of code is shown as following. \sphinxincludegraphics{{wi_acts}.png}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{sessions} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1975}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1977}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1979}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1981}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1983}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1985}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1987}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1989}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1991}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1993}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1995}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1997}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1999}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2001}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2003}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2005}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2007}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2009}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2011}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2013}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2015}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2017}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2019}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2021}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{session} \PYG{o+ow}{in} \PYG{n}{sessions}\PYG{p}{:}
    \PYG{n}{session\PYGZus{}url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://docs.legis.wisconsin.gov/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{session}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/related/acts}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{session\PYGZus{}url}\PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}partial\PYGZus{}link\PYGZus{}text}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Wisconsin}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{acts}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{pdfurl} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://docs.legis.wisconsin.gov/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{session}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/related/acts/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.pdf}\PYG{l+s+s2}{\PYGZdq{}}
        \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{pdfurl}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch52:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{path}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*.pdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{badfiles} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{:}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{doc} \PYG{o}{=} \PYG{n}{fitz}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{pgtxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{page} \PYG{o+ow}{in} \PYG{n}{doc}\PYG{p}{:}
            \PYG{n}{pgtxt} \PYG{o}{=} \PYG{n}{page}\PYG{o}{.}\PYG{n}{get\PYGZus{}text}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{pgtxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{pgtxt}\PYG{p}{)}
            \PYG{n}{acttxt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{pgtxts}\PYG{p}{)}
        \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
        \PYG{n}{doc}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}
        \PYG{n}{badfiles}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)}

\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                     \PYG{n}{keep} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace} \PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} save bill info into files}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{WY\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{WY\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{WY\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{WY\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\chapter{Ch 53 Wyoming}
\label{\detokenize{ch53:ch-53-wyoming}}\label{\detokenize{ch53::doc}}
\sphinxAtStartPar
\sphinxhref{https://www.wyoleg.gov/}{Wyoming Legislature} stores all public acts in Wyoming since 2001. On the website, there is a Legislation Archives page.

\sphinxAtStartPar
\sphinxincludegraphics{{wy_archive}.png}


\section{Import libraries}
\label{\detokenize{ch53:import-libraries}}
\sphinxAtStartPar
As introduced in the chapter 1, we need to import some libraries as follows.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{time}
\PYG{k+kn}{from} \PYG{n+nn}{selenium} \PYG{k+kn}{import} \PYG{n}{webdriver}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{common}\PYG{n+nn}{.}\PYG{n+nn}{by} \PYG{k+kn}{import} \PYG{n}{By}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{WebDriverWait}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support} \PYG{k+kn}{import} \PYG{n}{expected\PYGZus{}conditions} \PYG{k}{as} \PYG{n}{EC}
\PYG{k+kn}{from} \PYG{n+nn}{selenium}\PYG{n+nn}{.}\PYG{n+nn}{webdriver}\PYG{n+nn}{.}\PYG{n+nn}{support}\PYG{n+nn}{.}\PYG{n+nn}{ui} \PYG{k+kn}{import} \PYG{n}{Select}
\PYG{k+kn}{from} \PYG{n+nn}{time} \PYG{k+kn}{import} \PYG{n}{sleep}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{datefinder}
\PYG{k+kn}{import} \PYG{n+nn}{calendar}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{unittest}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}
\PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}
\PYG{k+kn}{import} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{pickle}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{fitz}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Browser setup}
\label{\detokenize{ch53:browser-setup}}
\sphinxAtStartPar
Before scraping, we need to set up the browser. Here we use ChromeDriver for Google Chrome. You can download ChromeDriver from \sphinxurl{https://chromedriver.chromium.org/downloads} following the version of Google Chrome you use on your laptop.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{driver\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath/driver}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Change the working directory to your path on your computer}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yourpath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Get the working directory}
\PYG{n}{cwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print the current working directory}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Current working directory: }\PYG{l+s+si}{\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{cwd}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the driver}
\PYG{n}{chromeOptions} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{ChromeOptions}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{dnldpath} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{your\PYGZus{}download\PYGZus{}path}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{chromeOptions}\PYG{o}{.}\PYG{n}{add\PYGZus{}experimental\PYGZus{}option}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prefs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.default\PYGZus{}directory}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{dnldpath}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}Change default directory for downloads}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.prompt\PYGZus{}for\PYGZus{}download}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{False}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}To auto download the file}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{download.directory\PYGZus{}upgrade}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{plugins.always\PYGZus{}open\PYGZus{}pdf\PYGZus{}externally}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{}It will not show PDF directly in chrome}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}enable\PYGZhy{}javascript}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{True}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Open the driver}
\PYG{n}{driver} \PYG{o}{=} \PYG{n}{webdriver}\PYG{o}{.}\PYG{n}{Chrome}\PYG{p}{(}\PYG{n}{executable\PYGZus{}path}\PYG{o}{=}\PYG{n}{driver\PYGZus{}path}\PYG{p}{,} \PYG{n}{options}\PYG{o}{=}\PYG{n}{chromeOptions}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Direct webscraping}
\label{\detokenize{ch53:direct-webscraping}}
\sphinxAtStartPar
On Legislation Archives page, selecting a year and clicking \sphinxstyleemphasis{Enrolled Bills} button, we can see all enrolled bills. \sphinxincludegraphics{{wy_enroll}.png}

\sphinxAtStartPar
After enrolled bills show up, clicking one, we can see the bill full text.

\sphinxAtStartPar
\sphinxincludegraphics{{wy_text}.png}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{act\PYGZus{}urls} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{year} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2001}\PYG{p}{,} \PYG{l+m+mi}{2023}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.wyoleg.gov/Legislation/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body \PYGZgt{} div \PYGZgt{} div}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body \PYGZgt{} div \PYGZgt{} div \PYGZgt{} div:nth\PYGZhy{}child(3) \PYGZgt{} section \PYGZgt{} div \PYGZgt{} div:nth\PYGZhy{}child(4) \PYGZgt{} input:nth\PYGZhy{}child(3)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body \PYGZgt{} div \PYGZgt{} div \PYGZgt{} div:nth\PYGZhy{}child(3) \PYGZgt{} section \PYGZgt{} div \PYGZgt{} div.table\PYGZhy{}responsive.ng\PYGZhy{}scope \PYGZgt{} table \PYGZgt{} tbody.ng\PYGZhy{}scope \PYGZgt{} tr \PYGZgt{} td:nth\PYGZhy{}child(1) \PYGZgt{} a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{act\PYGZus{}url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.wyoleg.gov/Legislation/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{act}\PYG{o}{.}\PYG{n}{text}\PYG{p}{)}
        \PYG{n}{act\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{act\PYGZus{}url}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{year} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2019}\PYG{p}{,} \PYG{l+m+mi}{2022}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.wyoleg.gov/Legislation/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{?specialSessionValue=1}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
        \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body \PYGZgt{} div \PYGZgt{} div}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body \PYGZgt{} div \PYGZgt{} div \PYGZgt{} div:nth\PYGZhy{}child(3) \PYGZgt{} section \PYGZgt{} div \PYGZgt{} div:nth\PYGZhy{}child(4) \PYGZgt{} input:nth\PYGZhy{}child(3)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{click}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)}
    \PYG{n}{acts} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}elements\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body \PYGZgt{} div \PYGZgt{} div \PYGZgt{} div:nth\PYGZhy{}child(3) \PYGZgt{} section \PYGZgt{} div \PYGZgt{} div.table\PYGZhy{}responsive.ng\PYGZhy{}scope \PYGZgt{} table \PYGZgt{} tbody.ng\PYGZhy{}scope \PYGZgt{} tr \PYGZgt{} td:nth\PYGZhy{}child(1) \PYGZgt{} a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{act} \PYG{o+ow}{in} \PYG{n}{acts}\PYG{p}{:}
        \PYG{n}{act\PYGZus{}url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://www.wyoleg.gov/Legislation/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{act}\PYG{o}{.}\PYG{n}{text}\PYG{p}{)}
        \PYG{n}{act\PYGZus{}urls}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{act\PYGZus{}url}\PYG{p}{)}

\PYG{n}{act\PYGZus{}urls} \PYG{o}{=} \PYG{p}{[}\PYG{o}{*}\PYG{n+nb}{set}\PYG{p}{(}\PYG{n}{act\PYGZus{}urls}\PYG{p}{)}\PYG{p}{]}

\PYG{n}{acttxts} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{checklist} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{i}\PYG{p}{,}\PYG{n}{url} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{act\PYGZus{}urls}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}
    \PYG{n}{driver}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{WebDriverWait}\PYG{p}{(}\PYG{n}{driver}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{)}\PYG{o}{.}\PYG{n}{until}\PYG{p}{(}
            \PYG{n}{EC}\PYG{o}{.}\PYG{n}{presence\PYGZus{}of\PYGZus{}element\PYGZus{}located}\PYG{p}{(}\PYG{p}{(}\PYG{n}{By}\PYG{o}{.}\PYG{n}{CSS\PYGZus{}SELECTOR}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body \PYGZgt{} div \PYGZgt{} div \PYGZgt{} div:nth\PYGZhy{}child(3) \PYGZgt{} section \PYGZgt{} div \PYGZgt{} div.ng\PYGZhy{}scope \PYGZgt{} div \PYGZgt{} div \PYGZgt{} div.tab\PYGZhy{}pane.ng\PYGZhy{}scope.active \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}8.ng\PYGZhy{}scope}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
        \PYG{p}{)}
        \PYG{n}{acttxt} \PYG{o}{=} \PYG{n}{driver}\PYG{o}{.}\PYG{n}{find\PYGZus{}element\PYGZus{}by\PYGZus{}css\PYGZus{}selector}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{body \PYGZgt{} div \PYGZgt{} div \PYGZgt{} div:nth\PYGZhy{}child(3) \PYGZgt{} section \PYGZgt{} div \PYGZgt{} div.ng\PYGZhy{}scope \PYGZgt{} div \PYGZgt{} div \PYGZgt{} div.tab\PYGZhy{}pane.ng\PYGZhy{}scope.active \PYGZgt{} div.col\PYGZhy{}md\PYGZhy{}8.ng\PYGZhy{}scope}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{text}
        \PYG{n}{acttxts}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{acttxt}\PYG{p}{)}
        \PYG{n}{time}\PYG{o}{.}\PYG{n}{sleep}\PYG{p}{(}\PYG{l+m+mf}{0.001}\PYG{p}{)}
    \PYG{k}{except}\PYG{p}{:}
        \PYG{n}{checklist}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{url} \PYG{o+ow}{in} \PYG{n}{checklist}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Text extraction and saving}
\label{\detokenize{ch53:text-extraction-and-saving}}
\sphinxAtStartPar
In this section, we used the below code to extract all full texts from PDF files and save all act full texts into several format files including excel, csv, pickle and json.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{datasource} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{acttxts}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{drop\PYGZus{}duplicates}\PYG{p}{(}\PYG{n}{subset} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Full text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                     \PYG{n}{keep} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inplace} \PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{ignore\PYGZus{}index}\PYG{o}{=} \PYG{k+kc}{True}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} save bill info into files}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}excel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{WY\PYGZus{}Leginfo.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{WY\PYGZus{}Leginfo.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}pickle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{WY\PYGZus{}Leginfo.pkl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{datasource}\PYG{o}{.}\PYG{n}{to\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{WY\PYGZus{}Leginfo.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}






\renewcommand{\indexname}{Index}
\printindex
\end{document}