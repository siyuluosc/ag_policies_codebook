
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Chapter 7 Appendix &#8212; Codebook for Web-scraping of State Legislative Info</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ch7';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Chapter 6 Conclusion" href="ch6.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/booklogo.png" class="logo__image only-light" alt="Codebook for Web-scraping of State Legislative Info - Home"/>
    <script>document.write(`<img src="_static/booklogo.png" class="logo__image only-dark" alt="Codebook for Web-scraping of State Legislative Info - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    Contents
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ch1.html">Chapter 1 Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch2.html">Chapter 2 Data Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch3.html">Chapter 3 Data cleaning</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch4.html">Chapter 4 Topic Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch5.html">Chapter 5 Sentiment analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch6.html">Chapter 6 Conclusion</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Chapter 7 Appendix</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/_build/html/blob/master/docs/ch7.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/yanxulong/ag_policies_codebook/_build/html" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/yanxulong/ag_policies_codebook/_build/html/issues/new?title=Issue%20on%20page%20%2Fch7.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/ch7.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Chapter 7 Appendix</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="chapter-7-appendix">
<h1>Chapter 7 Appendix<a class="headerlink" href="#chapter-7-appendix" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="c1">#import PyPDF2</span>
<span class="c1">#import glob</span>

<span class="n">driver_path</span> <span class="o">=</span> <span class="s1">&#39;C:/Users/longy/OneDrive/Projects/AFRI/windows/chromedriver.exe&#39;</span> <span class="c1">#for windows</span>
<span class="c1"># driver_path = &#39;/Users/Yanxu/OneDrive/Projects/AgPolicyCoding/chromedriver&#39;</span>
<span class="c1"># driver = webdriver.Chrome(executable_path=DRIVER_PATH)</span>

<span class="c1"># Change the working directory</span>
<span class="c1">#os.chdir(&#39;/Users/long/OneDrive/Projects/AFRI&#39;)</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;C:/Users/longy/OneDrive/Projects/AFRI&#39;</span><span class="p">)</span>
<span class="c1"># os.chdir(&#39;/Volumes/GoogleDrive/Shared drives/UCSC-UMN AFRI project/Data/GA&#39;)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="n">chromeOptions</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
<span class="c1"># for mac</span>
<span class="c1">#dnldpath = {&quot;download.default_directory&quot; : &quot;/Users/long/OneDrive/Projects/AFRI/data/SD/&quot;}</span>
<span class="c1"># for windows</span>
<span class="n">dnldpath</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;download.default_directory&quot;</span> <span class="p">:</span><span class="s2">&quot;C:/Users/longy/OneDrive/Projects/AFRI/data/SD/&quot;</span><span class="p">}</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s2">&quot;prefs&quot;</span><span class="p">,</span><span class="n">dnldpath</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="n">driver_path</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">chromeOptions</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>



<span class="n">urls</span><span class="o">=</span><span class="p">[]</span>
<span class="n">sessionurls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://www.sdlegislature.gov/Session/Archived&quot;</span><span class="p">)</span>
<span class="c1">#sessions = driver.find_elements_by_link_text(&quot;Session Laws&quot;)</span>
<span class="n">sessions</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;tbody tr td:nth-child(7) a&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">sessions</span><span class="p">:</span>
    <span class="n">sessionurl</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
    <span class="n">sessionurls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sessionurl</span><span class="p">)</span>

<span class="k">for</span> <span class="n">sessionurl</span> <span class="ow">in</span> <span class="n">sessionurls</span><span class="p">:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sessionurl</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">list</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s2">&quot;tbody tr td:nth-child(1) span a&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">sessionurl</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;urls are done&quot;</span><span class="p">)</span>

<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">acttxt</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">acttxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1">#sleep(randint(1,2))</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Link to full text&#39;</span><span class="p">:</span><span class="n">urls</span><span class="p">,</span>
    <span class="s1">&#39;Full text&#39;</span><span class="p">:</span> <span class="n">acttxts</span>
<span class="p">})</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;SD_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;SD_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;SD_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;SD_Leginfo.json&#39;</span><span class="p">)</span>
<span class="c1"># End of SD_Leginfo.py</span>


<span class="c1"># Start of IA_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="c1">## others</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">inflect</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># set up working directory</span>
<span class="n">working_directory</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">))</span>

<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;./Data/Raw_Data/IA/PDFs&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>


<span class="c1"># Specify the path to the Firefox binary</span>
<span class="n">firefox_binary_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Firefox.app/Contents/MacOS/firefox&#39;</span>

<span class="c1"># Create a Firefox profile and configure preferences</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
<span class="n">options</span><span class="o">.</span><span class="n">binary_location</span> <span class="o">=</span> <span class="n">firefox_binary_path</span>

<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span> <span class="o">=</span> <span class="s1">&#39;./Data/geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="c1"># Initialize the WebDriver with the specified path</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">service</span><span class="p">)</span>


<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="k">def</span> <span class="nf">get_mdls_where_from</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;mdls&#39;</span><span class="p">,</span> <span class="s1">&#39;-name&#39;</span><span class="p">,</span> <span class="s1">&#39;kMDItemWhereFroms&#39;</span><span class="p">,</span> <span class="s1">&#39;-raw&#39;</span><span class="p">,</span> <span class="n">file_path</span><span class="p">],</span>
                                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">where_from_info</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">where_from_info</span><span class="p">:</span>
                <span class="c1"># The output might be a JSON-like list, so we print it directly</span>
                <span class="k">return</span> <span class="n">where_from_info</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No &#39;Where from&#39; information available.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error running mdls command: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">extract_text_from_pdf</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Open the PDF file</span>
        <span class="n">pdf_document</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Iterate through each page and extract text</span>
        <span class="k">for</span> <span class="n">page_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pdf_document</span><span class="p">)):</span>
            <span class="n">page</span> <span class="o">=</span> <span class="n">pdf_document</span><span class="o">.</span><span class="n">load_page</span><span class="p">(</span><span class="n">page_num</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">text</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>


<span class="n">urls</span><span class="o">=</span><span class="p">[]</span>
<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">session_nos</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">session_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">166</span><span class="p">):</span>

    <span class="n">session_url</span> <span class="o">=</span> <span class="s2">&quot;https://www.legis.iowa.gov/law/statutory/acts/actsChapter?ssid=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>

    <span class="c1"># Navigate to the website</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">session_url</span><span class="p">)</span>

    <span class="c1"># Wait for the links to be loaded on the page</span>
    <span class="n">timeout</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># Adjust the timeout value as needed</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div.grid_9:nth-child(2) &gt; h2:nth-child(1)&#39;</span><span class="p">)))</span>
    <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Timed out waiting for page to load&quot;</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">session_no</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div.grid_9:nth-child(2) &gt; h2:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;IowaActsChapters-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>

    <span class="n">session_name</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div.grid_9:nth-child(2) &gt; h2:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

    <span class="k">if</span> <span class="mi">65</span> <span class="o">&lt;</span> <span class="n">session_no</span> <span class="o">&lt;</span> <span class="mi">90</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">session_no</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">chapters</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span><span class="s1">&#39;Chapter&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">chapter</span> <span class="ow">in</span> <span class="n">chapters</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">chapter</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">chapter</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
                <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="n">chapter</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="n">session_nos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session_no</span><span class="p">)</span>
                <span class="n">session_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session_name</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no Chapter found&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="n">folder_path</span> <span class="o">=</span> <span class="s2">&quot;./Data/Raw_Data/IA/PDFs&quot;</span>
<span class="n">list_of_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>
<span class="c1">#latest_file = max(list_of_files, key=os.path.getctime)</span>
<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_files</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
    <span class="n">acttxt</span> <span class="o">=</span> <span class="n">extract_text_from_pdf</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">acttxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">get_mdls_where_from</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;()</span><span class="se">\n</span><span class="s1"> &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;,</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">acttxts</span><span class="p">,</span>
    <span class="s1">&#39;link&#39;</span><span class="p">:</span> <span class="n">urlss</span><span class="p">,</span>
    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">list_of_files</span><span class="p">,</span>
    <span class="s1">&#39;session_number&#39;</span><span class="p">:</span> <span class="n">session_no</span><span class="p">,</span>
    <span class="s1">&#39;session_name&#39;</span><span class="p">:</span> <span class="n">session_names</span>
<span class="p">})</span>
<span class="n">s</span>
<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;session_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">4</span><span class="p">])</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_act_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;PDFs/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">6</span><span class="p">])</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;act_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;IA&quot;</span> <span class="o">+</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_act_num&#39;</span><span class="p">]</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s1">&#39;IA&#39;</span><span class="p">)</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;./Data/Raw_Data/IA/IA_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;./Data/Raw_Data/IA/IA_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;./Data/Raw_Data/IA/IA_Leginfo.json&#39;</span><span class="p">)</span>
<span class="c1"># End of IA_Leginfo.py</span>


<span class="c1"># Start of ME_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>

<span class="c1">#driver_path = &#39;C:/Users/longy/OneDrive/Projects/AFRI/windows/chromedriver.exe&#39; #for windows</span>
<span class="n">driver_path</span> <span class="o">=</span> <span class="s1">&#39;/Users/long/OneDrive/Projects/AFRI/chromedriver&#39;</span>
<span class="n">driver_path</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/chromedriver&#39;</span>
<span class="c1"># driver = webdriver.Chrome(executable_path=DRIVER_PATH)</span>

<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/ME&#39;</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_directory</span> <span class="o">=</span> <span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/ME&quot;</span>

<span class="c1"># Set Chrome options to automatically download files to the specified directory</span>
<span class="n">chrome_options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
<span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--headless&quot;</span><span class="p">)</span>  <span class="c1"># Run in headless mode (without opening the browser window)</span>
<span class="n">chrome_options</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s2">&quot;prefs&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;download.default_directory&quot;</span><span class="p">:</span> <span class="n">download_directory</span><span class="p">,</span>
    <span class="s2">&quot;download.prompt_for_download&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;download.directory_upgrade&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;plugins.always_open_pdf_externally&quot;</span><span class="p">:</span> <span class="kc">True</span>  <span class="c1"># Open PDF files in an external PDF viewer</span>
<span class="p">})</span>

<span class="c1"># Create the WebDriver instance</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="n">driver_path</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">chrome_options</span><span class="p">)</span>



<span class="c1"># import libraries</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.firefox_profile</span> <span class="kn">import</span> <span class="n">FirefoxProfile</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>


<span class="c1">#driver_path = &#39;C:/Users/longy/OneDrive/Projects/AFRI/windows/chromedriver.exe&#39; #for windows</span>
<span class="n">driver_path</span> <span class="o">=</span> <span class="s1">&#39;/Users/long/OneDrive/Projects/AFRI/chromedriver&#39;</span>
<span class="n">driver_path</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/chromedriver&#39;</span>
<span class="c1"># driver = webdriver.Chrome(executable_path=DRIVER_PATH)</span>

<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/ME&#39;</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/ME&quot;</span>

<span class="c1"># Create a Firefox profile and configure preferences</span>
<span class="n">firefox_profile</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">FirefoxProfile</span><span class="p">()</span>

<span class="c1"># Set the download directory</span>
<span class="n">firefox_profile</span><span class="o">.</span><span class="n">set_preference</span><span class="p">(</span><span class="s2">&quot;browser.download.folderList&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">firefox_profile</span><span class="o">.</span><span class="n">set_preference</span><span class="p">(</span><span class="s2">&quot;browser.download.dir&quot;</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">)</span>

<span class="c1"># Disable the download dialog and set MIME types for automatic download</span>
<span class="n">firefox_profile</span><span class="o">.</span><span class="n">set_preference</span><span class="p">(</span><span class="s2">&quot;browser.download.manager.showWhenStarting&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">firefox_profile</span><span class="o">.</span><span class="n">set_preference</span><span class="p">(</span><span class="s2">&quot;browser.helperApps.neverAsk.saveToDisk&quot;</span><span class="p">,</span> <span class="s2">&quot;application/pdf&quot;</span><span class="p">)</span>
<span class="n">firefox_profile</span><span class="o">.</span><span class="n">set_preference</span><span class="p">(</span><span class="s2">&quot;browser.helperApps.neverAsk.openFile&quot;</span><span class="p">,</span> <span class="s2">&quot;application/pdf&quot;</span><span class="p">)</span>

<span class="c1"># Disable Firefox&#39;s built-in PDF viewer</span>
<span class="n">firefox_profile</span><span class="o">.</span><span class="n">set_preference</span><span class="p">(</span><span class="s2">&quot;pdfjs.disabled&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># Start Firefox with the customized profile</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="s1">&#39;/Volumes/SSD/AFRI/Data/geckodriver&#39;</span><span class="p">,</span><span class="n">firefox_profile</span><span class="o">=</span><span class="n">firefox_profile</span><span class="p">)</span>


<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://lldc.mainelegislature.org/Open/Laws/&#39;</span><span class="p">)</span>

<span class="n">sessions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1975&#39;</span><span class="p">,</span> <span class="s1">&#39;1977&#39;</span><span class="p">,</span> <span class="s1">&#39;1979&#39;</span><span class="p">,</span> <span class="s1">&#39;1981&#39;</span><span class="p">,</span> <span class="s1">&#39;1983&#39;</span><span class="p">,</span> <span class="s1">&#39;1985&#39;</span><span class="p">,</span> <span class="s1">&#39;1987&#39;</span><span class="p">,</span> <span class="s1">&#39;1989&#39;</span><span class="p">,</span> <span class="s1">&#39;1991&#39;</span><span class="p">,</span> <span class="s1">&#39;1993&#39;</span><span class="p">,</span> <span class="s1">&#39;1995&#39;</span><span class="p">,</span> <span class="s1">&#39;1997&#39;</span><span class="p">,</span> <span class="s1">&#39;1999&#39;</span><span class="p">,</span> <span class="s1">&#39;2001&#39;</span><span class="p">,</span> <span class="s1">&#39;2003&#39;</span><span class="p">,</span> <span class="s1">&#39;2005&#39;</span><span class="p">,</span> <span class="s1">&#39;2007&#39;</span><span class="p">,</span> <span class="s1">&#39;2009&#39;</span><span class="p">,</span> <span class="s1">&#39;2011&#39;</span><span class="p">,</span> <span class="s1">&#39;2013&#39;</span><span class="p">,</span> <span class="s1">&#39;2015&#39;</span><span class="p">,</span> <span class="s1">&#39;2017&#39;</span><span class="p">,</span> <span class="s1">&#39;2019&#39;</span><span class="p">,</span> <span class="s1">&#39;2021&#39;</span><span class="p">]</span>

<span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">sessions</span><span class="p">:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://lldc.mainelegislature.org/Open/Laws/&#39;</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="n">pdfs</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">pdf</span> <span class="ow">in</span> <span class="n">pdfs</span><span class="p">:</span>
        <span class="n">pdf</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">pdf</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;_PL_&quot;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
            <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>


<span class="n">bad_act_urls</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/ME/PDFs&quot;</span>

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="c1"># Ensure the request was successful</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="c1"># Write the content of the response to a file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
        <span class="n">bad_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>




<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/ME/PDFs&quot;</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
        <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
        <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>



<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;links&#39;</span><span class="p">:</span><span class="n">urls</span><span class="p">,</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">act_txts</span><span class="p">,</span>
    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">files</span>
<span class="p">})</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;ME_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;ME_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;ME_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;ME_Leginfo.json&#39;</span><span class="p">)</span>


<span class="c1"># End of ME_Leginfo.py</span>


<span class="c1"># Start of IL_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">import</span> <span class="nn">selenium</span>

<span class="nb">print</span><span class="p">(</span><span class="n">selenium</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="c1">## others</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># set up working directory</span>
<span class="n">working_directory</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/IL&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">))</span>


<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;./PDFs/&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>

<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span> <span class="o">=</span> <span class="s1">&#39;../../geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">service</span><span class="p">)</span>

<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">subtitles</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bill_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">broken_act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bill_status_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bill_status_pages</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">effective_dates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">orginal_act_nums</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">103</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="mi">93</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">act_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1300</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">act_num</span><span class="p">)</span>
            <span class="n">start_year</span> <span class="o">=</span> <span class="mi">1817</span> <span class="o">+</span> <span class="n">num</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="mi">1818</span> <span class="o">+</span> <span class="n">num</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="n">session</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="n">sessions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>

            <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.ilga.gov/legislation/publicacts/pubact&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/acts/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">act_num</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span>

            <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Navigate to the webpage</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">bill_status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s2">&quot;Bill Status&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">bill_status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">act_pdf_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s2">&quot;PDF&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">act_pdf_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">act_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1300</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">act_num</span><span class="p">)</span>
            <span class="n">start_year</span> <span class="o">=</span> <span class="mi">1817</span> <span class="o">+</span> <span class="n">num</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="mi">1818</span> <span class="o">+</span> <span class="n">num</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="n">session</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="n">sessions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>

            <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.ilga.gov/legislation/publicacts/fulltext.asp?Name=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">act_num</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&amp;GA=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

            <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Navigate to the webpage</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">bill_status_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s2">&quot;Bill Status&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">bill_status_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">act_pdf_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s2">&quot;PDF&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">act_pdf_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;session&#39;</span><span class="p">:</span> <span class="n">sessions</span><span class="p">,</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">act_txts</span><span class="p">,</span>
    <span class="s1">&#39;link&#39;</span><span class="p">:</span> <span class="n">act_urls</span><span class="p">,</span>
    <span class="s1">&#39;bill_status_urls&#39;</span><span class="p">:</span> <span class="n">bill_status_urls</span><span class="p">,</span>
    <span class="s1">&#39;pdf_url&#39;</span><span class="p">:</span> <span class="n">act_pdf_urls</span><span class="p">,</span>
    <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s1">&#39;IL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">act_txts</span>
<span class="p">})</span>



<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">[</span><span class="s1">&#39;Translate Website</span><span class="se">\n\n\n</span><span class="s1">  Home     Legislation &amp; Laws     Senate     House     My Legislation     Site Map    </span><span class="se">\n\n</span><span class="s1">Previous General Assemblies</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">]</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Translate Website</span><span class="se">\n\n\n</span><span class="s1">  Home     Legislation &amp; Laws     Senate     House     My Legislation     Site Map    </span><span class="se">\n\n</span><span class="s1">Previous General Assemblies</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;State of Illinois</span><span class="se">\n</span><span class="s1">Public Acts</span><span class="se">\n</span><span class="s1">90th General Assembly</span><span class="se">\n</span><span class="s1">[ Home ] [ Public Acts ] [ ILCS ] [ Search ] [ Bottom ]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;State of Illinois</span><span class="se">\n</span><span class="s1">91st General Assembly</span><span class="se">\n</span><span class="s1">Public Acts</span><span class="se">\n</span><span class="s1">[ Home ]  [ ILCS ] [ Search ] [ Bottom ]</span><span class="se">\n</span><span class="s1"> [ Other General Assemblies ]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="o">~</span><span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;No LegislationDocumentId returned.&quot;</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;bill_status&#39;</span><span class="p">]):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">bill_status_pages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">bill_status_pages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;bill_status_pages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bill_status_pages</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="o">~</span><span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;bill_status_pages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Request Not Found&quot;</span><span class="p">)]</span>

<span class="c1"># Reset the index</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;bill_status_pages&#39;</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="c1"># Regular expression pattern to find dates in the format MM/DD/YYYY</span>
    <span class="n">year_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\b\d{1,2}/\d{1,2}/\d</span><span class="si">{4}</span><span class="s1">\b&#39;</span>

    <span class="c1"># Find all occurrences of the pattern in the text</span>
    <span class="n">dates_found</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="c1"># Convert the string dates to datetime objects and find the earliest</span>
    <span class="k">if</span> <span class="n">dates_found</span><span class="p">:</span>
        <span class="c1"># Convert each found date string to a datetime object</span>
        <span class="n">date_objects</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="s1">&#39;%B </span><span class="si">%d</span><span class="s1">, %Y&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">dates_found</span><span class="p">]</span>
        <span class="c1"># Find the earliest date</span>
        <span class="n">earliest_date</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">date_objects</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Earliest date found: </span><span class="si">{</span><span class="n">earliest_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">earliest_date</span><span class="o">.</span><span class="n">year</span>
        <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No dates found in the text.&quot;</span><span class="p">)</span>
        <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="n">effective_date_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Effective Date (\w+ \d{1,2}, \d</span><span class="si">{4}</span><span class="s1">)&#39;</span>
    <span class="c1"># Search for the pattern in the text</span>
    <span class="n">effective_date_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">effective_date_pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="c1"># Check if a match was found</span>
    <span class="k">if</span> <span class="n">effective_date_match</span><span class="p">:</span>
        <span class="c1"># Extract the date string</span>
        <span class="n">date_str</span> <span class="o">=</span> <span class="n">effective_date_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Parse the date string into a datetime object</span>
        <span class="n">date_obj</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="s1">&#39;%B </span><span class="si">%d</span><span class="s1">, %Y&#39;</span><span class="p">)</span>  <span class="c1"># &#39;%B %d, %Y&#39; is the format like &#39;March 17, 2023&#39;</span>

        <span class="c1"># Convert the datetime object to the desired format MM/DD/YYYY</span>
        <span class="n">effective_date</span> <span class="o">=</span> <span class="n">date_obj</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
        <span class="n">effective_dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">effective_date</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No date found after &#39;Effective Date&#39; in the given text.&quot;</span><span class="p">)</span>
        <span class="n">effective_dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">years</span>
<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;effective_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">effective_dates</span>

<span class="c1"># PA(90-0564) 12-22-97</span>
<span class="c1"># PA(91-0676) 12-23-99</span>
<span class="c1"># PA(92-0505) 12-20-01</span>

<span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]:</span>
    <span class="c1">#Regular expression pattern to find numbers after &#39;Public Act&#39;</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Public Act (\d+-\d+)&#39;</span>

    <span class="c1"># Search for the pattern in the text</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="c1"># Check if any matches were found and print them</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="n">orginal_act_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No numbers found after &#39;Public Act&#39; in the given text.&quot;</span><span class="p">)</span>
        <span class="n">orginal_act_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;orginal_act_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">orginal_act_nums</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">datasource</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;orginal_act_num&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">90</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">564</span><span class="p">:</span>
                <span class="n">datasource</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1997</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">datasource</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1998</span>
        <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">91</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">676</span><span class="p">:</span>
                <span class="n">datasource</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1999</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">datasource</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">505</span><span class="p">:</span>
                <span class="n">datasource</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2001</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">datasource</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2002</span>



<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="o">~</span><span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;404 - File or directory not found&#39;</span><span class="p">)]</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;IL_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;IL_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;IL_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;IL_Leginfo.json&#39;</span><span class="p">)</span>


<span class="c1"># End of IL_Leginfo.py</span>


<span class="c1"># Start of KY_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="c1">#import datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="c1">#import PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pdfplumber</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="c1"># Set the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/KY&#39;</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>



<span class="c1">#driver_path = r&#39;C:/Users/longy/OneDrive/Projects/AFRI/windows/chromedriver.exe&#39; #for windows</span>
<span class="n">driver_path</span> <span class="o">=</span> <span class="s1">&#39;/Users/long/Library/CloudStorage/OneDrive-Personal/Projects/AFRI/chromedriver&#39;</span>
<span class="c1"># driver = webdriver.Chrome(executable_path=DRIVER_PATH)</span>

<span class="n">chromeOptions</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s1">&#39;prefs&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;download.default_directory&quot;</span><span class="p">:</span> <span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/KY&quot;</span><span class="p">,</span> <span class="c1">#Change default directory for downloads</span>
    <span class="s2">&quot;download.prompt_for_download&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="c1">#To auto download the file</span>
    <span class="s2">&quot;download.directory_upgrade&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;plugins.always_open_pdf_externally&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="c1">#It will not show PDF directly in chrome</span>
    <span class="s2">&quot;--enable-javascript&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="n">driver_path</span><span class="p">)</span>



<span class="c1"># driver = webdriver.Firefox(executable_path=&#39;/path_to_geckodriver_folder/geckodriver&#39;)</span>
<span class="c1"># If geckodriver is in your PATH, you can initiate it directly</span>
<span class="c1">#driver = webdriver.Firefox()</span>


<span class="c1"># Set up browser options to auto-download PDFs</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
<span class="n">options</span><span class="o">.</span><span class="n">set_preference</span><span class="p">(</span><span class="s2">&quot;browser.download.folderList&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">options</span><span class="o">.</span><span class="n">set_preference</span><span class="p">(</span><span class="s2">&quot;browser.download.manager.showWhenStarting&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">options</span><span class="o">.</span><span class="n">set_preference</span><span class="p">(</span><span class="s2">&quot;browser.download.dir&quot;</span><span class="p">,</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/KY/acts_PDFs&#39;</span><span class="p">)</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>


<span class="n">session_url</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bad_act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bill_num</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://legislature.ky.gov/Law/Pages/KyActs.aspx&quot;</span><span class="p">)</span>
<span class="n">sessions</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span> <span class="s2">&quot;Session&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">session</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sessions</span><span class="p">[:</span><span class="mi">37</span><span class="p">]):</span>
    <span class="n">session_url</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">))</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">session_url</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">19</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s2">&quot;Acts Table by Chapter&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;.table &gt; tbody:nth-child(1) &gt; tr &gt; td:nth-child(2)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bill</span> <span class="ow">in</span> <span class="n">bills</span><span class="p">:</span>
            <span class="n">bill_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bill</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">acts</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;.table &gt; tbody:nth-child(1) &gt; tr &gt; td:nth-child(1) &gt; a:nth-child(1)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">acts</span><span class="p">:</span>
            <span class="n">act_url</span> <span class="o">=</span> <span class="n">act</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;acts/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;documents&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;ACTS&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/KY/acts_PDFs/&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.pdf&quot;</span>
            <span class="c1"># Send a GET request to the URL</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
            <span class="c1"># Ensure the request was successful</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="c1"># Write the content of the response to a file</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
                <span class="n">bad_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">22</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s2">&quot;Acts Table by Chapter&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                                     <span class="s2">&quot;body &gt; table:nth-child(6) &gt; tbody:nth-child(1) &gt; tr &gt; td:nth-child(2)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bill</span> <span class="ow">in</span> <span class="n">bills</span><span class="p">:</span>
            <span class="n">bill_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bill</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">acts</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                                    <span class="s2">&quot;body &gt; table:nth-child(6) &gt; tbody:nth-child(1) &gt; tr &gt; td:nth-child(1) &gt; a:nth-child(1)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">acts</span><span class="p">:</span>
            <span class="n">act_url</span> <span class="o">=</span> <span class="n">act</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;acts/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;documents&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/KY/acts_PDFs/&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.pdf&quot;</span>
            <span class="c1"># Send a GET request to the URL</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
            <span class="c1"># Ensure the request was successful</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="c1"># Write the content of the response to a file</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
                <span class="n">bad_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">22</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s2">&quot;Acts Table by Chapter&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;body &gt; table &gt; tbody &gt; tr&gt; td:nth-child(1)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bill</span> <span class="ow">in</span> <span class="n">bills</span><span class="p">:</span>
            <span class="n">bill_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bill</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">acts</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                                    <span class="s2">&quot;body &gt; table &gt; tbody &gt; tr &gt; td:nth-child(2) &gt; a&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">acts</span><span class="p">:</span>
            <span class="n">act_url</span> <span class="o">=</span> <span class="n">act</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;acts/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;documents&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;ACTS&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/KY/acts_PDFs/&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.pdf&quot;</span>
            <span class="c1"># Send a GET request to the URL</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
            <span class="c1"># Ensure the request was successful</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="c1"># Write the content of the response to a file</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
                <span class="n">bad_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">33</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s2">&quot;Acts Table by Chapter&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                                     <span class="s2">&quot;body &gt; table:nth-child(6) &gt; tbody:nth-child(1) &gt; tr &gt; td:nth-child(2)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bill</span> <span class="ow">in</span> <span class="n">bills</span><span class="p">:</span>
            <span class="n">bill_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bill</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">acts</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                                    <span class="s2">&quot;body &gt; table:nth-child(6) &gt; tbody:nth-child(1) &gt; tr &gt; td:nth-child(1) &gt; a:nth-child(1)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">acts</span><span class="p">:</span>
            <span class="n">act_url</span> <span class="o">=</span> <span class="n">act</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;acts/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;documents&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/KY/acts_PDFs/&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.pdf&quot;</span>
            <span class="c1"># Send a GET request to the URL</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
            <span class="c1"># Ensure the request was successful</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="c1"># Write the content of the response to a file</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
                <span class="n">bad_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s2">&quot;Acts Table by Chapter&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;body &gt; table &gt; tbody &gt; tr&gt; td:nth-child(2)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bill</span> <span class="ow">in</span> <span class="n">bills</span><span class="p">:</span>
            <span class="n">bill_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bill</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">acts</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;body &gt; table &gt; tbody &gt; tr&gt; td:nth-child(1) &gt; a&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">acts</span><span class="p">:</span>
            <span class="n">act_url</span> <span class="o">=</span> <span class="n">act</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;acts/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;documents&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;ACTS&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/KY/acts_PDFs/&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.pdf&quot;</span>
            <span class="c1"># Send a GET request to the URL</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
            <span class="c1"># Ensure the request was successful</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="c1"># Write the content of the response to a file</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
                <span class="n">bad_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">session_url</span><span class="p">[</span><span class="mi">33</span><span class="p">:</span><span class="mi">36</span><span class="p">]):</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s2">&quot;Acts Table by Chapter&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;body &gt; table &gt; tbody:nth-child(1) &gt; tr &gt; td:nth-child(2)&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">bill</span> <span class="ow">in</span> <span class="n">bills</span><span class="p">:</span>
        <span class="n">bill_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bill</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">acts</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                                <span class="s2">&quot;body &gt; table &gt; tbody:nth-child(1) &gt; tr &gt; td:nth-child(1) &gt; a:nth-child(1)&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">acts</span><span class="p">:</span>
        <span class="n">act_url</span> <span class="o">=</span> <span class="n">act</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;acts/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;documents&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/KY/acts_PDFs/&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.pdf&quot;</span>
        <span class="c1"># Send a GET request to the URL</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
        <span class="c1"># Ensure the request was successful</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="c1"># Write the content of the response to a file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
            <span class="n">bad_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">session_url</span><span class="p">[</span><span class="mi">35</span><span class="p">:</span><span class="mi">36</span><span class="p">]):</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s2">&quot;Acts Table by Chapter&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;body &gt; table &gt; tbody:nth-child(1) &gt; tr &gt; td:nth-child(2)&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">bill</span> <span class="ow">in</span> <span class="n">bills</span><span class="p">:</span>
        <span class="n">bill_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bill</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">acts</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                                <span class="s2">&quot;body &gt; table &gt; tbody:nth-child(1) &gt; tr &gt; td:nth-child(1) &gt; a:nth-child(1)&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">acts</span><span class="p">:</span>
        <span class="n">act_url</span> <span class="o">=</span> <span class="n">act</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;acts/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;documents&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/KY/acts_PDFs/&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.pdf&quot;</span>
        <span class="c1"># Send a GET request to the URL</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
        <span class="c1"># Ensure the request was successful</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="c1"># Write the content of the response to a file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
            <span class="n">bad_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>


<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">act_urls1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">act_urls</span><span class="p">))</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;bill_num&#39;</span><span class="p">:</span><span class="n">bill_num</span><span class="p">,</span>
    <span class="s1">&#39;act_urls&#39;</span><span class="p">:</span> <span class="n">act_urls</span>
<span class="p">})</span>

<span class="c1"># Remove duplicates based on &#39;act_urls&#39;</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;act_urls&#39;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;act_urls&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;http://www.lrc.ky.gov/Statrev/ACTS2003/0194.pdf&quot;</span><span class="p">]</span>

<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">bad_files</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/KY/acts_PDFs&quot;</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
            <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
            <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
            <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
        <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">bad_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="c1"># Replace &#39;path_to_pdf&#39; with the path to your PDF file</span>
<span class="n">file</span> <span class="o">=</span> <span class="s2">&quot;./KY_1998.pdf&quot;</span>

<span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
    <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
    <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
    <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
<span class="n">acttxt_backup</span> <span class="o">=</span> <span class="n">acttxt</span>
<span class="n">year_1998_acts</span> <span class="o">=</span> <span class="n">acttxt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Section 1.   &quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">split_by_chapter</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c1"># Define the pattern to split on</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;CHAPTER \d+ \n\(&#39;</span><span class="p">)</span>

    <span class="c1"># Split the text using the pattern</span>
    <span class="n">chapters</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="c1"># Filter out empty strings</span>
    <span class="n">chapters</span> <span class="o">=</span> <span class="p">[</span><span class="n">chapter</span> <span class="k">for</span> <span class="n">chapter</span> <span class="ow">in</span> <span class="n">chapters</span> <span class="k">if</span> <span class="n">chapter</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">chapters</span>


<span class="c1"># Example usage:</span>
<span class="n">chapters</span> <span class="o">=</span> <span class="n">split_by_chapter</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>

<span class="n">year_1998_chapters</span> <span class="o">=</span>  <span class="n">chapters</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="n">year_1998_chapters</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Chapter </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">year_1998_chapters</span><span class="p">)]</span>

<span class="n">year_1998_bill_num</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">chapters</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="n">year_1998_bill_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;) </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

<span class="c1"># Creating DataFrame</span>
<span class="n">df_1998</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">year_1998_chapters</span><span class="p">,</span> <span class="s1">&#39;bill_num&#39;</span><span class="p">:</span> <span class="n">year_1998_bill_num</span><span class="p">})</span>
<span class="n">df_1998</span><span class="p">[</span><span class="s1">&#39;act_urls&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://apps.legislature.ky.gov/law/acts/98RS/actsmas.pdf&#39;</span>
<span class="n">df_1998</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;KY_1998.pdf&quot;</span>

<span class="c1"># Read the CSV file into a DataFrame</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./KY_Leginfo.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">df_1998</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;KY&quot;</span>


<span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;KY_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;KY_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;KY_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;KY_Leginfo.json&#39;</span><span class="p">)</span>


<span class="c1"># End of KY_Leginfo.py</span>


<span class="c1"># Start of NJ_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">import</span> <span class="nn">selenium</span>
<span class="nb">print</span><span class="p">(</span><span class="n">selenium</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="c1">## others</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># set up working directory</span>
<span class="n">working_directory</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/NJ&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">))</span>


<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;./PDFs/&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>

<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span> <span class="o">=</span> <span class="s1">&#39;../../geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span> <span class="o">=</span> <span class="n">service</span><span class="p">)</span>

<span class="c1"># empty list to store info</span>

<span class="n">act_pdf_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_html_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bill_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">chapter_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">broken_act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1">#approved_dates = []</span>
<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>


<span class="c1"># New Jersey Legislature Website: https://www.njleg.state.nj.us/chapter-laws</span>

<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://www.njleg.state.nj.us/chapter-laws&#39;</span><span class="p">)</span>

<span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
    <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;.chapter-laws-filter_yearSelect__G_DM8&#39;</span><span class="p">))</span>
<span class="p">)</span>

<span class="n">select_session</span> <span class="o">=</span> <span class="n">Select</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;.chapter-laws-filter_yearSelect__G_DM8&#39;</span><span class="p">))</span>

<span class="n">sessions</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;.chapter-laws-filter_yearSelect__G_DM8  &gt; option&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">sessions</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2022</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">select_session</span><span class="o">.</span><span class="n">select_by_visible_text</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;button.chapter-laws-filter_filterButtons__NFfv4:nth-child(1)&#39;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;button.chapter-laws-filter_filterButtons__NFfv4:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

        <span class="n">total_page</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div.chapter-laws-pagination_pagination__ulkGd:nth-child(1) &gt; div:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;of &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">total_page</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>

            <span class="n">chapter_num_elements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                                                        <span class="s1">&#39;div.chapter-laws-list_chapterLaw__KotAo &gt; div:nth-child(1) &gt; div:nth-child(1) &gt; span:nth-child(1)&#39;</span><span class="p">)</span>

            <span class="c1"># Iterate over each element and get the text</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">chapter_num_elements</span><span class="p">:</span>
                <span class="n">chapter_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


            <span class="n">bill_num_elements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                                                     <span class="s1">&#39;div.chapter-laws-list_chapterLaw__KotAo &gt; div:nth-child(1) &gt; div:nth-child(1) &gt; a:nth-child(2)&#39;</span><span class="p">)</span>

            <span class="c1"># Iterate over each element and get the text</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">bill_num_elements</span><span class="p">:</span>
                <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


            <span class="n">summmary_elements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                                                     <span class="s1">&#39;div.chapter-laws-list_chapterLaw__KotAo &gt; div:nth-child(2) &gt; p:nth-child(1)&#39;</span><span class="p">)</span>

            <span class="c1"># Iterate over each element and get the text</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">summmary_elements</span><span class="p">:</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


            <span class="n">act_pdf_url_elements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                                                        <span class="s1">&#39;div.chapter-laws-list_chapterLaw__KotAo &gt; div:nth-child(1) &gt; div:nth-child(2) &gt; a:nth-child(1)&#39;</span><span class="p">)</span>

            <span class="c1"># Iterate over each element and get the text</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">act_pdf_url_elements</span><span class="p">:</span>
                <span class="n">act_pdf_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">))</span>

            <span class="c1">#act_html_url_elements = driver.find_elements(By.CSS_SELECTOR,</span>
            <span class="c1"># &#39;div.chapter-laws-list_chapterLaw__KotAo &gt; div:nth-child(1) &gt; div:nth-child(2) &gt; a:nth-child(2)&#39;)</span>

            <span class="c1"># Iterate over each element and get the text</span>
            <span class="c1">#for element in act_html_url_elements:</span>
            <span class="c1">#    act_html_urls.append(element.get_attribute(&#39;href&#39;))</span>

            <span class="c1">#approved_date_elements = driver.find_elements(By.CSS_SELECTOR,</span>
            <span class="c1">#  &#39;div.chapter-laws-list_chapterLaw__KotAo &gt; div:nth-child(1) &gt; div:nth-child(2) &gt; p:nth-child(3)&#39;)</span>

            <span class="c1"># Iterate over each element and get the text</span>
            <span class="c1">#for element in approved_date_elements:</span>
            <span class="c1">#    approved_dates.append(element.text)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;div.chapter-laws-pagination_pagination__ulkGd:nth-child(1) &gt; div:nth-child(2) &gt; a:last-child  &gt; svg:nth-child(1) &gt; path:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>




<span class="c1"># download corresponding pdf file</span>

<span class="k">for</span> <span class="n">act_url</span> <span class="ow">in</span> <span class="n">act_pdf_urls</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">act_url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;nj.usBills&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">+</span> <span class="n">name</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.005</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
    <span class="c1"># Ensure the request was successful</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="c1"># Write the content of the response to a file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
        <span class="n">broken_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;bill_num&#39;</span><span class="p">:</span> <span class="n">bill_nums</span><span class="p">,</span>
    <span class="s1">&#39;chapter_num&#39;</span><span class="p">:</span> <span class="n">chapter_nums</span><span class="p">,</span>
    <span class="s1">&#39;link&#39;</span><span class="p">:</span> <span class="n">act_pdf_urls</span><span class="p">,</span>
    <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s2">&quot;NJ&quot;</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">names</span>
<span class="p">})</span>
<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;nj.usBills&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1">#read pdfs</span>
<span class="n">folder_path</span> <span class="o">=</span> <span class="s2">&quot;./PDFs&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">folder_path</span><span class="p">))</span>

<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s1">&#39;*.PDF&#39;</span><span class="p">))</span>

<span class="n">broken_files</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
            <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
            <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
            <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
        <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
        <span class="n">broken_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;./PDFs/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">datasource_pdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">act_txts</span><span class="p">,</span>
    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">file_names</span><span class="p">,</span>
<span class="p">})</span>


<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">datasource</span><span class="p">,</span><span class="n">datasource_pdf</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;file_name&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="c1"># delete one act with missing pdf from the url https://pub.njleg.state.nj.us/Bills/2010/PL11/209_.PDF</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">])</span>
<span class="c1"># delete duplicates</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">])</span>


<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;NJ_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;NJ_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;NJ_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;NJ_Leginfo.json&#39;</span><span class="p">)</span>

<span class="c1"># End of NJ_Leginfo.py</span>


<span class="c1"># Start of WV_Leginfo.py</span>

<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">fitz</span>


<span class="c1">#driver_path = &#39;I:\Projects\AFRI/chromedriver.exe&#39; #for windows</span>
<span class="n">driver_path</span> <span class="o">=</span> <span class="s1">&#39;/Users/long/Library/CloudStorage/OneDrive-Personal/Projects/AFRI/chromedriver&#39;</span>
<span class="c1"># driver = webdriver.Chrome(executable_path=DRIVER_PATH)</span>

<span class="c1"># Change the working directory</span>
<span class="c1">#os.chdir(&#39;/Users/long/OneDrive/Projects/AFRI&#39;)</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/WV&#39;</span><span class="p">)</span>
<span class="c1"># os.chdir(&#39;/Volumes/GoogleDrive/Shared drives/UCSC-UMN AFRI project/Data/GA&#39;)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="n">chromeOptions</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s1">&#39;prefs&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;download.default_directory&quot;</span><span class="p">:</span> <span class="s1">&#39;/Users/long/Library/CloudStorage/OneDrive-Personal/Projects/AFRI/data/WV&#39;</span><span class="p">,</span> <span class="c1">#Change default directory for downloads</span>
    <span class="s2">&quot;download.prompt_for_download&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="c1">#To auto download the file</span>
    <span class="s2">&quot;download.directory_upgrade&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;plugins.always_open_pdf_externally&quot;</span><span class="p">:</span> <span class="kc">True</span> <span class="c1">#It will not show PDF directly in chrome</span>
<span class="p">})</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="n">driver_path</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">chromeOptions</span><span class="p">)</span>

<span class="n">act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">checklist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">session_acts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://www.wvlegislature.gov/Educational/publications.cfm#acts&quot;</span><span class="p">)</span>

<span class="c1">#most sessions except 2003</span>

<span class="n">sessions</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_partial_link_text</span><span class="p">(</span><span class="s2">&quot;Vol.&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">sessions</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">othersessions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;https://www.wvlegislature.gov/legisdocs/publications/acts/Acts_2003_Vol_1.pdf&quot;</span><span class="p">,</span><span class="s2">&quot;https://www.wvlegislature.gov/legisdocs/publications/acts/Acts_2003_Vol_2.pdf&quot;</span><span class="p">,</span><span class="s2">&quot;https://www.wvlegislature.gov/legisdocs/publications/acts/Acts_2003_2ES.pdf&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">othersessions</span><span class="p">:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/WV/PDFs&quot;</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
        <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
        <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="n">acttxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">acttxts</span><span class="p">,</span>
    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">files</span>
<span class="p">})</span>

<span class="c1"># save bill info into files</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;WV_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;WV_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;WV_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;WV_Leginfo.json&#39;</span><span class="p">)</span>
<span class="c1"># End of WV_Leginfo.py</span>


<span class="c1"># Start of ID_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="c1">## others</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">inflect</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">import</span> <span class="nn">re</span>


<span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;ID&quot;</span>
<span class="c1"># Read the CSV file into a DataFrame</span>
<span class="n">work_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">/&#39;</span>
<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">work_dir</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>


<span class="c1"># Specify the path to the Firefox binary</span>
<span class="n">firefox_binary_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Firefox.app/Contents/MacOS/firefox&#39;</span>

<span class="c1"># Create a Firefox profile and configure preferences</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
<span class="n">options</span><span class="o">.</span><span class="n">binary_location</span> <span class="o">=</span> <span class="n">firefox_binary_path</span>

<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span> <span class="o">=</span> <span class="s1">&#39;./Data/geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="c1"># Initialize the WebDriver with the specified path</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">service</span><span class="p">)</span>



<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://legislature.idaho.gov/statutesrules/sessionlaws/&#39;</span><span class="p">)</span>

<span class="n">sessions</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span> <span class="s2">&quot;Volume&quot;</span><span class="p">)</span>

<span class="n">session_urls</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">sessions</span><span class="p">:</span>
    <span class="n">session_url</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
    <span class="n">session_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session_url</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">session_urls</span><span class="p">):</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>


<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;PDFs&quot;</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>

<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">year</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">chapter_num</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>  <span class="c1"># Open the file explicitly</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
            <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
            <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>

        <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Ensure the file is closed after processing</span>
    <span class="n">acttxt</span> <span class="o">=</span> <span class="n">acttxt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;RESOLUTIONS </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\nCHAPTER \d+ \n&#39;</span><span class="p">,</span> <span class="n">acttxt</span><span class="p">)</span>
    <span class="n">acttxts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">chapter_num</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\nCHAPTER (\d+) \n&#39;</span><span class="p">,</span> <span class="n">acttxt</span><span class="p">))</span>
    <span class="c1"># Append the same number of rows (for demonstration, we&#39;ll append a placeholder)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:])):</span>
        <span class="n">year</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">acttxts</span><span class="p">,</span>
    <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">year</span><span class="p">,</span>
    <span class="s1">&#39;chapter_num&#39;</span><span class="p">:</span> <span class="n">chapter_num</span><span class="p">,</span>
    <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s2">&quot;ID&quot;</span>
<span class="p">})</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;ID_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;ID_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;ID_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;ID_Leginfo.json&#39;</span><span class="p">)</span>


<span class="c1"># End of ID_Leginfo.py</span>


<span class="c1"># Start of LA_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">import</span> <span class="nn">selenium</span>
<span class="nb">print</span><span class="p">(</span><span class="n">selenium</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.firefox_profile</span> <span class="kn">import</span> <span class="n">FirefoxProfile</span>
<span class="c1">## others</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># set up working directory</span>
<span class="n">working_directory</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/LA&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">))</span>


<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;./PDFs/&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>

<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span> <span class="o">=</span> <span class="s1">&#39;../../geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span> <span class="o">=</span> <span class="n">service</span><span class="p">)</span>


<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://www.legis.la.gov/Legis/SessionInfo/SessionInfo.aspx&#39;</span><span class="p">)</span>


<span class="n">acts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bill_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;97RS&#39;</span><span class="p">,</span><span class="s1">&#39;971ES&#39;</span><span class="p">,</span><span class="s1">&#39;972ES&#39;</span><span class="p">,</span><span class="s1">&#39;973ES&#39;</span><span class="p">,</span><span class="s1">&#39;98RS&#39;</span><span class="p">,</span><span class="s1">&#39;981ES&#39;</span><span class="p">,</span><span class="s1">&#39;982ES&#39;</span><span class="p">,</span><span class="s1">&#39;983ES&#39;</span><span class="p">,</span><span class="s1">&#39;99RS&#39;</span><span class="p">,</span><span class="s1">&#39;991ES&#39;</span><span class="p">,</span><span class="s1">&#39;992ES&#39;</span><span class="p">,</span><span class="s1">&#39;993ES&#39;</span><span class="p">,</span><span class="s1">&#39;00RS&#39;</span><span class="p">,</span><span class="s1">&#39;001ES&#39;</span><span class="p">,</span><span class="s1">&#39;002ES&#39;</span><span class="p">,</span><span class="s1">&#39;003ES&#39;</span><span class="p">,</span><span class="s1">&#39;01RS&#39;</span><span class="p">,</span><span class="s1">&#39;011ES&#39;</span><span class="p">,</span><span class="s1">&#39;012ES&#39;</span><span class="p">,</span><span class="s1">&#39;013ES&#39;</span><span class="p">,</span><span class="s1">&#39;02RS&#39;</span><span class="p">,</span><span class="s1">&#39;021ES&#39;</span><span class="p">,</span><span class="s1">&#39;022ES&#39;</span><span class="p">,</span><span class="s1">&#39;023ES&#39;</span><span class="p">,</span><span class="s1">&#39;03RS&#39;</span><span class="p">,</span><span class="s1">&#39;031ES&#39;</span><span class="p">,</span><span class="s1">&#39;032ES&#39;</span><span class="p">,</span><span class="s1">&#39;033ES&#39;</span><span class="p">,</span><span class="s1">&#39;04RS&#39;</span><span class="p">,</span><span class="s1">&#39;041ES&#39;</span><span class="p">,</span><span class="s1">&#39;042ES&#39;</span><span class="p">,</span><span class="s1">&#39;043ES&#39;</span><span class="p">,</span><span class="s1">&#39;05RS&#39;</span><span class="p">,</span><span class="s1">&#39;051ES&#39;</span><span class="p">,</span><span class="s1">&#39;052ES&#39;</span><span class="p">,</span><span class="s1">&#39;053ES&#39;</span><span class="p">,</span><span class="s1">&#39;06RS&#39;</span><span class="p">,</span><span class="s1">&#39;061ES&#39;</span><span class="p">,</span><span class="s1">&#39;062ES&#39;</span><span class="p">,</span><span class="s1">&#39;063ES&#39;</span><span class="p">,</span><span class="s1">&#39;07RS&#39;</span><span class="p">,</span><span class="s1">&#39;071ES&#39;</span><span class="p">,</span><span class="s1">&#39;072ES&#39;</span><span class="p">,</span><span class="s1">&#39;073ES&#39;</span><span class="p">,</span><span class="s1">&#39;08RS&#39;</span><span class="p">,</span><span class="s1">&#39;081ES&#39;</span><span class="p">,</span><span class="s1">&#39;082ES&#39;</span><span class="p">,</span><span class="s1">&#39;083ES&#39;</span><span class="p">,</span><span class="s1">&#39;09RS&#39;</span><span class="p">,</span><span class="s1">&#39;091ES&#39;</span><span class="p">,</span><span class="s1">&#39;092ES&#39;</span><span class="p">,</span><span class="s1">&#39;093ES&#39;</span><span class="p">,</span><span class="s1">&#39;10RS&#39;</span><span class="p">,</span><span class="s1">&#39;101ES&#39;</span><span class="p">,</span><span class="s1">&#39;102ES&#39;</span><span class="p">,</span><span class="s1">&#39;103ES&#39;</span><span class="p">,</span><span class="s1">&#39;11RS&#39;</span><span class="p">,</span><span class="s1">&#39;111ES&#39;</span><span class="p">,</span><span class="s1">&#39;112ES&#39;</span><span class="p">,</span><span class="s1">&#39;113ES&#39;</span><span class="p">,</span><span class="s1">&#39;12RS&#39;</span><span class="p">,</span><span class="s1">&#39;121ES&#39;</span><span class="p">,</span><span class="s1">&#39;122ES&#39;</span><span class="p">,</span><span class="s1">&#39;123ES&#39;</span><span class="p">,</span><span class="s1">&#39;13RS&#39;</span><span class="p">,</span><span class="s1">&#39;131ES&#39;</span><span class="p">,</span><span class="s1">&#39;132ES&#39;</span><span class="p">,</span><span class="s1">&#39;133ES&#39;</span><span class="p">,</span><span class="s1">&#39;14RS&#39;</span><span class="p">,</span><span class="s1">&#39;141ES&#39;</span><span class="p">,</span><span class="s1">&#39;142ES&#39;</span><span class="p">,</span><span class="s1">&#39;143ES&#39;</span><span class="p">,</span><span class="s1">&#39;15RS&#39;</span><span class="p">,</span><span class="s1">&#39;151ES&#39;</span><span class="p">,</span><span class="s1">&#39;152ES&#39;</span><span class="p">,</span><span class="s1">&#39;153ES&#39;</span><span class="p">,</span><span class="s1">&#39;16RS&#39;</span><span class="p">,</span><span class="s1">&#39;161ES&#39;</span><span class="p">,</span><span class="s1">&#39;162ES&#39;</span><span class="p">,</span><span class="s1">&#39;163ES&#39;</span><span class="p">,</span><span class="s1">&#39;17RS&#39;</span><span class="p">,</span><span class="s1">&#39;171ES&#39;</span><span class="p">,</span><span class="s1">&#39;172ES&#39;</span><span class="p">,</span><span class="s1">&#39;173ES&#39;</span><span class="p">,</span><span class="s1">&#39;18RS&#39;</span><span class="p">,</span><span class="s1">&#39;181ES&#39;</span><span class="p">,</span><span class="s1">&#39;182ES&#39;</span><span class="p">,</span><span class="s1">&#39;183ES&#39;</span><span class="p">,</span><span class="s1">&#39;19RS&#39;</span><span class="p">,</span><span class="s1">&#39;191ES&#39;</span><span class="p">,</span><span class="s1">&#39;192ES&#39;</span><span class="p">,</span><span class="s1">&#39;193ES&#39;</span><span class="p">,</span><span class="s1">&#39;20RS&#39;</span><span class="p">,</span><span class="s1">&#39;201ES&#39;</span><span class="p">,</span><span class="s1">&#39;202ES&#39;</span><span class="p">,</span><span class="s1">&#39;203ES&#39;</span><span class="p">,</span><span class="s1">&#39;21RS&#39;</span><span class="p">,</span><span class="s1">&#39;211ES&#39;</span><span class="p">,</span><span class="s1">&#39;212ES&#39;</span><span class="p">,</span><span class="s1">&#39;213ES&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.legis.la.gov/Legis/ActNumbers.aspx?sid=&#39;</span> <span class="o">+</span> <span class="n">year</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">act_elements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;.ResultsListTable &gt; tbody:nth-child(2) &gt; *&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">act_elements</span><span class="p">:</span>

            <span class="n">act_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

            <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(2)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

            <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">))</span>

            <span class="n">act_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(4)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="n">num_pages</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;#ctl00_ctl00_PageBody_PageContent_LabelTotalInstruments&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">num_pages</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">num_pages</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>

                <span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
                    <span class="n">next_page</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span><span class="s1">&#39;...&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">next_page</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

                <span class="n">act_elements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;.ResultsListTable &gt; tbody:nth-child(2) &gt; *&#39;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">act_elements</span><span class="p">:</span>
                    <span class="n">act_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

                    <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(2)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

                    <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">))</span>

                    <span class="n">act_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(4)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="n">pdf_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">act_url</span> <span class="ow">in</span> <span class="n">act_urls</span><span class="p">:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;#ctl00_PageBody_LabelSession&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; REGULAR&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
    <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;#ctl00_PageBody_PanelBillInfo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span><span class="s1">&#39;Text&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">))</span>
    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">pdf_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">))</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">*</span><span class="mf">0.005</span><span class="p">)</span>


<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">link</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pdf_urls</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">link</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;d=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.pdf&quot;</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.pdf&quot;</span>
    <span class="c1"># Send a GET request to the URL</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
    <span class="c1"># Ensure the request was successful</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="c1"># Write the content of the response to a file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
        <span class="n">bad_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">*</span><span class="mf">0.005</span><span class="p">)</span>


<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;act_name&#39;</span><span class="p">:</span> <span class="n">act_names</span><span class="p">,</span>
    <span class="s1">&#39;bill_num&#39;</span><span class="p">:</span> <span class="n">bill_nums</span><span class="p">,</span>
    <span class="s1">&#39;act_num&#39;</span><span class="p">:</span> <span class="n">act_nums</span><span class="p">,</span>
    <span class="s1">&#39;link&#39;</span><span class="p">:</span> <span class="n">act_urls</span><span class="p">,</span>
    <span class="s1">&#39;pdf_url&#39;</span><span class="p">:</span> <span class="n">pdf_urls</span><span class="p">,</span>
    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">file_names</span><span class="p">,</span>
    <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">years</span><span class="p">,</span>
    <span class="s1">&#39;record&#39;</span><span class="p">:</span> <span class="n">records</span>
<span class="p">})</span>



<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>

<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">broken_files</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
            <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
            <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
            <span class="n">act_txt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
        <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_txt</span><span class="p">)</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;PDFs/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">broken_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>



<span class="n">file_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">file_names</span><span class="p">,</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">act_txts</span>
<span class="p">})</span>





<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;LA_Leginfo.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;LA_Leginfo.xlsx&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;LA_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;LA_Leginfo.json&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1">#datasource = pd.read_csv(&#39;LA_Leginfo.csv&#39;, index_col=False)</span>
<span class="c1"># End of LA_Leginfo.py</span>


<span class="c1"># Start of MT_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">import</span> <span class="nn">selenium</span>
<span class="nb">print</span><span class="p">(</span><span class="n">selenium</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="c1">## others</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="c1"># Counting the occurrence of each item in the list</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="c1"># set up working directory</span>
<span class="n">working_directory</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/MT&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">))</span>


<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;./PDFs/&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>

<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span> <span class="o">=</span> <span class="s1">&#39;../../geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span> <span class="o">=</span> <span class="n">service</span><span class="p">)</span>

<span class="c1"># empty list to store info</span>

<span class="n">act_pdf_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_html_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pdf_file_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">html_file_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bill_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">chapter_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">broken_act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">summaries</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">session_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">statuss</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">rowtxts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Montana Legislature Website: https://laws.leg.mt.gov/legprd/law0203w$.startup</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;20211&#39;</span><span class="p">,</span> <span class="s1">&#39;20191&#39;</span><span class="p">,</span> <span class="s1">&#39;20171&#39;</span><span class="p">,</span> <span class="s1">&#39;20172&#39;</span><span class="p">,</span> <span class="s1">&#39;20151&#39;</span><span class="p">,</span> <span class="s1">&#39;20131&#39;</span><span class="p">,</span> <span class="s1">&#39;20111&#39;</span><span class="p">,</span> <span class="s1">&#39;20091&#39;</span><span class="p">,</span> <span class="s1">&#39;20071&#39;</span><span class="p">,</span> <span class="s1">&#39;20072&#39;</span><span class="p">,</span> <span class="s1">&#39;20051&#39;</span><span class="p">,</span> <span class="s1">&#39;20051&#39;</span><span class="p">,</span> <span class="s1">&#39;20031&#39;</span><span class="p">,</span> <span class="s1">&#39;20011&#39;</span><span class="p">,</span> <span class="s1">&#39;19991&#39;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://laws.leg.mt.gov/legprd/LAW0217W$BAIV.return_all_bills?P_SESS=&#39;</span> <span class="o">+</span> <span class="n">i</span>
    <span class="n">session_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="n">rows</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;body &gt; table:nth-child(13) &gt; tbody:nth-child(1) &gt; tr&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="s2">&quot;*&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">rowtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

            <span class="n">act_html_url</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;td:nth-child(1) &gt; a:nth-child(2)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="n">act_html_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_html_url</span><span class="p">)</span>

            <span class="n">act_pdf_url</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;td:nth-child(1) &gt; a:nth-child(3)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="n">act_pdf_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_pdf_url</span><span class="p">)</span>

            <span class="n">bill_num</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;td:nth-child(1) &gt; a:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bill_num</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>

            <span class="n">chapter_num</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;td:nth-child(2)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="n">chapter_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chapter_num</span><span class="p">)</span>

            <span class="n">status</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;td:nth-child(4)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="n">statuss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>

            <span class="n">year</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;td:nth-child(5)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>

            <span class="n">name</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;td:nth-child(6)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.001</span><span class="p">)</span>



<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;bill_num&#39;</span><span class="p">:</span> <span class="n">rowtxts</span><span class="p">,</span>
    <span class="s1">&#39;chapter_num&#39;</span><span class="p">:</span> <span class="n">chapter_nums</span><span class="p">,</span>
    <span class="s1">&#39;act_pdf_url&#39;</span><span class="p">:</span> <span class="n">act_pdf_urls</span><span class="p">,</span>
    <span class="s1">&#39;act_html_url&#39;</span><span class="p">:</span> <span class="n">act_html_urls</span><span class="p">,</span>
    <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s2">&quot;MT&quot;</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="n">names</span><span class="p">,</span>
    <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">years</span><span class="p">,</span>
    <span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="n">statuss</span>
<span class="p">})</span>

<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;act_pdf_url&#39;</span><span class="p">]:</span>
    <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/billpdf&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">+</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;billpdf/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.htm&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_names</span>

<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">act_url</span> <span class="ow">in</span> <span class="n">act_pdf_urls</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">act_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/billpdf&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">+</span> <span class="n">act_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;billpdf/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.htm&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">+</span> <span class="n">name</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.005</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
    <span class="c1"># Ensure the request was successful</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="c1"># Write the content of the response to a file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
        <span class="n">broken_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>

<span class="n">folder_path</span> <span class="o">=</span> <span class="s2">&quot;./PDFs&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">folder_path</span><span class="p">))</span>

<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>

<span class="n">broken_files</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
            <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
            <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
            <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
        <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
        <span class="n">broken_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;./PDFs/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">datasource_pdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">act_txts</span><span class="p">,</span>
    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">file_names</span><span class="p">,</span>
<span class="p">})</span>


<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">datasource</span><span class="p">,</span> <span class="n">datasource_pdf</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;file_name&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>



<span class="c1"># missing url &#39;http://leg.mt.gov/bills/2007/billpdf/SB0382.pdf&#39;</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">])</span>
<span class="c1"># delete duplicates</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">])</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;MT_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;MT_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;MT_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;MT_Leginfo.json&#39;</span><span class="p">)</span>

<span class="c1"># End of MT_Leginfo.py</span>


<span class="c1"># Start of FL_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">import</span> <span class="nn">selenium</span>
<span class="nb">print</span><span class="p">(</span><span class="n">selenium</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="c1">## others</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># set up working directory</span>
<span class="n">working_directory</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/FL&#39;</span>
<span class="c1">#working_directory = &#39;/Volumes/SSD/AFRI/Data/Raw_Data/FL&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">))</span>


<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;./PDFs/&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>

<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span> <span class="o">=</span> <span class="s1">&#39;../../geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span> <span class="o">=</span> <span class="n">service</span><span class="p">)</span>

<span class="c1"># empty list to store info</span>
<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bill_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">chapter_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">broken_act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1">#for 1975-1996</span>
<span class="n">session_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">years_1975_1996</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">file_names_1975_1996</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># there are two sources to web-scrape for FL leginfo.</span>
<span class="c1"># for 1975-1996</span>

<span class="c1"># 1975 special session</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;1975&#39;</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;special.pdf&#39;</span>
<span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">+</span> <span class="n">name</span>
<span class="n">years_1975_1996</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1975</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://edocs.dlis.state.fl.us/fldocs/leg/actsflorida/1975/LOF1975V1Ch001-306.pdf&#39;</span><span class="p">)</span>
<span class="n">session_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;http://edocs.dlis.state.fl.us/fldocs/leg/actsflorida/1975/LOF1975V1Ch001-306.pdf&#39;</span><span class="p">)</span>

<span class="c1"># Ensure the request was successful</span>
<span class="c1"># Write the content of the response to a file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://edocs.dlis.state.fl.us/fldocs/leg/actsflorida/index.htm&#39;</span><span class="p">)</span>
<span class="c1"># regular sessions in 1975-1996</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1975</span><span class="p">,</span> <span class="mi">1997</span><span class="p">)):</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

    <span class="c1"># get the last two digits of the year</span>
    <span class="n">partial_link</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="si">}</span><span class="s2">-&quot;</span>

    <span class="n">session_elements</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_all_elements_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span> <span class="n">partial_link</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">session_elements</span><span class="p">):</span>
        <span class="n">session_url</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">session_url</span><span class="p">)</span>
        <span class="n">session_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session_url</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span>
        <span class="n">file_names_1975_1996</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">years_1975_1996</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>


        <span class="n">path</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">+</span> <span class="s1">&#39;/1975-1996/&#39;</span><span class="o">+</span> <span class="n">name</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.005</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pdf_url</span><span class="p">)</span>
        <span class="c1"># Ensure the request was successful</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="c1"># Write the content of the response to a file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
            <span class="n">broken_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pdf_url</span><span class="p">)</span>


<span class="n">datasource_1975_1996</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">file_names</span><span class="p">,</span>
    <span class="s1">&#39;year&#39;</span><span class="p">:</span><span class="n">years</span><span class="p">,</span>
    <span class="s1">&#39;link&#39;</span><span class="p">:</span><span class="n">session_urls</span>
<span class="p">})</span>

<span class="n">folder_path</span> <span class="o">=</span> <span class="s2">&quot;./PDFs/1975_1996/&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">folder_path</span><span class="p">))</span>

<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>

<span class="n">broken_files</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
            <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
            <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
            <span class="n">session_txt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
        <span class="n">session_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session_txt</span><span class="p">)</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
        <span class="n">session_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
        <span class="n">broken_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="c1">#creat a key to match</span>
<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;1975_1996/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">datasource_1975_1996_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">session_txts</span><span class="p">,</span>
    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">file_names</span>
<span class="p">})</span>

<span class="n">datasource_1975_1996</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">datasource_1975_1996</span><span class="p">,</span><span class="n">datasource_1975_1996_new</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;file_name&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_urls</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">datasource_1975_1996</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]</span>
    <span class="n">act_url</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span>

    <span class="n">page_header_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;LAWS OF FLORIDA\s+\n+CHAPTER | CHAPTER+.*?\s+\n+LAWS OF FLORIDA | CHAPTER+.*?\s+\n+LAWS OF FLORIDA\s+\n+CHAPTER &#39;</span>
    <span class="c1"># Finding all occurrences of the pattern in the text</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">page_header_pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="c1"># Print the matches</span>
    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># split the chapters</span>
    <span class="n">chapters</span> <span class="o">=</span><span class="p">[]</span>
    <span class="n">chap_pattern</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Filed in Office Secretary of State \b(?:January|February|March|April|May|June|July|August|September|October|November|December)\b \d{1,2}, \d</span><span class="si">{4}</span><span class="s1">\.&#39;</span>
    <span class="c1"># Split the text using the modified pattern</span>
    <span class="n">chapters</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">chap_pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">chapter</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chapters</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;CHAPTER&#39;</span> <span class="o">+</span> <span class="n">chapter</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;CHAPTER&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chapter</span><span class="p">)</span>
        <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
        <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>

<span class="n">datasource_1975_1996</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">act_txts</span><span class="p">,</span>
    <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">years</span><span class="p">,</span>
    <span class="s1">&#39;link&#39;</span><span class="p">:</span><span class="n">act_urls</span><span class="p">,</span>
    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span><span class="n">file_names</span><span class="p">,</span>
    <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s1">&#39;FL&#39;</span>
<span class="p">})</span>

<span class="c1"># for 1997-2021</span>

<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://laws.flrules.org/node?field_list_year_nid=8184&#39;</span><span class="p">)</span>

<span class="n">session_id_elements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;#edit-field-list-year-nid option&#39;</span><span class="p">)</span>

<span class="c1"># Assuming session_id_elements is a list of elements</span>
<span class="n">session_id_dict</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">session_id_elements</span><span class="p">):</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span>
    <span class="n">session_id</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
    <span class="n">session_id_dict</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">session_id</span><span class="p">)</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">session_id</span><span class="p">)</span> <span class="ow">in</span> <span class="n">session_id_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="c1"># Now you can use index, year, and session_id within your loop</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Index: </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">, Year: </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">, Session ID: </span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2022</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
        <span class="n">session_url</span> <span class="o">=</span> <span class="s1">&#39;https://laws.flrules.org/node?field_list_year_nid=&#39;</span> <span class="o">+</span> <span class="n">session_id</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">session_url</span><span class="p">)</span>

        <span class="n">act_elements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;table.views-table:nth-child(1) &gt; tbody:nth-child(3) &gt; tr&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">act_elements</span><span class="p">):</span>
            <span class="c1">#print(element.text)</span>
            <span class="k">if</span> <span class="s1">&#39;Ch&#39;</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

                <span class="n">act_url</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span><span class="s1">&#39;.pdf&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>
                <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
                <span class="n">act_name</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;:nth-child(3)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="n">act_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_name</span><span class="p">)</span>
                <span class="n">bill_num</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;:nth-child(4)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bill_num</span><span class="p">)</span>

                <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

                <span class="c1"># download corresponding pdf file</span>
                <span class="n">name</span> <span class="o">=</span>  <span class="n">element</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

                <span class="n">path</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">+</span> <span class="n">name</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.005</span><span class="p">)</span>

                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
                <span class="c1"># Ensure the request was successful</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                    <span class="c1"># Write the content of the response to a file</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
                    <span class="n">broken_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>



<span class="n">folder_path</span> <span class="o">=</span> <span class="s2">&quot;./PDFs&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">folder_path</span><span class="p">))</span>

<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>

<span class="n">broken_files</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
            <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
            <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
            <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
        <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
        <span class="n">broken_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;./PDFs/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">file_names_new</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">:</span>
    <span class="c1"># Remove &#39;Ch_&#39; and &#39;.pdf&#39;, then replace &#39;_&#39; with &#39;-&#39; if it exists</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Ch_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>  <span class="c1"># Split at &#39;-&#39;</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Convert to int to remove leading zeros</span>
    <span class="n">file_names_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">datasource_1997_2021_pdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">act_txts</span><span class="p">,</span>
    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">file_names_new</span>
<span class="p">})</span>


<span class="n">datasource_1997_2021</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;bill_num&#39;</span><span class="p">:</span> <span class="n">bill_nums</span><span class="p">,</span>
    <span class="s1">&#39;link&#39;</span><span class="p">:</span> <span class="n">act_urls</span><span class="p">,</span>
    <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s2">&quot;FL&quot;</span><span class="p">,</span>
    <span class="s1">&#39;act_name&#39;</span><span class="p">:</span> <span class="n">act_names</span>
<span class="p">})</span>

<span class="c1"># delete the duplicates from the websites, like https://laws.flrules.org/node?field_list_year_nid=5235</span>
<span class="n">datasource_1997_2021</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>

<span class="n">datasource_1997_2021</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource_1997_2021</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;https://laws.flrules.org/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">datasource_1997_2021</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">datasource_1997_2021_pdf</span><span class="p">,</span> <span class="n">datasource_1997_2021</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;file_name&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">datasource_1975_1996</span><span class="p">,</span> <span class="n">datasource_1997_2021</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>

<span class="c1"># Filter out the rows where the specified text is found</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="o">~</span><span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">House Concurrent Resolution No.&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;FL_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;FL_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;FL_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;FL_Leginfo.json&#39;</span><span class="p">)</span>
<span class="c1"># End of FL_Leginfo.py</span>


<span class="c1"># Start of CA_leginfo_Galina.py</span>

<span class="c1"># Import libraries</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">MultinomialNB</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfVectorizer</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfVectorizer</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">import</span> <span class="nn">openai</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">gensim</span>
<span class="kn">from</span> <span class="nn">gensim.utils</span> <span class="kn">import</span> <span class="n">simple_preprocess</span>
<span class="kn">from</span> <span class="nn">gensim.corpora.dictionary</span> <span class="kn">import</span> <span class="n">Dictionary</span>
<span class="kn">from</span> <span class="nn">gensim.models.ldamodel</span> <span class="kn">import</span> <span class="n">LdaModel</span>
<span class="kn">from</span> <span class="nn">nltk.stem</span> <span class="kn">import</span> <span class="n">WordNetLemmatizer</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">import</span> <span class="nn">inflection</span>
<span class="kn">from</span> <span class="nn">nltk.stem</span> <span class="kn">import</span> <span class="n">WordNetLemmatizer</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="c1">#import PyPDF2</span>
<span class="c1">#import glob</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>


<span class="c1"># working path</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Users/long/Library/CloudStorage/GoogleDrive-long0555@umn.edu/Shared drives/UCSC-UMN AFRI project/Data/Raw_Data/CA/&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Users/long/Documents/AFRI_AI/Inputs&#39;</span><span class="p">)</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>
<span class="n">driver_path</span> <span class="o">=</span> <span class="s1">&#39;/Users/long/Documents/AFRI_AI/chromedriver.exe&#39;</span>
<span class="n">chromeOptions</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
<span class="n">dnldpath</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;download.default_directory&quot;</span> <span class="p">:</span><span class="s2">&quot;/Users/long/Documents/AFRI_AI/Inputs&quot;</span><span class="p">}</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s2">&quot;prefs&quot;</span><span class="p">,</span><span class="n">dnldpath</span><span class="p">)</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--no-sandbox&#39;</span><span class="p">)</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-dev-shm-usage&#39;</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="n">driver_path</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">chromeOptions</span><span class="p">)</span>


<span class="n">acts_Galina</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;StateLawsCA_by year_by category.xls&quot;</span><span class="p">)</span>



<span class="c1"># set up list titles</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sessionyears</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">billnumbers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">briefsummarys</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">introduceddates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">signingdates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">effectivedates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">expireddates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">leadauthors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">textlinks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">fulltexts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">fulltextpages</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">urls</span> <span class="o">=</span> <span class="n">acts_Galina</span><span class="p">[</span><span class="s2">&quot;Link to full text&quot;</span><span class="p">]</span>

<span class="c1"># extract bill information on each bill</span>

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;CA&quot;</span>
    <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="n">billnumber</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;#bill_header &gt; div:nth-child(3) &gt; h1&#39;</span><span class="p">)</span>
    <span class="n">billnumbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">billnumber</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;#bill_header &gt; div:nth-child(3) &gt; h1&#39;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">title</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="n">textlinks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">fulltext</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s2">&quot;#bill_all&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">fulltexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fulltext</span><span class="p">)</span>
    <span class="n">fulltextpage</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s2">&quot;#centercolumn&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">fulltextpages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fulltextpage</span><span class="p">)</span>
    <span class="n">sleeptime</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span><span class="o">*</span><span class="mf">0.01</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;State&#39;</span><span class="p">:</span> <span class="n">states</span><span class="p">,</span>
    <span class="s1">&#39;Bill Number&#39;</span><span class="p">:</span> <span class="n">billnumbers</span><span class="p">,</span>
    <span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="n">titles</span><span class="p">,</span>
    <span class="s1">&#39;Full text&#39;</span><span class="p">:</span> <span class="n">fulltexts</span><span class="p">,</span>
    <span class="s1">&#39;Link to full text&#39;</span><span class="p">:</span><span class="n">textlinks</span>
<span class="p">})</span>



<span class="c1"># Python program to read</span>
<span class="c1"># json file</span>



<span class="c1"># Opening JSON file</span>

<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Volumes/GoogleDrive/Shared drives/UCSC-UMN AFRI project/Data/CA/&#39;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.json&#39;</span><span class="p">)</span>
<span class="c1"># os.chdir(&#39;/Volumes/GoogleDrive/Shared drives/UCSC-UMN AFRI project/Data/GA&#39;)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>


<span class="c1">#datasource = json.load(f)</span>

<span class="c1">#datasource = pd.read_pickle(&quot;CA_Leginfo.pkl&quot;)</span>
<span class="c1">#datasource = datasource.drop([&#39;authors&#39;,&#39;Introduced Date&#39;,&#39;Date effective&#39;,&#39;Expiration date&#39;], axis = 1)</span>

<span class="c1"># save bill info into files</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo_Galina.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo_Galina.csv&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite://&#39;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.sql&#39;</span><span class="p">,</span><span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.json&#39;</span><span class="p">)</span>


<span class="n">datasource</span><span class="o">.</span><span class="n">to_stata</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.dta&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;download finished&quot;</span><span class="p">)</span>
<span class="c1"># End of CA_leginfo_Galina.py</span>


<span class="c1"># Start of NASS.py</span>

<span class="c1"># import libraries</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="c1">#import PyPDF2</span>
<span class="c1">#import glob</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>


<span class="n">driver_path</span> <span class="o">=</span> <span class="s1">&#39;C:/Users/longy/OneDrive/Projects/AFRI/windows/chromedriver.exe&#39;</span> <span class="c1">#for windows</span>
<span class="c1"># driver_path = &#39;/Users/Yanxu/OneDrive/Projects/AgPolicyCoding/chromedriver&#39;</span>
<span class="c1"># driver = webdriver.Chrome(executable_path=DRIVER_PATH)</span>

<span class="c1"># Change the working directory</span>
<span class="c1">#os.chdir(&#39;/Users/long/OneDrive/Projects/AFRI&#39;)</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;C:/Users/longy/OneDrive/Projects/AFRI&#39;</span><span class="p">)</span>
<span class="c1"># os.chdir(&#39;/Volumes/GoogleDrive/Shared drives/UCSC-UMN AFRI project/Data/GA&#39;)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="n">chromeOptions</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
<span class="c1"># for mac</span>
<span class="c1">#dnldpath = {&quot;download.default_directory&quot; : &quot;/Users/long/OneDrive/Projects/AFRI/data/SD/&quot;}</span>
<span class="c1"># for windows</span>
<span class="n">dnldpath</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;download.default_directory&quot;</span> <span class="p">:</span><span class="s2">&quot;C:/Users/longy/OneDrive/Projects/AFRI/data/CA/&quot;</span><span class="p">}</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s2">&quot;prefs&quot;</span><span class="p">,</span><span class="n">dnldpath</span><span class="p">)</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--no-sandbox&#39;</span><span class="p">)</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-dev-shm-usage&#39;</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="n">driver_path</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">chromeOptions</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>



<span class="n">sessions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2021 - 2022&#39;</span><span class="p">,</span> <span class="s1">&#39;2019 - 2020&#39;</span><span class="p">,</span> <span class="s1">&#39;2017 - 2018&#39;</span><span class="p">,</span> <span class="s1">&#39;2015 - 2016&#39;</span><span class="p">,</span> <span class="s1">&#39;2013 - 2014&#39;</span><span class="p">,</span> <span class="s1">&#39;2011 - 2012&#39;</span><span class="p">,</span> <span class="s1">&#39;2009 - 2010&#39;</span><span class="p">,</span> <span class="s1">&#39;2007 - 2008&#39;</span><span class="p">,</span> <span class="s1">&#39;2005 - 2006&#39;</span><span class="p">,</span> <span class="s1">&#39;2003 - 2004&#39;</span><span class="p">,</span> <span class="s1">&#39;2001 - 2002&#39;</span><span class="p">,</span> <span class="s1">&#39;1999 - 2000&#39;</span><span class="p">]</span>

<span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">measures</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">subjects</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">authors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">statuss</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">subjects1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">authors1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">statuss1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># search bills by iterating sessionyears first and then keywords</span>
<span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">sessions</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://leginfo.legislature.ca.gov/faces/billSearchClient.xhtml&quot;</span><span class="p">)</span>
    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;#attrSearch&quot;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">select_session</span> <span class="o">=</span> <span class="n">Select</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;select#session_year&#39;</span><span class="p">))</span>
    <span class="n">select_session</span><span class="o">.</span><span class="n">select_by_visible_text</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
    <span class="n">search</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#attrSearch&#39;</span><span class="p">)</span>
    <span class="n">search</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;tbody tr&quot;</span><span class="p">)))</span>
    <span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;tbody tr&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">bill</span> <span class="ow">in</span> <span class="n">bills</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bill</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;td:nth-child(4)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;Chaptered&#39;</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">bill</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;td:nth-child(1) a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">measure</span> <span class="o">=</span> <span class="n">bill</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;td:nth-child(1) a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="n">measures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measure</span><span class="p">)</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="n">bill</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;td:nth-child(2)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="n">subjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
            <span class="n">author</span> <span class="o">=</span> <span class="n">bill</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;td:nth-child(3)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="n">authors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">author</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">bill</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;td:nth-child(4)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="n">statuss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Do not pass&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;url done&quot;</span><span class="p">)</span>

<span class="c1"># set up list titles</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sessionyears</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">billnumbers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">briefsummarys</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">introduceddates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">signingdates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">effectivedates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">expireddates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">leadauthors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">textlinks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">fulltexts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">fulltextpages</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># extract bill information on each bill</span>

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">[</span><span class="mi">6313</span><span class="p">:]:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;CA&quot;</span>
    <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="n">billnumber</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#bill_header &gt; div:nth-child(3) &gt; h1&#39;</span><span class="p">)</span>
    <span class="n">billnumbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">billnumber</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#bill_header &gt; div:nth-child(3) &gt; h1&#39;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">title</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="n">textlinks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">fulltext</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;#bill_all&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">fulltexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fulltext</span><span class="p">)</span>
    <span class="n">fulltextpage</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;#centercolumn&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">fulltextpages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fulltextpage</span><span class="p">)</span>
    <span class="n">sleeptime</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span><span class="o">*</span><span class="mf">0.1</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Year&#39;</span><span class="p">:</span> <span class="n">years</span><span class="p">,</span>
    <span class="s1">&#39;State&#39;</span><span class="p">:</span> <span class="n">states</span><span class="p">,</span>
    <span class="s1">&#39;Session Year&#39;</span><span class="p">:</span> <span class="n">sessionyears</span><span class="p">,</span>
    <span class="s1">&#39;Bill Number&#39;</span><span class="p">:</span> <span class="n">billnumbers</span><span class="p">,</span>
    <span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="n">titles</span><span class="p">,</span>
    <span class="s1">&#39;Brief Summary&#39;</span><span class="p">:</span> <span class="n">briefsummarys</span><span class="p">,</span>
    <span class="s1">&#39;Introduced Date&#39;</span><span class="p">:</span> <span class="n">introduceddates</span><span class="p">,</span>
    <span class="s1">&#39;Date it was signed&#39;</span><span class="p">:</span><span class="n">signingdates</span><span class="p">,</span>
    <span class="s1">&#39;Date effective&#39;</span><span class="p">:</span><span class="n">effectivedates</span><span class="p">,</span>
    <span class="s1">&#39;Expiration date&#39;</span><span class="p">:</span><span class="n">expireddates</span><span class="p">,</span>
    <span class="s1">&#39;Introducer&#39;</span><span class="p">:</span><span class="n">leadauthors</span><span class="p">,</span>
    <span class="s1">&#39;Full text&#39;</span><span class="p">:</span> <span class="n">fulltexts</span><span class="p">,</span>
    <span class="s1">&#39;Link to full text&#39;</span><span class="p">:</span><span class="n">textlinks</span>
<span class="p">})</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Year&#39;</span><span class="p">:</span> <span class="n">years</span><span class="p">,</span>
    <span class="s1">&#39;State&#39;</span><span class="p">:</span> <span class="n">states</span><span class="p">,</span>
    <span class="s1">&#39;Session Year&#39;</span><span class="p">:</span> <span class="n">sessionyears</span><span class="p">,</span>
    <span class="s1">&#39;Bill Number&#39;</span><span class="p">:</span> <span class="n">billnumbers</span><span class="p">,</span>
    <span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="n">titles</span><span class="p">,</span>
    <span class="s1">&#39;authors&#39;</span><span class="p">:</span><span class="n">authors</span><span class="p">,</span>
    <span class="s1">&#39;Brief Summary&#39;</span><span class="p">:</span> <span class="n">briefsummarys</span><span class="p">,</span>
    <span class="s1">&#39;Introduced Date&#39;</span><span class="p">:</span> <span class="n">introduceddates</span><span class="p">,</span>
    <span class="s1">&#39;Date effective&#39;</span><span class="p">:</span><span class="n">effectivedates</span><span class="p">,</span>
    <span class="s1">&#39;Expiration date&#39;</span><span class="p">:</span><span class="n">expireddates</span><span class="p">,</span>
    <span class="s1">&#39;Full text&#39;</span><span class="p">:</span> <span class="n">fulltexts</span><span class="p">,</span>
    <span class="s1">&#39;Link to full text&#39;</span><span class="p">:</span><span class="n">textlinks</span>
<span class="p">})</span>


<span class="c1"># Python program to read</span>
<span class="c1"># json file</span>



<span class="c1"># Opening JSON file</span>

<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Volumes/GoogleDrive/Shared drives/UCSC-UMN AFRI project/Data/CA/&#39;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.json&#39;</span><span class="p">)</span>
<span class="c1"># os.chdir(&#39;/Volumes/GoogleDrive/Shared drives/UCSC-UMN AFRI project/Data/GA&#39;)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>


<span class="c1">#datasource = json.load(f)</span>

<span class="c1">#datasource = pd.read_pickle(&quot;CA_Leginfo.pkl&quot;)</span>
<span class="c1">#datasource = datasource.drop([&#39;authors&#39;,&#39;Introduced Date&#39;,&#39;Date effective&#39;,&#39;Expiration date&#39;], axis = 1)</span>

<span class="c1"># save bill info into files</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite://&#39;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.sql&#39;</span><span class="p">,</span><span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.json&#39;</span><span class="p">)</span>


<span class="n">datasource</span><span class="o">.</span><span class="n">to_stata</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.dta&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;download finished&quot;</span><span class="p">)</span>
<span class="c1"># End of NASS.py</span>


<span class="c1"># Start of CA_leginfo_v3.py</span>

<span class="c1"># import libraries</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="c1">#import PyPDF2</span>
<span class="c1">#import glob</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>


<span class="n">driver_path</span> <span class="o">=</span> <span class="s1">&#39;C:/Users/longy/OneDrive/Projects/AFRI/windows/chromedriver.exe&#39;</span> <span class="c1">#for windows</span>
<span class="c1"># driver_path = &#39;/Users/Yanxu/OneDrive/Projects/AgPolicyCoding/chromedriver&#39;</span>
<span class="c1"># driver = webdriver.Chrome(executable_path=DRIVER_PATH)</span>

<span class="c1"># Change the working directory</span>
<span class="c1">#os.chdir(&#39;/Users/long/OneDrive/Projects/AFRI&#39;)</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;C:/Users/longy/OneDrive/Projects/AFRI&#39;</span><span class="p">)</span>
<span class="c1"># os.chdir(&#39;/Volumes/GoogleDrive/Shared drives/UCSC-UMN AFRI project/Data/GA&#39;)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="n">chromeOptions</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
<span class="c1"># for mac</span>
<span class="c1">#dnldpath = {&quot;download.default_directory&quot; : &quot;/Users/long/OneDrive/Projects/AFRI/data/SD/&quot;}</span>
<span class="c1"># for windows</span>
<span class="n">dnldpath</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;download.default_directory&quot;</span> <span class="p">:</span><span class="s2">&quot;C:/Users/longy/OneDrive/Projects/AFRI/data/CA/&quot;</span><span class="p">}</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s2">&quot;prefs&quot;</span><span class="p">,</span><span class="n">dnldpath</span><span class="p">)</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--no-sandbox&#39;</span><span class="p">)</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-dev-shm-usage&#39;</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="n">driver_path</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">chromeOptions</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>



<span class="n">sessions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2021 - 2022&#39;</span><span class="p">,</span> <span class="s1">&#39;2019 - 2020&#39;</span><span class="p">,</span> <span class="s1">&#39;2017 - 2018&#39;</span><span class="p">,</span> <span class="s1">&#39;2015 - 2016&#39;</span><span class="p">,</span> <span class="s1">&#39;2013 - 2014&#39;</span><span class="p">,</span> <span class="s1">&#39;2011 - 2012&#39;</span><span class="p">,</span> <span class="s1">&#39;2009 - 2010&#39;</span><span class="p">,</span> <span class="s1">&#39;2007 - 2008&#39;</span><span class="p">,</span> <span class="s1">&#39;2005 - 2006&#39;</span><span class="p">,</span> <span class="s1">&#39;2003 - 2004&#39;</span><span class="p">,</span> <span class="s1">&#39;2001 - 2002&#39;</span><span class="p">,</span> <span class="s1">&#39;1999 - 2000&#39;</span><span class="p">]</span>

<span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">measures</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">subjects</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">authors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">statuss</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">subjects1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">authors1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">statuss1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># search bills by iterating sessionyears first and then keywords</span>
<span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">sessions</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://leginfo.legislature.ca.gov/faces/billSearchClient.xhtml&quot;</span><span class="p">)</span>
    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;#attrSearch&quot;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">select_session</span> <span class="o">=</span> <span class="n">Select</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;select#session_year&#39;</span><span class="p">))</span>
    <span class="n">select_session</span><span class="o">.</span><span class="n">select_by_visible_text</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
    <span class="n">search</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#attrSearch&#39;</span><span class="p">)</span>
    <span class="n">search</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;tbody tr&quot;</span><span class="p">)))</span>
    <span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;tbody tr&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">bill</span> <span class="ow">in</span> <span class="n">bills</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bill</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;td:nth-child(4)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;Chaptered&#39;</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">bill</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;td:nth-child(1) a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">measure</span> <span class="o">=</span> <span class="n">bill</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;td:nth-child(1) a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="n">measures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measure</span><span class="p">)</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="n">bill</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;td:nth-child(2)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="n">subjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
            <span class="n">author</span> <span class="o">=</span> <span class="n">bill</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;td:nth-child(3)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="n">authors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">author</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">bill</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;td:nth-child(4)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="n">statuss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Do not pass&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;url done&quot;</span><span class="p">)</span>

<span class="c1"># set up list titles</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sessionyears</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">billnumbers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">briefsummarys</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">introduceddates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">signingdates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">effectivedates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">expireddates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">leadauthors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">textlinks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">fulltexts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">fulltextpages</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># extract bill information on each bill</span>

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">[</span><span class="mi">6313</span><span class="p">:]:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;CA&quot;</span>
    <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="n">billnumber</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#bill_header &gt; div:nth-child(3) &gt; h1&#39;</span><span class="p">)</span>
    <span class="n">billnumbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">billnumber</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#bill_header &gt; div:nth-child(3) &gt; h1&#39;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">title</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="n">textlinks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">fulltext</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;#bill_all&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">fulltexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fulltext</span><span class="p">)</span>
    <span class="n">fulltextpage</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;#centercolumn&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">fulltextpages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fulltextpage</span><span class="p">)</span>
    <span class="n">sleeptime</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span><span class="o">*</span><span class="mf">0.1</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Year&#39;</span><span class="p">:</span> <span class="n">years</span><span class="p">,</span>
    <span class="s1">&#39;State&#39;</span><span class="p">:</span> <span class="n">states</span><span class="p">,</span>
    <span class="s1">&#39;Session Year&#39;</span><span class="p">:</span> <span class="n">sessionyears</span><span class="p">,</span>
    <span class="s1">&#39;Bill Number&#39;</span><span class="p">:</span> <span class="n">billnumbers</span><span class="p">,</span>
    <span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="n">titles</span><span class="p">,</span>
    <span class="s1">&#39;Brief Summary&#39;</span><span class="p">:</span> <span class="n">briefsummarys</span><span class="p">,</span>
    <span class="s1">&#39;Introduced Date&#39;</span><span class="p">:</span> <span class="n">introduceddates</span><span class="p">,</span>
    <span class="s1">&#39;Date it was signed&#39;</span><span class="p">:</span><span class="n">signingdates</span><span class="p">,</span>
    <span class="s1">&#39;Date effective&#39;</span><span class="p">:</span><span class="n">effectivedates</span><span class="p">,</span>
    <span class="s1">&#39;Expiration date&#39;</span><span class="p">:</span><span class="n">expireddates</span><span class="p">,</span>
    <span class="s1">&#39;Introducer&#39;</span><span class="p">:</span><span class="n">leadauthors</span><span class="p">,</span>
    <span class="s1">&#39;Full text&#39;</span><span class="p">:</span> <span class="n">fulltexts</span><span class="p">,</span>
    <span class="s1">&#39;Link to full text&#39;</span><span class="p">:</span><span class="n">textlinks</span>
<span class="p">})</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Year&#39;</span><span class="p">:</span> <span class="n">years</span><span class="p">,</span>
    <span class="s1">&#39;State&#39;</span><span class="p">:</span> <span class="n">states</span><span class="p">,</span>
    <span class="s1">&#39;Session Year&#39;</span><span class="p">:</span> <span class="n">sessionyears</span><span class="p">,</span>
    <span class="s1">&#39;Bill Number&#39;</span><span class="p">:</span> <span class="n">billnumbers</span><span class="p">,</span>
    <span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="n">titles</span><span class="p">,</span>
    <span class="s1">&#39;authors&#39;</span><span class="p">:</span><span class="n">authors</span><span class="p">,</span>
    <span class="s1">&#39;Brief Summary&#39;</span><span class="p">:</span> <span class="n">briefsummarys</span><span class="p">,</span>
    <span class="s1">&#39;Introduced Date&#39;</span><span class="p">:</span> <span class="n">introduceddates</span><span class="p">,</span>
    <span class="s1">&#39;Date effective&#39;</span><span class="p">:</span><span class="n">effectivedates</span><span class="p">,</span>
    <span class="s1">&#39;Expiration date&#39;</span><span class="p">:</span><span class="n">expireddates</span><span class="p">,</span>
    <span class="s1">&#39;Full text&#39;</span><span class="p">:</span> <span class="n">fulltexts</span><span class="p">,</span>
    <span class="s1">&#39;Link to full text&#39;</span><span class="p">:</span><span class="n">textlinks</span>
<span class="p">})</span>


<span class="c1"># Python program to read</span>
<span class="c1"># json file</span>



<span class="c1"># Opening JSON file</span>

<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Volumes/GoogleDrive/Shared drives/UCSC-UMN AFRI project/Data/CA/&#39;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.json&#39;</span><span class="p">)</span>
<span class="c1"># os.chdir(&#39;/Volumes/GoogleDrive/Shared drives/UCSC-UMN AFRI project/Data/GA&#39;)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>


<span class="c1">#datasource = json.load(f)</span>

<span class="c1">#datasource = pd.read_pickle(&quot;CA_Leginfo.pkl&quot;)</span>
<span class="c1">#datasource = datasource.drop([&#39;authors&#39;,&#39;Introduced Date&#39;,&#39;Date effective&#39;,&#39;Expiration date&#39;], axis = 1)</span>

<span class="c1"># save bill info into files</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite://&#39;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.sql&#39;</span><span class="p">,</span><span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.json&#39;</span><span class="p">)</span>


<span class="n">datasource</span><span class="o">.</span><span class="n">to_stata</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.dta&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;download finished&quot;</span><span class="p">)</span>
<span class="c1"># End of CA_leginfo_v3.py</span>


<span class="c1"># Start of NM_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="c1">## others</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">inflect</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># set up working directory</span>
<span class="n">working_directory</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">))</span>

<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;./Data/Raw_Data/NM/PDFs&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>



<span class="c1"># Specify the path to the Firefox binary</span>
<span class="n">firefox_binary_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Firefox.app/Contents/MacOS/firefox&#39;</span>

<span class="c1"># Create a Firefox profile and configure preferences</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
<span class="n">options</span><span class="o">.</span><span class="n">binary_location</span> <span class="o">=</span> <span class="n">firefox_binary_path</span>

<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span> <span class="o">=</span> <span class="s1">&#39;./Data/geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="c1"># Initialize the WebDriver with the specified path</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">service</span><span class="p">)</span>


<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://www.nmlegis.gov/Legislation/BillFinder/Chaptered&#39;</span><span class="p">)</span>

<span class="n">session_info_elements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;#MainContent_gridViewLegislation &gt; tbody &gt; tr:&#39;</span><span class="p">)</span>

<span class="n">sessions_info</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">session_element</span> <span class="ow">in</span> <span class="n">session_info_elements</span><span class="p">:</span>
    <span class="n">sessions_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session_element</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="n">sessions_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">bill_nums</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">bill_elements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;#MainContent_gridViewLegislation &gt; tbody &gt; tr &gt; td:nth-child(1)&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">bill_elements</span><span class="p">:</span>
    <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="nb">len</span><span class="p">(</span><span class="n">bill_nums</span><span class="p">)</span>

<span class="c1">#MainContent_gridViewLegislation_lblSession_0</span>
<span class="c1">#MainContent_gridViewLegislation &gt; tbody:nth-child(2) &gt; tr:nth-child(1) &gt; td:nth-child(5)</span>
<span class="c1">#MainContent_gridViewLegislation &gt; tbody:nth-child(2) &gt; tr:nth-child(1) &gt; td:nth-child(5)</span>
<span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">session_elements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;#MainContent_gridViewLegislation &gt; tbody &gt; tr &gt; td:nth-child(5)&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">session_element</span> <span class="ow">in</span> <span class="n">session_elements</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">session_element</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">sessions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session_element</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="nb">len</span><span class="p">(</span><span class="n">sessions</span><span class="p">)</span>


<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;bill_num&#39;</span><span class="p">:</span> <span class="n">bill_nums</span><span class="p">,</span>
    <span class="s1">&#39;session&#39;</span><span class="p">:</span> <span class="n">sessions</span>
<span class="p">})</span>

<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/NM/NM_leginfo_re.csv&quot;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/NM/NM_leginfo_re.csv&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;session&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span>
<span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">][:</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">session_part</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;1st&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;2nd&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">bill_num</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;bill_num&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">bill_num</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">bill_part</span> <span class="o">=</span> <span class="n">bill_num</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">year</span> <span class="o">&gt;</span> <span class="mi">2003</span><span class="p">:</span>
        <span class="c1"># Construct the URL based on conditions</span>
        <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;https://www.nmlegis.gov/Sessions/</span><span class="si">{</span><span class="n">session_part</span><span class="si">}</span><span class="s1">/final/</span><span class="si">{</span><span class="nb">type</span><span class="si">}{</span><span class="n">bill_part</span><span class="si">}</span><span class="s1">.pdf&#39;</span><span class="p">)</span>
        <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;https://www.nmlegis.gov/Sessions/</span><span class="si">{</span><span class="n">session_part</span><span class="si">}</span><span class="s1">2/final/</span><span class="si">{</span><span class="nb">type</span><span class="si">}{</span><span class="n">bill_part</span><span class="si">}</span><span class="s1">.pdf&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;https://www.nmlegis.gov/Sessions/</span><span class="si">{</span><span class="n">session_part</span><span class="si">}</span><span class="s1">/FinalVersions/</span><span class="si">{</span><span class="nb">type</span><span class="si">}{</span><span class="n">bill_part</span><span class="si">}</span><span class="s1">.pdf&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># Specify the path to the Firefox binary</span>
<span class="n">firefox_binary_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Firefox.app/Contents/MacOS/firefox&#39;</span>

<span class="c1"># Create a Firefox profile and configure preferences</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
<span class="n">options</span><span class="o">.</span><span class="n">binary_location</span> <span class="o">=</span> <span class="n">firefox_binary_path</span>

<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span> <span class="o">=</span> <span class="s1">&#39;./geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="c1"># Initialize the WebDriver with the specified path</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">service</span><span class="p">)</span>


<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.001</span><span class="p">)</span>
    <span class="c1"># Navigate to the URL using JavaScript</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;window.location.href = &#39;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;window.location.reload();&quot;</span><span class="p">)</span>








<span class="c1"># End of NM_Leginfo.py</span>


<span class="c1"># Start of ML_test.py</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="kn">from</span> <span class="nn">torch.nn</span> <span class="kn">import</span> <span class="n">functional</span> <span class="k">as</span> <span class="n">F</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">random_split</span>
<span class="kn">from</span> <span class="nn">torchvision.datasets</span> <span class="kn">import</span> <span class="n">MNIST</span>
<span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">transforms</span>
<span class="kn">import</span> <span class="nn">pytorch_lightning</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">import</span> <span class="nn">re</span>


<span class="k">class</span> <span class="nc">LitAutoEncoder</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">LightningModule</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span> <span class="o">*</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">28</span> <span class="o">*</span> <span class="mi">28</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">embedding</span>

    <span class="k">def</span> <span class="nf">configure_optimizers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">optimizer</span>

    <span class="k">def</span> <span class="nf">training_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">train_batch</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">x_hat</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;train_loss&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">loss</span>

    <span class="k">def</span> <span class="nf">validation_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val_batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">val_batch</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">x_hat</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="p">)</span>


<span class="c1"># data</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">MNIST</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">())</span>
<span class="n">mnist_train</span><span class="p">,</span> <span class="n">mnist_val</span> <span class="o">=</span> <span class="n">random_split</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="p">[</span><span class="mi">55000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">])</span>

<span class="n">train_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">mnist_train</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
<span class="n">val_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">mnist_val</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>

<span class="c1"># model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">LitAutoEncoder</span><span class="p">()</span>

<span class="c1"># training</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">Trainer</span><span class="p">(</span><span class="n">gpus</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_nodes</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">limit_train_batches</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">val_loader</span><span class="p">)</span>


<span class="c1"># End of ML_test.py</span>


<span class="c1"># Start of OR_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>


<span class="c1"># driver_path = &#39;C:/Program Files (x86)/Google/Chrome/Application/chromedriver.exe&#39; #for windows</span>
<span class="c1"># driver_path = &#39;/Users/Yanxu/OneDrive/Projects/AgPolicyCoding/chromedriver&#39;</span>
<span class="c1"># driver = webdriver.Chrome(executable_path=DRIVER_PATH)</span>

<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Users/long/OneDrive/Projects/AFRI&#39;</span><span class="p">)</span>
<span class="c1"># os.chdir(&#39;/Volumes/GoogleDrive/Shared drives/UCSC-UMN AFRI project/Data/GA&#39;)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="n">chromeOptions</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
<span class="n">dnldpath</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;download.default_directory&quot;</span> <span class="p">:</span> <span class="s2">&quot;/Users/long/OneDrive/Projects/AFRI/data/OR/&quot;</span><span class="p">}</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s2">&quot;prefs&quot;</span><span class="p">,</span><span class="n">dnldpath</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="s1">&#39;./chromedriver&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">chromeOptions</span><span class="p">)</span>
<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://www.oregonlegislature.gov/bills_laws/Pages/Oregon-Laws.aspx&quot;</span><span class="p">)</span>


<span class="n">urls</span><span class="o">=</span><span class="p">[]</span>
<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">sessionlist</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;span.ms-commentexpand-iconouter&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">sessionlist</span><span class="p">:</span>
    <span class="n">session</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">chapters</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;td.ms-cellstyle.ms-vb2 a&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">chapter</span> <span class="ow">in</span> <span class="n">chapters</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">chapter</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
    <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="n">urlslist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">urls</span><span class="p">))</span>

<span class="n">urlslist</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">urlslist</span><span class="p">):</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;.pdf&#39;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Users/long/OneDrive/Projects/AFRI/data/OR/&quot;</span>
        <span class="n">list_of_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>
        <span class="n">latest_file</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">list_of_files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getctime</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">latest_file</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">latest_file</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>  <span class="c1"># open in readonly mode</span>
            <span class="c1"># creating a pdf File object of original pdf</span>
            <span class="n">pdfFileObj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">latest_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
            <span class="n">pdfReader</span> <span class="o">=</span> <span class="n">PyPDF2</span><span class="o">.</span><span class="n">PdfFileReader</span><span class="p">(</span><span class="n">pdfFileObj</span><span class="p">)</span>
            <span class="n">pagenumber</span> <span class="o">=</span> <span class="n">pdfReader</span><span class="o">.</span><span class="n">numPages</span>
            <span class="n">acttxt</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pagenumber</span><span class="p">):</span>
                <span class="n">pageObj</span> <span class="o">=</span> <span class="n">pdfReader</span><span class="o">.</span><span class="n">getPage</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">pageObj</span><span class="o">.</span><span class="n">extractText</span><span class="p">()</span>
                <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
                <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">body</span>
        <span class="n">acttxt</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">tag</span><span class="o">.</span><span class="n">strings</span><span class="p">:</span>
            <span class="n">acttxt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="n">acttxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Session Laws&#39;</span><span class="p">:</span> <span class="n">acttxts</span><span class="p">,</span>
    <span class="s1">&#39;Link to full text&#39;</span><span class="p">:</span> <span class="n">urls</span><span class="p">,</span>
<span class="p">})</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;OR_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;OR_Leginfo.csv&#39;</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Web-scrapting finished&quot;</span><span class="p">)</span>
<span class="c1"># End of OR_Leginfo.py</span>


<span class="c1"># Start of CA_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="c1">#import calendar</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1">#driver_path = &#39;C:/Program Files (x86)/Google/Chrome/Application/chromedriver.exe&#39; #for windows</span>
<span class="c1">#driver_path = &#39;/Users/Yanxu/OneDrive/Projects/AgPolicyCoding/chromedriver&#39;</span>
<span class="c1">#driver = webdriver.Chrome(executable_path=driver_path)</span>

<span class="c1">#Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Users/long/OneDrive/Projects/AFRI&#39;</span><span class="p">)</span>
<span class="c1">#Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>


<span class="c1"># set up webdriver by short path</span>
<span class="c1">#driver = webdriver.Chrome(&#39;/Users/Yanxu/OneDrive/Projects/AgPolicyCoding/chromedriver&#39;)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="s1">&#39;./chromedriver&#39;</span><span class="p">)</span>

<span class="c1"># input keyword(s)</span>
<span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;agriculture&#39;</span><span class="p">]</span>

<span class="c1"># choose sessionyears</span>
<span class="c1">#input_sessionyears = [&#39;2021 - 2022&#39;]</span>
<span class="n">input_sessionyears</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2015 - 2016&#39;</span><span class="p">,</span> <span class="s1">&#39;2013 - 2014&#39;</span><span class="p">,</span> <span class="s1">&#39;2011 - 2012&#39;</span><span class="p">,</span> <span class="s1">&#39;2009 - 2010&#39;</span><span class="p">,</span> <span class="s1">&#39;2007 - 2008&#39;</span><span class="p">]</span>
<span class="c1">#input_sessionyears = [&#39;2015 - 2016&#39;, &#39;2013 - 2014&#39;, &#39;2011 - 2012&#39;, &#39;2009 - 2010&#39;, &#39;2007 - 2008&#39;]</span>
<span class="c1">#input_sessionyears = [&#39;2021 - 2022&#39;, &#39;2019 - 2020&#39;, &#39;2017 - 2018&#39;, &#39;2015 - 2016&#39;, &#39;2013 - 2014&#39;, &#39;2011 - 2012&#39;, &#39;2009 - 2010&#39;, &#39;2007 - 2008&#39;, &#39;2005 - 2006&#39;, &#39;2003 - 2004&#39;, &#39;2001 - 2002&#39;, &#39;1999 - 2000&#39;]</span>


<span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># search bills by iterating sessionyears first and then keywords</span>
<span class="k">for</span> <span class="n">input_sessionyear</span> <span class="ow">in</span> <span class="n">input_sessionyears</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://leginfo.legislature.ca.gov/faces/billSearchClient.xhtml&quot;</span><span class="p">)</span>

        <span class="c1"># select session year</span>
        <span class="n">select_sessionyear</span> <span class="o">=</span> <span class="n">Select</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;select#session_year&#39;</span><span class="p">))</span>
        <span class="n">select_sessionyear</span><span class="o">.</span><span class="n">select_by_visible_text</span><span class="p">(</span><span class="n">input_sessionyear</span><span class="p">)</span>

        <span class="c1"># search by keywords</span>
        <span class="n">input_keywords</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;input#keyword.keyword_text&quot;</span><span class="p">)</span>
        <span class="n">input_keywords</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span>
        <span class="n">search_button</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;input#attrSearch&#39;</span><span class="p">)</span>
        <span class="n">search_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

        <span class="n">no_bills_returned</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;#text_bill_returned&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Bills&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">no_bills_returned</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="c1"># get urls in the first page</span>
            <span class="n">searchresult</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div#searchresult tbody a&#39;</span><span class="p">)</span>
            <span class="n">basicinfo</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div.commdataRow&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">searchresult</span><span class="p">)):</span>
                <span class="c1">#for i in range(10):</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">searchresult</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
                <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

            <span class="c1">#%%</span>
            <span class="c1"># get urls in the middle pages</span>
            <span class="n">text_bill_returned</span><span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div#text_bill_returned&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="n">n_pages</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">text_bill_returned</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;of &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">page_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">text_bill_returned</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;Page &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39; of&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">while</span> <span class="n">page_index</span> <span class="o">&lt;</span> <span class="n">n_pages</span><span class="p">:</span>
                <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                    <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;input#nextTen&quot;</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="n">next_page</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;input#nextTen&#39;</span><span class="p">)</span>
                <span class="n">next_page</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                    <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;div#searchresult tbody a&quot;</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="n">searchresult</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div#searchresult tbody a&#39;</span><span class="p">)</span>
                <span class="n">basicinfo</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div.commdataRow&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">searchresult</span><span class="p">)):</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="n">searchresult</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
                    <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                    <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;div#text_bill_returned&quot;</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="n">text_bill_returned</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div#text_bill_returned&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="n">page_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">text_bill_returned</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;Page &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39; of&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;done with urls&quot;</span><span class="p">)</span>


<span class="c1"># set up list titles</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sessionyears</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">billnumbers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">briefsummarys</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">introduceddates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">signingdates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">effectivedates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">expireddates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">leadauthors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">textlinks</span> <span class="o">=</span> <span class="p">[]</span>


<span class="c1"># extract bill information on each bill</span>

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;select#version.bill_version_select&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;Chaptered&quot;</span> <span class="ow">in</span> <span class="n">version</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
        <span class="n">introduceddate</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;- Introduced&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">introduceddate</span> <span class="o">=</span> <span class="n">introduceddate</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">introduceddates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">introduceddate</span><span class="p">)</span>

        <span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;CA&quot;</span>
        <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

        <span class="n">billnumber</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div#bill_title&#39;</span><span class="p">)</span>
        <span class="n">billnumbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">billnumber</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">title</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div#bill_title h2&#39;</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">title</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">briefsummaryresolution</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;span.Resolution&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">briefsummaryresolution</span> <span class="o">=</span> <span class="s2">&quot;N/A&quot;</span>

        <span class="n">briefsummarydigest</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;span#digesttext&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">briefsummarydigest</span><span class="p">:</span>
            <span class="n">briefsummary</span> <span class="o">=</span> <span class="n">briefsummaryresolution</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">briefsummary</span> <span class="o">=</span> <span class="n">briefsummarydigest</span>

        <span class="n">briefsummarys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">briefsummary</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">version</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Chaptered&quot;</span><span class="p">):</span>
            <span class="n">signingdate</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">signingdate</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;- Chaptered&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">signingdates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">signingdate</span><span class="p">)</span>

        <span class="n">signingdate_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">signingdate</span><span class="p">)</span>
        <span class="n">signingdate_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">signingdate_str</span><span class="p">)</span>
        <span class="n">shortyear</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">signingdate</span><span class="p">)[</span><span class="n">signingdate_length</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="n">signingdate_length</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">shortyear</span> <span class="o">&gt;</span> <span class="mi">22</span><span class="p">:</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">shortyear</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shortyear</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">year</span> <span class="o">=</span> <span class="s2">&quot;200&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">shortyear</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">year</span> <span class="o">=</span> <span class="s2">&quot;20&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">shortyear</span><span class="p">)</span>
        <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sessionyear</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sessionyear</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">sessionyears</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sessionyear</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;take effect immediately&quot;</span> <span class="ow">in</span> <span class="n">briefsummary</span><span class="p">:</span>
            <span class="n">effectivedate</span> <span class="o">=</span> <span class="n">signingdate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;take effect on or before&quot;</span> <span class="ow">in</span> <span class="n">briefsummary</span><span class="p">:</span>
                <span class="n">effectivedate</span> <span class="o">=</span> <span class="n">briefsummary</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;take effect on or before&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;take effect on&quot;</span> <span class="ow">in</span> <span class="n">briefsummary</span><span class="p">:</span>
                <span class="n">effectivedate</span> <span class="o">=</span> <span class="n">briefsummary</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;take effect on&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">effectivedate</span> <span class="o">=</span> <span class="s2">&quot;Need to check&quot;</span>

        <span class="n">effectivedates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">effectivedate</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">datefinder</span><span class="o">.</span><span class="n">find_dates</span><span class="p">(</span><span class="n">briefsummary</span><span class="p">):</span>
            <span class="n">dates</span> <span class="o">=</span> <span class="n">datefinder</span><span class="o">.</span><span class="n">find_dates</span><span class="p">(</span><span class="n">briefsummary</span><span class="p">)</span>
            <span class="n">datelist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">:</span>
                    <span class="n">datelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>
                <span class="n">exdtkeys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;expired&#39;</span><span class="p">,</span> <span class="s1">&#39;repeal&#39;</span><span class="p">,</span> <span class="s1">&#39;extend&#39;</span><span class="p">,</span> <span class="s1">&#39;repealed&#39;</span><span class="p">,</span> <span class="s1">&#39;repeals&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">briefsummary</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">exdtkeys</span><span class="p">):</span>
                    <span class="n">expireddate</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">datelist</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">expireddate</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">expireddate</span> <span class="o">=</span> <span class="s1">&#39;Need to check&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">expireddate</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>

        <span class="n">expireddates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expireddate</span><span class="p">)</span>

        <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;#nav_bar_top_status &gt; span&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">leadauthor</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#leadAuthors&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="c1">#try:</span>
        <span class="c1">#    leadauthor = driver.find_element_by_css_selector(&#39;#leadAuthors&#39;).text.replace(&quot; (A)&quot;,&quot;&quot;)</span>
        <span class="c1">#except:</span>
        <span class="c1">#    leadauthor = driver.find_element_by_css_selector(&#39;#leadAuthors&#39;).text.replace(&quot; (S)&quot;,&quot;&quot;)</span>
        <span class="n">leadauthors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">leadauthor</span><span class="p">)</span>

        <span class="n">textlinks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Year&#39;</span><span class="p">:</span> <span class="n">years</span><span class="p">,</span>
    <span class="s1">&#39;State&#39;</span><span class="p">:</span> <span class="n">states</span><span class="p">,</span>
    <span class="s1">&#39;Session Year&#39;</span><span class="p">:</span> <span class="n">sessionyears</span><span class="p">,</span>
    <span class="s1">&#39;Bill Number&#39;</span><span class="p">:</span> <span class="n">billnumbers</span><span class="p">,</span>
    <span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="n">titles</span><span class="p">,</span>
    <span class="s1">&#39;Brief Summary&#39;</span><span class="p">:</span> <span class="n">briefsummarys</span><span class="p">,</span>
    <span class="s1">&#39;Introduced Date&#39;</span><span class="p">:</span> <span class="n">introduceddates</span><span class="p">,</span>
    <span class="s1">&#39;Date it was signed&#39;</span><span class="p">:</span><span class="n">signingdates</span><span class="p">,</span>
    <span class="s1">&#39;Date effective&#39;</span><span class="p">:</span><span class="n">effectivedates</span><span class="p">,</span>
    <span class="s1">&#39;Expiration date&#39;</span><span class="p">:</span><span class="n">expireddates</span><span class="p">,</span>
    <span class="s1">&#39;Introducer&#39;</span><span class="p">:</span><span class="n">leadauthors</span><span class="p">,</span>
    <span class="s1">&#39;Link to full text&#39;</span><span class="p">:</span><span class="n">textlinks</span>
<span class="p">})</span>

<span class="c1"># drop duplicates by &quot;Official ID&quot;</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Bill Number&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">],</span>
                           <span class="n">keep</span> <span class="o">=</span> <span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># save bill info into excel file</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo_food.xlsx&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;download finished&quot;</span><span class="p">)</span>
<span class="c1"># End of CA_Leginfo.py</span>


<span class="c1"># Start of NASS_data.py</span>

<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="c1">## others</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">inflect</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># set up working directory</span>
<span class="n">working_directory</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">))</span>

<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;./NASS_Commodities&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>


<span class="c1"># Specify the path to the Firefox binary</span>
<span class="n">firefox_binary_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Firefox.app/Contents/MacOS/firefox&#39;</span>

<span class="c1"># Create a Firefox profile and configure preferences</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
<span class="n">options</span><span class="o">.</span><span class="n">binary_location</span> <span class="o">=</span> <span class="n">firefox_binary_path</span>

<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span> <span class="o">=</span> <span class="s1">&#39;./geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="c1"># Initialize the WebDriver with the specified path</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">service</span><span class="p">)</span>



<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://quickstats.nass.usda.gov/&#39;</span><span class="p">)</span>

<span class="n">states</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;AL&#39;</span><span class="p">,</span> <span class="s1">&#39;AK&#39;</span><span class="p">,</span> <span class="s1">&#39;AZ&#39;</span><span class="p">,</span> <span class="s1">&#39;AR&#39;</span><span class="p">,</span> <span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="s1">&#39;CO&#39;</span><span class="p">,</span> <span class="s1">&#39;CT&#39;</span><span class="p">,</span> <span class="s1">&#39;DE&#39;</span><span class="p">,</span> <span class="s1">&#39;FL&#39;</span><span class="p">,</span> <span class="s1">&#39;GA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HI&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;IL&#39;</span><span class="p">,</span> <span class="s1">&#39;IN&#39;</span><span class="p">,</span> <span class="s1">&#39;IA&#39;</span><span class="p">,</span> <span class="s1">&#39;KS&#39;</span><span class="p">,</span> <span class="s1">&#39;KY&#39;</span><span class="p">,</span> <span class="s1">&#39;LA&#39;</span><span class="p">,</span> <span class="s1">&#39;ME&#39;</span><span class="p">,</span> <span class="s1">&#39;MD&#39;</span><span class="p">,</span>
    <span class="s1">&#39;MA&#39;</span><span class="p">,</span> <span class="s1">&#39;MI&#39;</span><span class="p">,</span> <span class="s1">&#39;MN&#39;</span><span class="p">,</span> <span class="s1">&#39;MS&#39;</span><span class="p">,</span> <span class="s1">&#39;MO&#39;</span><span class="p">,</span> <span class="s1">&#39;MT&#39;</span><span class="p">,</span> <span class="s1">&#39;NE&#39;</span><span class="p">,</span> <span class="s1">&#39;NV&#39;</span><span class="p">,</span> <span class="s1">&#39;NH&#39;</span><span class="p">,</span> <span class="s1">&#39;NJ&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NM&#39;</span><span class="p">,</span> <span class="s1">&#39;NY&#39;</span><span class="p">,</span> <span class="s1">&#39;NC&#39;</span><span class="p">,</span> <span class="s1">&#39;ND&#39;</span><span class="p">,</span> <span class="s1">&#39;OH&#39;</span><span class="p">,</span> <span class="s1">&#39;OK&#39;</span><span class="p">,</span> <span class="s1">&#39;OR&#39;</span><span class="p">,</span> <span class="s1">&#39;PA&#39;</span><span class="p">,</span> <span class="s1">&#39;RI&#39;</span><span class="p">,</span> <span class="s1">&#39;SC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SD&#39;</span><span class="p">,</span> <span class="s1">&#39;TN&#39;</span><span class="p">,</span> <span class="s1">&#39;TX&#39;</span><span class="p">,</span> <span class="s1">&#39;UT&#39;</span><span class="p">,</span> <span class="s1">&#39;VT&#39;</span><span class="p">,</span> <span class="s1">&#39;VA&#39;</span><span class="p">,</span> <span class="s1">&#39;WA&#39;</span><span class="p">,</span> <span class="s1">&#39;WV&#39;</span><span class="p">,</span> <span class="s1">&#39;WI&#39;</span><span class="p">,</span> <span class="s1">&#39;WY&#39;</span>
<span class="p">]</span>

<span class="n">commodities</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">commodity_elements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;#commodity_desc &gt; option&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">commodity_elements</span><span class="p">:</span>
    <span class="n">commodities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">commodities</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Commodity&#39;</span><span class="p">])</span>

<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;NASS_commodities.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Replace &#39;your_api_key&#39; with your actual QuickStats API key</span>
<span class="n">api_key</span> <span class="o">=</span> <span class="s1">&#39;07D7A7C0-032B-3C59-BCD4-3ECB111B0BE6&#39;</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://quickstats.nass.usda.gov/api/api_GET/&#39;</span>

<span class="n">commodity_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">state_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">download_status</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1">#index = commodities.index(&#39;CRUSTACEANS&#39;)</span>

<span class="k">for</span> <span class="n">commodity</span> <span class="ow">in</span> <span class="n">commodities</span><span class="p">:</span>
    <span class="n">commodity_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">commodity</span><span class="p">)</span>
    <span class="c1"># Loop over states</span>
    <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
        <span class="n">state_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="c1"># Example parameters for the API request</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
            <span class="s1">&#39;commodity_desc&#39;</span><span class="p">:</span> <span class="n">commodity</span><span class="p">,</span>
            <span class="c1">#&#39;year&#39;: &#39;2022&#39;,</span>
            <span class="s1">&#39;state_alpha&#39;</span><span class="p">:</span> <span class="n">state</span><span class="p">,</span>
            <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;CSV&#39;</span>  <span class="c1"># Request data in CSV format</span>
        <span class="p">}</span>

        <span class="c1"># Make the API request</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

        <span class="c1"># Check if the request was successful</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="c1"># Specify the path to save the CSV file</span>
            <span class="n">csv_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;quickstats_data_</span><span class="si">{</span><span class="n">commodity</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">state</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">.csv&#39;</span><span class="p">)</span>

            <span class="c1"># Save the CSV data to a file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_file_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data for </span><span class="si">{</span><span class="n">commodity</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2"> saved to </span><span class="si">{</span><span class="n">csv_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">download_status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch data for </span><span class="si">{</span><span class="n">commodity</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">. Status code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">download_status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;No&#39;</span><span class="p">)</span>


<span class="c1"># List all CSV files in the directory</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">download_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;._&#39;</span><span class="p">)]</span>

<span class="c1"># Initialize an empty list to hold DataFrames</span>
<span class="n">data_frames</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Specify the dtype for problematic columns (replace &#39;object&#39; with appropriate dtype if known)</span>
<span class="n">dtype_spec</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">18</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span>
    <span class="mi">21</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span>
    <span class="mi">35</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span>
    <span class="mi">38</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span>
<span class="p">}</span>

<span class="c1"># Loop through the list of CSV files and read each into a DataFrame, then append to the list</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">data_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># Concatenate all DataFrames in the list into a single DataFrame</span>
<span class="n">appended_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data_frames</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">appended_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;./NASS_Commodities/NASS_commodities_data.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./NASS_Commodities/NASS_commodities_data.csv&quot;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;agg_level_desc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;STATE&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;freq_desc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ANNUAL&#39;</span><span class="p">)]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="o">~</span><span class="p">(</span><span class="n">df</span> <span class="o">==</span> <span class="s1">&#39;nan&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="c1"># Filter out rows where &#39;Value&#39; contains &#39;(D)&#39;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\(D\)&#39;</span><span class="p">)]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sector_desc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;ANIMALS &amp; PRODUCTS&#39;</span><span class="p">,</span> <span class="s1">&#39;CROPS&#39;</span><span class="p">])]</span>

<span class="n">commodities_list</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sector_desc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;ANIMALS &amp; PRODUCTS&#39;</span><span class="p">,</span> <span class="s1">&#39;CROPS&#39;</span><span class="p">])]</span>
<span class="n">commodities_list</span> <span class="o">=</span> <span class="n">commodities_list</span><span class="p">[</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">commodities_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">commodity</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; TOTALS&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">commodity</span> <span class="ow">in</span> <span class="n">commodities_list</span><span class="p">]</span>

<span class="n">commodities_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">commodities_list</span><span class="p">))</span>

<span class="n">commodities_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">commodities_list</span><span class="p">)</span>

<span class="n">commodities_dict_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Define the list to hold the dictionary values</span>
<span class="n">commodity_dicts</span> <span class="o">=</span> <span class="p">[]</span>


<span class="c1"># Initialize an inflect engine</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">inflect</span><span class="o">.</span><span class="n">engine</span><span class="p">()</span>

<span class="c1"># Iterate over each commodity description in the DataFrame</span>
<span class="k">for</span> <span class="n">commodity</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">]:</span>
    <span class="c1"># Convert the commodity description to lowercase</span>
    <span class="n">commodity_lower</span> <span class="o">=</span> <span class="n">commodity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="c1"># Check if the commodity is in singular form</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">singular_noun</span><span class="p">(</span><span class="n">commodity_lower</span><span class="p">):</span>
        <span class="c1"># If it&#39;s plural, we generate singular form and use the original as plural form</span>
        <span class="n">original_commodity</span> <span class="o">=</span> <span class="n">commodity_lower</span>
        <span class="n">revised_commodity</span> <span class="o">=</span> <span class="n">commodity_lower</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;, other&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">plural_commodity</span> <span class="o">=</span> <span class="n">commodity_lower</span>
        <span class="n">singular_commodity</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">singular_noun</span><span class="p">(</span><span class="n">commodity_lower</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If it&#39;s singular, we generate plural form and use the original as singular form</span>
        <span class="n">original_commodity</span> <span class="o">=</span> <span class="n">commodity_lower</span>
        <span class="n">revised_commodity</span> <span class="o">=</span> <span class="n">commodity_lower</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;, other&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">singular_commodity</span> <span class="o">=</span> <span class="n">commodity_lower</span>
        <span class="n">plural_commodity</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">plural</span><span class="p">(</span><span class="n">commodity_lower</span><span class="p">)</span>


    <span class="c1"># Perform transformations and store results in a list</span>
    <span class="n">commodity_forms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">commodity_lower</span><span class="p">,</span>  <span class="c1"># original_commodity</span>
        <span class="n">commodity_lower</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;, other&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>  <span class="c1"># revised_commodity</span>
        <span class="n">commodity_lower</span><span class="p">,</span>  <span class="c1"># singular_commodity</span>
        <span class="n">p</span><span class="o">.</span><span class="n">plural</span><span class="p">(</span><span class="n">commodity_lower</span><span class="p">)</span>  <span class="c1"># plural_commodity</span>
    <span class="p">]</span>

    <span class="c1"># Create a dictionary with the original and generated forms</span>
    <span class="c1">#commodity_dict = {</span>
    <span class="c1">#    &#39;original&#39;: original_commodity,</span>
    <span class="c1">#    &#39;singular&#39;: singular_commodity,</span>
    <span class="c1">#    &#39;plural&#39;: plural_commodity,</span>
    <span class="c1">#    &#39;revised&#39;: revised_commodity</span>
    <span class="c1">#}</span>

    <span class="c1"># Append the dictionary to the list</span>
    <span class="n">commodity_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">commodity_dict</span><span class="p">)</span>

<span class="c1"># Create the new column in the DataFrame</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;commodity_forms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">commodity_dicts</span>

<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;NASS_commodities_animal_crop.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./NASS_Commodities/NASS_commodities_animal_crop.csv&quot;</span><span class="p">)</span>

<span class="c1"># Group by &#39;STATE&#39; and save each group to a separate CSV file</span>
<span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;state_alpha&#39;</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;./NASS_Commodities/</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">_commodity_price.csv&quot;</span>
    <span class="n">group</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

















<span class="c1"># Iterate over each commodity description in commodities_list</span>
<span class="k">for</span> <span class="n">commodity</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">]:</span>
    <span class="c1"># Convert the commodity description to lowercase</span>
    <span class="n">commodity_lower</span> <span class="o">=</span> <span class="n">commodity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="c1"># Check if the commodity is in singular form</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">singular_noun</span><span class="p">(</span><span class="n">commodity_lower</span><span class="p">):</span>
        <span class="c1"># Generate plural form</span>
        <span class="n">original_commodity</span> <span class="o">=</span> <span class="n">commodity_lower</span>
        <span class="n">revised_commodity</span> <span class="o">=</span> <span class="n">commodity_lower</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;, other&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">plural_commodity</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">plural</span><span class="p">(</span><span class="n">commodity_lower</span><span class="p">)</span>
        <span class="n">singular_commodity</span> <span class="o">=</span> <span class="n">commodity_lower</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Generate singular form</span>
        <span class="n">original_commodity</span> <span class="o">=</span> <span class="n">commodity_lower</span>
        <span class="n">revised_commodity</span> <span class="o">=</span> <span class="n">commodity_lower</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;, other&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">singular_commodity</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">singular_noun</span><span class="p">(</span><span class="n">commodity_lower</span><span class="p">)</span>
        <span class="n">plural_commodity</span> <span class="o">=</span> <span class="n">commodity_lower</span>

    <span class="c1"># Create a dictionary with the original and generated forms</span>
    <span class="n">commodity_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;original&#39;</span><span class="p">:</span><span class="n">commodity_lower</span><span class="p">,</span> <span class="s1">&#39;singular&#39;</span><span class="p">:</span> <span class="n">singular_commodity</span><span class="p">,</span> <span class="s1">&#39;plural&#39;</span><span class="p">:</span> <span class="n">plural_commodity</span><span class="p">,</span> <span class="s1">&#39;revised&#39;</span><span class="p">:</span> <span class="n">revised_commodity</span><span class="p">}</span>

    <span class="c1"># Append the dictionary to the list</span>
    <span class="n">commodities_dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">commodity_dict</span><span class="p">)</span>

<span class="n">commodities_list</span><span class="p">[</span><span class="s1">&#39;commodities_dict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">commodities_dict_list</span>


<span class="c1"># Convert commodities_list to DataFrame with a column name &#39;commodity_desc&#39;</span>
<span class="n">commodities_list_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">:</span> <span class="n">commodities_list</span><span class="p">})</span>

<span class="c1"># Combine both DataFrames horizontally</span>
<span class="n">commodities_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">commodities_dict_df</span><span class="p">,</span> <span class="n">commodities_list_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;NASS_commodities_state_annual.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>



<span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>


<span class="c1"># List of columns to keep</span>
<span class="n">columns_to_keep</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;source_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;sector_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;group_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;commodity_desc&#39;</span><span class="p">]</span>

<span class="c1"># Keep only the specified columns using filter</span>
<span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="n">columns_to_keep</span><span class="p">)</span>

<span class="n">df_filtered</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;NASS_commodities_list.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>



<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/Volumes/SSD/AFRI/Data/NASS_Commodities/combined_data/NASS_commodities_state.csv&#39;</span><span class="p">)</span>



<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;class_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;state_alpha&#39;</span><span class="p">])</span>


<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;class_desc&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;ALL CLASSES&#39;</span><span class="p">]</span>

<span class="n">df_country</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;class_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">])</span>

<span class="n">df_country</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;us_commodity_classes.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">df_apple</span> <span class="o">=</span> <span class="n">df_country</span><span class="p">[</span><span class="n">df_country</span><span class="p">[</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;APPLES&#39;</span><span class="p">]</span>
<span class="n">df_apple</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;APPLES&#39;</span><span class="p">]</span>

<span class="n">df_apple</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;apple.xlsx&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">df_wheat</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;WHEAT&#39;</span><span class="p">]</span>

<span class="n">df_wheat</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;us_commodity_classes_state.xlsx&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>




<span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
    <span class="c1"># Define the parameters for the API request</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
        <span class="s1">&#39;commodity_desc&#39;</span><span class="p">:</span> <span class="s1">&#39;APPLES&#39;</span><span class="p">,</span>  <span class="c1"># Request data for APPLES</span>
        <span class="c1">#&#39;year&#39;: &#39;2022&#39;,</span>
        <span class="s1">&#39;state_alpha&#39;</span><span class="p">:</span> <span class="n">state</span><span class="p">,</span>
        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;CSV&#39;</span>  <span class="c1"># Request data in CSV format</span>
    <span class="p">}</span>

    <span class="c1"># Define the URL for the API request</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://quickstats.nass.usda.gov/api/api_GET/&#39;</span>  <span class="c1"># Replace with the actual API endpoint URL</span>

    <span class="c1"># Make the API request</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># Check if the request was successful</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="c1"># Specify the path to save the CSV file</span>
        <span class="n">csv_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;apples_</span><span class="si">{</span><span class="n">state</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">.csv&#39;</span><span class="p">)</span>

        <span class="c1"># Save the CSV data to a file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_file_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data in </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2"> saved to </span><span class="si">{</span><span class="n">csv_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch data for </span><span class="si">{</span><span class="n">commodity</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">. Status code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">data_frames</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">download_dir</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/apple&#39;</span>

<span class="c1"># List all CSV files in the directory</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">download_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;._&#39;</span><span class="p">)]</span>


<span class="c1"># Loop through the list of CSV files and read each into a DataFrame, then append to the list</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">data_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># Concatenate all DataFrames in the list into a single DataFrame</span>
<span class="n">apple</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data_frames</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">apple</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;apple.xlsx&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">apple_country</span> <span class="o">=</span> <span class="n">apple</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;class_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">])</span>
<span class="n">apple_country</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;apple.xlsx&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>




<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/Volumes/SSD/AFRI/Data/NASS_Commodities/combined_data/NASS_commodities_state.csv&#39;</span><span class="p">)</span>

<span class="n">df_survey</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;source_desc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SURVEY&#39;</span> <span class="o">|</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;source_desc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;CROPS&#39;</span><span class="p">]</span>

<span class="n">df_survey</span> <span class="o">=</span> <span class="n">df_survey</span><span class="p">[</span><span class="n">df_survey</span><span class="p">[</span><span class="s1">&#39;freq_desc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ANNUAL&#39;</span><span class="p">]</span>

<span class="n">df_survey</span> <span class="o">=</span> <span class="n">df_survey</span><span class="p">[</span><span class="n">df_survey</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2024</span><span class="p">]</span>

<span class="n">df_survey</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;NASS_commodities_state_survey.csv&#39;</span><span class="p">)</span>

<span class="n">df_survey_us</span> <span class="o">=</span>  <span class="n">df_survey</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;class_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">])</span>

<span class="n">df_survey_us</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;NASS_commodities_survey_US.xlsx&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Step 1: Group by &#39;commodity_desc&#39; and &#39;year&#39; and count unique &#39;class_desc&#39;</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">df_survey_us</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">])[</span><span class="s1">&#39;class_desc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;unique_class_count&#39;</span><span class="p">)</span>

<span class="c1"># Step 2: Identify groups with more than 1 unique &#39;class_desc&#39;</span>
<span class="n">groups_with_multiple_classes</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">[</span><span class="n">grouped</span><span class="p">[</span><span class="s1">&#39;unique_class_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">]</span>

<span class="c1"># Step 3: Filter out &#39;ALL CLASSES&#39; rows for these identified groups</span>
<span class="c1"># Merge to find the rows that should be filtered out</span>
<span class="n">result_df</span> <span class="o">=</span> <span class="n">df_survey_us</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">groups_with_multiple_classes</span><span class="p">[[</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">indicator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Filter out rows where &#39;ALL CLASSES&#39; should be removed</span>
<span class="n">df_survey_us_filtered</span> <span class="o">=</span> <span class="n">result_df</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">result_df</span><span class="p">[</span><span class="s1">&#39;_merge&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">result_df</span><span class="p">[</span><span class="s1">&#39;class_desc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ALL CLASSES&#39;</span><span class="p">))]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_merge&#39;</span><span class="p">])</span>


<span class="n">df_survey_us_filtered</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;NASS_commodities_US_filtered.xlsx&#39;</span><span class="p">)</span>

<span class="c1"># Group by &#39;year&#39; and &#39;commodity_desc&#39;, then count the unique &#39;class_desc&#39;</span>
<span class="n">results_table</span> <span class="o">=</span> <span class="n">df_survey_us_filtered</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;commodity_desc&#39;</span><span class="p">])[</span><span class="s1">&#39;class_desc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Rename the &#39;class_desc&#39; column to &#39;count_class_desc&#39; to reflect the counts</span>
<span class="n">results_table</span> <span class="o">=</span> <span class="n">results_table</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class_desc&#39;</span><span class="p">:</span> <span class="s1">&#39;count_class_desc&#39;</span><span class="p">})</span>

<span class="n">results_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;NASS_commodities_US_varieties.csv&#39;</span><span class="p">)</span>
<span class="n">results_table</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;NASS_commodities_US_varieties.xlsx&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Plotting</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>

<span class="c1"># Iterate over unique &#39;commodity_desc&#39; to plot each as a separate line</span>
<span class="k">for</span> <span class="n">commodity</span> <span class="ow">in</span> <span class="n">results_table</span><span class="p">[</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">results_table</span><span class="p">[</span><span class="n">results_table</span><span class="p">[</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">commodity</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">subset</span><span class="p">[</span><span class="s1">&#39;count_class_desc&#39;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">commodity</span><span class="p">)</span>

<span class="c1"># Add labels and title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Count of Unique Class Desc&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Number of Unique Class Descriptions for Each Commodity by Year&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Commodity&#39;</span><span class="p">)</span>

<span class="c1"># Show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>



<span class="n">df_census</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;source_desc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;CENSUS&#39;</span><span class="p">]</span>

<span class="n">df_survey</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sector_desc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ANIMALS &amp; PRODUCTS&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sector_desc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;CROPS&#39;</span><span class="p">)]</span>

<span class="n">df_census</span> <span class="o">=</span> <span class="n">df_census</span><span class="p">[</span><span class="n">df_census</span><span class="p">[</span><span class="s1">&#39;freq_desc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ANNUAL&#39;</span><span class="p">]</span>

<span class="n">df_census</span> <span class="o">=</span> <span class="n">df_census</span><span class="p">[</span><span class="n">df_census</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2024</span><span class="p">]</span>

<span class="n">df_census</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;NASS_commodities_state_census.csv&#39;</span><span class="p">)</span>

<span class="n">df_census_us</span> <span class="o">=</span>  <span class="n">df_census</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;class_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">])</span>

<span class="n">df_census_us</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;NASS_commodities_census_US.xlsx&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Step 1: Group by &#39;commodity_desc&#39; and &#39;year&#39; and count unique &#39;class_desc&#39;</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">df_census_us</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">])[</span><span class="s1">&#39;class_desc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;unique_class_count&#39;</span><span class="p">)</span>

<span class="c1"># Step 2: Identify groups with more than 1 unique &#39;class_desc&#39;</span>
<span class="n">groups_with_multiple_classes</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">[</span><span class="n">grouped</span><span class="p">[</span><span class="s1">&#39;unique_class_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">]</span>

<span class="c1"># Step 3: Filter out &#39;ALL CLASSES&#39; rows for these identified groups</span>
<span class="c1"># Merge to find the rows that should be filtered out</span>
<span class="n">result_df</span> <span class="o">=</span> <span class="n">df_census_us</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">groups_with_multiple_classes</span><span class="p">[[</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;commodity_desc&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">indicator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Filter out rows where &#39;ALL CLASSES&#39; should be removed</span>
<span class="n">df_census_us_filtered</span> <span class="o">=</span> <span class="n">result_df</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">result_df</span><span class="p">[</span><span class="s1">&#39;_merge&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">result_df</span><span class="p">[</span><span class="s1">&#39;class_desc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ALL CLASSES&#39;</span><span class="p">))]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_merge&#39;</span><span class="p">])</span>


<span class="n">df_census_us_filtered</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;NASS_commodities_US_census_filtered.xlsx&#39;</span><span class="p">)</span>

<span class="c1"># Group by &#39;year&#39; and &#39;commodity_desc&#39;, then count the unique &#39;class_desc&#39;</span>
<span class="n">results_table</span> <span class="o">=</span> <span class="n">df_census_us_filtered</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;commodity_desc&#39;</span><span class="p">])[</span><span class="s1">&#39;class_desc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Rename the &#39;class_desc&#39; column to &#39;count_class_desc&#39; to reflect the counts</span>
<span class="n">results_table</span> <span class="o">=</span> <span class="n">results_table</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class_desc&#39;</span><span class="p">:</span> <span class="s1">&#39;count_class_desc&#39;</span><span class="p">})</span>

<span class="n">results_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;NASS_commodities_US_varieties_census.csv&#39;</span><span class="p">)</span>
<span class="n">results_table</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;NASS_commodities_US_varieties_census.xlsx&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>









<span class="c1"># End of NASS_data.py</span>


<span class="c1"># Start of NE_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">word_tokenize</span>
<span class="kn">from</span> <span class="nn">word_forms.word_forms</span> <span class="kn">import</span> <span class="n">get_word_forms</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">from</span> <span class="nn">dateutil</span> <span class="kn">import</span> <span class="n">parser</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="c1">## others</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">inflect</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">fitz</span>


<span class="c1"># Specify the path to the Firefox binary</span>
<span class="n">firefox_binary_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Firefox.app/Contents/MacOS/firefox&#39;</span>

<span class="c1"># Create a Firefox profile and configure preferences</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
<span class="n">options</span><span class="o">.</span><span class="n">binary_location</span> <span class="o">=</span> <span class="n">firefox_binary_path</span>

<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span> <span class="o">=</span> <span class="s1">&#39;./geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="c1"># Initialize the WebDriver with the specified path</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">service</span><span class="p">)</span>




<span class="n">urls</span><span class="o">=</span><span class="p">[]</span>
<span class="n">sessionurls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">section_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">chs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">91</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">chs</span><span class="p">:</span>
    <span class="n">ch</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
    <span class="n">ch_url</span> <span class="o">=</span> <span class="s2">&quot;https://nebraskalegislature.gov/laws/browse-chapters.php?chapter=&quot;</span> <span class="o">+</span> <span class="n">ch</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ch_url</span><span class="p">)</span>
    <span class="n">sections</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s2">&quot;span.col-md-2.col-sm-3.my-auto:nth-child(1) a&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
        <span class="n">section_url</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="n">section_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section_url</span><span class="p">)</span>

<span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bill_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">section_url</span> <span class="ow">in</span> <span class="n">section_urls</span><span class="p">:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section_url</span><span class="p">)</span>
    <span class="n">section_text</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;div.card-body&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section_text</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_partial_link_text</span><span class="p">(</span><span class="s2">&quot;Laws &quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bill</span> <span class="ow">in</span> <span class="n">bills</span><span class="p">:</span>
            <span class="n">bill_url</span> <span class="o">=</span> <span class="n">bill</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="n">bill_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bill_url</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no source&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;done with bill urls&quot;</span><span class="p">)</span>

<span class="n">billurls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">bill_urls</span><span class="p">))</span>


<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">billurls</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Navigate to the URL using JavaScript</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;window.location.href = &#39;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="n">wait_for_page_load</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>  <span class="c1"># Wait for the page to load</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># Additional sleep to simulate user delay</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Refresh the page</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;window.location.reload();&quot;</span><span class="p">)</span>
        <span class="n">wait_for_page_load</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>  <span class="c1"># Wait again after refresh</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># Wait to ensure the page is properly loaded after refresh</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while refreshing the page: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Raw_Data/</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">/PDFs&quot;</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_mdls_where_from</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
        <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
        <span class="n">act_txt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_txt</span><span class="p">)</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">acttxts</span><span class="p">,</span>
    <span class="s1">&#39;link&#39;</span><span class="p">:</span><span class="n">billurls</span>
<span class="p">})</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;FloorDocs/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/PDF&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;AN</span><span class="se">\n</span><span class="s1">ACT&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;BILL&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Introduced&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(corrected)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(CORRECTED)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Corrected Copy&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;the &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">][</span><span class="mi">1645</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;2001&#39;</span>
<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">][</span><span class="mi">707</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;2000&#39;</span>
<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">][</span><span class="mi">762</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;2017&#39;</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[(</span><span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1975</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2021</span><span class="p">)]</span>


<span class="c1"># Save the DataFrame to an Excel file</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">_Leginfo.xlsx&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Save the DataFrame to a CSV file</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">_Leginfo.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Save the DataFrame to a Pickle file</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">_Leginfo.pkl&#39;</span><span class="p">)</span>

<span class="c1"># Save the DataFrame to a JSON file</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">_Leginfo.json&#39;</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;records&#39;</span><span class="p">)</span>

<span class="c1"># End of NE_Leginfo.py</span>


<span class="c1"># Start of KS_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.firefox_profile</span> <span class="kn">import</span> <span class="n">FirefoxProfile</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="c1">## others</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="c1"># set up working directory</span>
<span class="n">working_directory</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/KS&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">))</span>

<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;./PDFs/&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>

<span class="c1"># Create a Firefox profile and configure preferences</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>


<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span><span class="o">=</span><span class="s1">&#39;../../geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span> <span class="o">=</span> <span class="n">service</span><span class="p">)</span>

<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bad_act_urls</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1996</span><span class="p">,</span><span class="mi">2011</span><span class="p">):</span>
    <span class="n">session_url</span> <span class="o">=</span> <span class="s2">&quot;https://kslegislature.org/historical_data/sessionlaws/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">session_url</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2004</span><span class="p">:</span>
        <span class="n">acts</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">acts</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span> <span class="s2">&quot;pdf&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">acts</span><span class="p">:</span>
        <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
        <span class="n">act_url</span> <span class="o">=</span> <span class="n">act</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;sessionlaws&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">+</span> <span class="n">name</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)))</span>
        <span class="c1"># Send a GET request to the URL</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
        <span class="c1"># Ensure the request was successful</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="c1"># Write the content of the response to a file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
            <span class="n">bad_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>

<span class="n">bill_urls_2011_2022</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">session_url</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;http://www.kslegislature.org/li_2022/b2021_22/measures/bills/&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;http://www.kslegislature.org/li_2021s/b2021s/measures/bills/&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;http://www.kslegislature.org/li_2020s/b2020s/measures/bills/&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;http://www.kslegislature.org/li_2020/b2019_20/measures/bills/&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;http://www.kslegislature.org/li_2018/b2017_18/measures/bills/&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;http://www.kslegislature.org/li_2016s/b2015_16/measures/bills/&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;http://www.kslegislature.org/li_2016/b2015_16/measures/bills/&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;http://www.kslegislature.org/li_2014/b2013_14/measures/bills/&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;http://www.kslegislature.org/li_2013s/b2013_14/measures/bills/&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;http://www.kslegislature.org/li_2012/b2011_12/measures/bills/&quot;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">session_url</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">session_url</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">page_no</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s2">&quot;#tab-disp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;of &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="s2">&quot;for more than 1 pages of bills&quot;</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">page_no</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
            <span class="n">page_url</span> <span class="o">=</span> <span class="n">session_url</span> <span class="o">+</span> <span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
            <span class="c1">#print(page_url)</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">page_url</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
            <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;#bill-tab-1&quot;</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;#bill-tab-</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2"> li a&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">bill</span> <span class="ow">in</span> <span class="n">bills</span><span class="p">:</span>
                <span class="n">bill_url</span> <span class="o">=</span> <span class="n">bill</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>
                <span class="n">bill_urls_2011_2022</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bill_url</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;#bill-tab-1 &gt; li a&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bill</span> <span class="ow">in</span> <span class="n">bills</span><span class="p">:</span>
            <span class="n">bill_url</span> <span class="o">=</span> <span class="n">bill</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>
            <span class="n">bill_urls_2011_2022</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bill_url</span><span class="p">)</span>


<span class="n">not_found_urls</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">bill_urls_2011_2022</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;#version-tab-1 &gt; tr&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

        <span class="k">if</span> <span class="s2">&quot;Enrolled&quot;</span> <span class="ow">in</span> <span class="n">version</span><span class="p">:</span>
            <span class="n">act_url</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                                          <span class="s2">&quot;#version-tab-1 &gt; tr:nth-child(1) &gt; td:nth-child(2) &gt; a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>

            <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>

            <span class="c1"># get the act year</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">year</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                                           <span class="s2">&quot;#history-tab-1 &gt; tr:nth-child(1) &gt; td:nth-child(1)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">year</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                                           <span class="s2">&quot;#version-tab-1 &gt; tr:nth-child(1) &gt; td:nth-child(1)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
            <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

            <span class="n">name</span> <span class="o">=</span> <span class="n">year</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;documents&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">+</span> <span class="n">name</span>
            <span class="c1">#print(os.path.abspath(path))</span>
            <span class="c1"># Send a GET request to the URL</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
            <span class="c1"># Ensure the request was successful</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="c1"># Write the content of the response to a file</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
                <span class="n">bad_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">not_found_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="c1"># missing url</span>
<span class="c1"># http://www.kslegislature.org/li_2014/b2013_14/measures/hb2070/</span>

<span class="c1"># Get index of the element</span>
<span class="c1">#index = bill_urls_2011_2022.index(&quot;http://www.kslegislature.org/li_2014/b2013_14/measures/hb2070/&quot;)</span>

<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">badfiles</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">folder_path</span> <span class="o">=</span> <span class="s2">&quot;./PDFs&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">folder_path</span><span class="p">))</span>

<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">))</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;./PDFs/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
        <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
        <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">act_txts</span><span class="p">,</span>
    <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">years</span><span class="p">,</span>
    <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s2">&quot;KS&quot;</span><span class="p">,</span>
    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">file_names</span><span class="p">,</span>
    <span class="s1">&#39;link&#39;</span><span class="p">:</span><span class="n">act_urls</span>
<span class="p">})</span>



<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;KS_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;KS_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;KS_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;KS_Leginfo.json&#39;</span><span class="p">)</span>



<span class="c1"># End of KS_Leginfo.py</span>


<span class="c1"># Start of NV_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">import</span> <span class="nn">selenium</span>
<span class="nb">print</span><span class="p">(</span><span class="n">selenium</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="c1">## others</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># set up working directory</span>
<span class="n">working_directory</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/NV&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">))</span>


<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;./PDFs/&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>

<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span> <span class="o">=</span> <span class="s1">&#39;../../geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span> <span class="o">=</span> <span class="n">service</span><span class="p">)</span>

<span class="c1"># empty list to store info</span>

<span class="n">act_pdf_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_html_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bill_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">chapter_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">broken_act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>


<span class="c1"># New Jersey Legislature Website: https://www.njleg.state.nj.us/chapter-laws</span>

<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://www.leg.state.nv.us/law1.html&#39;</span><span class="p">)</span>

<span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
    <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div.col-md-2 &gt; div&#39;</span><span class="p">))</span>
<span class="p">)</span>

<span class="n">divs</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;div.col-md-2 &gt; div&#39;</span><span class="p">)</span>
<span class="n">session_elements</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">session_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">div</span> <span class="ow">in</span> <span class="n">divs</span><span class="p">:</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Session \((\d</span><span class="si">{4}</span><span class="s2">)\)&quot;</span><span class="p">,</span> <span class="n">div</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">year</span> <span class="o">&gt;</span> <span class="mi">1974</span> <span class="ow">and</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2022</span><span class="p">:</span>
            <span class="n">session_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="n">session_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">div</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Bills&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">session_content_list_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">session_elements</span><span class="p">:</span>
    <span class="n">session_content_list_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span> <span class="s1">&#39;Bills by Chapter Number&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">))</span>


<span class="n">datasource_session</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;session_name&#39;</span><span class="p">:</span><span class="n">session_names</span><span class="p">,</span>
    <span class="s1">&#39;session_content_list_url&#39;</span><span class="p">:</span> <span class="n">session_content_list_urls</span>
<span class="p">})</span>


<span class="n">session_content_lists</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_html_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">session_nums</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">datasource_session</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">session_num</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;session_name&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">session_num</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;session_content_list_url&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">session_content_list</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;body&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

    <span class="n">rows</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;.MsoNormalTable &gt; tbody:nth-child(1) &gt; tr&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
        <span class="c1">#print(row.text)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">page</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;:nth-child(3)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">act_html_url</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="n">act_html_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_html_url</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">act_html_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
        <span class="n">session_content_lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session_content_list</span><span class="p">)</span>
        <span class="n">session_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session_num</span><span class="p">)</span>

<span class="n">datasource_session_content</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;act_html_url&#39;</span><span class="p">:</span><span class="n">act_html_urls</span><span class="p">,</span>
    <span class="s1">&#39;session_num&#39;</span><span class="p">:</span><span class="n">session_nums</span><span class="p">,</span>
    <span class="s1">&#39;session_content_list&#39;</span><span class="p">:</span> <span class="n">session_content_lists</span>
<span class="p">})</span>

<span class="n">datasource_session_content</span> <span class="o">=</span> <span class="n">datasource_session_content</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">datasource_session_content</span><span class="p">[</span><span class="s1">&#39;act_html_url&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">)]</span>

<span class="n">session_txts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_html_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">datasource_session_content</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;act_html_url&#39;</span><span class="p">]</span>
    <span class="n">act_html_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">session_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;body&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="n">datasource_session_content</span><span class="p">[</span><span class="s1">&#39;session_txt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">session_txts</span>

<span class="n">datasource_session_content</span> <span class="o">=</span> <span class="n">datasource_session_content</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;session_txt&#39;</span><span class="p">])</span>
<span class="n">datasource_session_content</span> <span class="o">=</span> <span class="n">datasource_session_content</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">datasource_session_content</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;NV_Leginfo_sessionclean.csv&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">act_html_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">session_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">session_content_lists</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">datasource_session_content</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">acts</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;session_txt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;________&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">acts</span><span class="p">:</span>
        <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act</span><span class="p">)</span>
        <span class="n">session_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;session_num&#39;</span><span class="p">])</span>
        <span class="n">act_html_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;act_html_url&#39;</span><span class="p">])</span>
        <span class="n">session_content_lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;session_content_list&#39;</span><span class="p">])</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;act_url&#39;</span><span class="p">:</span><span class="n">act_html_urls</span><span class="p">,</span>
    <span class="s1">&#39;session_num&#39;</span><span class="p">:</span><span class="n">session_nums</span><span class="p">,</span>
    <span class="s1">&#39;session_content_list&#39;</span><span class="p">:</span> <span class="n">session_content_lists</span><span class="p">,</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span><span class="n">act_txts</span>
<span class="p">})</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">])</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;session_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;session_num&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Statutes of Nevada&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;session_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;session_num&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;session_num&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Session&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="o">~</span><span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;SESSION OF THE LEGISLATURE&quot;</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">keep_after_bill</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">phrase</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Assembly Bill No.&quot;</span><span class="p">,</span> <span class="s2">&quot;Senate Bill No.&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">phrase</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">phrase</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">phrase</span> <span class="o">+</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Return the part after the phrase, including the phrase itself</span>
    <span class="k">return</span> <span class="n">text</span>  <span class="c1"># Return the original text if none of the phrases are found</span>

<span class="c1"># Apply the function to each row in the &#39;original_text&#39; column</span>
<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">keep_after_bill</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Assembly Bill No.|Senate Bill No.&quot;</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">extract_bill_number</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c1"># Pattern to find &quot;Assembly Bill No. &lt;number&gt;&quot; or &quot;Senate Bill No. &lt;number&gt;&quot;</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(Assembly Bill No\.|Senate Bill No\.) (\d+)&#39;</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="n">bill_prefix</span> <span class="o">=</span> <span class="s1">&#39;AB&#39;</span> <span class="k">if</span> <span class="s1">&#39;Assembly&#39;</span> <span class="ow">in</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;SB&#39;</span>
        <span class="n">bill_number</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bill_prefix</span> <span class="o">+</span> <span class="n">bill_number</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># or some default value if needed</span>

<span class="c1"># Apply the function to the &#39;original_text&#39; column and create a new &#39;bill_num&#39; column</span>
<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;bill_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">extract_bill_number</span><span class="p">)</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;session_content_list&#39;</span><span class="p">])</span>


<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;NV_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;NV_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;NV_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;NV_Leginfo.json&#39;</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;NV_Leginfo.csv&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># End of NV_Leginfo.py</span>


<span class="c1"># Start of NH_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="c1">## others</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>


<span class="c1"># set up working directory</span>
<span class="n">working_directory</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/NH&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">))</span>

<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;./PDFs/&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>

<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span><span class="o">=</span><span class="s1">&#39;../../geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span> <span class="o">=</span> <span class="n">service</span><span class="p">)</span>

<span class="c1"># session years: 1989-2021</span>

<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">original_act_num</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bad_act_urls</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1989</span><span class="p">,</span><span class="mi">2022</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://www.gencourt.state.nh.us/bill_status/legacy/bs2016/&#39;</span><span class="p">)</span>
    <span class="c1"># Find the input element by its css &quot;#txtsessionyear&quot;</span>
    <span class="n">sessionyear</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;input#txtsessionyear&quot;</span><span class="p">)</span>
    <span class="c1"># Clear the existing value in the input field</span>
    <span class="n">sessionyear</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="c1"># Input the current year into the input field</span>
    <span class="n">sessionyear</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">))</span>

    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;#Table1 &gt; tbody:nth-child(1) &gt; tr:nth-child(13) &gt; td:nth-child(1) &gt; input:nth-child(1)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="c1"># click submit</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;#cmdsubmit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="c1"># Wait for a brief moment (you may adjust the sleep time as needed)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;#btnsh&#39;</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="mf">0.01</span><span class="p">)</span>

    <span class="n">chapters</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span>
                                    <span class="s2">&quot;//*[contains(text(), &#39;SIGNED BY GOVERNOR&#39;) or contains(text(), &#39;LAW WITHOUT SIGNATURE&#39;) or contains(text(), &#39;VETO OVERRIDDEN&#39;)]/../../../../../..&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chapters</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">chap</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chapters</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="n">original_act_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chap</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s2">&quot;./*[1]/*[1]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">act_url</span> <span class="o">=</span> <span class="n">chap</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s2">&quot;./*[1]//*[contains(text(), &#39;Bill Text&#39;)]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>

        <span class="k">except</span><span class="p">:</span>

            <span class="n">act_url</span> <span class="o">=</span> <span class="n">chap</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s2">&quot;./*[1]//*[contains(text(), &#39;HTML&#39;)]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>


        <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_act_num&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">+</span> <span class="n">name</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.02</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
        <span class="c1"># Ensure the request was successful</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="c1"># Write the content of the response to a file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
            <span class="n">bad_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>




<span class="c1"># Calculating the frequency of each element in the list</span>
<span class="n">frequency</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">years</span><span class="p">)</span>

<span class="c1"># Printing the frequency of each element</span>
<span class="k">for</span> <span class="n">element</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">frequency</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Element </span><span class="si">{</span><span class="n">element</span><span class="si">}</span><span class="s2"> appears </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> times&quot;</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="c1">#&#39;original_text&#39;: act_txts,</span>
    <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">years</span><span class="p">,</span>
    <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s2">&quot;NH&quot;</span><span class="p">,</span>
    <span class="s1">&#39;link&#39;</span><span class="p">:</span><span class="n">act_urls</span><span class="p">,</span>
    <span class="s1">&#39;original_act_num&#39;</span><span class="p">:</span><span class="n">original_act_num</span>
<span class="p">})</span>


<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="c1">#&#39;original_text&#39;: act_txts,</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">names</span><span class="p">,</span>
<span class="p">})</span>

<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;./extra_urls.xlsx&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">act_url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_act_num&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-FN&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">+</span> <span class="n">name</span>
    <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.01</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
    <span class="c1"># Ensure the request was successful</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="c1"># Write the content of the response to a file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
        <span class="n">bad_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>

    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">))</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">read_html_files</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>
    <span class="n">html_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.html&#39;</span><span class="p">)]</span>
    <span class="n">extracted_info</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">html_files</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;ISO-8859-1&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
            <span class="c1"># Example: Extracting all paragraphs</span>
            <span class="n">paragraphs</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
            <span class="n">extracted_info</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paragraphs</span><span class="p">]</span>
            <span class="p">})</span>

    <span class="k">return</span> <span class="n">extracted_info</span>

<span class="c1"># Use the function</span>
<span class="n">original_text</span> <span class="o">=</span> <span class="n">read_html_files</span><span class="p">(</span><span class="n">download_dir</span><span class="p">)</span>

<span class="c1"># Iterate over all files in the directory</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">download_dir</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.html&quot;</span><span class="p">):</span>
        <span class="c1"># Form the path to the HTML file</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

        <span class="c1"># Open and read the HTML file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">html_content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="c1"># Parse HTML content using BeautifulSoup</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html_content</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>

        <span class="c1"># Extract content as needed</span>
        <span class="c1"># Example: Extract all text content</span>
        <span class="n">text_content</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>

        <span class="c1"># Example: Extract specific elements like &lt;p&gt;</span>
        <span class="n">paragraphs</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">paragraphs</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">paragraph</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


<span class="n">file_name</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="s1">&#39;*.html&#39;</span><span class="p">))</span>


<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="c1">#&#39;original_text&#39;: act_txts,</span>
    <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">years</span><span class="p">,</span>
    <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s2">&quot;NH&quot;</span><span class="p">,</span>
    <span class="s1">&#39;link&#39;</span><span class="p">:</span><span class="n">act_urls</span><span class="p">,</span>
    <span class="s1">&#39;original_act_num&#39;</span><span class="p">:</span><span class="n">original_act_num</span><span class="p">,</span>
    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span><span class="n">names</span>
<span class="p">})</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">names</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;link&#39;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;NH_Leginfo_url.csv&#39;</span><span class="p">)</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;NH_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;NH_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;NH_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;NH_Leginfo.json&#39;</span><span class="p">)</span>




<span class="c1"># End of NH_Leginfo.py</span>


<span class="c1"># Start of SC_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">word_tokenize</span>
<span class="kn">from</span> <span class="nn">word_forms.word_forms</span> <span class="kn">import</span> <span class="n">get_word_forms</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">from</span> <span class="nn">dateutil</span> <span class="kn">import</span> <span class="n">parser</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="c1">## others</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">inflect</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">fitz</span>

<span class="c1"># Set the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Volumes/SSD/AFRI/Data/&#39;</span><span class="p">)</span>

<span class="c1"># Verify the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>


<span class="c1"># Specify the path to the Firefox binary</span>
<span class="n">firefox_binary_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Firefox.app/Contents/MacOS/firefox&#39;</span>

<span class="c1"># Create a Firefox profile and configure preferences</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
<span class="n">options</span><span class="o">.</span><span class="n">binary_location</span> <span class="o">=</span> <span class="n">firefox_binary_path</span>

<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span> <span class="o">=</span> <span class="s1">&#39;./geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="c1"># Initialize the WebDriver with the specified path</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">service</span><span class="p">)</span>




<span class="c1"># driver_path = &#39;C:/Program Files (x86)/Google/Chrome/Application/chromedriver.exe&#39; #for windows</span>
<span class="c1"># driver_path = &#39;/Users/Yanxu/OneDrive/Projects/AgPolicyCoding/chromedriver&#39;</span>
<span class="c1"># driver = webdriver.Chrome(executable_path=DRIVER_PATH)</span>

<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Users/long/OneDrive/Projects/AFRI&#39;</span><span class="p">)</span>
<span class="c1"># os.chdir(&#39;/Volumes/GoogleDrive/Shared drives/UCSC-UMN AFRI project/Data/GA&#39;)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># chromeOptions = webdriver.ChromeOptions()</span>
<span class="n">dnldpath</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;download.default_directory&quot;</span> <span class="p">:</span> <span class="s2">&quot;/Users/long/OneDrive/Projects/AFRI/data/SC/&quot;</span><span class="p">}</span>
<span class="n">chromeOptions</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s1">&#39;prefs&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;download.default_directory&quot;</span><span class="p">:</span> <span class="n">dnldpath</span><span class="p">,</span> <span class="c1">#Change default directory for downloads</span>
    <span class="s2">&quot;download.prompt_for_download&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="c1">#To auto download the file</span>
    <span class="s2">&quot;download.directory_upgrade&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;plugins.always_open_pdf_externally&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span><span class="c1">#It will not show PDF directly in chrome</span>
    <span class="s2">&quot;--enable-javascript&quot;</span><span class="p">:</span><span class="kc">True</span>
<span class="p">})</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="s1">&#39;./chromedriver&#39;</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="n">chromeOptions</span><span class="p">)</span>
<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://www.scstatehouse.gov/aacts.php&quot;</span><span class="p">)</span>

<span class="n">session_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">urls</span> <span class="o">=</span><span class="p">[]</span>
<span class="n">docurls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">yrs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">billnums</span><span class="o">=</span> <span class="p">[]</span>
<span class="n">billnumlist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">specialyears</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1995&#39;</span><span class="p">,</span><span class="s1">&#39;1996&#39;</span><span class="p">]</span>
<span class="n">sgurls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">summarys</span> <span class="o">=</span> <span class="p">[]</span>


<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://www.scstatehouse.gov/aacts.php&quot;</span><span class="p">)</span>

<span class="n">sessions</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s2">&quot;div#contentsection a&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">session</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sessions</span><span class="p">):</span>
    <span class="n">sessionname</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">text</span>
    <span class="k">if</span> <span class="s2">&quot;Excel&quot;</span> <span class="ow">in</span> <span class="n">sessionname</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">sessionname</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">session_url</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="n">session_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session_url</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">session_url</span>  <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">session_urls</span><span class="p">):</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">session_url</span> <span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;h2.barheader&quot;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">yr</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;h2.barheader&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;Acts&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;Session&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">yr</span> <span class="ow">in</span> <span class="n">specialyears</span><span class="p">:</span>
        <span class="n">sessiongroup</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s2">&quot;div#resultsbox dl dd a&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">sessiongroup</span><span class="p">:</span>
            <span class="n">sgurl</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sgurl</span><span class="p">)</span>
            <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;div#contentsection&quot;</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">lawlist</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s2">&quot;div#contentsection dl dt a&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">lawlist</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
                <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;div#resultsbox dl dd&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">lawlist</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&quot;resultsbox&quot;]/ dl / dt / a[1]&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">lawlist</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;div#resultsbox&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;div#resultsbox&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="c1"># summarys</span>
    <span class="n">summarys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">textloc</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;div.bill-list-item a.nodisplay&quot;</span><span class="p">)</span>
        <span class="c1"># docurls</span>
        <span class="n">docurl</span> <span class="o">=</span> <span class="n">textloc</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="n">docurls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">docurl</span><span class="p">)</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">docurl</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">docurls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span>
    <span class="c1"># acttxts</span>
    <span class="n">acttxt</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span>
    <span class="n">acttxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>

<span class="n">sessions1</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Bill&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">acttxts</span><span class="p">]</span>
<span class="n">sessions2</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Download&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sessions1</span><span class="p">]</span>
<span class="n">sessions</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sessions2</span><span class="p">]</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="c1">#&#39;Year&#39;: yrs,</span>
    <span class="c1"># &#39;State&#39;: sts,</span>
    <span class="s1">&#39;Session Year&#39;</span><span class="p">:</span> <span class="n">sessions</span><span class="p">,</span>
    <span class="c1">#&#39;Bill Number&#39;: billnums,</span>
    <span class="c1">#&#39;Title&#39;: titles,</span>
    <span class="c1">#&#39;Brief Summary&#39;: summarys,</span>
    <span class="c1"># &#39;Introduced Date&#39;: introdts,</span>
    <span class="c1">#&#39;Date it was signed&#39;:sigdts,</span>
    <span class="c1"># &#39;Date effective&#39;:effdts,</span>
    <span class="s1">&#39;Full Text&#39;</span><span class="p">:</span><span class="n">acttxts</span><span class="p">,</span>
    <span class="s1">&#39;Link to full text&#39;</span><span class="p">:</span> <span class="n">docurls</span><span class="p">,</span>
    <span class="s1">&#39;Link to bill&#39;</span><span class="p">:</span> <span class="n">urls</span>
<span class="p">})</span>




<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://www.scstatehouse.gov/listofacts.php?O=&amp;Y=2021&#39;</span><span class="p">)</span>

<span class="n">url_elements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s1">&#39;Word&#39;</span><span class="p">)</span>
<span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">url_elements</span><span class="p">:</span>
    <span class="n">element</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
    <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">textract</span>
<span class="kn">import</span> <span class="nn">docx2txt</span>

<span class="c1"># Define the folder path</span>
<span class="n">folder_path</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/SC/2021&#39;</span>

<span class="c1"># Function to read text from a .docx file using textract</span>
<span class="c1"># Function to read text from a .docx file using docx2txt</span>
<span class="k">def</span> <span class="nf">read_docx</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">docx2txt</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>



<span class="c1"># List to store the content of all files</span>
<span class="n">SC2021</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Iterate over all files in the folder</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.docx&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;._&#39;</span><span class="p">):</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">file_content</span> <span class="o">=</span> <span class="n">read_docx</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">SC2021</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span>

<span class="n">new_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Full Text&#39;</span><span class="p">:</span> <span class="n">SC2021</span><span class="p">,</span>
    <span class="s1">&#39;Link to full text&#39;</span><span class="p">:</span> <span class="n">urls</span><span class="p">,</span>
    <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2021</span>
<span class="p">})</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;SC_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;SC_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Web-scrapting finished&quot;</span><span class="p">)</span>
<span class="c1"># End of SC_Leginfo.py</span>


<span class="c1"># Start of MO_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1">#driver_path = &#39;C:/Users/longy/OneDrive/Projects/AFRI/windows/chromedriver.exe&#39; #for windows</span>
<span class="n">driver_path</span> <span class="o">=</span> <span class="s1">&#39;/Users/long/Library/CloudStorage/OneDrive-Personal/Projects/AFRI/chromedriver&#39;</span>
<span class="c1"># driver = webdriver.Chrome(executable_path=DRIVER_PATH)</span>

<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Users/long/OneDrive/Projects/AFRI&#39;</span><span class="p">)</span>
<span class="c1">#os.chdir(&#39;C:/Users/longy/OneDrive/Projects/AFRI&#39;)</span>
<span class="c1"># os.chdir(&#39;/Volumes/GoogleDrive/Shared drives/UCSC-UMN AFRI project/Data/GA&#39;)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="n">chromeOptions</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
<span class="n">dnldpath</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;download.default_directory&quot;</span> <span class="p">:</span> <span class="s2">&quot;/Users/long/OneDrive/Projects/AFRI/data/ND/&quot;</span><span class="p">}</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s1">&#39;prefs&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;download.default_directory&quot;</span><span class="p">:</span> <span class="n">dnldpath</span><span class="p">,</span> <span class="c1">#Change default directory for downloads</span>
    <span class="s2">&quot;download.prompt_for_download&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="c1">#To auto download the file</span>
    <span class="s2">&quot;download.directory_upgrade&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;plugins.always_open_pdf_externally&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="c1">#It will not show PDF directly in chrome</span>
    <span class="s2">&quot;--enable-javascript&quot;</span><span class="p">:</span><span class="kc">True</span>
<span class="p">})</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="n">driver_path</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">chromeOptions</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">unique</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="n">urls</span><span class="o">=</span><span class="p">[]</span>
<span class="n">sessionurls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">billurls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://house.mo.gov/LegislationSP.aspx?year=2022&amp;code=R&quot;</span><span class="p">)</span>
<span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
    <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;div.view-content ul li a&quot;</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#Bills\ Truly\ Agreed\ and\ Finally\ Passed\ by\ Effective\ Date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

<span class="c1">#reportgrid &gt; tbody &gt; tr &gt; td</span>
<span class="c1">#reportgrid &gt; tbody &gt; tr &gt; td</span>

<span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#reportgrid &gt; tbody &gt; tr:nth-child(2)&#39;</span><span class="p">)</span>

<span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&quot;reportgrid&quot;]/tbody/tr[2]&#39;</span><span class="p">)</span>
<span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by</span>



<span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_xpath</span><span class="p">(</span><span class="s1">&#39;/html/body/form/div[3]/div[1]/table/tbody/tr/th/table/tbody/tr&#39;</span><span class="p">)</span>

<span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;tbody &gt; tr:nth-child(2) &gt; td:nth-child(1) &gt; a&#39;</span><span class="p">)</span>

<span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;table#reportgrid&#39;</span><span class="p">)</span>

<span class="o">//*</span><span class="p">[</span><span class="nd">@id</span><span class="o">=</span><span class="s2">&quot;reportgrid&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">tbody</span><span class="o">/</span><span class="n">tr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;tr.reportbillinfo&#39;</span><span class="p">)</span>

<span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#reportgrid &gt; tbody &gt; tr:nth-child(12) &gt; td &gt; a&#39;</span><span class="p">)</span>

<span class="c1">#reportgrid &gt; tbody &gt; tr:nth-child(7) &gt; td:nth-child(1)</span>

<span class="n">bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#reportgrid &gt; tbody &gt; tr &gt; td:nth-child(1) &gt; a&#39;</span><span class="p">)</span>


<span class="n">digits</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="s2">&quot;4&quot;</span><span class="p">,</span><span class="s2">&quot;5&quot;</span><span class="p">,</span><span class="s2">&quot;6&quot;</span><span class="p">,</span><span class="s2">&quot;7&quot;</span><span class="p">,</span><span class="s2">&quot;8&quot;</span><span class="p">,</span><span class="s2">&quot;9&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">digit</span> <span class="ow">in</span> <span class="n">digits</span><span class="p">:</span>
    <span class="n">element</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_partial_link_text</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
    <span class="n">laws</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span>


<span class="n">c</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#GridView1&#39;</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;tbody tr td a&#39;</span><span class="p">)</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;tbody &gt; tr &gt; td &gt; a&#39;</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;tbody &gt; tr &gt; td:nth-child(1) &gt; a&#39;</span><span class="p">)</span>

<span class="c1">#reportgrid &gt; tbody &gt; tr:nth-child(2) &gt; td:nth-child(1) &gt; a</span>

<span class="c1">#reportgrid &gt; tbody &gt; tr:nth-child(2) &gt; td:nth-child(1) &gt; a</span>

<span class="n">laws</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

<span class="n">sessions</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div.view-content ul li a&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">session</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sessions</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">sessionurl</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
    <span class="n">sessionurls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sessionurl</span><span class="p">)</span>

<span class="k">for</span> <span class="n">sessionurl</span> <span class="ow">in</span> <span class="n">sessionurls</span><span class="p">[:</span><span class="mi">33</span><span class="p">]:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sessionurl</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_link_text</span><span class="p">(</span><span class="s2">&quot;Chapter Categories&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">chapters</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div.field-items ul li a&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">chapter</span> <span class="ow">in</span> <span class="n">chapters</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">chapter</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">sessionurl</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;urls are done&quot;</span><span class="p">)</span>

<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;C:/Users/longy/OneDrive/Projects/AFRI/data/ND/&quot;</span>
    <span class="n">list_of_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>
    <span class="n">latest_file</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">list_of_files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getctime</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">latest_file</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">latest_file</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>  <span class="c1"># open in readonly mode</span>
        <span class="c1"># creating a pdf File object of original pdf</span>
        <span class="n">pdfFileObj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">latest_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">pdfReader</span> <span class="o">=</span> <span class="n">PyPDF2</span><span class="o">.</span><span class="n">PdfFileReader</span><span class="p">(</span><span class="n">pdfFileObj</span><span class="p">)</span>
        <span class="n">pagenumber</span> <span class="o">=</span> <span class="n">pdfReader</span><span class="o">.</span><span class="n">numPages</span>
        <span class="n">acttxt</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pagenumber</span><span class="p">):</span>
            <span class="n">pageObj</span> <span class="o">=</span> <span class="n">pdfReader</span><span class="o">.</span><span class="n">getPage</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">pageObj</span><span class="o">.</span><span class="n">extractText</span><span class="p">()</span>
            <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
            <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="n">acttxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;C:/Users/longy/OneDrive/Projects/AFRI/data/ND/&quot;</span>
<span class="n">list_of_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>
<span class="c1">#latest_file = max(list_of_files, key=os.path.getctime)</span>
<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_files</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">file</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>  <span class="c1"># open in readonly mode</span>
        <span class="c1"># creating a pdf File object of original pdf</span>
        <span class="n">pdfFileObj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">pdfReader</span> <span class="o">=</span> <span class="n">PyPDF2</span><span class="o">.</span><span class="n">PdfFileReader</span><span class="p">(</span><span class="n">pdfFileObj</span><span class="p">)</span>
        <span class="n">pagenumber</span> <span class="o">=</span> <span class="n">pdfReader</span><span class="o">.</span><span class="n">numPages</span>
        <span class="n">acttxt</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pagenumber</span><span class="p">):</span>
            <span class="n">pageObj</span> <span class="o">=</span> <span class="n">pdfReader</span><span class="o">.</span><span class="n">getPage</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">pageObj</span><span class="o">.</span><span class="n">extractText</span><span class="p">()</span>
            <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
            <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="n">acttxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Link to full text&#39;</span><span class="p">:</span><span class="n">urls</span><span class="p">,</span>
    <span class="s1">&#39;Full text&#39;</span><span class="p">:</span> <span class="n">acttxts</span>
<span class="p">})</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Full text&#39;</span><span class="p">:</span> <span class="n">acttxts</span>
<span class="p">})</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;ND_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;ND_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;ND_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;ND_Leginfo.json&#39;</span><span class="p">)</span>


<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;ND_Leginfo.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">k</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

<span class="c1"># End of MO_Leginfo.py</span>


<span class="c1"># Start of CA_leginfo_v2.py</span>

<span class="c1"># import libraries</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>


<span class="c1"># driver_path = &#39;C:/Program Files (x86)/Google/Chrome/Application/chromedriver.exe&#39; #for windows</span>
<span class="c1"># driver_path = &#39;/Users/Yanxu/OneDrive/Projects/AgPolicyCoding/chromedriver&#39;</span>
<span class="c1"># driver = webdriver.Chrome(executable_path=DRIVER_PATH)</span>

<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Users/long/OneDrive/Projects/AFRI&#39;</span><span class="p">)</span>
<span class="c1"># os.chdir(&#39;/Volumes/GoogleDrive/Shared drives/UCSC-UMN AFRI project/Data/GA&#39;)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="n">chromeOptions</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
<span class="n">dnldpath</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;download.default_directory&quot;</span> <span class="p">:</span> <span class="s2">&quot;/Users/long/OneDrive/Projects/AFRI/data/CA/&quot;</span><span class="p">}</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s2">&quot;prefs&quot;</span><span class="p">,</span><span class="n">dnldpath</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="s1">&#39;./chromedriver&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">chromeOptions</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>


<span class="c1"># input keyword(s)</span>
<span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>

<span class="c1"># choose sessionyears</span>
<span class="c1">#input_sessionyears = [&#39;2021 - 2022&#39;]</span>
<span class="c1">#input_sessionyears = [&#39;2015 - 2016&#39;, &#39;2013 - 2014&#39;, &#39;2011 - 2012&#39;, &#39;2009 - 2010&#39;, &#39;2007 - 2008&#39;]</span>
<span class="c1">#input_sessionyears = [&#39;2015 - 2016&#39;, &#39;2013 - 2014&#39;, &#39;2011 - 2012&#39;, &#39;2009 - 2010&#39;, &#39;2007 - 2008&#39;]</span>
<span class="n">input_sessionyears</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2021 - 2022&#39;</span><span class="p">,</span> <span class="s1">&#39;2019 - 2020&#39;</span><span class="p">,</span> <span class="s1">&#39;2017 - 2018&#39;</span><span class="p">,</span> <span class="s1">&#39;2015 - 2016&#39;</span><span class="p">,</span> <span class="s1">&#39;2013 - 2014&#39;</span><span class="p">,</span> <span class="s1">&#39;2011 - 2012&#39;</span><span class="p">,</span> <span class="s1">&#39;2009 - 2010&#39;</span><span class="p">,</span> <span class="s1">&#39;2007 - 2008&#39;</span><span class="p">,</span> <span class="s1">&#39;2005 - 2006&#39;</span><span class="p">,</span> <span class="s1">&#39;2003 - 2004&#39;</span><span class="p">,</span> <span class="s1">&#39;2001 - 2002&#39;</span><span class="p">,</span> <span class="s1">&#39;1999 - 2000&#39;</span><span class="p">]</span>


<span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># search bills by iterating sessionyears first and then keywords</span>
<span class="k">for</span> <span class="n">input_sessionyear</span> <span class="ow">in</span> <span class="n">input_sessionyears</span><span class="p">:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://leginfo.legislature.ca.gov/faces/advance/advance.xhtml&quot;</span><span class="p">)</span>

    <span class="c1"># select session year</span>
    <span class="n">select_sessionyear</span> <span class="o">=</span> <span class="n">Select</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;select#session_year&#39;</span><span class="p">))</span>
    <span class="n">select_sessionyear</span><span class="o">.</span><span class="n">select_by_visible_text</span><span class="p">(</span><span class="n">input_sessionyear</span><span class="p">)</span>

    <span class="c1"># search by keywords</span>
    <span class="c1">#input_keywords = driver.find_element_by_css_selector(&quot;input#keyword.keyword_text&quot;)</span>
    <span class="c1">#input_keywords.send_keys(keyword)</span>

    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;input#executeSearchBtn&quot;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">search_button</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;input#executeSearchBtn&#39;</span><span class="p">)</span>
    <span class="n">search_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="c1"># get urls in the first page</span>
    <span class="n">searchresult</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;tbody a&#39;</span><span class="p">)</span>
    <span class="n">basicinfo</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div.commdataRow&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">searchresult</span><span class="p">)):</span>
        <span class="c1">#for i in range(10):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">searchresult</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="n">searchresultmiddle</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;tbody a&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">searchresultmiddle</span><span class="p">)):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">searchresultmiddle</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
<span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># get urls in the middle pages</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c1">#driver.find_element_by_link_text(&quot;Next 1000 BIlls&quot;)</span>
    <span class="c1"># centercolumn &gt; div:nth-child(10) &gt; input[type=submit]</span>
    <span class="n">next_page</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div:nth-child(10) &gt; input[type=submit]&#39;</span><span class="p">)</span>
    <span class="n">next_page</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="n">searchresultmiddle</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;tbody a&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">searchresultmiddle</span><span class="p">)):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">searchresultmiddle</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
    <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>


    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;div#searchresult tbody a&quot;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">searchresult</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div#searchresult tbody a&#39;</span><span class="p">)</span>
    <span class="n">basicinfo</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div.commdataRow&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">searchresult</span><span class="p">)):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">searchresult</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;div#text_bill_returned&quot;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">text_bill_returned</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div#text_bill_returned&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">page_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">text_bill_returned</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;Page &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39; of&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="c1">#print(&quot;done with urls&quot;)</span>


<span class="c1"># set up list titles</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sessionyears</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">billnumbers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">briefsummarys</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">introduceddates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">signingdates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">effectivedates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">expireddates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">leadauthors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">textlinks</span> <span class="o">=</span> <span class="p">[]</span>


<span class="c1"># extract bill information on each bill</span>

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;select#version.bill_version_select&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;Chaptered&quot;</span> <span class="ow">in</span> <span class="n">version</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
        <span class="n">introduceddate</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;- Introduced&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">introduceddate</span> <span class="o">=</span> <span class="n">introduceddate</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">introduceddates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">introduceddate</span><span class="p">)</span>

        <span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;CA&quot;</span>
        <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

        <span class="n">billnumber</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div#bill_title&#39;</span><span class="p">)</span>
        <span class="n">billnumbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">billnumber</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">title</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div#bill_title h2&#39;</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">title</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">briefsummaryresolution</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;span.Resolution&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">briefsummaryresolution</span> <span class="o">=</span> <span class="s2">&quot;N/A&quot;</span>

        <span class="n">briefsummarydigest</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;span#digesttext&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">briefsummarydigest</span><span class="p">:</span>
            <span class="n">briefsummary</span> <span class="o">=</span> <span class="n">briefsummaryresolution</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">briefsummary</span> <span class="o">=</span> <span class="n">briefsummarydigest</span>

        <span class="n">briefsummarys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">briefsummary</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">version</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Chaptered&quot;</span><span class="p">):</span>
            <span class="n">signingdate</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">signingdate</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;- Chaptered&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">signingdates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">signingdate</span><span class="p">)</span>

        <span class="n">signingdate_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">signingdate</span><span class="p">)</span>
        <span class="n">signingdate_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">signingdate_str</span><span class="p">)</span>
        <span class="n">shortyear</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">signingdate</span><span class="p">)[</span><span class="n">signingdate_length</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="n">signingdate_length</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">shortyear</span> <span class="o">&gt;</span> <span class="mi">22</span><span class="p">:</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">shortyear</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shortyear</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">year</span> <span class="o">=</span> <span class="s2">&quot;200&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">shortyear</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">year</span> <span class="o">=</span> <span class="s2">&quot;20&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">shortyear</span><span class="p">)</span>
        <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sessionyear</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sessionyear</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">sessionyears</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sessionyear</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;take effect immediately&quot;</span> <span class="ow">in</span> <span class="n">briefsummary</span><span class="p">:</span>
            <span class="n">effectivedate</span> <span class="o">=</span> <span class="n">signingdate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;take effect on or before&quot;</span> <span class="ow">in</span> <span class="n">briefsummary</span><span class="p">:</span>
                <span class="n">effectivedate</span> <span class="o">=</span> <span class="n">briefsummary</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;take effect on or before&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;take effect on&quot;</span> <span class="ow">in</span> <span class="n">briefsummary</span><span class="p">:</span>
                <span class="n">effectivedate</span> <span class="o">=</span> <span class="n">briefsummary</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;take effect on&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">effectivedate</span> <span class="o">=</span> <span class="s2">&quot;Need to check&quot;</span>

        <span class="n">effectivedates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">effectivedate</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">datefinder</span><span class="o">.</span><span class="n">find_dates</span><span class="p">(</span><span class="n">briefsummary</span><span class="p">):</span>
            <span class="n">dates</span> <span class="o">=</span> <span class="n">datefinder</span><span class="o">.</span><span class="n">find_dates</span><span class="p">(</span><span class="n">briefsummary</span><span class="p">)</span>
            <span class="n">datelist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">:</span>
                    <span class="n">datelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>
                <span class="n">exdtkeys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;expired&#39;</span><span class="p">,</span> <span class="s1">&#39;repeal&#39;</span><span class="p">,</span> <span class="s1">&#39;extend&#39;</span><span class="p">,</span> <span class="s1">&#39;repealed&#39;</span><span class="p">,</span> <span class="s1">&#39;repeals&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">briefsummary</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">exdtkeys</span><span class="p">):</span>
                    <span class="n">expireddate</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">datelist</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">expireddate</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">expireddate</span> <span class="o">=</span> <span class="s1">&#39;Need to check&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">expireddate</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>

        <span class="n">expireddates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expireddate</span><span class="p">)</span>

        <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;#nav_bar_top_status &gt; span&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">leadauthor</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#leadAuthors&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="c1">#try:</span>
        <span class="c1">#    leadauthor = driver.find_element_by_css_selector(&#39;#leadAuthors&#39;).text.replace(&quot; (A)&quot;,&quot;&quot;)</span>
        <span class="c1">#except:</span>
        <span class="c1">#    leadauthor = driver.find_element_by_css_selector(&#39;#leadAuthors&#39;).text.replace(&quot; (S)&quot;,&quot;&quot;)</span>
        <span class="n">leadauthors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">leadauthor</span><span class="p">)</span>

        <span class="n">textlinks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Year&#39;</span><span class="p">:</span> <span class="n">years</span><span class="p">,</span>
    <span class="s1">&#39;State&#39;</span><span class="p">:</span> <span class="n">states</span><span class="p">,</span>
    <span class="s1">&#39;Session Year&#39;</span><span class="p">:</span> <span class="n">sessionyears</span><span class="p">,</span>
    <span class="s1">&#39;Bill Number&#39;</span><span class="p">:</span> <span class="n">billnumbers</span><span class="p">,</span>
    <span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="n">titles</span><span class="p">,</span>
    <span class="s1">&#39;Brief Summary&#39;</span><span class="p">:</span> <span class="n">briefsummarys</span><span class="p">,</span>
    <span class="s1">&#39;Introduced Date&#39;</span><span class="p">:</span> <span class="n">introduceddates</span><span class="p">,</span>
    <span class="s1">&#39;Date it was signed&#39;</span><span class="p">:</span><span class="n">signingdates</span><span class="p">,</span>
    <span class="s1">&#39;Date effective&#39;</span><span class="p">:</span><span class="n">effectivedates</span><span class="p">,</span>
    <span class="s1">&#39;Expiration date&#39;</span><span class="p">:</span><span class="n">expireddates</span><span class="p">,</span>
    <span class="s1">&#39;Introducer&#39;</span><span class="p">:</span><span class="n">leadauthors</span><span class="p">,</span>
    <span class="s1">&#39;Link to full text&#39;</span><span class="p">:</span><span class="n">textlinks</span>
<span class="p">})</span>

<span class="c1"># drop duplicates by &quot;Official ID&quot;</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Bill Number&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">],</span>
                           <span class="n">keep</span> <span class="o">=</span> <span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># save bill info into excel file</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;CA_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;download finished&quot;</span><span class="p">)</span>
<span class="c1"># End of CA_leginfo_v2.py</span>


<span class="c1"># Start of CO_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">import</span> <span class="nn">selenium</span>
<span class="nb">print</span><span class="p">(</span><span class="n">selenium</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="c1">## others</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># set up working directory</span>
<span class="n">working_directory</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/CO&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">))</span>


<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;./PDFs/&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>

<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span> <span class="o">=</span> <span class="s1">&#39;../../geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span> <span class="o">=</span> <span class="n">service</span><span class="p">)</span>

<span class="c1"># empty list to store info</span>
<span class="n">act_pdf_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bill_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">chapter_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">broken_act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">effective_dates</span> <span class="o">=</span> <span class="p">[]</span>


<span class="c1"># Colorado Legislature Website: https://leg.colorado.gov/session-laws?field_sessions_target_id=75371&amp;sort_bef_combine=field_page_value%20ASC</span>

<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://leg.colorado.gov/session-laws?field_sessions_target_id=92641&amp;sort_bef_combine=field_page_value%20ASC&#39;</span><span class="p">)</span>

<span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
    <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;#edit-field-sessions-target-id&#39;</span><span class="p">))</span>
<span class="p">)</span>

<span class="n">select_session</span> <span class="o">=</span> <span class="n">Select</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;#edit-field-sessions-target-id&#39;</span><span class="p">))</span>

<span class="n">all_sessions</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;#edit-field-sessions-target-id  &gt; option&#39;</span><span class="p">)</span>

<span class="n">session_pages</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">session_elements</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">all_sessions</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">2022</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">text</span> <span class="o">!=</span> <span class="s1">&#39;2017 Extraordinary Session&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">select_session</span><span class="o">.</span><span class="n">select_by_visible_text</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;.pager-last &gt; a:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="n">session_pages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;.pager-current&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
                <span class="n">session_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">session_pages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">session_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">session</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">session_elements</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">2022</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">text</span> <span class="o">!=</span> <span class="s1">&#39;2017 Extraordinary Session&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">select_session</span><span class="o">.</span><span class="n">select_by_visible_text</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

            <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;.views-table &gt; tbody:nth-child(2) &gt; tr &quot;</span><span class="p">))</span>
            <span class="p">)</span>

            <span class="n">rows</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;.views-table &gt; tbody:nth-child(2) &gt; tr&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>

                <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="mi">4</span><span class="p">]))</span>

                <span class="n">bill_num</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bill_num</span><span class="p">)</span>

                <span class="n">name</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(2)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

                <span class="n">effective_date</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(3)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="n">effective_dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">effective_date</span><span class="p">)</span>

                <span class="n">chapter_num</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(5)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="n">chapter_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chapter_num</span><span class="p">)</span>

                <span class="n">act_pdf_url</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(6) &gt; a:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
                <span class="n">act_pdf_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_pdf_url</span><span class="p">)</span>



            <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">text</span> <span class="o">!=</span> <span class="s1">&#39;2020 Extraordinary Session&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">session_pages</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>

                    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;.pager-next &gt; a:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                    <span class="n">rows</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;.views-table &gt; tbody:nth-child(2) &gt; tr&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>

                        <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="mi">4</span><span class="p">]))</span>

                        <span class="n">bill_num</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bill_num</span><span class="p">)</span>

                        <span class="n">name</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(2)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

                        <span class="n">effective_date</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(3)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="n">effective_dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">effective_date</span><span class="p">)</span>

                        <span class="n">chapter_num</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(5)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="n">chapter_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chapter_num</span><span class="p">)</span>

                        <span class="n">act_pdf_url</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(6) &gt; a:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
                        <span class="n">act_pdf_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_pdf_url</span><span class="p">)</span>





<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1993</span><span class="p">,</span> <span class="mi">2016</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
    <span class="n">session_url</span> <span class="o">=</span> <span class="s1">&#39;https://leg.colorado.gov/agencies/office-legislative-legal-services/session-laws-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">session_url</span><span class="p">)</span>

    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;div &gt; table &gt; tbody &gt; tr&quot;</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="n">rows</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div &gt; table &gt; tbody &gt; tr&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>

        <span class="n">bill_num</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;td:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">bill_num</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;Extraordinary&quot;</span> <span class="ow">in</span> <span class="n">bill_num</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bill_num</span><span class="p">)</span>

        <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;td:nth-child(2)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="n">effective_date</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;td:nth-child(3)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">effective_dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">effective_date</span><span class="p">)</span>

        <span class="n">chapter_num</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;td:nth-child(5)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">chapter_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chapter_num</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">act_pdf_url</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;td:nth-child(6) &gt; a:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="n">act_pdf_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_pdf_url</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">act_pdf_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>


<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;bill_num&#39;</span><span class="p">:</span> <span class="n">bill_nums</span><span class="p">,</span>
    <span class="s1">&#39;chapter_num&#39;</span><span class="p">:</span> <span class="n">chapter_nums</span><span class="p">,</span>
    <span class="s1">&#39;link&#39;</span><span class="p">:</span> <span class="n">act_pdf_urls</span><span class="p">,</span>
    <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s2">&quot;CO&quot;</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">names</span><span class="p">,</span>
    <span class="s1">&#39;effective_date&#39;</span><span class="p">:</span><span class="n">effective_dates</span><span class="p">,</span>
<span class="p">})</span>

<span class="c1">#for these &#39;HB11-1130&#39;&#39;SB11-024&#39;&#39;HB11-1169&#39;&#39;SB11-020&#39; bills, I added links by hand.</span>
<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">][</span><span class="mi">7136</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://leg.colorado.gov/sites/default/files/images/olls/2011a_sl_106.pdf&#39;</span>
<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">][</span><span class="mi">7109</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://leg.colorado.gov/sites/default/files/images/olls/2011a_sl_79.pdf&#39;</span>
<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">][</span><span class="mi">7149</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://leg.colorado.gov/sites/default/files/images/olls/2011a_sl_119.pdf&#39;</span>
<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">][</span><span class="mi">7069</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://leg.colorado.gov/sites/default/files/images/olls/2011a_sl_39.pdf&#39;</span>

<span class="c1">#delete one bill since there is no pdf file.https://leg.colorado.gov/agencies/office-legislative-legal-services/session-laws-1994</span>
<span class="c1"># SB94-157 	Implementation Of Federal Mandates 	6/1/1994 	1829 	305</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">convert_to_four_digit_year</span><span class="p">(</span><span class="n">two_digit_year</span><span class="p">):</span>
    <span class="n">cutoff</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># Define a cutoff for deciding the century</span>
    <span class="k">if</span> <span class="n">two_digit_year</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2000</span> <span class="o">+</span> <span class="n">two_digit_year</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1900</span> <span class="o">+</span> <span class="n">two_digit_year</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;bill_num&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">convert_to_four_digit_year</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])))</span>


<span class="c1"># download corresponding pdf file</span>
<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">datasource</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">2015</span><span class="p">:</span>
        <span class="n">act_url</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">act_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;sl/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_name</span> <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">+</span> <span class="n">file_name</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.005</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
        <span class="c1"># Ensure the request was successful</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="c1"># Write the content of the response to a file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
            <span class="n">broken_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">act_url</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">act_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;olls/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_name</span> <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">+</span> <span class="n">file_name</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.005</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
        <span class="c1"># Ensure the request was successful</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="c1"># Write the content of the response to a file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
            <span class="n">broken_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_names</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

<span class="c1">#read pdfs</span>
<span class="n">folder_path</span> <span class="o">=</span> <span class="s2">&quot;./PDFs&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">folder_path</span><span class="p">))</span>

<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>

<span class="n">broken_files</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
            <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
            <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
            <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
        <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
        <span class="n">broken_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;./PDFs/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">datasource_pdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">act_txts</span><span class="p">,</span>
    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">file_names</span>
<span class="p">})</span>


<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">datasource</span><span class="p">,</span><span class="n">datasource_pdf</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;file_name&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;CO_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;CO_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;CO_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;CO_Leginfo.json&#39;</span><span class="p">)</span>

<span class="c1"># End of CO_Leginfo.py</span>


<span class="c1"># Start of TN_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="c1">#import PyPDF2</span>
<span class="c1">#import glob</span>

<span class="n">driver_path</span> <span class="o">=</span> <span class="s1">&#39;C:/Users/longy/OneDrive/Projects/AFRI/windows/chromedriver.exe&#39;</span> <span class="c1">#for windows</span>
<span class="c1"># driver_path = &#39;/Users/Yanxu/OneDrive/Projects/AgPolicyCoding/chromedriver&#39;</span>
<span class="c1"># driver = webdriver.Chrome(executable_path=DRIVER_PATH)</span>

<span class="c1"># Change the working directory</span>
<span class="c1">#os.chdir(&#39;/Users/long/OneDrive/Projects/AFRI&#39;)</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;C:/Users/longy/OneDrive/Projects/AFRI&#39;</span><span class="p">)</span>
<span class="c1"># os.chdir(&#39;/Volumes/GoogleDrive/Shared drives/UCSC-UMN AFRI project/Data/GA&#39;)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="n">chromeOptions</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
<span class="c1"># for mac</span>
<span class="c1">#dnldpath = {&quot;download.default_directory&quot; : &quot;/Users/long/OneDrive/Projects/AFRI/data/SD/&quot;}</span>
<span class="c1"># for windows</span>
<span class="n">dnldpath</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;download.default_directory&quot;</span> <span class="p">:</span><span class="s2">&quot;C:/Users/longy/OneDrive/Projects/AFRI/data/LA/&quot;</span><span class="p">}</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s2">&quot;prefs&quot;</span><span class="p">,</span><span class="n">dnldpath</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="n">driver_path</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">chromeOptions</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>


<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://sos.tn.gov/publications/services/acts-and-resolutions&#39;</span><span class="p">)</span>

<span class="c1"># End of TN_Leginfo.py</span>


<span class="c1"># Start of WI_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1">#driver_path = &#39;C:/Users/longy/OneDrive/Projects/AFRI/windows/chromedriver.exe&#39; #for windows</span>
<span class="n">driver_path</span> <span class="o">=</span> <span class="s1">&#39;/Users/long/Library/CloudStorage/OneDrive-Personal/Projects/AFRI/chromedriver&#39;</span>
<span class="c1"># driver = webdriver.Chrome(executable_path=DRIVER_PATH)</span>

<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Users/long/Library/CloudStorage/OneDrive-Personal/Projects/AFRI&#39;</span><span class="p">)</span>
<span class="c1">#os.chdir(&#39;C:/Users/longy/OneDrive/Projects/AFRI&#39;)</span>
<span class="c1"># os.chdir(&#39;/Volumes/GoogleDrive/Shared drives/UCSC-UMN AFRI project/Data/GA&#39;)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="n">chromeOptions</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
<span class="c1"># for mac</span>
<span class="c1">#dnldpath = {&quot;download.default_directory&quot; : &quot;/Users/long/OneDrive/Projects/AFRI/data/SD/&quot;}</span>
<span class="c1"># for windows</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s1">&#39;prefs&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;download.default_directory&quot;</span><span class="p">:</span> <span class="s2">&quot;/Users/long/Library/CloudStorage/OneDrive-Personal/Projects/AFRI/data/WI/&quot;</span><span class="p">,</span> <span class="c1">#Change default directory for downloads</span>
    <span class="s2">&quot;download.prompt_for_download&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="c1">#To auto download the file</span>
    <span class="s2">&quot;download.directory_upgrade&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;plugins.always_open_pdf_externally&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="c1">#It will not show PDF directly in chrome</span>
    <span class="s2">&quot;--enable-javascript&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="n">driver_path</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">chromeOptions</span><span class="p">)</span>
<span class="c1">#river = webdriver.Firefox()</span>

<span class="n">sessions_first</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1975&#39;</span><span class="p">,</span><span class="s1">&#39;1977&#39;</span><span class="p">,</span><span class="s1">&#39;1979&#39;</span><span class="p">,</span><span class="s1">&#39;1981&#39;</span><span class="p">,</span><span class="s1">&#39;1983&#39;</span><span class="p">,</span><span class="s1">&#39;1985&#39;</span><span class="p">,</span><span class="s1">&#39;1987&#39;</span><span class="p">,</span><span class="s1">&#39;1989&#39;</span><span class="p">,</span><span class="s1">&#39;1991&#39;</span><span class="p">,</span><span class="s1">&#39;1993&#39;</span><span class="p">]</span>
<span class="n">sessions_first_act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">sessions_first</span><span class="p">:</span>
    <span class="n">session_url</span> <span class="o">=</span> <span class="s2">&quot;https://docs.legis.wisconsin.gov/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/related/acts&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">session_url</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">session_url</span><span class="p">)</span>
    <span class="n">acts</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_partial_link_text</span><span class="p">(</span><span class="s2">&quot;Wisconsin&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">acts</span><span class="p">:</span>
        <span class="n">act_url</span> <span class="o">=</span> <span class="n">act</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>

<span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">sessions_first_act_urls</span><span class="p">:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Users/long/OneDrive/Projects/AFRI/data/WI/&quot;</span>
<span class="n">list_of_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">list_of_files</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">file</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>  <span class="c1"># open in readonly mode</span>
        <span class="c1"># creating a pdf File object of original pdf</span>
        <span class="n">pdfFileObj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">latest_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">pdfReader</span> <span class="o">=</span> <span class="n">PyPDF2</span><span class="o">.</span><span class="n">PdfFileReader</span><span class="p">(</span><span class="n">pdfFileObj</span><span class="p">)</span>
        <span class="n">pagenumber</span> <span class="o">=</span>  <span class="n">pdfReader</span><span class="o">.</span><span class="n">numPages</span>
        <span class="n">acttxt</span> <span class="o">=</span><span class="p">[]</span>
        <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pagenumber</span><span class="p">):</span>
            <span class="n">pageObj</span> <span class="o">=</span> <span class="n">pdfReader</span><span class="o">.</span><span class="n">getPage</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">pageObj</span><span class="o">.</span><span class="n">extractText</span><span class="p">()</span>
            <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
            <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="n">acttxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
    <span class="n">st</span> <span class="o">=</span><span class="s2">&quot;WI&quot;</span>
    <span class="n">sts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">act2_urls</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">sessions_second</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1995&#39;</span><span class="p">,</span><span class="s1">&#39;1997&#39;</span><span class="p">,</span><span class="s1">&#39;1999&#39;</span><span class="p">,</span><span class="s1">&#39;2001&#39;</span><span class="p">,</span><span class="s1">&#39;2003&#39;</span><span class="p">,</span><span class="s1">&#39;2005&#39;</span><span class="p">,</span><span class="s1">&#39;2007&#39;</span><span class="p">,</span><span class="s1">&#39;2009&#39;</span><span class="p">,</span><span class="s1">&#39;2011&#39;</span><span class="p">,</span><span class="s1">&#39;2013&#39;</span><span class="p">,</span><span class="s1">&#39;2015&#39;</span><span class="p">,</span><span class="s1">&#39;2017&#39;</span><span class="p">,</span><span class="s1">&#39;2019&#39;</span><span class="p">,</span><span class="s1">&#39;2021&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">sessions_second</span><span class="p">:</span>
    <span class="n">session_url</span> <span class="o">=</span> <span class="s2">&quot;https://docs.legis.wisconsin.gov/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/related/acts&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">session_url</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">session_url</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">acts</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_partial_link_text</span><span class="p">(</span><span class="s2">&quot;Wisconsin Act&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">acts</span><span class="p">:</span>
        <span class="n">act2_url</span> <span class="o">=</span> <span class="n">act</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="n">act2_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act2_url</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">act2_url</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">act2_urls</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">*</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;div#document.acts&quot;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">acttxt</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div#document.acts&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">acttxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
    <span class="n">st</span> <span class="o">=</span> <span class="s2">&quot;WI&quot;</span>
    <span class="n">sts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">*</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="c1">#&#39;Link to full text&#39;:session_urls,</span>
    <span class="s1">&#39;Full text&#39;</span><span class="p">:</span> <span class="n">acttxts</span>
<span class="p">})</span>

<span class="c1"># drop duplicates by &quot;Official ID&quot;</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Full text&#39;</span><span class="p">],</span>
                           <span class="n">keep</span> <span class="o">=</span> <span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>


<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;WI_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;WI_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;WI_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;WI_Leginfo.json&#39;</span><span class="p">)</span>
<span class="c1"># End of WI_Leginfo.py</span>


<span class="c1"># Start of MI_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">dateutil.parser</span> <span class="kn">import</span> <span class="n">parse</span>

<span class="c1"># driver_path = &#39;C:/Program Files (x86)/Google/Chrome/Application/chromedriver.exe&#39; #for windows</span>
<span class="c1"># driver = webdriver.Chrome(executable_path=driver_path)</span>

<span class="c1"># set up webdriver by short path</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="s1">&#39;./chromedriver&#39;</span><span class="p">)</span>


<span class="c1"># choose sessionyears</span>
<span class="n">input_sessionyears</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2021-2022&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-2020&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-2018&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-2016&#39;</span><span class="p">,</span> <span class="s1">&#39;2013-2014&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-2012&#39;</span><span class="p">,</span> <span class="s1">&#39;2009-2010&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;2007-2008&#39;</span><span class="p">,</span> <span class="s1">&#39;2005-2006&#39;</span><span class="p">,</span> <span class="s1">&#39;2003-2004&#39;</span><span class="p">,</span> <span class="s1">&#39;2001-2002&#39;</span><span class="p">,</span> <span class="s1">&#39;1999-2000&#39;</span><span class="p">,</span> <span class="s1">&#39;1997-1998&#39;</span><span class="p">]</span>


<span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">input_sessionyear</span> <span class="ow">in</span> <span class="n">input_sessionyears</span><span class="p">:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://www.legislature.mi.gov/(S(uycj0anii1cfudf2mj0uyllp))/mileg.aspx?page=LegAdvancedSearch&quot;</span><span class="p">)</span>

    <span class="n">select_public</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#frg_legadvancedsearch_PublicActs&#39;</span><span class="p">)</span>
    <span class="n">select_public</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="c1"># select session year</span>
    <span class="n">select_sessionyear</span> <span class="o">=</span> <span class="n">Select</span><span class="p">(</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#frg_legadvancedsearch_LegislativeSession_LegislativeSession&#39;</span><span class="p">))</span>
    <span class="n">select_sessionyear</span><span class="o">.</span><span class="n">select_by_visible_text</span><span class="p">(</span><span class="n">input_sessionyear</span><span class="p">)</span>

    <span class="c1"># search by keywords</span>
    <span class="c1">#input_keywords = driver.find_element_by_css_selector(&#39;#frg_legadvancedsearch_LegFullText&#39;)</span>
    <span class="c1">#input_keywords.send_keys(keyword)</span>

    <span class="c1"># click search button</span>
    <span class="n">search_button</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#frg_legadvancedsearch_SearchButton&#39;</span><span class="p">)</span>
    <span class="n">search_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">(</span>
            <span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;#maincontent &gt; table:nth-child(2) &gt; tbody &gt; tr:nth-child(1) &gt; td &gt; span&quot;</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">searchresult</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span>
            <span class="s1">&#39;table#frg_executesearch_SearchResults_Results  tbody  tr td a&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">searchresult</span><span class="p">)):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">searchresult</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;done with urls&quot;</span><span class="p">)</span>

<span class="c1"># set up list titles</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sessionyears</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">billnumbers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">briefsummarys</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">introduceddates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">signingdates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">effectivedates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">expirationdates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">leadauthors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">textlinks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>

    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="n">textlink</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;#frg_print_HtmlDocIcon_DocumentImage&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
    <span class="n">textlinks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">textlink</span><span class="p">)</span>

    <span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;MI&quot;</span>
    <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="n">year</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#frg_print_DocumentName&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; of &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sessionyear</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sessionyear</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">sessionyears</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sessionyear</span><span class="p">)</span>

    <span class="n">briefsummary</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#frg_print_DocumentDescription&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">briefsummarys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">briefsummary</span><span class="p">)</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#frg_print_HtmlDocIcon_DocumentImage &gt; img&#39;</span><span class="p">)</span>
    <span class="n">text</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="c1">#try:</span>
    <span class="c1">#    billnumber = driver.find_element_by_xpath(&quot;//font[contains(text(),&#39;SENATE BILL No.&#39;)]&quot;).text.split(&quot;No. &quot;)[1]</span>
    <span class="c1">#    billnumber = &quot;SB-&quot; + str(billnumber)</span>
    <span class="c1">#except:</span>
    <span class="c1">#    billnumber = driver.find_element_by_xpath(&quot;//font[contains(text(),&#39;HOUSE BILL No.&#39;)]&quot;).text.split(&quot;No. &quot;)[1]</span>
    <span class="c1">#    billnumber = &quot;HB-&quot; + str(billnumber)</span>
    <span class="c1">#billnumbers.append(billnumber)</span>

    <span class="c1">#name = driver.find_element_by_xpath(&quot;//font[contains(text(),&#39;AN ACT to&#39;)]&quot;).text</span>
    <span class="c1">#names.append(name)</span>

    <span class="c1">#leadauthor = driver.find_element_by_xpath(&quot;//font[contains(text(),&#39;Introduced by&#39;)]&quot;).text.split(&quot;Introduced by &quot;)[1]</span>
    <span class="c1">#leadauthors.append(leadauthor)</span>

    <span class="c1">#signingdate = driver.find_element_by_css_selector(&#39;body&#39;).text.split(&#39;Approved by the Governor&#39;)[1].split(&#39;Filed with the Secretary of State&#39;)[0]</span>
    <span class="c1">#dates = datefinder.find_dates(signingdate)</span>
    <span class="c1">#datelist = []</span>
    <span class="c1">#for date in dates:</span>
    <span class="c1">#    signingdate = date.date()</span>
    <span class="c1">#signingdates.append(signingdate)</span>

    <span class="n">acttxt</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">acttxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Year&#39;</span><span class="p">:</span> <span class="n">years</span><span class="p">,</span>
    <span class="s1">&#39;State&#39;</span><span class="p">:</span> <span class="n">states</span><span class="p">,</span>
    <span class="s1">&#39;Session Year&#39;</span><span class="p">:</span> <span class="n">sessionyears</span><span class="p">,</span>
    <span class="s1">&#39;Brief Summary&#39;</span><span class="p">:</span> <span class="n">briefsummarys</span><span class="p">,</span>
    <span class="s1">&#39;Link to full text&#39;</span><span class="p">:</span><span class="n">textlinks</span><span class="p">,</span>
    <span class="s1">&#39;Full text&#39;</span><span class="p">:</span> <span class="n">acttxts</span>
<span class="p">})</span>



<span class="c1"># save bill info into excel file</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;MI_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;MI_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite://&#39;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;MI_Leginfo.sql&#39;</span><span class="p">,</span><span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;MI_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;MI_Leginfo.json&#39;</span><span class="p">)</span>


<span class="n">datasource</span><span class="o">.</span><span class="n">to_stata</span><span class="p">(</span><span class="s1">&#39;MI_Leginfo.dta&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;download finished&quot;</span><span class="p">)</span>
<span class="c1"># End of MI_Leginfo.py</span>


<span class="c1"># Start of TX_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="c1"># driver_path = r&#39;C:\Users\longy\OneDrive\Projects\AFRI\windows\chromedriver.exe&#39; #for windows</span>
<span class="n">driver_path</span> <span class="o">=</span> <span class="s1">&#39;/Users/long/OneDrive/Projects/AFRI/chromedriver&#39;</span>
<span class="c1"># driver = webdriver.Chrome(executable_path=DRIVER_PATH)</span>

<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Users/long/OneDrive/Projects/AFRI&#39;</span><span class="p">)</span>
<span class="c1"># os.chdir(&#39;C:/Users/longy/OneDrive/Projects/AFRI/&#39;)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="n">chromeOptions</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s1">&#39;prefs&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;download.default_directory&quot;</span><span class="p">:</span> <span class="s2">&quot;C:/Users/longy/OneDrive/Projects/AFRI/data/TX/&quot;</span><span class="p">,</span> <span class="c1">#Change default directory for downloads</span>
    <span class="s2">&quot;download.default_directory&quot;</span><span class="p">:</span> <span class="s2">&quot;/Users/long/OneDrive/Projects/AFRI/data/TX/&quot;</span><span class="p">,</span> <span class="c1">#Change default directory for downloads</span>
    <span class="s2">&quot;download.prompt_for_download&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="c1">#To auto download the file</span>
    <span class="s2">&quot;download.directory_upgrade&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;plugins.always_open_pdf_externally&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="c1">#It will not show PDF directly in chrome</span>
    <span class="s2">&quot;--enable-javascript&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="n">driver_path</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">chromeOptions</span><span class="p">)</span>

<span class="c1">#64-86th session 2021</span>
<span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">87</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://lrl.texas.gov/legis/billsearch/searchchapter.cfm?legSession=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="o">+</span><span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&amp;chapter=&amp;submitbutton=Search+by+chapter&quot;</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">act_urls</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;td.results a&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">act_urls</span><span class="p">:</span>
            <span class="n">act_url</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;pdf&#39;</span> <span class="ow">in</span> <span class="n">act_url</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
                <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>


<span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">*</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>



<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Users/long/Downloads/TX2&quot;</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>

<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">doc</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
            <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
            <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
            <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mf">0.03</span> <span class="o">*</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">acttxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>


<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="c1">#&#39;Link to full text&#39;:session_urls,</span>
    <span class="s1">&#39;Full text&#39;</span><span class="p">:</span> <span class="n">acttxts</span>
<span class="p">})</span>


<span class="n">datasource</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="s2">&quot;TX_Leginfo&quot;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;TX_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;TX_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;TX_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;TX_Leginfo.json&#39;</span><span class="p">)</span>


<span class="c1"># End of TX_Leginfo.py</span>


<span class="c1"># Start of NC_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">import</span> <span class="nn">selenium</span>
<span class="nb">print</span><span class="p">(</span><span class="n">selenium</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="c1">## others</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># set up working directory</span>
<span class="n">working_directory</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/NC&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">))</span>


<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;./PDFs/&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>

<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span> <span class="o">=</span> <span class="s1">&#39;../../geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span> <span class="o">=</span> <span class="n">service</span><span class="p">)</span>

<span class="c1"># empty list to store info</span>

<span class="n">act_pdf_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_html_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pdf_file_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">html_file_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bill_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">chapter_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">broken_act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">summaries</span> <span class="o">=</span> <span class="p">[]</span>


<span class="c1"># North Caroline Legislature Website: https://www.ncleg.gov/Laws/SessionLaws/</span>

<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://www.ncleg.gov/Laws/SessionLaws/&#39;</span><span class="p">)</span>

<span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
    <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">))</span>
<span class="p">)</span>

<span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;#sessionDropdown_chosen &gt; a:nth-child(1) &gt; span:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

<span class="n">session_elements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;li.active-result&#39;</span><span class="p">)</span>
<span class="n">session_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">session_elements</span><span class="p">:</span>
    <span class="n">session_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="n">session_urls</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">session_list</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">2021</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">1975</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;Extra&#39;</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
            <span class="n">session_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;https://www.ncleg.gov/Laws/SessionLaws/&#39;</span> <span class="o">+</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;e&#39;</span> <span class="o">+</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Session &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">session_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;https://www.ncleg.gov/Laws/SessionLaws/&#39;</span> <span class="o">+</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">session_urls</span><span class="p">:</span>

    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="n">rows</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;div.py-2&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>

        <span class="n">act_html_url</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                                        <span class="s1">&#39;div:nth-child(1) &gt; a:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="n">act_html_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_html_url</span><span class="p">)</span>

        <span class="n">act_pdf_url</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                                       <span class="s1">&#39;div:nth-child(1) &gt; a:nth-child(2)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="n">act_pdf_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_html_url</span><span class="p">)</span>

        <span class="n">chapter_num</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                                       <span class="s1">&#39;div:nth-child(1) &gt; a:nth-child(3)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">chapter_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chapter_num</span><span class="p">)</span>

        <span class="n">bill_num</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                                    <span class="s1">&#39;div:nth-child(2)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bill_num</span><span class="p">)</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                                   <span class="s1">&#39;div:nth-child(3)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">summaries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>

<span class="n">datasource</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;bill_num&#39;</span><span class="p">:</span> <span class="n">bill_nums</span><span class="p">,</span>
    <span class="s1">&#39;chapter_num&#39;</span><span class="p">:</span> <span class="n">chapter_nums</span><span class="p">,</span>
    <span class="s1">&#39;act_pdf_url&#39;</span><span class="p">:</span> <span class="n">act_pdf_urls</span><span class="p">,</span>
    <span class="s1">&#39;act_html_url&#39;</span><span class="p">:</span> <span class="n">act_html_urls</span><span class="p">,</span>
    <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s2">&quot;NC&quot;</span><span class="p">,</span>
    <span class="s1">&#39;summary&#39;</span><span class="p">:</span><span class="n">summaries</span>
<span class="p">})</span>


<span class="c1"># download corresponding pdf file</span>

<span class="k">for</span> <span class="n">act_url</span> <span class="ow">in</span> <span class="n">act_html_urls</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>

    <span class="c1"># Open the desired webpage</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>

    <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;body&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="c1"># Get the HTML content of the page</span>
    <span class="n">html_content</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">page_source</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">act_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;SL&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">html_file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">+</span> <span class="n">name</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

    <span class="c1"># Write the HTML content to a file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">act_txts</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">])</span>
<span class="c1"># delete duplicates</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">])</span>

<span class="c1">#datasource.to_excel(&#39;NC_Leginfo.xlsx&#39;) IllegalCharacterError</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;NC_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;NC_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;NC_Leginfo.json&#39;</span><span class="p">)</span>

<span class="c1"># End of NC_Leginfo.py</span>


<span class="c1"># Start of WA_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.firefox_profile</span> <span class="kn">import</span> <span class="n">FirefoxProfile</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="c1">## others</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="c1"># set up working directory</span>
<span class="n">working_directory</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/WA&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">))</span>

<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;../PDFs&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>

<span class="c1"># Create a Firefox profile and configure preferences</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>


<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span><span class="o">=</span><span class="s1">&#39;../../geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span> <span class="o">=</span> <span class="n">service</span><span class="p">)</span>


<span class="c1"># The page you&#39;re looking for doesn&#39;t exist.</span>
<span class="sd">&#39;&#39;&#39; </span>
<span class="sd">[&#39;https://leg.wa.gov/CodeReviser/documents/sessionlaw/1991c54.pdf&#39;,</span>
<span class="sd"> &#39;https://leg.wa.gov/CodeReviser/documents/sessionlaw/1991ex1c1.pdf&#39;,</span>
<span class="sd"> &#39;http://lawfilesext.leg.wa.gov/biennium/1991-92/Pdf/Bills/Session%20Laws/House/120.sl.pdf&#39;,</span>
<span class="sd"> &#39;http://lawfilesext.leg.wa.gov/biennium/1991-92/Pdf/Bills/Session%20Laws/Senate/6347-S2.sl.pdf&#39;,</span>
<span class="sd"> &#39;http://lawfilesext.leg.wa.gov/biennium/1995-96/Pdf/Bills/Session%20Laws/House/164.sl.pdf&#39;]</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://leg.wa.gov/CodeReviser/pages/session_laws.aspx&#39;</span><span class="p">)</span>

<span class="c1"># Create a list from range</span>
<span class="n">years_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1975</span><span class="p">,</span> <span class="mi">2022</span><span class="p">))</span>  <span class="c1"># Note: 2022 is exclusive</span>

<span class="c1"># Remove the year 1978</span>
<span class="n">years_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">1978</span><span class="p">)</span>

<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">badfiles</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years_list</span><span class="p">:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://leg.wa.gov/CodeReviser/pages/session_laws.aspx&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">))</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="n">chapters</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span> <span class="s2">&quot;Ch.&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">chapter</span> <span class="ow">in</span> <span class="n">chapters</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
            <span class="n">link</span> <span class="o">=</span> <span class="n">chapter</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>
            <span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="o">*</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">badfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chapter</span><span class="p">)</span>


<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;year&#39;</span><span class="p">:</span><span class="n">years</span><span class="p">,</span>
    <span class="s1">&#39;link&#39;</span><span class="p">:</span> <span class="n">links</span>
<span class="p">})</span>

<span class="c1"># Dropping duplicates based on &#39;links&#39; column</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;links&#39;</span><span class="p">)</span>



<span class="c1"># store some broken pages</span>
<span class="n">bad_act_urls</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># download pdfs from the above links scraped</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">link</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;links&#39;</span><span class="p">]):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">link</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;sessionlaw/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/WA/PDFs/&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.pdf&quot;</span>
        <span class="c1"># Send a GET request to the URL</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
        <span class="c1"># Ensure the request was successful</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="c1"># Write the content of the response to a file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
            <span class="n">bad_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># Find the position of the last &#39;/&#39;</span>
        <span class="n">last_slash_pos</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

        <span class="c1"># Split the URL into two parts</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">link</span><span class="p">[:</span><span class="n">last_slash_pos</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;biennium/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/Pdf&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">link</span><span class="p">[</span><span class="n">last_slash_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/WA/PDFs/&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.pdf&quot;</span>
        <span class="c1"># Send a GET request to the URL</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
        <span class="c1"># Ensure the request was successful</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="c1"># Write the content of the response to a file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
            <span class="n">bad_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_names</span>


<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">file_names_from_folder</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;./PDFs&quot;</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
        <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
        <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">file_names_from_folder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;PDFs/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>

<span class="n">df_pdfs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span><span class="n">act_txts</span><span class="p">,</span>
    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">file_names_from_folder</span>
<span class="p">})</span>


<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df_pdfs</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;file_name&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;WA_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;WA_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;WA_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;WA_Leginfo.json&#39;</span><span class="p">)</span>
<span class="c1"># End of WA_Leginfo.py</span>


<span class="c1"># Start of AR_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="c1">## others</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">fitz</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="c1"># set up working directory</span>
<span class="n">working_directory</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/AR&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">))</span>

<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;./PDFs/&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>

<span class="c1"># Create a Firefox profile and configure preferences</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>


<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span><span class="o">=</span><span class="s1">&#39;../../geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="c1"># Initialize the WebDriver with the specified path</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">service</span><span class="p">)</span>

<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">chapter_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">subtitles</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bill_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">broken_act_urls</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://www.arkleg.state.ar.us/Acts/SearchByRange?ddBienniumSession&#39;</span><span class="p">)</span>
<span class="c1"># accept cookies button</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;a.btn&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="n">session_elements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;#ddBienniumSessionActsSearchByRange option&#39;</span><span class="p">)</span>
<span class="n">session_texts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">session_text</span> <span class="ow">in</span> <span class="n">session_elements</span><span class="p">:</span>
    <span class="n">session_texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session_text</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="k">for</span> <span class="n">session_text</span> <span class="ow">in</span> <span class="n">session_texts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">session_text</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Attempt to convert the value to an integer</span>
        <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">session_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">year</span> <span class="o">&gt;</span> <span class="mi">2021</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">select</span> <span class="o">=</span> <span class="n">Select</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;#ddBienniumSessionActsSearchByRange&#39;</span><span class="p">))</span>
            <span class="n">select</span><span class="o">.</span><span class="n">select_by_visible_text</span><span class="p">(</span><span class="n">session_text</span><span class="p">)</span>
            <span class="c1"># clear starting act number and ending act number</span>
            <span class="n">starting_num</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;#startAct&#39;</span><span class="p">)</span>
            <span class="n">starting_num</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">starting_num</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ending_num</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;#endAct&#39;</span><span class="p">)</span>
            <span class="n">ending_num</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">ending_num</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="mi">9999</span><span class="p">)</span>
            <span class="c1"># startAct</span>
            <span class="n">search_button</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div.form-row:nth-child(5) &gt; button:nth-child(1)&#39;</span><span class="p">)</span>
            <span class="n">search_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

            <span class="c1"># for page 1</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div.row.tableRow, div.row.tableRowAlt&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="c1">#years.append(year)</span>
                <span class="c1">#sessions.append(session_text)</span>
                <span class="n">chapter_num</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="n">chapter_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chapter_num</span><span class="p">)</span>
                <span class="n">subtitles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(3)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="n">act_url</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s1">&#39;PDF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
                <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>

                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">session_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;chap&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">chapter_num</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.pdf&quot;</span>
                <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

                <span class="n">path</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">+</span> <span class="n">name</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.005</span><span class="p">)</span>

                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
                <span class="c1"># Ensure the request was successful</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                    <span class="c1"># Write the content of the response to a file</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
                    <span class="n">broken_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># for page 2-n</span>
            <span class="n">page_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;div.row:nth-child(25) &gt; div:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;of &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div.row.tableRow, div.row.tableRowAlt&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                    <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
                    <span class="n">sessions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session_text</span><span class="p">)</span>
                    <span class="n">chapter_num</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                    <span class="n">chapter_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chapter_num</span><span class="p">)</span>
                    <span class="n">subtitles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(2)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                    <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(3)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                    <span class="n">act_url</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s1">&#39;PDF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
                    <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>

                    <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">session_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;chap&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">chapter_num</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.pdf&quot;</span>
                    <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

                    <span class="n">path</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">+</span> <span class="n">name</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.005</span><span class="p">)</span>

                    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
                    <span class="c1"># Ensure the request was successful</span>
                    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                        <span class="c1"># Write the content of the response to a file</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
                        <span class="n">broken_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>



<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Users/long/Downloads/AR/&quot;</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">[:</span><span class="mi">20</span><span class="p">]:</span>
    <span class="n">pdfFileObj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
    <span class="n">pdfReader</span> <span class="o">=</span> <span class="n">PyPDF2</span><span class="o">.</span><span class="n">PdfFileReader</span><span class="p">(</span><span class="n">pdfFileObj</span><span class="p">)</span>
    <span class="n">numpages</span> <span class="o">=</span> <span class="n">pdfReader</span><span class="o">.</span><span class="n">numPages</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numpages</span><span class="p">):</span>
        <span class="n">pgtxt</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">pdfReader</span><span class="o">.</span><span class="n">getPage</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
    <span class="n">acttxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
    <span class="n">pdfFileObj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;./PDFs&quot;</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
        <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
        <span class="n">act_txt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_txt</span><span class="p">)</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">act_txts</span><span class="p">,</span>
    <span class="s1">&#39;year&#39;</span><span class="p">:</span><span class="n">years</span><span class="p">,</span>
    <span class="s1">&#39;chapter_num&#39;</span><span class="p">:</span><span class="n">chapter_nums</span><span class="p">,</span>
    <span class="s1">&#39;subtitle&#39;</span><span class="p">:</span><span class="n">subtitles</span><span class="p">,</span>
    <span class="s1">&#39;bill_num&#39;</span><span class="p">:</span><span class="n">bill_nums</span><span class="p">,</span>
    <span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="n">filenames</span><span class="p">,</span>
    <span class="s1">&#39;act_url&#39;</span><span class="p">:</span><span class="n">act_urls</span><span class="p">,</span>
    <span class="s1">&#39;session&#39;</span><span class="p">:</span><span class="n">sessions</span>
<span class="p">})</span>

<span class="c1"># save bill info into files</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;AR_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;AR_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;AR_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;AR_Leginfo.json&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;done&quot;</span><span class="p">)</span>
<span class="c1"># End of AR_Leginfo.py</span>


<span class="c1"># Start of OH_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">import</span> <span class="nn">selenium</span>
<span class="nb">print</span><span class="p">(</span><span class="n">selenium</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="c1">## others</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">datefinder</span>

<span class="c1"># set up working directory</span>
<span class="n">working_directory</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/OH&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">))</span>


<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;./PDFs/&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>
<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span> <span class="o">=</span> <span class="s1">&#39;../../geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">service</span><span class="p">)</span>


<span class="c1"># empty list to store info</span>

<span class="n">act_urls_1997_2014</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_pdf_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_html_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pdf_file_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">html_file_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bill_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">chapter_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">broken_act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">summaries</span> <span class="o">=</span> <span class="p">[]</span>


<span class="c1"># Ohio lature Website: http://archives.legislature.state.oh.us/acts.cfm?GenAssem=122 1997-2014</span>
<span class="c1"># https://www.legislature.ohio.gov/legislation/acts/131 after 2016</span>

<span class="c1"># for 1997-2014</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span><span class="mi">131</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://archives.legislature.state.oh.us/acts.cfm?GenAssem=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="n">bill_elements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span><span class="s1">&#39;Bill&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">bill_elements</span><span class="p">:</span>
        <span class="n">sessions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">act_urls_1997_2014</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">))</span>

<span class="n">act_pdf_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_status_urls</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">act_urls_1997_2014</span><span class="p">:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="c1">#act_txts.append(driver.find_element(By.CSS_SELECTOR,&#39;.bigPanel&#39;).text)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">act_pdf_url</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span> <span class="s1">&#39;PDF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">act_pdf_url</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span> <span class="s1">&#39;pdf&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e2</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">act_pdf_url</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span> <span class="s1">&#39;As Enrolled&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e3</span><span class="p">:</span>
                <span class="n">act_pdf_url</span> <span class="o">=</span> <span class="n">url</span>

    <span class="n">act_pdf_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_pdf_url</span><span class="p">)</span>

    <span class="n">act_status_url</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span><span class="s1">&#39;Status &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>

    <span class="n">act_status_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_status_url</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;bill_num&#39;</span><span class="p">:</span> <span class="n">bill_nums</span><span class="p">,</span>
    <span class="s1">&#39;session&#39;</span><span class="p">:</span> <span class="n">sessions</span><span class="p">,</span>
    <span class="s1">&#39;act_html_url&#39;</span><span class="p">:</span> <span class="n">act_urls_1997_2014</span><span class="p">,</span>
    <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s2">&quot;OH&quot;</span><span class="p">,</span>
    <span class="s1">&#39;act_pdf_url&#39;</span><span class="p">:</span> <span class="n">act_pdf_urls</span><span class="p">,</span>
    <span class="s1">&#39;act_status_url&#39;</span><span class="p">:</span> <span class="n">act_status_urls</span>
<span class="p">})</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;OH_Leginfo_1997_2014.csv&#39;</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;OH_Leginfo_1997_2014.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;act_html_url&#39;</span><span class="p">]:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;.bigPanel&#39;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;.bigPanel&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span><span class="o">*</span><span class="mf">0.005</span><span class="p">)</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">act_txts</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;OH_Leginfo_1997_2014.csv&#39;</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;OH_Leginfo_1997_2014.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="n">act_urls_2016</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bill_nums_2016</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">names_2016</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_pdf_urls_2016</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sessions_2016</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">131</span><span class="p">,</span><span class="mi">136</span><span class="p">):</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://www.legislature.ohio.gov/legislation/acts/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="n">bill_elements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span><span class="s1">&#39;No.&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">bill_elements</span><span class="p">:</span>
        <span class="n">sessions_2016</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">bill_nums_2016</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">act_urls_2016</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">))</span>

        <span class="c1"># Find the next sibling of the element</span>
        <span class="n">names_2016</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s2">&quot;following-sibling::*[2]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="n">grandparent_element</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s2">&quot;../..&quot;</span><span class="p">)</span>

        <span class="n">act_pdf_urls_2016</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grandparent_element</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span><span class="s1">&#39;Download&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">))</span>

<span class="n">datasource_2016</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;session&#39;</span><span class="p">:</span><span class="n">sessions_2016</span><span class="p">,</span>
    <span class="s1">&#39;bill_num&#39;</span><span class="p">:</span> <span class="n">bill_nums_2016</span><span class="p">,</span>
    <span class="s1">&#39;chapter_num&#39;</span><span class="p">:</span> <span class="s1">&#39;NA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;act_pdf_url&#39;</span><span class="p">:</span> <span class="n">act_pdf_urls_2016</span><span class="p">,</span>
    <span class="s1">&#39;act_html_url&#39;</span><span class="p">:</span> <span class="n">act_urls_2016</span><span class="p">,</span>
    <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s2">&quot;OH&quot;</span>
<span class="p">})</span>

<span class="n">datasource_2016</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;OH_Leginfo_2016.csv&#39;</span><span class="p">)</span>



<span class="n">datasource_2016</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;OH_Leginfo_2016.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">file_names_20162</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">acttxts_20162</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">datasource_2016</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">act_url</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;act_html_url&#39;</span><span class="p">]</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span><span class="s1">&#39;As Enrolled&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s1">&#39;As Adopted by Senate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/OH/PDFs_2016new/&quot;</span>
    <span class="n">list_of_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>
    <span class="n">latest_file</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">list_of_files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getctime</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">latest_file</span><span class="p">)</span>
    <span class="c1"># New file name</span>
    <span class="n">new_pdf_file_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="n">act_url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;legislation&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span>
    <span class="n">file_names_20162</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;legislation&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
    <span class="c1"># Rename the file</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">latest_file</span><span class="p">,</span> <span class="n">new_pdf_file_path</span><span class="p">)</span>

<span class="n">file_names_2016</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">datasource_2016</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">act_url</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;act_html_url&#39;</span><span class="p">]</span>
    <span class="n">file_names_2016</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;legislation&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>

<span class="n">datasource_2016</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_names_2016</span>


<span class="n">folder_path</span> <span class="o">=</span> <span class="s2">&quot;./PDFs_2016new&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">folder_path</span><span class="p">))</span>

<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>

<span class="n">act_txts_2016</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">broken_files</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
            <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
            <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
            <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
        <span class="n">act_txts_2016</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">act_txts_2016</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
        <span class="n">broken_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="n">file_names_2016</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">file_names_2016</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;PDFs_2016new/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">datasource_2016_pdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span><span class="n">act_txts_2016</span><span class="p">,</span>
    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">file_names_2016</span>
<span class="p">})</span>

<span class="n">datasource_2016</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">datasource_2016</span><span class="p">,</span> <span class="n">datasource_2016_pdf</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;file_name&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">datasource_2016</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;OH_Leginfo_2016.csv&#39;</span><span class="p">)</span>
<span class="n">datasource_2016</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;OH_Leginfo_2016.csv&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;OH_Leginfo_1997_2014.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">_append</span><span class="p">(</span><span class="n">datasource_2016</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># cleaning</span>
<span class="n">bill_nums</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;bill_num&#39;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;Bill&#39;</span> <span class="ow">in</span> <span class="n">num</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;Senate&#39;</span> <span class="ow">in</span> <span class="n">num</span><span class="p">:</span>
            <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;SB&#39;</span> <span class="o">+</span> <span class="n">num</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; Bill &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;HB&#39;</span> <span class="o">+</span> <span class="n">num</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; Bill &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;No.&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;bill_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bill_nums</span>

<span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">datasource</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]):</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;act_html_url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;legislation/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">sessions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sessions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">])</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sessions</span>

<span class="n">act_status_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">datasource</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;act_status_url&#39;</span><span class="p">]):</span>
        <span class="n">act_status_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;act_html_url&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/status&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">act_status_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;act_status_url&#39;</span><span class="p">])</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;act_status_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">act_status_urls</span>

<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="mi">122</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">135</span><span class="p">:</span>
        <span class="c1"># Calculate the year range based on the session number</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="mi">1997</span> <span class="o">+</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="o">-</span> <span class="mi">122</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="n">start_year</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">year_range</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year_range</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Unknown Session&quot;</span><span class="p">)</span>
<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">years</span>


<span class="n">state</span> <span class="o">=</span> <span class="s1">&#39;OH&#39;</span>
<span class="c1"># Read the CSV file into a DataFrame</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/Volumes/SSD/AFRI/Data/Cleaned/</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">_leginfo_clean.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">status_file_urls</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;archives&#39;</span> <span class="ow">in</span> <span class="n">link</span><span class="p">:</span>
        <span class="n">status_url</span> <span class="o">=</span> <span class="s1">&#39;http://archives.legislature.state.oh.us/lsc/statusreport&#39;</span> <span class="o">+</span> <span class="n">link</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;ID=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span>  <span class="n">link</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;ID=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_statusreport.pdf&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">status_url</span> <span class="o">=</span> <span class="n">link</span> <span class="o">+</span> <span class="s1">&#39;/votes&#39;</span>
    <span class="n">status_file_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">status_url</span><span class="p">)</span>
<span class="n">year_info</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">status_file_urls</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;archives&#39;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;window.location.href = &#39;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">year_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://www.legislature.ohio.gov/legislation/134/hb575/votes&#39;</span><span class="p">)</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">year_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="n">link</span> <span class="o">=</span> <span class="s1">&#39;http://archives.legislature.state.oh.us/bills.cfm?ID=130_SB_378&#39;</span>
<span class="s1">&#39;https://www.legislature.ohio.gov/legislation/134/hb687/status&#39;</span>

<span class="c1">#http://archives.legislature.state.oh.us/lsc/statusreport125/125_HB_1_statusreport.pdf</span>
<span class="c1">#http://archives.legislature.state.oh.us/lsc/statusreport122/122_HB_1_statusreport.pdf</span>
<span class="c1">#http://archives.legislature.state.oh.us/lsc/statusreport</span>
<span class="c1">#http://archives.legislature.state.oh.us/bills.cfm?ID=122_HB_1</span>
<span class="c1">#https://www.legislature.ohio.gov/legislation/134/hb687statusreport.pdf</span>
<span class="c1">#https://www.legislature.ohio.gov/legislation/134/hb575/votes</span>

<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;/Users/long/Downloads&#39;</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>

<span class="n">status_info</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
        <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
        <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="n">status_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">df_status_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">files</span><span class="p">,</span>
    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">status_info</span>
<span class="p">})</span>

<span class="n">df_status_info</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_status_info</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/Users/long/Downloads/&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>


<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">status_file_urls</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/statusreport&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">:])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_names</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_status_info</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;file_name&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;status_x&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>



<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;OH_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;OH_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;OH_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;OH_Leginfo.json&#39;</span><span class="p">)</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;OH_leginfo_clean.csv&quot;</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;OH_Leginfo.csv&#39;</span><span class="p">)</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Unnamed: 0.2&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">datasource</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">if</span> <span class="s1">&#39;pdf&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">])</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">])</span>


<span class="n">status_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;status-report-of-legislation.xlsx&#39;</span><span class="p">)</span>


<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;https://www.legislature.ohio.gov/legislation/&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">status_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>


<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;status_y&#39;</span><span class="p">]:</span>
    <span class="c1">#print(status)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Consideration&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s1">&#39;19&#39;</span> <span class="o">+</span> <span class="n">year</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s1">&#39;20&#39;</span> <span class="o">+</span> <span class="n">year</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>


<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">years</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;introduced&#39;</span><span class="p">]</span>


<span class="n">nan_df</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">][</span><span class="mi">492</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1999&#39;</span>
<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">][</span><span class="mi">493</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1999&#39;</span>
<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">][</span><span class="mi">566</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;2001&#39;</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">datasource</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="c1">#print(row[1][&#39;key&#39;])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="s1">&#39;introduced&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="s1">&#39;status_y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Consideration&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="s1">&#39;status_y&#39;</span><span class="p">)</span>


        <span class="n">status_df</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status_df</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="n">status_df</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="n">status_df</span><span class="p">[</span><span class="s1">&#39;Number&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="c1"># End of OH_Leginfo.py</span>


        <span class="c1"># Start of ND_Leginfo.py</span>

        <span class="c1"># import libraries</span>
        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
        <span class="kn">import</span> <span class="nn">os</span>
        <span class="kn">import</span> <span class="nn">re</span>
        <span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
        <span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">word_tokenize</span>
        <span class="kn">from</span> <span class="nn">word_forms.word_forms</span> <span class="kn">import</span> <span class="n">get_word_forms</span>
        <span class="kn">import</span> <span class="nn">datefinder</span>
        <span class="kn">from</span> <span class="nn">dateutil</span> <span class="kn">import</span> <span class="n">parser</span>
        <span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
        <span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
        <span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.options</span> <span class="kn">import</span> <span class="n">Options</span>
        <span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
        <span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
        <span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
        <span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
        <span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
        <span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
        <span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
        <span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
        <span class="c1">## others</span>
        <span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
        <span class="kn">import</span> <span class="nn">datefinder</span>
        <span class="kn">import</span> <span class="nn">calendar</span>
        <span class="kn">import</span> <span class="nn">os</span>
        <span class="kn">import</span> <span class="nn">unittest</span>
        <span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
        <span class="kn">import</span> <span class="nn">PyPDF2</span>
        <span class="kn">import</span> <span class="nn">glob</span>
        <span class="kn">import</span> <span class="nn">pickle</span>
        <span class="kn">import</span> <span class="nn">inflect</span>
        <span class="kn">import</span> <span class="nn">time</span>
        <span class="kn">import</span> <span class="nn">requests</span>
        <span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">import</span> <span class="nn">fitz</span>


        <span class="c1"># Set the working directory</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Volumes/SSD/AFRI/Data/&#39;</span><span class="p">)</span>

        <span class="c1"># Verify the current working directory</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>


        <span class="n">urls</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">sessionurls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://ndlegis.gov/session-laws/&quot;</span><span class="p">)</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;div.view-content ul li a&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">sessions</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div.view-content ul li a&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">session</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sessions</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">sessionurl</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="n">sessionurls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sessionurl</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">sessionurl</span> <span class="ow">in</span> <span class="n">sessionurls</span><span class="p">[:</span><span class="mi">33</span><span class="p">]:</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sessionurl</span><span class="p">)</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_link_text</span><span class="p">(</span><span class="s2">&quot;Chapter Categories&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">chapters</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div.field-items ul li a&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">chapter</span> <span class="ow">in</span> <span class="n">chapters</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">chapter</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
                <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">sessionurl</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;urls are done&quot;</span><span class="p">)</span>

<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;C:/Users/longy/OneDrive/Projects/AFRI/data/ND/&quot;</span>
    <span class="n">list_of_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>
    <span class="n">latest_file</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">list_of_files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getctime</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">latest_file</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">latest_file</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>  <span class="c1"># open in readonly mode</span>
        <span class="c1"># creating a pdf File object of original pdf</span>
        <span class="n">pdfFileObj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">latest_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">pdfReader</span> <span class="o">=</span> <span class="n">PyPDF2</span><span class="o">.</span><span class="n">PdfFileReader</span><span class="p">(</span><span class="n">pdfFileObj</span><span class="p">)</span>
        <span class="n">pagenumber</span> <span class="o">=</span> <span class="n">pdfReader</span><span class="o">.</span><span class="n">numPages</span>
        <span class="n">acttxt</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pagenumber</span><span class="p">):</span>
            <span class="n">pageObj</span> <span class="o">=</span> <span class="n">pdfReader</span><span class="o">.</span><span class="n">getPage</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">pageObj</span><span class="o">.</span><span class="n">extractText</span><span class="p">()</span>
            <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
            <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="n">acttxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;C:/Users/longy/OneDrive/Projects/AFRI/data/ND/&quot;</span>
<span class="n">list_of_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>
<span class="c1">#latest_file = max(list_of_files, key=os.path.getctime)</span>
<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_files</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">file</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>  <span class="c1"># open in readonly mode</span>
        <span class="c1"># creating a pdf File object of original pdf</span>
        <span class="n">pdfFileObj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">pdfReader</span> <span class="o">=</span> <span class="n">PyPDF2</span><span class="o">.</span><span class="n">PdfFileReader</span><span class="p">(</span><span class="n">pdfFileObj</span><span class="p">)</span>
        <span class="n">pagenumber</span> <span class="o">=</span> <span class="n">pdfReader</span><span class="o">.</span><span class="n">numPages</span>
        <span class="n">acttxt</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pagenumber</span><span class="p">):</span>
            <span class="n">pageObj</span> <span class="o">=</span> <span class="n">pdfReader</span><span class="o">.</span><span class="n">getPage</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">pageObj</span><span class="o">.</span><span class="n">extractText</span><span class="p">()</span>
            <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
            <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="n">acttxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Link to full text&#39;</span><span class="p">:</span><span class="n">urls</span><span class="p">,</span>
    <span class="s1">&#39;Full text&#39;</span><span class="p">:</span> <span class="n">acttxts</span>
<span class="p">})</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Full text&#39;</span><span class="p">:</span> <span class="n">acttxts</span>
<span class="p">})</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;ND_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;ND_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;ND_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;ND_Leginfo.json&#39;</span><span class="p">)</span>




<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;ND_Leginfo.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">k</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>




<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="k">def</span> <span class="nf">get_mdls_where_from</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;mdls&#39;</span><span class="p">,</span> <span class="s1">&#39;-name&#39;</span><span class="p">,</span> <span class="s1">&#39;kMDItemWhereFroms&#39;</span><span class="p">,</span> <span class="s1">&#39;-raw&#39;</span><span class="p">,</span> <span class="n">file_path</span><span class="p">],</span>
                                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">where_from_info</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">where_from_info</span><span class="p">:</span>
                <span class="c1"># The output might be a JSON-like list, so we print it directly</span>
                <span class="k">return</span> <span class="n">where_from_info</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No &#39;Where from&#39; information available.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error running mdls command: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>


<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;Raw_Data/ND/PDFs&quot;</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
        <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
        <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="n">acttxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">acttxts</span><span class="p">,</span>
<span class="p">})</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;ND_Leginfo_AAEA.csv&#39;</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;ND_Leginfo_AAEA.csv&#39;</span><span class="p">)</span>


<span class="c1"># New list to hold the split strings</span>
<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Loop through each string in the example list</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]:</span>
    <span class="c1"># Split the string by &#39;Filed&#39;</span>
    <span class="n">split_parts</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Filed&#39;</span><span class="p">)</span>
    <span class="c1"># Extend the new list with the resulting parts</span>
    <span class="n">acttxts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">split_parts</span><span class="p">)</span>

<span class="c1"># Print the new list</span>
<span class="nb">print</span><span class="p">(</span><span class="n">new_list</span><span class="p">)</span>


<span class="n">acttxts</span>


<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">acttxts</span><span class="p">,</span>
<span class="p">})</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">]</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">])</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1975</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2021</span><span class="p">)]</span>

<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;Raw_Data/Cleaned/ND_leginfo_clean.csv&quot;</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;Raw_Data/ND/ND_leginfo_clean.csv&quot;</span><span class="p">)</span>


<span class="c1"># End of ND_Leginfo.py</span>


<span class="c1"># Start of AK_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="c1">## others</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="c1">#import fitz</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="c1"># set up working directory</span>
<span class="n">working_directory</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">))</span>

<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;./PDFs/&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>

<span class="c1"># Create a Firefox profile and configure preferences</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>


<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span><span class="o">=</span><span class="s1">&#39;./geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="c1"># Initialize the WebDriver with the specified path</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">service</span><span class="p">)</span>


<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">chapter_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">subtitles</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bill_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">broken_act_urls</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://www.arkleg.state.ar.us/Acts/SearchByRange?ddBienniumSession&#39;</span><span class="p">)</span>
<span class="c1"># accept cookies button</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;a.btn&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="n">session_elements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;#ddBienniumSessionActsSearchByRange option&#39;</span><span class="p">)</span>
<span class="n">session_texts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">session_text</span> <span class="ow">in</span> <span class="n">session_elements</span><span class="p">:</span>
    <span class="n">session_texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session_text</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="k">for</span> <span class="n">session_text</span> <span class="ow">in</span> <span class="n">session_texts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">session_text</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Attempt to convert the value to an integer</span>
        <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">session_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">year</span> <span class="o">&gt;</span> <span class="mi">2021</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">select</span> <span class="o">=</span> <span class="n">Select</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;#ddBienniumSessionActsSearchByRange&#39;</span><span class="p">))</span>
            <span class="n">select</span><span class="o">.</span><span class="n">select_by_visible_text</span><span class="p">(</span><span class="n">session_text</span><span class="p">)</span>
            <span class="c1"># clear starting act number and ending act number</span>
            <span class="n">starting_num</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;#startAct&#39;</span><span class="p">)</span>
            <span class="n">starting_num</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">starting_num</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ending_num</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;#endAct&#39;</span><span class="p">)</span>
            <span class="n">ending_num</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">ending_num</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="mi">9999</span><span class="p">)</span>
            <span class="c1"># startAct</span>
            <span class="n">search_button</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div.form-row:nth-child(5) &gt; button:nth-child(1)&#39;</span><span class="p">)</span>
            <span class="n">search_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

            <span class="c1"># for page 1</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div.row.tableRow, div.row.tableRowAlt&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="c1">#years.append(year)</span>
                <span class="c1">#sessions.append(session_text)</span>
                <span class="n">chapter_num</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="n">chapter_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chapter_num</span><span class="p">)</span>
                <span class="n">subtitles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(3)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="n">act_url</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s1">&#39;PDF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
                <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>

                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">session_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;chap&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">chapter_num</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.pdf&quot;</span>
                <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

                <span class="n">path</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">+</span> <span class="n">name</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.005</span><span class="p">)</span>

                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
                <span class="c1"># Ensure the request was successful</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                    <span class="c1"># Write the content of the response to a file</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
                    <span class="n">broken_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># for page 2-n</span>
            <span class="n">page_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;div.row:nth-child(25) &gt; div:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;of &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div.row.tableRow, div.row.tableRowAlt&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                    <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
                    <span class="n">sessions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session_text</span><span class="p">)</span>
                    <span class="n">chapter_num</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                    <span class="n">chapter_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chapter_num</span><span class="p">)</span>
                    <span class="n">subtitles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(2)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                    <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;:nth-child(3)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                    <span class="n">act_url</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s1">&#39;PDF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
                    <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>

                    <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">session_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;chap&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">chapter_num</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.pdf&quot;</span>
                    <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

                    <span class="n">path</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">+</span> <span class="n">name</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.005</span><span class="p">)</span>

                    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
                    <span class="c1"># Ensure the request was successful</span>
                    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                        <span class="c1"># Write the content of the response to a file</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
                        <span class="n">broken_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Users/long/Downloads/AR/&quot;</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">[:</span><span class="mi">20</span><span class="p">]:</span>
    <span class="n">pdfFileObj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
    <span class="n">pdfReader</span> <span class="o">=</span> <span class="n">PyPDF2</span><span class="o">.</span><span class="n">PdfFileReader</span><span class="p">(</span><span class="n">pdfFileObj</span><span class="p">)</span>
    <span class="n">numpages</span> <span class="o">=</span> <span class="n">pdfReader</span><span class="o">.</span><span class="n">numPages</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numpages</span><span class="p">):</span>
        <span class="n">pgtxt</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">pdfReader</span><span class="o">.</span><span class="n">getPage</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
    <span class="n">acttxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
    <span class="n">pdfFileObj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;./PDFs&quot;</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
        <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
        <span class="n">act_txt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_txt</span><span class="p">)</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">act_txts</span><span class="p">,</span>
    <span class="s1">&#39;year&#39;</span><span class="p">:</span><span class="n">years</span><span class="p">,</span>
    <span class="s1">&#39;chapter_num&#39;</span><span class="p">:</span><span class="n">chapter_nums</span><span class="p">,</span>
    <span class="s1">&#39;subtitle&#39;</span><span class="p">:</span><span class="n">subtitles</span><span class="p">,</span>
    <span class="s1">&#39;bill_num&#39;</span><span class="p">:</span><span class="n">bill_nums</span><span class="p">,</span>
    <span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="n">filenames</span><span class="p">,</span>
    <span class="s1">&#39;act_url&#39;</span><span class="p">:</span><span class="n">act_urls</span><span class="p">,</span>
    <span class="s1">&#39;session&#39;</span><span class="p">:</span><span class="n">sessions</span>
<span class="p">})</span>

<span class="c1"># save bill info into files</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;AR_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;AR_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;AR_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;AR_Leginfo.json&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;done&quot;</span><span class="p">)</span>
<span class="c1"># End of AK_Leginfo.py</span>


<span class="c1"># Start of DC_Leginfo.py</span>

<span class="c1"># %%</span>
<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">import</span> <span class="nn">selenium</span>

<span class="nb">print</span><span class="p">(</span><span class="n">selenium</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="c1">## others</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">fitz</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="c1"># set up working directory</span>
<span class="n">working_directory</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/DC&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">))</span>

<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;./PDFs/&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>

<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span> <span class="o">=</span> <span class="s1">&#39;../../geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">service</span><span class="p">)</span>

<span class="c1"># %%</span>

<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">chapter_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">subtitles</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bill_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">broken_act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">expired_dates</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># go the website and select Bill under the Legislation Category; enated, expired, Official law under the status, click download</span>
<span class="c1"># https://lims.dccouncil.gov/searchresult/currentPage=1&amp;documentSearch=false&amp;refinBy[0]=statusId%3A%20Expired&amp;refinBy[1]=statusId%3A%20Enacted&amp;refinBy[2]=statusId%3A%20Official%20Law&amp;refinBy[3]=legislationCategoryId%3A%20Bill&amp;searchString=</span>
<span class="c1"># download &#39;/Volumes/SSD/AFRI/Data/Raw_Data/DC/PDFs&#39;</span>


<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://lims.dccouncil.gov/searchresult/documentSearch=false&amp;searchString=&#39;</span><span class="p">)</span>

<span class="c1">#More under Legislation Category</span>
<span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div.widget:nth-child(2) &gt; div:nth-child(3) &gt; a:nth-child(1) &gt; span:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<span class="c1"># select bill</span>
<span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div.widget:nth-child(2) &gt; div:nth-child(2) &gt; ul:nth-child(1) &gt; li:nth-child(2) &gt; div:nth-child(1) &gt; label:nth-child(2)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

<span class="c1">#More under Status</span>
<span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div.widget:nth-child(4) &gt; div:nth-child(3) &gt; a:nth-child(1) &gt; span:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<span class="c1"># select Enacted</span>
<span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div.widget:nth-child(4) &gt; div:nth-child(2) &gt; ul:nth-child(1) &gt; li:nth-child(1) &gt; div:nth-child(1) &gt; label:nth-child(2)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<span class="c1"># select Expired</span>
<span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div.widget:nth-child(4) &gt; div:nth-child(2) &gt; ul:nth-child(1) &gt; li:nth-child(2) &gt; div:nth-child(1) &gt; label:nth-child(2)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<span class="c1"># select Official Law</span>
<span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div.widget:nth-child(4) &gt; div:nth-child(2) &gt; ul:nth-child(1) &gt; li:nth-child(4) &gt; div:nth-child(1) &gt; label:nth-child(2)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

<span class="c1"># more period</span>
<span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div.widget:nth-child(1) &gt; div:nth-child(3) &gt; a:nth-child(1) &gt; span:nth-child(1)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

<span class="c1"># select period and download</span>

<span class="n">period_elements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s1">&#39;div.widget:nth-child(1) &gt; div:nth-child(2) &gt; ul:nth-child(1) &gt; li &gt; div:nth-child(1) &gt; label:nth-child(2)&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">period_elements</span><span class="p">:</span>

    <span class="n">element</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s1">&#39;Download&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

    <span class="n">element</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

<span class="c1"># Initialize an empty DataFrame to hold all appended data</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="c1"># Iterate over all files in the specified directory</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">download_dir</span><span class="p">):</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="c1"># Construct the full file path</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

    <span class="c1"># Check if the file is an Excel file</span>
    <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Read the Excel file into a DataFrame</span>
            <span class="n">file_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">)</span>

            <span class="c1"># Append the DataFrame to the master DataFrame</span>
            <span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">file_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;not working&#39;</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

<span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasource</span><span class="p">[</span><span class="s1">&#39;Introduction Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#datasource = datasource[pd.notna(datasource[&#39;Act/Res Number&#39;])]</span>

<span class="c1"># Reset the index</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">datasource</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://lims.dccouncil.gov/Legislation/&#39;</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Legislation Number&#39;</span><span class="p">]</span>
    <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">broken_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.01</span><span class="p">)</span>

        <span class="n">session_elements</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_all_elements_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s1">&#39;Enrollment&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Enrollment link not found, trying Introduction link...&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span> <span class="s1">&#39;View Introduction&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Introduction link not found, trying download icon...&quot;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Assuming &#39;i.download.icon&#39; is a CSS class, not link text</span>
                    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;i.download.icon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Download icon not found. No action could be taken.&quot;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Assuming &#39;i.download.icon&#39; is a CSS class, not link text</span>
                        <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;.download&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                    <span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Download icon not found. No action could be taken.&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">broken_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>


<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/DC/DC_Leginfo_broken_urls.csv&#39;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

<span class="n">broken_act_urls</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;urls&#39;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="n">broken_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.01</span><span class="p">)</span>

        <span class="n">session_elements</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_all_elements_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s1">&#39;Enrollment&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Enrollment link not found, trying Introduction link...&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span> <span class="s1">&#39;View Introduction&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Introduction link not found, trying download icon...&quot;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Assuming &#39;i.download.icon&#39; is a CSS class, not link text</span>
                    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;i.download.icon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Download icon not found. No action could be taken.&quot;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Assuming &#39;i.download.icon&#39; is a CSS class, not link text</span>
                        <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;.download&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                    <span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Download icon not found. No action could be taken.&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">broken_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>



<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Volumes/SSD/AFRI/Data/Raw_Data/DC/PDFs&quot;</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
        <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
        <span class="n">act_txt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_txt</span><span class="p">)</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">file_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">files</span><span class="p">,</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">act_txts</span>
<span class="p">})</span>


<span class="n">bill_nums</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">file_df</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;B\d+-\d+&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">extracted_text</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">extracted_text</span><span class="p">)</span>
        <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extracted_text</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>

<span class="n">file_df</span><span class="p">[</span><span class="s1">&#39;bill_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bill_nums</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/DC/DC_Leginfo.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">datasource</span><span class="p">,</span> <span class="n">file_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;Legislation Number&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;bill_name&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="c1"># Drop rows where &#39;file_name&#39; is NaN</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#  reset the index after dropping rows</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bill_name&#39;</span><span class="p">,</span><span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="s1">&#39;Legislation Number&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Act/Res Number&#39;</span><span class="p">:</span> <span class="s1">&#39;act_num&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>



<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;DC_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;DC_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;DC_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;DC_Leginfo.json&#39;</span><span class="p">)</span>


<span class="c1"># End of DC_Leginfo.py</span>


<span class="c1"># Start of MN_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="c1">## selenium</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="c1">## others</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">fitz</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="c1"># set up working directory</span>
<span class="n">working_directory</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/SSD/AFRI/Data/Raw_Data/MN&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">working_directory</span><span class="p">))</span>

<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="c1"># Specify the desired download directory</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;./PDFs/&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>

<span class="c1"># Create a Firefox profile and configure preferences</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>


<span class="c1"># Initialize the Firefox driver with the specified options</span>
<span class="n">executable_path</span><span class="o">=</span><span class="s1">&#39;../../geckodriver&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable_path</span><span class="p">))</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">service</span> <span class="o">=</span> <span class="n">service</span><span class="p">)</span>

<span class="c1"># session years: 1975-2021</span>

<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bill_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">chapter_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">broken_act_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1975</span><span class="p">,</span> <span class="mi">2022</span><span class="p">)):</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">session_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
        <span class="c1"># there might be extra two sessions in one year.</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://www.revisor.mn.gov/laws/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">session_num</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;/&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">session_num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">session</span> <span class="o">=</span> <span class="s2">&quot;rs&quot;</span>
            <span class="c1">#&quot;regular_session&quot;</span>
        <span class="k">elif</span> <span class="n">session_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">session</span> <span class="o">=</span> <span class="s2">&quot;fs&quot;</span>
            <span class="c1">#&quot;1st special session&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">session</span> <span class="o">=</span> <span class="s2">&quot;ss&quot;</span>
            <span class="c1">#&quot;2nd special session&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Open the website in Chrome</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Wait for the page to load and find all the chapter links</span>
                <span class="n">chapter_elements</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                    <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_all_elements_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span> <span class="s2">&quot;Chapter&quot;</span><span class="p">))</span>
                <span class="p">)</span>

                <span class="n">chapter_urls</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">chapter_elements</span><span class="p">:</span>
                    <span class="n">bill_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span><span class="s1">&#39;../following-sibling::*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                    <span class="n">chapter_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span><span class="s1">&#39;..&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
                    <span class="n">chapter_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">))</span>

                <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">chapter_url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chapter_urls</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

                    <span class="nb">print</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="n">chapter_url</span><span class="p">)</span>

                    <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

                    <span class="n">sessions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="mi">1983</span><span class="p">:</span>
                        <span class="n">act_url</span> <span class="o">=</span> <span class="n">chapter_url</span>
                        <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">chapter_url</span><span class="p">)</span>

                        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">(</span>
                                <span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span>
                                 <span class="s2">&quot;PDF&quot;</span><span class="p">))</span>
                        <span class="p">)</span>
                        <span class="c1"># If accessing the URL directly fails, get the URL from the link with text &quot;PDF&quot; and navigate to it</span>
                        <span class="n">pdf_link</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span> <span class="s2">&quot;PDF&quot;</span><span class="p">)</span>
                        <span class="n">pdf_url</span> <span class="o">=</span> <span class="n">pdf_link</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>
                        <span class="n">act_url</span> <span class="o">=</span> <span class="n">pdf_url</span>
                        <span class="c1">#act_txts.append(driver.find_element(By.CSS_SELECTOR,&quot;.xtend &gt; pre:nth-child(1)&quot;).text)</span>

                    <span class="n">act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>

                    <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;chap&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">chapter_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Chapter/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">+</span> <span class="s2">&quot;.pdf&quot;</span>
                    <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

                    <span class="n">path</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">+</span> <span class="n">name</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.005</span><span class="p">)</span>

                    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
                    <span class="c1"># Ensure the request was successful</span>
                    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                        <span class="c1"># Write the content of the response to a file</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch PDF. Status code:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
                        <span class="n">broken_act_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_url</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve website content.&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>


<span class="n">act_txts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">folder_path</span> <span class="o">=</span> <span class="s2">&quot;./PDFs&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">folder_path</span><span class="p">))</span>


<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">))</span>

<span class="n">broken_files</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
            <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
            <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
            <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
        <span class="n">act_txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">broken_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;./PDFs/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>


<span class="n">datasource</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;original_text&#39;</span><span class="p">:</span> <span class="n">act_txts</span><span class="p">,</span>
    <span class="s1">&#39;bill_num&#39;</span><span class="p">:</span> <span class="n">bill_nums</span><span class="p">,</span>
    <span class="s1">&#39;chapter_num&#39;</span><span class="p">:</span> <span class="n">chapter_nums</span><span class="p">,</span>
    <span class="s1">&#39;year&#39;</span><span class="p">:</span><span class="n">years</span><span class="p">,</span>
    <span class="s1">&#39;session&#39;</span><span class="p">:</span><span class="n">sessions</span><span class="p">,</span>
    <span class="s1">&#39;link&#39;</span><span class="p">:</span> <span class="n">act_urls</span><span class="p">,</span>
    <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s2">&quot;MN&quot;</span><span class="p">,</span>
    <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="n">file_names</span>
<span class="p">})</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;link&#39;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;MN_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;MN_Leginfo.csv&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;MN_Leginfo.pkl&#39;</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;MN_Leginfo.json&#39;</span><span class="p">)</span>

<span class="c1"># End of MN_Leginfo.py</span>


<span class="c1"># Start of GA_Leginfo.py</span>

<span class="c1"># import libraries</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datefinder</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="kn">import</span> <span class="nn">glob</span>


<span class="c1"># driver_path = &#39;C:/Program Files (x86)/Google/Chrome/Application/chromedriver.exe&#39; #for windows</span>
<span class="c1"># driver_path = &#39;/Users/Yanxu/OneDrive/Projects/AgPolicyCoding/chromedriver&#39;</span>
<span class="c1"># driver = webdriver.Chrome(executable_path=DRIVER_PATH)</span>

<span class="c1"># Change the working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Users/long/OneDrive/Projects/AFRI&#39;</span><span class="p">)</span>
<span class="c1"># os.chdir(&#39;/Volumes/GoogleDrive/Shared drives/UCSC-UMN AFRI project/Data/GA&#39;)</span>
<span class="c1"># Get the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="c1"># Print the current working directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span>

<span class="n">chromeOptions</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
<span class="n">dnldpath</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;download.default_directory&quot;</span> <span class="p">:</span> <span class="s2">&quot;/Users/long/OneDrive/Projects/AFRI/data/GA/&quot;</span><span class="p">}</span>
<span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s2">&quot;prefs&quot;</span><span class="p">,</span><span class="n">dnldpath</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="s1">&#39;./chromedriver&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">chromeOptions</span><span class="p">)</span>
<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://www.legis.ga.gov/legislation/signed-by-governor&quot;</span><span class="p">)</span>
<span class="n">yrs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">seyrs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bfsums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">introdts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sigdts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">effdts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">epddtes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">introducers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">txtlks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">acttxts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">stas</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">hoscoms</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># house committee</span>
<span class="n">sponsors</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">sessions</span> <span class="o">=</span><span class="p">[]</span>
<span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">billnums</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
    <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;#session &gt; option&quot;</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">session_list</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#session &gt; option&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">session_list</span><span class="p">):</span>
    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;#session &gt; option&quot;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">session_list</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;#session &gt; option&#39;</span><span class="p">)</span>
    <span class="n">session_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">session_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>

    <span class="n">search_btn</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;button.btn.btn-primary&#39;</span><span class="p">)</span>
    <span class="n">search_btn</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;div.noResults&#39;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div.noResults&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No results found&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;div.resultCount b:nth-child(2)&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">total_bills</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;div.resultCount b:nth-child(2)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

        <span class="c1"># total_bills = 40</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_bills</span><span class="p">)</span> <span class="o">%</span> <span class="mi">20</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">total_pages</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">total_bills</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">total_pages</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">total_bills</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">total_pages</span><span class="p">)</span>

        <span class="c1"># temporary setup for developing</span>
        <span class="c1">#total_pages = 6</span>

        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_pages</span><span class="p">):</span>
            <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;.text-nowrap&quot;</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">bill_list</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;.text-nowrap&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">bill</span> <span class="ow">in</span> <span class="n">bill_list</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">bill</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
                <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="n">billnum</span> <span class="o">=</span> <span class="n">bill</span><span class="o">.</span><span class="n">text</span>
                <span class="n">billnums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">billnum</span><span class="p">)</span>
                <span class="n">sessions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;page&quot;</span><span class="p">,</span><span class="n">page</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">total_pages</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                    <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;ul &gt; li:last-child &gt; a &gt; span&quot;</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="n">next_page</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;ul &gt; li:last-child &gt; a &gt; span&#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">next_page</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;this session is done for urls&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;this session is done for urls&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;div.card div.card-body&quot;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">bfsum</span><span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;h2.card-title + div.card-text-sm&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
        <span class="c1">#Briefsummary = driver.find_elements_by_css_selector(&#39;div.card div.card-body&#39;)[1].text</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">bfsum</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">bfsums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bfsum</span><span class="p">)</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s2">&quot;div.h1.subHead&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;app-status-history-list div  table tbody&quot;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1">## Status History Dates</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;app-status-history-list div  table tbody&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

        <span class="k">if</span> <span class="s2">&quot;Senate Date Signed by Governor&quot;</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">:</span>
            <span class="n">sigdt</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Senate Date Signed by Governor&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sigdt</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;House Date Signed by Governor&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">sigdts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sigdt</span><span class="p">)</span>

        <span class="n">effdt</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; Effective Date&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">effdts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">effdt</span><span class="p">)</span>

        <span class="n">introdt</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">introdts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">introdt</span><span class="p">)</span>

        <span class="n">yr</span> <span class="o">=</span> <span class="n">effdt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">yrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yr</span><span class="p">)</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        # if (int(yr) % 2) == 0:</span>
<span class="sd">            seyr = str(int(yr) - 1) + &quot;-&quot; + str(yr)</span>
<span class="sd">        else:</span>
<span class="sd">            seyr = str(yr) + str(&quot;-&quot;) + str(int(yr) + 1)</span>
<span class="sd">        &#39;&#39;&#39;</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">effdt</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="n">effdts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">effdt</span><span class="p">)</span>
        <span class="n">sigdt</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="n">sigdts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sigdt</span><span class="p">)</span>
        <span class="n">introdt</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="n">introdts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">introdt</span><span class="p">)</span>
        <span class="n">yr</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="n">yrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yr</span><span class="p">)</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        seyr =&#39;&#39;</span>
<span class="sd">        seyrs.append(seyr)</span>
<span class="sd">        &#39;&#39;&#39;</span>

    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;li.list-inline-item&quot;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">version_btn</span> <span class="o">=</span><span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s1">&#39;li.list-inline-item&#39;</span><span class="p">)</span>
    <span class="n">version_btn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;div.col-6.justify-content-end.text-right &gt; button&quot;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">dnldbtn</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_class_name</span><span class="p">(</span><span class="s1">&#39;btn.btn-outline-primary.btn-sm.mr-2.mb-1&#39;</span><span class="p">)</span>
    <span class="n">dnldbtn</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="n">sleep</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Users/long/OneDrive/Projects/AFRI/data/GA/&quot;</span>
    <span class="n">list_of_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*.pdf&#39;</span><span class="p">))</span>
    <span class="n">latest_file</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">list_of_files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getctime</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">latest_file</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">latest_file</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>  <span class="c1"># open in readonly mode</span>
        <span class="c1"># creating a pdf File object of original pdf</span>
        <span class="n">pdfFileObj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">latest_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">pdfReader</span> <span class="o">=</span> <span class="n">PyPDF2</span><span class="o">.</span><span class="n">PdfFileReader</span><span class="p">(</span><span class="n">pdfFileObj</span><span class="p">)</span>
        <span class="n">pagenumber</span> <span class="o">=</span>  <span class="n">pdfReader</span><span class="o">.</span><span class="n">numPages</span>
        <span class="n">acttxt</span> <span class="o">=</span><span class="p">[]</span>
        <span class="n">pgtxts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pagenumber</span><span class="p">):</span>
            <span class="n">pageObj</span> <span class="o">=</span> <span class="n">pdfReader</span><span class="o">.</span><span class="n">getPage</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">pgtxt</span> <span class="o">=</span> <span class="n">pageObj</span><span class="o">.</span><span class="n">extractText</span><span class="p">()</span>
            <span class="n">pgtxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pgtxt</span><span class="p">)</span>
            <span class="n">acttxt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pgtxts</span><span class="p">)</span>
    <span class="n">acttxts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acttxt</span><span class="p">)</span>
    <span class="n">st</span> <span class="o">=</span><span class="s2">&quot;GA&quot;</span>
    <span class="n">sts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>


    <span class="nb">print</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># sleep(randint(1, 2))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloading is finished&quot;</span><span class="p">)</span>


<span class="c1">#&#39;sponsors&#39;: sponsors</span>
<span class="c1">#&#39;HouseCommittees&#39;: HouseCommittees,</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Session Year&#39;</span><span class="p">:</span> <span class="n">sessions</span><span class="p">,</span>
    <span class="s1">&#39;Bill Number&#39;</span><span class="p">:</span> <span class="n">billnums</span><span class="p">,</span>
    <span class="s1">&#39;Link to full text&#39;</span><span class="p">:</span> <span class="n">urls</span>
<span class="p">})</span>


<span class="n">datasource</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Year&#39;</span><span class="p">:</span> <span class="n">yrs</span><span class="p">,</span>
    <span class="c1"># &#39;State&#39;: sts,</span>
    <span class="s1">&#39;Session Year&#39;</span><span class="p">:</span> <span class="n">sessions</span><span class="p">,</span>
    <span class="s1">&#39;Bill Number&#39;</span><span class="p">:</span> <span class="n">billnums</span><span class="p">,</span>
    <span class="s1">&#39;Title&#39;</span><span class="p">:</span> <span class="n">titles</span><span class="p">,</span>
    <span class="s1">&#39;Brief Summary&#39;</span><span class="p">:</span> <span class="n">bfsums</span><span class="p">,</span>
    <span class="c1"># &#39;Introduced Date&#39;: introdts,</span>
    <span class="c1">#&#39;Date it was signed&#39;:sigdts,</span>
    <span class="c1"># &#39;Date effective&#39;:effdts,</span>
    <span class="c1"># &#39;Full Text&#39;:acttxts,</span>
    <span class="s1">&#39;Link to full text&#39;</span><span class="p">:</span> <span class="n">urls</span>
<span class="p">})</span>

<span class="c1">#&#39;House Committee&#39;: hoscoms,</span>
<span class="c1"># drop duplicates</span>
<span class="c1">#datasource.drop_duplicates(subset = [&#39;Bill Number&#39;],</span>
<span class="c1"># keep = &#39;first&#39;, inplace = True, ignore_index= True)</span>

<span class="c1"># save bill info into excel file</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;GA_Leginfo.xlsx&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Web-scrapting finished&quot;</span><span class="p">)</span>

<span class="c1"># End of GA_Leginfo.py</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;&gt;:5062: SyntaxWarning: invalid escape sequence &#39;\ &#39;
&lt;&gt;:5062: SyntaxWarning: invalid escape sequence &#39;\ &#39;
/var/folders/2n/rpn2g0815p9f_hyy0rt2_kf00000gn/T/ipykernel_23517/3043220956.py:5062: SyntaxWarning: invalid escape sequence &#39;\ &#39;
  driver.find_element_by_css_selector(&#39;#Bills\ Truly\ Agreed\ and\ Finally\ Passed\ by\ Effective\ Date&#39;).click()
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>  <span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">5080</span>
    <span class="o">//*</span><span class="p">[</span><span class="nd">@id</span><span class="o">=</span><span class="s2">&quot;reportgrid&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">tbody</span><span class="o">/</span><span class="n">tr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="o">^</span>
<span class="ne">SyntaxError</span>: invalid syntax
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ch6.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Chapter 6 Conclusion</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By UMN UCSC AFRI Project
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>